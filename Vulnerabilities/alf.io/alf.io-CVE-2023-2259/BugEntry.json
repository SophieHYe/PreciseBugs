{"buggy_code": ["/**\n * This file is part of alf.io.\n *\n * alf.io is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * alf.io is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with alf.io.  If not, see <http://www.gnu.org/licenses/>.\n */\npackage alfio.util;\n\nimport ch.digitalfondue.basicxlsx.Cell;\nimport ch.digitalfondue.basicxlsx.StreamingWorkbook;\nimport ch.digitalfondue.basicxlsx.Style;\nimport com.opencsv.CSVWriter;\n\nimport javax.servlet.ServletOutputStream;\nimport javax.servlet.http.HttpServletResponse;\nimport java.io.IOException;\nimport java.io.OutputStreamWriter;\nimport java.util.Arrays;\nimport java.util.function.Consumer;\nimport java.util.stream.Collectors;\nimport java.util.stream.Stream;\n\nimport static java.nio.charset.StandardCharsets.UTF_8;\n\npublic class ExportUtils {\n\n    private static final int[] BOM_MARKERS = new int[] {0xEF, 0xBB, 0xBF};\n\n    private ExportUtils() {}\n\n    public static void exportExcel(String fileName, String sheetName, String[] header, Stream<String[]> data, HttpServletResponse response) throws IOException {\n        exportExcel(fileName, response, workbook -> addSheetToWorkbook(sheetName, header, data, workbook, workbook.defineStyle().font().bold(true).build()));\n    }\n\n    public static void exportExcel(String fileName,\n                                   HttpServletResponse response,\n                                   Consumer<StreamingWorkbook> workbookConsumer) throws IOException {\n        response.setContentType(\"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\");\n        response.setHeader(\"Content-Disposition\", \"attachment; filename=\" + fileName);\n\n        try (ServletOutputStream out = response.getOutputStream(); StreamingWorkbook workbook = new StreamingWorkbook(out)) {\n            workbookConsumer.accept(workbook);\n        }\n    }\n\n    public static void addSheetToWorkbook(String sheetName,\n                                          String[] header,\n                                          Stream<String[]> data,\n                                          StreamingWorkbook workbook,\n                                          Style headerStyle) {\n        try {\n            var headerRow = StreamingWorkbook.row(Arrays.stream(header)\n                .map(v -> Cell.cell(v).withStyle(headerStyle))\n                .collect(Collectors.toList()));\n\n            var dataStream = data\n                .map(rowData -> Arrays.stream(rowData).map(Cell::cell).collect(Collectors.toList()))\n                .map(StreamingWorkbook::row);\n\n            workbook.withSheet(sheetName, Stream.concat(Stream.of(headerRow), dataStream));\n\n        } catch (IOException e) {\n            throw new IllegalStateException(e);\n        }\n    }\n\n    public static void exportCsv(String fileName, String[] header, Stream<String[]> data, HttpServletResponse response) throws IOException {\n        response.setContentType(\"text/csv;charset=UTF-8\");\n        response.setHeader(\"Content-Disposition\", \"attachment; filename=\" + fileName);\n\n        try (ServletOutputStream out = response.getOutputStream(); CSVWriter writer = new CSVWriter(new OutputStreamWriter(out, UTF_8))) {\n            for (int marker : ExportUtils.BOM_MARKERS) {\n                out.write(marker);\n            }\n            writer.writeNext(header);\n            data.forEachOrdered(writer::writeNext);\n            writer.flush();\n            out.flush();\n        }\n    }\n}\n", "<!DOCTYPE html>\n<html lang=\"en\" data-ng-app=\"adminApplication\" data-ng-csp {{#basicConfigurationNeeded}}data-basic-configuration-needed{{/basicConfigurationNeeded}} {{#devModeEnabled}}dev-mode-enabled{{/devModeEnabled}} {{#prodModeEnabled}}prod-mode-enabled{{/prodModeEnabled}}>\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\">\n    <meta name=\"_csrf\" content=\"{{_csrf.token}}\"/>\n    <meta name=\"_csrf_header\" content=\"{{_csrf.headerName}}\"/>\n    <link rel=\"stylesheet\" href=\"{{contextPath}}/resources/css/source-sans-pro.css\" />\n    <link rel=\"stylesheet\" href=\"{{contextPath}}/resources/css/bootstrap-admin.min.css\" />\n    <link rel=\"stylesheet\" href=\"{{contextPath}}/resources/bower_components/chartist/dist/chartist.min.css\">\n    <link rel=\"stylesheet\" href=\"{{contextPath}}/resources/bower_components/chartist-plugin-tooltip/dist/chartist-plugin-tooltip.css\">\n    <link rel=\"stylesheet\" href=\"{{contextPath}}/resources/css/admin.css\" />\n    <link rel=\"stylesheet\" href=\"{{contextPath}}/resources/bower_components/components-font-awesome/css/font-awesome.min.css\" />\n    <link rel=\"stylesheet\" href=\"{{contextPath}}/resources/bower_components/bootstrap-daterangepicker/daterangepicker-bs3.css\" />\n    <link rel=\"stylesheet\" href=\"{{contextPath}}/resources/bower_components/angular-bootstrap/ui-bootstrap-csp.css\"/>\n    <link rel=\"stylesheet\" href=\"{{contextPath}}/resources/bower_components/nz-toggle/dist/nz-toggle.min.css\"/>\n    <link rel=\"stylesheet\" href=\"{{contextPath}}/resources/bower_components/angular-growl-v2/build/angular-growl.min.css\"/>\n    <link rel=\"stylesheet\" href=\"{{contextPath}}/resources/bower_components/dragula.js/dist/dragula.min.css\"/>\n    <script nonce=\"{{nonce}}\">\n        window.ALFIO_CONTEXT_PATH = \"{{contextPath}}\";\n        window.USER_IS_OWNER = {{isOwner}};\n    </script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/jquery/dist/jquery.min.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/lodash/lodash.min.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/moment/min/moment-with-locales.min.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/numeral/min/numeral.min.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/angular/angular.min.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/angular-sanitize/angular-sanitize.min.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/angular-messages/angular-messages.min.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/angular-bootstrap/ui-bootstrap-tpls.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/angular-ui-router/release/angular-ui-router.min.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/ng-file-upload/ng-file-upload-shim.min.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/ng-file-upload/ng-file-upload.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/chartist/dist/chartist.min.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/chartist-plugin-accessibility/dist/chartist-plugin-accessibility.min.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/chartist-plugin-tooltip/dist/chartist-plugin-tooltip.min.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/nz-toggle/dist/nz-toggle.min.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/angular-growl-v2/build/angular-growl.min.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/angular-animate/angular-animate.min.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/qrcode-generator/js/qrcode.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/qrcode-generator/js/qrcode_UTF8.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/angular-qrcode/angular-qrcode.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/dragula.js/dist/dragula.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/angularjs-dragula/dist/angularjs-dragula.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/jsqrcode/jsqrcode.min.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/ng-app/admin-application.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/directive/admin-directive.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/filter/util.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/service/service.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/service/resource-service.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/service/organization.service.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/service/user.service.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/email/email-log.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/util/file-upload.js\"></script>\n\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/configuration/configuration.js\"></script>\n\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/additional-service/additional-service.js\"></script>\n\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/event-statistic/event-statistic.js\"></script>\n\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/expired-events-list/expired-events-list.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/active-events-list/active-events-list.js\"></script>\n\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/event-data-to-collect/event-data-to-collect.js\"></script>\n\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/promo-codes/promo-codes.js\"></script>\n\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/tickets-remove/tickets-remove.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/ticket-full-data/ticket-full-data.js\"></script>\n\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/reservation-cancel/reservation-cancel.js\"></script>\n\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/users/users.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/user-edit/user-edit.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/apikey-bulk-import/apikey-bulk-import.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/user-edit-current/user-edit-current.js\"></script>\n\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/organizations/organizations.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/organization-edit/organization-edit.js\"></script>\n\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/resources/show/resources-show.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/resources/edit/resources-edit.js\"></script>\n\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/reservation/reservation.service.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/reservation/create/reservation-create.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/reservation/import/reservation-import.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/reservation/view/reservation-view.js\"></script>\n\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/reservations-list/reservations-list.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/tickets-list/tickets-list.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/label-template/label-template.js\"></script>\n\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/extension/extension.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/extension/extension.service.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/extension/add-update/extension-add-update.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/extension/log/extension-log.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/ticket-category/ticket-category.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/group/groups.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/subscriptions/subscriptions.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/util/reservation-identifier.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/internationalization-editor/internationalization-editor.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/copy-event/copy-event.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/metadata-editor/metadata-editor.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/project-banner/project-banner.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/polls/polls.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/export-reservations/export-reservations.js\"></script>\n\n\n    <link rel=\"stylesheet\" href=\"{{contextPath}}/resources/js/admin/feature/reservation/create/reservation-create.css\" />\n\n    <script nonce=\"{{nonce}}\" type=\"text/javascript\" src=\"{{contextPath}}/resources/bower_components/bootstrap-daterangepicker/daterangepicker.js\"></script>\n    <script nonce=\"{{nonce}}\" type=\"text/javascript\" src=\"{{contextPath}}/resources/bower_components/ace-builds/src-min-noconflict/ace.js\"></script>\n    <script nonce=\"{{nonce}}\" type=\"text/javascript\" src=\"{{contextPath}}/resources/bower_components/angular-ui-ace/ui-ace.js\"></script>\n    <script nonce=\"{{nonce}}\" type=\"text/javascript\" src=\"{{contextPath}}/resources/bower_components/dexie/dist/dexie.min.js\"></script>\n    <script nonce=\"{{nonce}}\" type=\"text/javascript\" src=\"{{contextPath}}/resources/bower_components/papaparse/papaparse.min.js\"></script>\n    <script nonce=\"{{nonce}}\" type=\"text/javascript\" src=\"{{contextPath}}/resources/bower_components/checklist-model/checklist-model.js\"></script>\n    <title>Alf.io Admin</title>\n</head>\n<body>\n    <div class=\"navbar navbar-default navbar-fixed-top\" role=\"navigation\" data-ng-controller=\"MenuController as ctrl\">\n        <div class=\"container-fluid\">\n            <div class=\"row\">\n                <div class=\"col-xs-12 col-lg-11\">\n                    <div class=\"navbar-header\">\n                        <button type=\"button\" class=\"navbar-toggle\" data-ng-click=\"ctrl.toggleCollapse(ctrl.menuCollapsed)\">\n                            <span class=\"sr-only\">Toggle navigation</span>\n                            <span class=\"icon-bar\"></span>\n                            <span class=\"icon-bar\"></span>\n                            <span class=\"icon-bar\"></span>\n                        </button>\n                        <a data-ui-sref=\"index\" style=\"margin-right: 10px;\"><img alt=\"Alf.io\" src=\"{{contextPath}}/resources/images/alfio-logo.svg\" width=\"100\" height=\"50\"></a>\n                    </div>\n                    <div class=\"navbar-left\">\n                        <div class=\"collapse navbar-collapse\" data-uib-collapse=\"ctrl.menuCollapsed\">\n                            <ul class=\"nav navbar-nav\">\n                                <li data-ui-sref-active=\"active\"><a data-ui-sref=\"index\" ng-click=\"ctrl.menuCollapsed = true\">Events</a></li>\n                                {{#isOwner}}\n                                <li data-ui-sref-active=\"active\"><a data-ui-sref=\"subscriptions\" ui-sref-opts=\"{reload: true, notify: true}\" ng-click=\"ctrl.menuCollapsed = true\">Subscriptions <span class=\"label label-xs label-default\">beta</span></a></li>\n                                <li data-ui-sref-active=\"active\"><a data-ui-sref=\"organizations\" ng-click=\"ctrl.menuCollapsed = true\">Organizations</a></li>\n                                {{#isDBAuthentication}}\n                                <li data-ui-sref-active=\"active\"><a data-ui-sref=\"users\" ng-click=\"ctrl.menuCollapsed = true\">Users</a></li>\n                                {{/isDBAuthentication}}\n                                <li data-ui-sref-active=\"active\"><a data-ui-sref=\"apikey\" ng-click=\"ctrl.menuCollapsed = true\">Api Keys</a></li>\n                                <li data-ui-sref-active=\"active\"><a data-ui-sref=\"groups\" ui-sref-opts=\"{reload: true, notify: true}\" ng-click=\"ctrl.menuCollapsed = true\">Groups</a></li>\n                                <li data-ui-sref-active=\"active\"><a data-ui-sref=\"configuration.system\" ng-click=\"ctrl.menuCollapsed = true\">Configuration</a></li>\n                                {{#isAdmin}}<li data-ui-sref-active=\"active\"><a data-ui-sref=\"extension.list\" ng-click=\"ctrl.menuCollapsed = true\">Extension</a></li>{{/isAdmin}}\n                                {{/isOwner}}\n                            </ul>\n                            <ul class=\"nav navbar-nav visible-sm visible-xs\" ng-if=\"ctrl.eventName\">\n                                <li class=\"navbar-header\"><h4>Actions</h4></li>\n                                <li data-ui-sref-active=\"active\"><a data-ui-sref=\"events.single.create-reservation({eventName: ctrl.eventName})\" ng-click=\"ctrl.menuCollapsed = true\"><i class=\"fa fa-magic\"></i> create reservation</a></li>\n                                <li data-ui-sref-active=\"active\"><a data-ui-sref=\"events.single.configuration({eventName: ctrl.eventName})\" ng-click=\"ctrl.menuCollapsed = true\"><i class=\"fa fa-wrench\"></i> edit configuration</a></li>\n                                <li data-ui-sref-active=\"active\"><a data-ui-sref=\"events.single.show-resources({eventName: ctrl.eventName})\" ng-click=\"ctrl.menuCollapsed = true\"><i class=\"fa fa-file-text-o\" aria-hidden=\"true\"></i> customize templates</a></li>\n                                <li data-ui-sref-active=\"active\"><a data-ui-sref=\"events.single.compose-custom-message({eventName: ctrl.eventName})\" ng-click=\"ctrl.menuCollapsed = true\"><i class=\"fa fa-envelope\"></i> compose message</a></li>\n                                <li data-ui-sref-active=\"active\" {{^isOwner}}data-ng-if=\"!ctrl.event.expired\"{{/isOwner}}><a data-ui-sref=\"events.single.checkIn({eventName: ctrl.eventName})\" ng-click=\"ctrl.menuCollapsed = true\"><i class=\"fa fa-check\"></i> Check-in</a></li>\n                            </ul>\n                            <ul class=\"nav navbar-nav visible-sm visible-xs\" ng-if=\"ctrl.eventName\">\n                                <li class=\"navbar-header\"><h4>Download</h4></li>\n                                <li role=\"menuitem\"><a data-ng-click=\"ctrl.openFieldSelectionModal()\"><i class=\"fa fa-users\"></i> attendees' data</a></li>\n                                <li role=\"menuitem\"><a data-ng-click=\"ctrl.openWaitingQueueModal()\" ><i class=\"fa fa-group\"></i> waiting list</a></li>\n                                <li role=\"menuitem\"><a data-ng-click=\"ctrl.downloadSponsorsScan()\" ><i class=\"fa fa-barcode\"></i> sponsors scan</a></li>\n                                <li role=\"menuitem\"><a data-ng-click=\"ctrl.downloadInvoices()\" ><i class=\"fa fa-file-o\"></i> all Billing Documents (PDF)</a></li>\n                                <li role=\"menuitem\"><a data-ng-click=\"ctrl.downloadInvoices('xls')\" ><i class=\"fa fa-file-o\"></i> all Billing Documents (Excel)</a></li>\n                            </ul>\n\n                            <ul class=\"nav navbar-nav visible-sm visible-xs\" ng-if=\"ctrl.eventName\">\n                                <li class=\"navbar-header\"><h4>Status</h4></li>\n                                <li data-ui-sref-active=\"active\" waiting-queue-display-counter=\"\" data-event-name=\"ctrl.eventName\" data-style-class=\"navbar-link\"></li>\n                                <li data-ui-sref-active=\"active\" pending-payments-link=\"\" data-style-class=\"emulate-nav-pills-link\" data-event-name=\"ctrl.eventName\"></li>\n                            </ul>\n\n                            <ul class=\"nav navbar-nav visible-sm visible-xs\" ng-if=\"ctrl.eventName\">\n                                <li class=\"navbar-header\"><h4>Navigate</h4></li>\n                                <li role=\"presentation\" data-ui-sref-active=\"active\">\n                                    <a ui-sref=\"events.single.dataToCollect({eventName: ctrl.eventName})\" ng-click=\"ctrl.menuCollapsed = true\"><i class=\"fa fa-info-circle\"></i> Attendees' data to collect</a>\n                                </li>\n                                <li role=\"presentation\" data-ui-sref-active=\"active\">\n                                    <a ui-sref=\"events.single.promoCodes({eventName: ctrl.eventName})\" ng-click=\"ctrl.menuCollapsed = true\"><i class=\"fa fa-percent\"></i> Promo Codes</a>\n                                </li>\n                                <li role=\"presentation\" data-ui-sref-active=\"active\">\n                                    <a ui-sref=\"events.single.additionalServices({eventName: ctrl.eventName})\" ng-click=\"ctrl.menuCollapsed = true\"><i class=\"fa fa-money\"></i> Additional options</a>\n                                </li>\n                                <li role=\"presentation\" data-ui-sref-active=\"active\">\n                                    <a ui-sref=\"events.single.donations({eventName: ctrl.eventName})\" ng-click=\"ctrl.menuCollapsed = true\"><i class=\"fa fa-gift\"></i> Donation options</a>\n                                </li>\n                                <li role=\"presentation\" data-ui-sref-active=\"active\">\n                                    <a data-ui-sref=\"events.single.reservationsList({eventName:ctrl.eventName})\" ng-click=\"ctrl.menuCollapsed = true\"><i class=\"fa fa-ticket\"></i> Reservations</a>\n                                </li>\n                                <li role=\"presentation\" data-ui-sref-active=\"active\">\n                                    <a data-ui-sref=\"events.single.email-log({eventName:ctrl.eventName})\" ng-click=\"ctrl.menuCollapsed = true\"><i class=\"fa fa-paper-plane-o\"></i> E-mail log</a>\n                                </li>\n                            </ul>\n                            <ul class=\"nav navbar-nav visible-sm visible-xs\">\n                                <li class=\"nav-divider\"></li>\n                                <li class=\"visible-xs visible-sm\">\n                                    <div class=\"pull-left\"><a href=\"#\" class=\"navbar-link\" ng-click=\"ctrl.menuCollapsed = true\" data-ui-sref=\"edit-current-user\" title=\"click to update account details\"><i class=\"fa fa-user\"></i> {{username}}</a></div>\n                                    <div class=\"pull-right\"><a href=\"\" class=\"navbar-link\" data-ng-click=\"ctrl.doLogout('{{idpLogoutRedirectionUrl}}')\"><i class=\"fa fa-sign-out\"></i> Log out</a></div>\n                                </li>\n                            </ul>\n                        </div>\n                    </div>\n                    <div class=\"navbar-right hidden-sm hidden-xs\">\n                        <ul class=\"nav navbar-nav\">\n                            <li role=\"presentation\" class=\"navbar-text\"><i class=\"fa fa-user\"></i> Logged in as {{username}}</li>\n                            {{#isDBAuthentication}}\n                            <li role=\"presentation\" data-ui-sref-active=\"active\"> <a data-ui-sref=\"edit-current-user\" title=\"click to update account details\"><i class=\"fa fa-edit\"></i> edit account</a></li>\n                            {{/isDBAuthentication}}\n                            <li role=\"presentation\"><a href=\"\" data-ng-click=\"ctrl.doLogout('{{idpLogoutRedirectionUrl}}')\"><i class=\"fa fa-sign-out\"></i> Log out</a></li>\n                        </ul>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    <div growl></div>\n    <div data-ng-controller=\"LayoutController as ctrl\">\n        <div class=\"container-fluid menu-spacer\">\n            <div class=\"row\">\n                <div class=\"hidden-xs hidden-sm col-md-3 col-lg-2\" ng-if=\"ctrl.displaySidebar\">\n                    <alfio-sidebar></alfio-sidebar>\n                </div>\n                <div class=\"col-sm-12 col-xs-12\" ng-class=\"{'col-md-9': ctrl.displaySidebar}\">\n                    {{#errorMessage}}\n                        <div class=\"container wMarginTop10px\">\n                            <div class=\"alert alert-danger text-center\"><i class=\"fa fa-warning\"></i> <strong>{{errorMessage}}</strong></div>\n                        </div>\n                    {{/errorMessage}}\n                    <div data-ui-view></div>\n                </div>\n            </div>\n            <footer class=\"text-center\" ng-if=\"!ctrl.displaySidebar\">\n                <project-banner data-full-banner=\"{{displayProjectBanner}}\" data-alfio-version=\"'{{alfioVersion}}'\"></project-banner>\n            </footer>\n        </div>\n    </div>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/common/warning-msg.js\" async=\"true\"></script>\n</body>\n</html>"], "fixing_code": ["/**\n * This file is part of alf.io.\n *\n * alf.io is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * alf.io is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with alf.io.  If not, see <http://www.gnu.org/licenses/>.\n */\npackage alfio.util;\n\nimport ch.digitalfondue.basicxlsx.Cell;\nimport ch.digitalfondue.basicxlsx.StreamingWorkbook;\nimport ch.digitalfondue.basicxlsx.Style;\nimport com.opencsv.CSVWriter;\nimport org.apache.commons.lang3.StringUtils;\n\nimport javax.servlet.ServletOutputStream;\nimport javax.servlet.http.HttpServletResponse;\nimport java.io.IOException;\nimport java.io.OutputStreamWriter;\nimport java.util.Arrays;\nimport java.util.function.Consumer;\nimport java.util.stream.Collectors;\nimport java.util.stream.Stream;\n\nimport static java.nio.charset.StandardCharsets.UTF_8;\n\npublic class ExportUtils {\n\n    private static final int[] BOM_MARKERS = new int[] {0xEF, 0xBB, 0xBF};\n\n    private ExportUtils() {}\n\n    public static void exportExcel(String fileName, String sheetName, String[] header, Stream<String[]> data, HttpServletResponse response) throws IOException {\n        exportExcel(fileName, response, workbook -> addSheetToWorkbook(sheetName, header, data, workbook, workbook.defineStyle().font().bold(true).build()));\n    }\n\n    public static void exportExcel(String fileName,\n                                   HttpServletResponse response,\n                                   Consumer<StreamingWorkbook> workbookConsumer) throws IOException {\n        response.setContentType(\"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\");\n        response.setHeader(\"Content-Disposition\", \"attachment; filename=\" + fileName);\n\n        try (ServletOutputStream out = response.getOutputStream(); StreamingWorkbook workbook = new StreamingWorkbook(out)) {\n            workbookConsumer.accept(workbook);\n        }\n    }\n\n    public static void addSheetToWorkbook(String sheetName,\n                                          String[] header,\n                                          Stream<String[]> data,\n                                          StreamingWorkbook workbook,\n                                          Style headerStyle) {\n        try {\n            var headerRow = StreamingWorkbook.row(Arrays.stream(header)\n                .map(v -> Cell.cell(v).withStyle(headerStyle))\n                .collect(Collectors.toList()));\n\n            var dataStream = data\n                .map(rowData -> Arrays.stream(rowData).map(Cell::cell).collect(Collectors.toList()))\n                .map(StreamingWorkbook::row);\n\n            workbook.withSheet(sheetName, Stream.concat(Stream.of(headerRow), dataStream));\n\n        } catch (IOException e) {\n            throw new IllegalStateException(e);\n        }\n    }\n\n    // https://owasp.org/www-community/attacks/CSV_Injection\n    private static String escapeFormulaChar(String s) {\n        var trimmed = StringUtils.trimToEmpty(s);\n        // tab and carriage return are removed by the trimming\n        var res = trimmed;\n        if (StringUtils.startsWithAny(trimmed, \"=\", \"+\", \"-\", \"@\")) {\n            res = \"\\t\" + trimmed; // http://georgemauer.net/2017/10/07/csv-injection.html starting with a tab seems to be enough?\n        }\n        return res;\n    }\n\n    public static void exportCsv(String fileName, String[] header, Stream<String[]> data, HttpServletResponse response) throws IOException {\n        response.setContentType(\"text/csv;charset=UTF-8\");\n        response.setHeader(\"Content-Disposition\", \"attachment; filename=\" + fileName);\n\n        try (ServletOutputStream out = response.getOutputStream(); CSVWriter writer = new CSVWriter(new OutputStreamWriter(out, UTF_8))) {\n            for (int marker : ExportUtils.BOM_MARKERS) {\n                out.write(marker);\n            }\n            writer.writeNext(header);\n            data.forEachOrdered(d -> {\n                var copy = Arrays.copyOf(d, d.length);\n                for (var i = 0; i < copy.length; i++) {\n                    var res = copy[i];\n                    copy[i] = escapeFormulaChar(res);\n                }\n                writer.writeNext(copy);\n            });\n            writer.flush();\n            out.flush();\n        }\n    }\n}\n", "<!DOCTYPE html>\n<html lang=\"en\" data-ng-app=\"adminApplication\" data-ng-csp {{#basicConfigurationNeeded}}data-basic-configuration-needed{{/basicConfigurationNeeded}} {{#devModeEnabled}}dev-mode-enabled{{/devModeEnabled}} {{#prodModeEnabled}}prod-mode-enabled{{/prodModeEnabled}}>\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\">\n    <meta name=\"_csrf\" content=\"{{_csrf.token}}\"/>\n    <meta name=\"_csrf_header\" content=\"{{_csrf.headerName}}\"/>\n    <link rel=\"stylesheet\" href=\"{{contextPath}}/resources/css/source-sans-pro.css\" />\n    <link rel=\"stylesheet\" href=\"{{contextPath}}/resources/css/bootstrap-admin.min.css\" />\n    <link rel=\"stylesheet\" href=\"{{contextPath}}/resources/bower_components/chartist/dist/chartist.min.css\">\n    <link rel=\"stylesheet\" href=\"{{contextPath}}/resources/bower_components/chartist-plugin-tooltip/dist/chartist-plugin-tooltip.css\">\n    <link rel=\"stylesheet\" href=\"{{contextPath}}/resources/css/admin.css\" />\n    <link rel=\"stylesheet\" href=\"{{contextPath}}/resources/bower_components/components-font-awesome/css/font-awesome.min.css\" />\n    <link rel=\"stylesheet\" href=\"{{contextPath}}/resources/bower_components/bootstrap-daterangepicker/daterangepicker-bs3.css\" />\n    <link rel=\"stylesheet\" href=\"{{contextPath}}/resources/bower_components/angular-bootstrap/ui-bootstrap-csp.css\"/>\n    <link rel=\"stylesheet\" href=\"{{contextPath}}/resources/bower_components/nz-toggle/dist/nz-toggle.min.css\"/>\n    <link rel=\"stylesheet\" href=\"{{contextPath}}/resources/bower_components/angular-growl-v2/build/angular-growl.min.css\"/>\n    <link rel=\"stylesheet\" href=\"{{contextPath}}/resources/bower_components/dragula.js/dist/dragula.min.css\"/>\n    <script nonce=\"{{nonce}}\">\n        window.ALFIO_CONTEXT_PATH = \"{{contextPath}}\";\n        window.USER_IS_OWNER = {{isOwner}};\n    </script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/jquery/dist/jquery.min.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/lodash/lodash.min.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/moment/min/moment-with-locales.min.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/numeral/min/numeral.min.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/angular/angular.min.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/angular-sanitize/angular-sanitize.min.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/angular-messages/angular-messages.min.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/angular-bootstrap/ui-bootstrap-tpls.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/angular-ui-router/release/angular-ui-router.min.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/ng-file-upload/ng-file-upload-shim.min.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/ng-file-upload/ng-file-upload.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/chartist/dist/chartist.min.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/chartist-plugin-accessibility/dist/chartist-plugin-accessibility.min.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/chartist-plugin-tooltip/dist/chartist-plugin-tooltip.min.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/nz-toggle/dist/nz-toggle.min.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/angular-growl-v2/build/angular-growl.min.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/angular-animate/angular-animate.min.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/qrcode-generator/js/qrcode.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/qrcode-generator/js/qrcode_UTF8.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/angular-qrcode/angular-qrcode.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/dragula.js/dist/dragula.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/bower_components/angularjs-dragula/dist/angularjs-dragula.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/jsqrcode/jsqrcode.min.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/ng-app/admin-application.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/directive/admin-directive.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/filter/util.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/service/service.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/service/resource-service.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/service/organization.service.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/service/user.service.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/email/email-log.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/util/file-upload.js\"></script>\n\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/configuration/configuration.js\"></script>\n\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/additional-service/additional-service.js\"></script>\n\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/event-statistic/event-statistic.js\"></script>\n\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/expired-events-list/expired-events-list.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/active-events-list/active-events-list.js\"></script>\n\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/event-data-to-collect/event-data-to-collect.js\"></script>\n\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/promo-codes/promo-codes.js\"></script>\n\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/tickets-remove/tickets-remove.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/ticket-full-data/ticket-full-data.js\"></script>\n\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/reservation-cancel/reservation-cancel.js\"></script>\n\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/users/users.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/user-edit/user-edit.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/apikey-bulk-import/apikey-bulk-import.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/user-edit-current/user-edit-current.js\"></script>\n\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/organizations/organizations.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/organization-edit/organization-edit.js\"></script>\n\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/resources/show/resources-show.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/resources/edit/resources-edit.js\"></script>\n\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/reservation/reservation.service.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/reservation/create/reservation-create.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/reservation/import/reservation-import.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/reservation/view/reservation-view.js\"></script>\n\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/reservations-list/reservations-list.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/tickets-list/tickets-list.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/label-template/label-template.js\"></script>\n\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/extension/extension.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/extension/extension.service.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/extension/add-update/extension-add-update.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/extension/log/extension-log.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/ticket-category/ticket-category.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/group/groups.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/subscriptions/subscriptions.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/util/reservation-identifier.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/internationalization-editor/internationalization-editor.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/copy-event/copy-event.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/metadata-editor/metadata-editor.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/project-banner/project-banner.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/polls/polls.js\"></script>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/admin/feature/export-reservations/export-reservations.js\"></script>\n\n\n    <link rel=\"stylesheet\" href=\"{{contextPath}}/resources/js/admin/feature/reservation/create/reservation-create.css\" />\n\n    <script nonce=\"{{nonce}}\" type=\"text/javascript\" src=\"{{contextPath}}/resources/bower_components/bootstrap-daterangepicker/daterangepicker.js\"></script>\n    <script nonce=\"{{nonce}}\" type=\"text/javascript\" src=\"{{contextPath}}/resources/bower_components/ace-builds/src-min-noconflict/ace.js\"></script>\n    <script nonce=\"{{nonce}}\" type=\"text/javascript\" src=\"{{contextPath}}/resources/bower_components/angular-ui-ace/ui-ace.js\"></script>\n    <script nonce=\"{{nonce}}\" type=\"text/javascript\" src=\"{{contextPath}}/resources/bower_components/dexie/dist/dexie.min.js\"></script>\n    <script nonce=\"{{nonce}}\" type=\"text/javascript\" src=\"{{contextPath}}/resources/bower_components/papaparse/papaparse.min.js\"></script>\n    <script nonce=\"{{nonce}}\" type=\"text/javascript\" src=\"{{contextPath}}/resources/bower_components/checklist-model/checklist-model.js\"></script>\n    <title>Alf.io Admin</title>\n</head>\n<body>\n    <div class=\"navbar navbar-default navbar-fixed-top\" role=\"navigation\" data-ng-controller=\"MenuController as ctrl\">\n        <div class=\"container-fluid\">\n            <div class=\"row\">\n                <div class=\"col-xs-12 col-lg-11\">\n                    <div class=\"navbar-header\">\n                        <button type=\"button\" class=\"navbar-toggle\" data-ng-click=\"ctrl.toggleCollapse(ctrl.menuCollapsed)\">\n                            <span class=\"sr-only\">Toggle navigation</span>\n                            <span class=\"icon-bar\"></span>\n                            <span class=\"icon-bar\"></span>\n                            <span class=\"icon-bar\"></span>\n                        </button>\n                        <a data-ui-sref=\"index\" style=\"margin-right: 10px;\"><img alt=\"Alf.io\" src=\"{{contextPath}}/resources/images/alfio-logo.svg\" width=\"100\" height=\"50\"></a>\n                    </div>\n                    <div class=\"navbar-left\">\n                        <div class=\"collapse navbar-collapse\" data-uib-collapse=\"ctrl.menuCollapsed\">\n                            <ul class=\"nav navbar-nav\">\n                                <li data-ui-sref-active=\"active\"><a data-ui-sref=\"index\" ng-click=\"ctrl.menuCollapsed = true\">Events</a></li>\n                                {{#isOwner}}\n                                <li data-ui-sref-active=\"active\"><a data-ui-sref=\"subscriptions\" ui-sref-opts=\"{reload: true, notify: true}\" ng-click=\"ctrl.menuCollapsed = true\">Subscriptions <span class=\"label label-xs label-default\">beta</span></a></li>\n                                <li data-ui-sref-active=\"active\"><a data-ui-sref=\"organizations\" ng-click=\"ctrl.menuCollapsed = true\">Organizations</a></li>\n                                {{#isDBAuthentication}}\n                                <li data-ui-sref-active=\"active\"><a data-ui-sref=\"users\" ng-click=\"ctrl.menuCollapsed = true\">Users</a></li>\n                                {{/isDBAuthentication}}\n                                <li data-ui-sref-active=\"active\"><a data-ui-sref=\"apikey\" ng-click=\"ctrl.menuCollapsed = true\">Api Keys</a></li>\n                                <li data-ui-sref-active=\"active\"><a data-ui-sref=\"groups\" ui-sref-opts=\"{reload: true, notify: true}\" ng-click=\"ctrl.menuCollapsed = true\">Groups</a></li>\n                                <li data-ui-sref-active=\"active\"><a data-ui-sref=\"configuration.system\" ng-click=\"ctrl.menuCollapsed = true\">Configuration</a></li>\n                                {{#isAdmin}}<li data-ui-sref-active=\"active\"><a data-ui-sref=\"extension.list\" ng-click=\"ctrl.menuCollapsed = true\">Extension</a></li>{{/isAdmin}}\n                                {{/isOwner}}\n                            </ul>\n                            <ul class=\"nav navbar-nav visible-sm visible-xs\" ng-if=\"ctrl.eventName\">\n                                <li class=\"navbar-header\"><h4>Actions</h4></li>\n                                <li data-ui-sref-active=\"active\"><a data-ui-sref=\"events.single.create-reservation({eventName: ctrl.eventName})\" ng-click=\"ctrl.menuCollapsed = true\"><i class=\"fa fa-magic\"></i> create reservation</a></li>\n                                <li data-ui-sref-active=\"active\"><a data-ui-sref=\"events.single.configuration({eventName: ctrl.eventName})\" ng-click=\"ctrl.menuCollapsed = true\"><i class=\"fa fa-wrench\"></i> edit configuration</a></li>\n                                <li data-ui-sref-active=\"active\"><a data-ui-sref=\"events.single.show-resources({eventName: ctrl.eventName})\" ng-click=\"ctrl.menuCollapsed = true\"><i class=\"fa fa-file-text-o\" aria-hidden=\"true\"></i> customize templates</a></li>\n                                <li data-ui-sref-active=\"active\"><a data-ui-sref=\"events.single.compose-custom-message({eventName: ctrl.eventName})\" ng-click=\"ctrl.menuCollapsed = true\"><i class=\"fa fa-envelope\"></i> compose message</a></li>\n                                <li data-ui-sref-active=\"active\" {{^isOwner}}data-ng-if=\"!ctrl.event.expired\"{{/isOwner}}><a data-ui-sref=\"events.single.checkIn({eventName: ctrl.eventName})\" ng-click=\"ctrl.menuCollapsed = true\"><i class=\"fa fa-check\"></i> Check-in</a></li>\n                            </ul>\n                            <ul class=\"nav navbar-nav visible-sm visible-xs\" ng-if=\"ctrl.eventName\">\n                                <li class=\"navbar-header\"><h4>Download</h4></li>\n                                <li role=\"menuitem\"><a data-ng-click=\"ctrl.openFieldSelectionModal()\"><i class=\"fa fa-users\"></i> attendees' data</a></li>\n                                <li role=\"menuitem\"><a data-ng-click=\"ctrl.openWaitingQueueModal()\" ><i class=\"fa fa-group\"></i> waiting list</a></li>\n                                <li role=\"menuitem\"><a data-ng-click=\"ctrl.downloadSponsorsScan()\" ><i class=\"fa fa-barcode\"></i> sponsors scan</a></li>\n                                <li role=\"menuitem\"><a data-ng-click=\"ctrl.downloadInvoices()\" ><i class=\"fa fa-file-o\"></i> all Billing Documents (PDF)</a></li>\n                                <li role=\"menuitem\"><a data-ng-click=\"ctrl.downloadInvoices('xls')\" ><i class=\"fa fa-file-o\"></i> all Billing Documents (Excel)</a></li>\n                            </ul>\n\n                            <ul class=\"nav navbar-nav visible-sm visible-xs\" ng-if=\"ctrl.eventName\">\n                                <li class=\"navbar-header\"><h4>Status</h4></li>\n                                <li data-ui-sref-active=\"active\" waiting-queue-display-counter=\"\" data-event-name=\"ctrl.eventName\" data-style-class=\"navbar-link\"></li>\n                                <li data-ui-sref-active=\"active\" pending-payments-link=\"\" data-style-class=\"emulate-nav-pills-link\" data-event-name=\"ctrl.eventName\"></li>\n                            </ul>\n\n                            <ul class=\"nav navbar-nav visible-sm visible-xs\" ng-if=\"ctrl.eventName\">\n                                <li class=\"navbar-header\"><h4>Navigate</h4></li>\n                                <li role=\"presentation\" data-ui-sref-active=\"active\">\n                                    <a ui-sref=\"events.single.dataToCollect({eventName: ctrl.eventName})\" ng-click=\"ctrl.menuCollapsed = true\"><i class=\"fa fa-info-circle\"></i> Attendees' data to collect</a>\n                                </li>\n                                <li role=\"presentation\" data-ui-sref-active=\"active\">\n                                    <a ui-sref=\"events.single.promoCodes({eventName: ctrl.eventName})\" ng-click=\"ctrl.menuCollapsed = true\"><i class=\"fa fa-percent\"></i> Promo Codes</a>\n                                </li>\n                                <li role=\"presentation\" data-ui-sref-active=\"active\">\n                                    <a ui-sref=\"events.single.additionalServices({eventName: ctrl.eventName})\" ng-click=\"ctrl.menuCollapsed = true\"><i class=\"fa fa-money\"></i> Additional options</a>\n                                </li>\n                                <li role=\"presentation\" data-ui-sref-active=\"active\">\n                                    <a ui-sref=\"events.single.donations({eventName: ctrl.eventName})\" ng-click=\"ctrl.menuCollapsed = true\"><i class=\"fa fa-gift\"></i> Donation options</a>\n                                </li>\n                                <li role=\"presentation\" data-ui-sref-active=\"active\">\n                                    <a data-ui-sref=\"events.single.reservationsList({eventName:ctrl.eventName})\" ng-click=\"ctrl.menuCollapsed = true\"><i class=\"fa fa-ticket\"></i> Reservations</a>\n                                </li>\n                                <li role=\"presentation\" data-ui-sref-active=\"active\">\n                                    <a data-ui-sref=\"events.single.email-log({eventName:ctrl.eventName})\" ng-click=\"ctrl.menuCollapsed = true\"><i class=\"fa fa-paper-plane-o\"></i> E-mail log</a>\n                                </li>\n                            </ul>\n                            <ul class=\"nav navbar-nav visible-sm visible-xs\">\n                                <li class=\"nav-divider\"></li>\n                                <li class=\"visible-xs visible-sm\">\n                                    <div class=\"pull-left\"><a href=\"#\" class=\"navbar-link\" ng-click=\"ctrl.menuCollapsed = true\" data-ui-sref=\"edit-current-user\" title=\"click to update account details\"><i class=\"fa fa-user\"></i> <span ng-non-bindable>{{username}}</span></a></div>\n                                    <div class=\"pull-right\"><a href=\"\" class=\"navbar-link\" data-ng-click=\"ctrl.doLogout('{{idpLogoutRedirectionUrl}}')\"><i class=\"fa fa-sign-out\"></i> Log out</a></div>\n                                </li>\n                            </ul>\n                        </div>\n                    </div>\n                    <div class=\"navbar-right hidden-sm hidden-xs\">\n                        <ul class=\"nav navbar-nav\">\n                            <li role=\"presentation\" class=\"navbar-text\"><i class=\"fa fa-user\"></i> Logged in as <span ng-non-bindable>{{username}}</span></li>\n                            {{#isDBAuthentication}}\n                            <li role=\"presentation\" data-ui-sref-active=\"active\"> <a data-ui-sref=\"edit-current-user\" title=\"click to update account details\"><i class=\"fa fa-edit\"></i> edit account</a></li>\n                            {{/isDBAuthentication}}\n                            <li role=\"presentation\"><a href=\"\" data-ng-click=\"ctrl.doLogout('{{idpLogoutRedirectionUrl}}')\"><i class=\"fa fa-sign-out\"></i> Log out</a></li>\n                        </ul>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    <div growl></div>\n    <div data-ng-controller=\"LayoutController as ctrl\">\n        <div class=\"container-fluid menu-spacer\">\n            <div class=\"row\">\n                <div class=\"hidden-xs hidden-sm col-md-3 col-lg-2\" ng-if=\"ctrl.displaySidebar\">\n                    <alfio-sidebar></alfio-sidebar>\n                </div>\n                <div class=\"col-sm-12 col-xs-12\" ng-class=\"{'col-md-9': ctrl.displaySidebar}\">\n                    {{#errorMessage}}\n                        <div class=\"container wMarginTop10px\">\n                            <div class=\"alert alert-danger text-center\"><i class=\"fa fa-warning\"></i> <strong>{{errorMessage}}</strong></div>\n                        </div>\n                    {{/errorMessage}}\n                    <div data-ui-view></div>\n                </div>\n            </div>\n            <footer class=\"text-center\" ng-if=\"!ctrl.displaySidebar\">\n                <project-banner data-full-banner=\"{{displayProjectBanner}}\" data-alfio-version=\"'{{alfioVersion}}'\"></project-banner>\n            </footer>\n        </div>\n    </div>\n    <script nonce=\"{{nonce}}\" src=\"{{contextPath}}/resources/js/common/warning-msg.js\" async=\"true\"></script>\n</body>\n</html>"], "buggy_code_start_loc": [22, 198], "buggy_code_end_loc": [87, 207], "fixing_code_start_loc": [23, 198], "fixing_code_end_loc": [106, 207], "type": "CWE-94", "message": "Improper Neutralization of Special Elements Used in a Template Engine in GitHub repository alfio-event/alf.io prior to 2.0-M4-2304.", "other": {"cve": {"id": "CVE-2023-2259", "sourceIdentifier": "security@huntr.dev", "published": "2023-04-24T21:15:09.547", "lastModified": "2023-05-03T20:01:59.110", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Improper Neutralization of Special Elements Used in a Template Engine in GitHub repository alfio-event/alf.io prior to 2.0-M4-2304."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "HIGH", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 7.2, "baseSeverity": "HIGH"}, "exploitabilityScore": 1.2, "impactScore": 5.9}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:H/UI:N/S:C/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "HIGH", "userInteraction": "NONE", "scope": "CHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.1, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 2.3, "impactScore": 6.0}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-94"}]}, {"source": "security@huntr.dev", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-1336"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:alf:alf:*:*:*:*:*:*:*:*", "versionEndExcluding": "2.0-m4-2304", "matchCriteriaId": "DB945ACA-B596-417D-9832-1137D9B9C640"}]}]}], "references": [{"url": "https://github.com/alfio-event/alf.io/commit/94e2923a317452e337393789c9f3192dfc1ddac2", "source": "security@huntr.dev", "tags": ["Patch"]}, {"url": "https://huntr.dev/bounties/e753bce0-ce82-463b-b344-2f67b39b60ff", "source": "security@huntr.dev", "tags": ["Exploit", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/alfio-event/alf.io/commit/94e2923a317452e337393789c9f3192dfc1ddac2"}}