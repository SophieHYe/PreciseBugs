{"buggy_code": [".. _news:\n\nRelease notes\n=============\n\n.. _release-2.6.0:\n\nScrapy 2.6.0 (2022-02-??)\n-------------------------\n\nHighlights:\n\n*   Python 3.10 support\n\n*   :ref:`asyncio support <using-asyncio>` is no longer considered\n    experimental, and works out-of-the-box on Windows regardless of your Python\n    version\n\n*   Feed exports now support :class:`pathlib.Path` output paths and per-feed\n    :ref:`item filtering <item-filter>` and\n    :ref:`post-processing <post-processing>`\n\nModified requirements\n~~~~~~~~~~~~~~~~~~~~~\n\n-   The h2_ dependency is now optional, only needed to\n    :ref:`enable HTTP/2 support <http2>`. (:issue:`5113`)\n\n    .. _h2: https://pypi.org/project/h2/\n\n\nBackward-incompatible changes\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n-   The ``formdata`` parameter of :class:`~scrapy.FormRequest`, if specified\n    for a non-POST request, now overrides the URL query string, instead of\n    being appended to it. (:issue:`2919`, :issue:`3579`)\n\n-   When a function is assigned to the :setting:`FEED_URI_PARAMS` setting, now\n    the return value of that function, and not the ``params`` input parameter,\n    will determine the feed URI parameters, unless that return value is\n    ``None``. (:issue:`4962`, :issue:`4966`)\n\n-   In :class:`scrapy.core.engine.ExecutionEngine`, methods\n    :meth:`~scrapy.core.engine.ExecutionEngine.crawl`,\n    :meth:`~scrapy.core.engine.ExecutionEngine.download`,\n    :meth:`~scrapy.core.engine.ExecutionEngine.schedule`,\n    and :meth:`~scrapy.core.engine.ExecutionEngine.spider_is_idle`\n    now raise :exc:`RuntimeError` if called before\n    :meth:`~scrapy.core.engine.ExecutionEngine.open_spider`. (:issue:`5090`)\n\n    These methods used to assume that\n    :attr:`ExecutionEngine.slot <scrapy.core.engine.ExecutionEngine.slot>` had\n    been defined by a prior call to\n    :meth:`~scrapy.core.engine.ExecutionEngine.open_spider`, so they were\n    raising :exc:`AttributeError` instead.\n\n-   If the API of the configured :ref:`scheduler <topics-scheduler>` does not\n    meet expectations, :exc:`TypeError` is now raised at startup time. Before,\n    other exceptions would be raised at run time. (:issue:`3559`)\n\n\nDeprecation removals\n~~~~~~~~~~~~~~~~~~~~\n\n-   ``scrapy.http.TextResponse.body_as_unicode``, deprecated in Scrapy 2.2, has\n    now been removed. (:issue:`5393`)\n\n-   ``scrapy.item.BaseItem``, deprecated in Scrapy 2.2, has now been removed.\n    (:issue:`5398`)\n\n-   ``scrapy.item.DictItem``, deprecated in Scrapy 1.8, has now been removed.\n    (:issue:`5398`)\n\n-   ``scrapy.Spider.make_requests_from_url``, deprecated in Scrapy 1.4, has now\n    been removed. (:issue:`4178`, :issue:`4356`)\n\n\nDeprecations\n~~~~~~~~~~~~\n\n-   When a function is assigned to the :setting:`FEED_URI_PARAMS` setting,\n    returning ``None`` or modifying the ``params`` input parameter is now\n    deprecated. Return a new dictionary instead. (:issue:`4962`, :issue:`4966`)\n\n-   :mod:`scrapy.utils.reqser` is deprecated. (:issue:`5130`)\n\n    -   Instead of :func:`~scrapy.utils.reqser.request_to_dict`, use the new\n        :meth:`Request.to_dict <scrapy.http.Request.to_dict>` method.\n\n    -   Instead of :func:`~scrapy.utils.reqser.request_from_dict`, use the new\n        :func:`scrapy.utils.request.request_from_dict` function.\n\n-   In :mod:`scrapy.squeues`, the following queue classes are deprecated:\n    :class:`~scrapy.squeues.PickleFifoDiskQueueNonRequest`,\n    :class:`~scrapy.squeues.PickleLifoDiskQueueNonRequest`,\n    :class:`~scrapy.squeues.MarshalFifoDiskQueueNonRequest`,\n    and :class:`~scrapy.squeues.MarshalLifoDiskQueueNonRequest`. You should\n    instead use:\n    :class:`~scrapy.squeues.PickleFifoDiskQueue`,\n    :class:`~scrapy.squeues.PickleLifoDiskQueue`,\n    :class:`~scrapy.squeues.MarshalFifoDiskQueue`,\n    and :class:`~scrapy.squeues.MarshalLifoDiskQueue`. (:issue:`5117`)\n\n-   Many aspects of :class:`scrapy.core.engine.ExecutionEngine` that come from\n    a time when this class could handle multiple :class:`~scrapy.Spider`\n    objects at a time have been deprecated. (:issue:`5090`)\n\n    -   The :meth:`~scrapy.core.engine.ExecutionEngine.has_capacity` method\n        is deprecated.\n\n    -   The :meth:`~scrapy.core.engine.ExecutionEngine.schedule` method is\n        deprecated, use :meth:`~scrapy.core.engine.ExecutionEngine.crawl` or\n        :meth:`~scrapy.core.engine.ExecutionEngine.download` instead.\n\n    -   The :attr:`~scrapy.core.engine.ExecutionEngine.open_spiders` attribute\n        is deprecated, use :attr:`~scrapy.core.engine.ExecutionEngine.spider`\n        instead.\n\n    -   The ``spider`` parameter is deprecated for the following methods:\n\n        -   :meth:`~scrapy.core.engine.ExecutionEngine.spider_is_idle`\n\n        -   :meth:`~scrapy.core.engine.ExecutionEngine.crawl`\n\n        -   :meth:`~scrapy.core.engine.ExecutionEngine.download`\n\n        Instead, call :meth:`~scrapy.core.engine.ExecutionEngine.open_spider`\n        first to set the :class:`~scrapy.Spider` object.\n\n\nNew features\n~~~~~~~~~~~~\n\n-   You can now use :ref:`item filtering <item-filter>` to control which items\n    are exported to each output feed. (:issue:`4575`, :issue:`5178`,\n    :issue:`5161`, :issue:`5203`)\n\n-   You can now apply :ref:`post-processing <post-processing>` to feeds, and\n    :ref:`built-in post-processing plugins <builtin-plugins>` are provided for\n    output file compression. (:issue:`2174`, :issue:`5168`, :issue:`5190`)\n\n-   The :setting:`FEEDS` setting now supports :class:`pathlib.Path` objects as\n    keys. (:issue:`5383`, :issue:`5384`)\n\n-   Enabling :ref:`asyncio <using-asyncio>` while using Windows and Python 3.8\n    or later will automatically switch the asyncio event loop to one that\n    allows Scrapy to work. See :ref:`asyncio-windows`. (:issue:`4976`,\n    :issue:`5315`)\n\n-   The :command:`genspider` command now supports a start URL instead of a\n    domain name. (:issue:`4439`)\n\n-   :mod:`scrapy.utils.defer` gained 2 new functions,\n    :func:`~scrapy.utils.defer.deferred_to_future` and\n    :func:`~scrapy.utils.defer.maybe_deferred_to_future`, to help :ref:`await\n    on Deferreds when using the asyncio reactor <asyncio-await-dfd>`.\n    (:issue:`5288`)\n\n-   :ref:`Amazon S3 feed export storage <topics-feed-storage-s3>` gained\n    support for `temporary security credentials`_\n    (:setting:`AWS_SESSION_TOKEN`) and endpoint customization\n    (:setting:`AWS_ENDPOINT_URL`). (:issue:`4998`, :issue:`5210`)\n\n    .. _temporary security credentials: https://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html#temporary-access-keys\n\n-   New :setting:`LOG_FILE_APPEND` setting to allow truncating the log file.\n    (:issue:`5279`)\n\n-   :attr:`Request.cookies <scrapy.Request.cookies>` values that are\n    :class:`bool`, :class:`float` or :class:`int` are cast to :class:`str`.\n    (:issue:`5252`, :issue:`5253`)\n\n-   You may now raise :exc:`~scrapy.exceptions.CloseSpider` from a handler of\n    the :signal:`spider_idle` signal to customize the reason why the spider is\n    stopping. (:issue:`5191`)\n\n-   When using\n    :class:`~scrapy.downloadermiddlewares.httpproxy.HttpProxyMiddleware`, the\n    proxy URL for non-HTTPS HTTP/1.1 requests no longer needs to include a URL\n    scheme. (:issue:`4505`, :issue:`4649`)\n\n-   All built-in queues now expose a ``peek`` method that returns the next\n    queue object (like ``pop``) but does not remove the returned object from\n    the queue. (:issue:`5112`)\n\n    If the underlying queue does not support peeking (e.g. because you are not\n    using ``queuelib`` 1.6.1 or later), the ``peek`` method raises\n    :exc:`NotImplementedError`.\n\n-   :class:`~scrapy.http.Request` and :class:`~scrapy.http.Response` now have\n    an ``attributes`` attribute that makes subclassing easier. For\n    :class:`~scrapy.http.Request`, it also allows subclasses to work with\n    :func:`scrapy.utils.request.request_from_dict`. (:issue:`1877`,\n    :issue:`5130`, :issue:`5218`)\n\n-   The :meth:`~scrapy.core.scheduler.BaseScheduler.open` and\n    :meth:`~scrapy.core.scheduler.BaseScheduler.close` methods of the\n    :ref:`scheduler <topics-scheduler>` are now optional. (:issue:`3559`)\n\n-   HTTP/1.1 :exc:`~scrapy.core.downloader.handlers.http11.TunnelError`\n    exceptions now only truncate response bodies longer than 1000 characters,\n    instead of those longer than 32 characters, making it easier to debug such\n    errors. (:issue:`4881`, :issue:`5007`)\n\n-   :class:`~scrapy.loader.ItemLoader` now supports non-text responses.\n    (:issue:`5145`, :issue:`5269`)\n\n\nBug fixes\n~~~~~~~~~\n\n-   The :setting:`TWISTED_REACTOR` and :setting:`ASYNCIO_EVENT_LOOP` settings\n    are no longer ignored if defined in :attr:`~scrapy.Spider.custom_settings`.\n    (:issue:`4485`, :issue:`5352`)\n\n-   Removed a module-level Twisted reactor import that could prevent\n    :ref:`using the asyncio reactor <using-asyncio>`. (:issue:`5357`)\n\n-   The :command:`startproject` command works with existing folders again.\n    (:issue:`4665`, :issue:`4676`)\n\n-   The :setting:`FEED_URI_PARAMS` setting now behaves as documented.\n    (:issue:`4962`, :issue:`4966`)\n\n-   :attr:`Request.cb_kwargs <scrapy.Request.cb_kwargs>` once again allows the\n    ``callback`` keyword. (:issue:`5237`, :issue:`5251`, :issue:`5264`)\n\n-   Made :func:`scrapy.utils.response.open_in_browser` support more complex\n    HTML. (:issue:`5319`, :issue:`5320`)\n\n-   Fixed :attr:`CSVFeedSpider.quotechar\n    <scrapy.spiders.CSVFeedSpider.quotechar>` being interpreted as the CSV file\n    encoding. (:issue:`5391`, :issue:`5394`)\n\n-   Added missing setuptools_ to the list of dependencies. (:issue:`5122`)\n\n    .. _setuptools: https://pypi.org/project/setuptools/\n\n-   :class:`LinkExtractor <scrapy.linkextractors.lxmlhtml.LxmlLinkExtractor>`\n    now also works as expected with links that have comma-separated ``rel``\n    attribute values including ``nofollow``. (:issue:`5225`)\n\n-   Fixed a :exc:`TypeError` that could be raised during :ref:`feed export\n    <topics-feed-exports>` parameter parsing. (:issue:`5359`)\n\n\nDocumentation\n~~~~~~~~~~~~~\n\n-   :ref:`asyncio support <using-asyncio>` is no longer considered\n    experimental. (:issue:`5332`)\n\n-   Included :ref:`Windows-specific help for asyncio usage <asyncio-windows>`.\n    (:issue:`4976`, :issue:`5315`)\n\n-   Rewrote :ref:`topics-headless-browsing` with up-to-date best practices.\n    (:issue:`4484`, :issue:`4613`)\n\n-   Documented :ref:`local file naming in media pipelines\n    <topics-file-naming>`. (:issue:`5069`, :issue:`5152`)\n\n-   :ref:`faq` now covers spider file name collision issues. (:issue:`2680`,\n    :issue:`3669`)\n\n-   Provided better context and instructions to disable the\n    :setting:`URLLENGTH_LIMIT` setting. (:issue:`5135`, :issue:`5250`)\n\n-   Documented that :ref:`reppy-parser` does not support Python 3.9+.\n    (:issue:`5226`, :issue:`5231`)\n\n-   Documented :ref:`the scheduler component <topics-scheduler>`.\n    (:issue:`3537`, :issue:`3559`)\n\n-   Documented the method used by :ref:`media pipelines\n    <topics-media-pipeline>` to :ref:`determine if a file has expired\n    <file-expiration>`. (:issue:`5120`, :issue:`5254`)\n\n-   :ref:`run-multiple-spiders` now features\n    :func:`scrapy.utils.project.get_project_settings` usage. (:issue:`5070`)\n\n-   :ref:`run-multiple-spiders` now covers what happens when you define\n    different per-spider values for some settings that cannot differ at run\n    time. (:issue:`4485`, :issue:`5352`)\n\n-   Extended the documentation of the\n    :class:`~scrapy.extensions.statsmailer.StatsMailer` extension.\n    (:issue:`5199`, :issue:`5217`)\n\n-   Added :setting:`JOBDIR` to :ref:`topics-settings`. (:issue:`5173`,\n    :issue:`5224`)\n\n-   Documented :attr:`Spider.attribute <scrapy.Spider.attribute>`.\n    (:issue:`5174`, :issue:`5244`)\n\n-   Documented :attr:`TextResponse.urljoin <scrapy.http.TextResponse.urljoin>`.\n    (:issue:`1582`)\n\n-   Added the ``body_length`` parameter to the documented signature of the\n    :signal:`headers_received` signal. (:issue:`5270`)\n\n-   Clarified :meth:`SelectorList.get <scrapy.selector.SelectorList.get>` usage\n    in the :ref:`tutorial <intro-tutorial>`. (:issue:`5256`)\n\n-   The documentation now features the shortest import path of classes with\n    multiple import paths. (:issue:`2733`, :issue:`5099`)\n\n-   ``quotes.toscrape.com`` references now use HTTPS instead of HTTP.\n    (:issue:`5395`, :issue:`5396`)\n\n-   Added a link to `our Discord server <https://discord.gg/mv3yErfpvq>`_\n    to :ref:`getting-help`. (:issue:`5421`, :issue:`5422`)\n\n-   The pronunciation of the project name is now :ref:`officially\n    <intro-overview>` /\u02c8skre\u026apa\u026a/. (:issue:`5280`, :issue:`5281`)\n\n-   Added the Scrapy logo to the README. (:issue:`5255`, :issue:`5258`)\n\n-   Fixed issues and implemented minor improvements. (:issue:`3155`,\n    :issue:`4335`, :issue:`5074`, :issue:`5098`, :issue:`5134`, :issue:`5180`,\n    :issue:`5194`, :issue:`5239`, :issue:`5266`, :issue:`5271`, :issue:`5273`,\n    :issue:`5274`, :issue:`5276`, :issue:`5347`, :issue:`5356`, :issue:`5414`,\n    :issue:`5415`, :issue:`5416`, :issue:`5419`, :issue:`5420`)\n\n\nQuality Assurance\n~~~~~~~~~~~~~~~~~\n\n-   Added support for Python 3.10. (:issue:`5212`, :issue:`5221`,\n    :issue:`5265`)\n\n-   Significantly reduced memory usage by\n    :func:`scrapy.utils.response.response_httprepr`, used by the\n    :class:`~scrapy.downloadermiddlewares.stats.DownloaderStats` downloader\n    middleware, which is enabled by default. (:issue:`4964`, :issue:`4972`)\n\n-   Removed uses of the deprecated :mod:`optparse` module. (:issue:`5366`,\n    :issue:`5374`)\n\n-   Extended typing hints. (:issue:`5077`, :issue:`5090`, :issue:`5100`,\n    :issue:`5108`, :issue:`5171`, :issue:`5215`, :issue:`5334`)\n\n-   Improved tests, fixed CI issues, removed unused code. (:issue:`5094`,\n    :issue:`5157`, :issue:`5162`, :issue:`5198`, :issue:`5207`, :issue:`5208`,\n    :issue:`5229`, :issue:`5298`, :issue:`5299`, :issue:`5310`, :issue:`5316`,\n    :issue:`5333`, :issue:`5388`, :issue:`5389`, :issue:`5400`, :issue:`5401`,\n    :issue:`5404`, :issue:`5405`, :issue:`5407`, :issue:`5410`, :issue:`5412`,\n    :issue:`5425`, :issue:`5427`)\n\n-   Implemented improvements for contributors. (:issue:`5080`, :issue:`5082`,\n    :issue:`5177`, :issue:`5200`)\n\n-   Implemented cleanups. (:issue:`5095`, :issue:`5106`, :issue:`5209`,\n    :issue:`5228`, :issue:`5235`, :issue:`5245`, :issue:`5246`, :issue:`5292`,\n    :issue:`5314`, :issue:`5322`)\n\n\n.. _release-2.5.1:\n\nScrapy 2.5.1 (2021-10-05)\n-------------------------\n\n*   **Security bug fix:**\n\n    If you use\n    :class:`~scrapy.downloadermiddlewares.httpauth.HttpAuthMiddleware`\n    (i.e. the ``http_user`` and ``http_pass`` spider attributes) for HTTP\n    authentication, any request exposes your credentials to the request target.\n\n    To prevent unintended exposure of authentication credentials to unintended\n    domains, you must now additionally set a new, additional spider attribute,\n    ``http_auth_domain``, and point it to the specific domain to which the\n    authentication credentials must be sent.\n\n    If the ``http_auth_domain`` spider attribute is not set, the domain of the\n    first request will be considered the HTTP authentication target, and\n    authentication credentials will only be sent in requests targeting that\n    domain.\n\n    If you need to send the same HTTP authentication credentials to multiple\n    domains, you can use :func:`w3lib.http.basic_auth_header` instead to\n    set the value of the ``Authorization`` header of your requests.\n\n    If you *really* want your spider to send the same HTTP authentication\n    credentials to any domain, set the ``http_auth_domain`` spider attribute\n    to ``None``.\n\n    Finally, if you are a user of `scrapy-splash`_, know that this version of\n    Scrapy breaks compatibility with scrapy-splash 0.7.2 and earlier. You will\n    need to upgrade scrapy-splash to a greater version for it to continue to\n    work.\n\n.. _scrapy-splash: https://github.com/scrapy-plugins/scrapy-splash\n\n\n.. _release-2.5.0:\n\nScrapy 2.5.0 (2021-04-06)\n-------------------------\n\nHighlights:\n\n-   Official Python 3.9 support\n\n-   Experimental :ref:`HTTP/2 support <http2>`\n\n-   New :func:`~scrapy.downloadermiddlewares.retry.get_retry_request` function\n    to retry requests from spider callbacks\n\n-   New :class:`~scrapy.signals.headers_received` signal that allows stopping\n    downloads early\n\n-   New :class:`Response.protocol <scrapy.http.Response.protocol>` attribute\n\nDeprecation removals\n~~~~~~~~~~~~~~~~~~~~\n\n-   Removed all code that :ref:`was deprecated in 1.7.0 <1.7-deprecations>` and\n    had not :ref:`already been removed in 2.4.0 <2.4-deprecation-removals>`.\n    (:issue:`4901`)\n\n-   Removed support for the ``SCRAPY_PICKLED_SETTINGS_TO_OVERRIDE`` environment\n    variable, :ref:`deprecated in 1.8.0 <1.8-deprecations>`. (:issue:`4912`)\n\n\nDeprecations\n~~~~~~~~~~~~\n\n-   The :mod:`scrapy.utils.py36` module is now deprecated in favor of\n    :mod:`scrapy.utils.asyncgen`. (:issue:`4900`)\n\n\nNew features\n~~~~~~~~~~~~\n\n-   Experimental :ref:`HTTP/2 support <http2>` through a new download handler\n    that can be assigned to the ``https`` protocol in the\n    :setting:`DOWNLOAD_HANDLERS` setting.\n    (:issue:`1854`, :issue:`4769`, :issue:`5058`, :issue:`5059`, :issue:`5066`)\n\n-   The new :func:`scrapy.downloadermiddlewares.retry.get_retry_request`\n    function may be used from spider callbacks or middlewares to handle the\n    retrying of a request beyond the scenarios that\n    :class:`~scrapy.downloadermiddlewares.retry.RetryMiddleware` supports.\n    (:issue:`3590`, :issue:`3685`, :issue:`4902`)\n\n-   The new :class:`~scrapy.signals.headers_received` signal gives early access\n    to response headers and allows :ref:`stopping downloads\n    <topics-stop-response-download>`.\n    (:issue:`1772`, :issue:`4897`)\n\n-   The new :attr:`Response.protocol <scrapy.http.Response.protocol>`\n    attribute gives access to the string that identifies the protocol used to\n    download a response. (:issue:`4878`)\n\n-   :ref:`Stats <topics-stats>` now include the following entries that indicate\n    the number of successes and failures in storing\n    :ref:`feeds <topics-feed-exports>`::\n\n        feedexport/success_count/<storage type>\n        feedexport/failed_count/<storage type>\n\n    Where ``<storage type>`` is the feed storage backend class name, such as\n    :class:`~scrapy.extensions.feedexport.FileFeedStorage` or\n    :class:`~scrapy.extensions.feedexport.FTPFeedStorage`.\n\n    (:issue:`3947`, :issue:`4850`)\n\n-   The :class:`~scrapy.spidermiddlewares.urllength.UrlLengthMiddleware` spider\n    middleware now logs ignored URLs with ``INFO`` :ref:`logging level\n    <levels>` instead of ``DEBUG``, and it now includes the following entry\n    into :ref:`stats <topics-stats>` to keep track of the number of ignored\n    URLs::\n\n        urllength/request_ignored_count\n\n    (:issue:`5036`)\n\n-   The\n    :class:`~scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware`\n    downloader middleware now logs the number of decompressed responses and the\n    total count of resulting bytes::\n\n        httpcompression/response_bytes\n        httpcompression/response_count\n\n    (:issue:`4797`, :issue:`4799`)\n\n\nBug fixes\n~~~~~~~~~\n\n-   Fixed installation on PyPy installing PyDispatcher in addition to\n    PyPyDispatcher, which could prevent Scrapy from working depending on which\n    package got imported. (:issue:`4710`, :issue:`4814`)\n\n-   When inspecting a callback to check if it is a generator that also returns\n    a value, an exception is no longer raised if the callback has a docstring\n    with lower indentation than the following code.\n    (:issue:`4477`, :issue:`4935`)\n\n-   The `Content-Length <https://tools.ietf.org/html/rfc2616#section-14.13>`_\n    header is no longer omitted from responses when using the default, HTTP/1.1\n    download handler (see :setting:`DOWNLOAD_HANDLERS`).\n    (:issue:`5009`, :issue:`5034`, :issue:`5045`, :issue:`5057`, :issue:`5062`)\n\n-   Setting the :reqmeta:`handle_httpstatus_all` request meta key to ``False``\n    now has the same effect as not setting it at all, instead of having the\n    same effect as setting it to ``True``.\n    (:issue:`3851`, :issue:`4694`)\n\n\nDocumentation\n~~~~~~~~~~~~~\n\n-   Added instructions to :ref:`install Scrapy in Windows using pip\n    <intro-install-windows>`.\n    (:issue:`4715`, :issue:`4736`)\n\n-   Logging documentation now includes :ref:`additional ways to filter logs\n    <topics-logging-advanced-customization>`.\n    (:issue:`4216`, :issue:`4257`, :issue:`4965`)\n\n-   Covered how to deal with long lists of allowed domains in the :ref:`FAQ\n    <faq>`. (:issue:`2263`, :issue:`3667`)\n\n-   Covered scrapy-bench_ in :ref:`benchmarking`.\n    (:issue:`4996`, :issue:`5016`)\n\n-   Clarified that one :ref:`extension <topics-extensions>` instance is created\n    per crawler.\n    (:issue:`5014`)\n\n-   Fixed some errors in examples.\n    (:issue:`4829`, :issue:`4830`, :issue:`4907`, :issue:`4909`,\n    :issue:`5008`)\n\n-   Fixed some external links, typos, and so on.\n    (:issue:`4892`, :issue:`4899`, :issue:`4936`, :issue:`4942`, :issue:`5005`,\n    :issue:`5063`)\n\n-   The :ref:`list of Request.meta keys <topics-request-meta>` is now sorted\n    alphabetically.\n    (:issue:`5061`, :issue:`5065`)\n\n-   Updated references to Scrapinghub, which is now called Zyte.\n    (:issue:`4973`, :issue:`5072`)\n\n-   Added a mention to contributors in the README. (:issue:`4956`)\n\n-   Reduced the top margin of lists. (:issue:`4974`)\n\n\nQuality Assurance\n~~~~~~~~~~~~~~~~~\n\n-   Made Python 3.9 support official (:issue:`4757`, :issue:`4759`)\n\n-   Extended typing hints (:issue:`4895`)\n\n-   Fixed deprecated uses of the Twisted API.\n    (:issue:`4940`, :issue:`4950`, :issue:`5073`)\n\n-   Made our tests run with the new pip resolver.\n    (:issue:`4710`, :issue:`4814`)\n\n-   Added tests to ensure that :ref:`coroutine support <coroutine-support>`\n    is tested. (:issue:`4987`)\n\n-   Migrated from Travis CI to GitHub Actions. (:issue:`4924`)\n\n-   Fixed CI issues.\n    (:issue:`4986`, :issue:`5020`, :issue:`5022`, :issue:`5027`, :issue:`5052`,\n    :issue:`5053`)\n\n-   Implemented code refactorings, style fixes and cleanups.\n    (:issue:`4911`, :issue:`4982`, :issue:`5001`, :issue:`5002`, :issue:`5076`)\n\n\n.. _release-2.4.1:\n\nScrapy 2.4.1 (2020-11-17)\n-------------------------\n\n-   Fixed :ref:`feed exports <topics-feed-exports>` overwrite support (:issue:`4845`, :issue:`4857`, :issue:`4859`)\n\n-   Fixed the AsyncIO event loop handling, which could make code hang\n    (:issue:`4855`, :issue:`4872`)\n\n-   Fixed the IPv6-capable DNS resolver\n    :class:`~scrapy.resolver.CachingHostnameResolver` for download handlers\n    that call\n    :meth:`reactor.resolve <twisted.internet.interfaces.IReactorCore.resolve>`\n    (:issue:`4802`, :issue:`4803`)\n\n-   Fixed the output of the :command:`genspider` command showing placeholders\n    instead of the import path of the generated spider module (:issue:`4874`)\n\n-   Migrated Windows CI from Azure Pipelines to GitHub Actions (:issue:`4869`,\n    :issue:`4876`)\n\n\n.. _release-2.4.0:\n\nScrapy 2.4.0 (2020-10-11)\n-------------------------\n\nHighlights:\n\n*   Python 3.5 support has been dropped.\n\n*   The ``file_path`` method of :ref:`media pipelines <topics-media-pipeline>`\n    can now access the source :ref:`item <topics-items>`.\n\n    This allows you to set a download file path based on item data.\n\n*   The new ``item_export_kwargs`` key of the :setting:`FEEDS` setting allows\n    to define keyword parameters to pass to :ref:`item exporter classes\n    <topics-exporters>`\n\n*   You can now choose whether :ref:`feed exports <topics-feed-exports>`\n    overwrite or append to the output file.\n\n    For example, when using the :command:`crawl` or :command:`runspider`\n    commands, you can use the ``-O`` option instead of ``-o`` to overwrite the\n    output file.\n\n*   Zstd-compressed responses are now supported if zstandard_ is installed.\n\n*   In settings, where the import path of a class is required, it is now\n    possible to pass a class object instead.\n\nModified requirements\n~~~~~~~~~~~~~~~~~~~~~\n\n*   Python 3.6 or greater is now required; support for Python 3.5 has been\n    dropped\n\n    As a result:\n\n    -   When using PyPy, PyPy 7.2.0 or greater :ref:`is now required\n        <faq-python-versions>`\n\n    -   For Amazon S3 storage support in :ref:`feed exports\n        <topics-feed-storage-s3>` or :ref:`media pipelines\n        <media-pipelines-s3>`, botocore_ 1.4.87 or greater is now required\n\n    -   To use the :ref:`images pipeline <images-pipeline>`, Pillow_ 4.0.0 or\n        greater is now required\n\n    (:issue:`4718`, :issue:`4732`, :issue:`4733`, :issue:`4742`, :issue:`4743`,\n    :issue:`4764`)\n\n\nBackward-incompatible changes\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n*   :class:`~scrapy.downloadermiddlewares.cookies.CookiesMiddleware` once again\n    discards cookies defined in :attr:`Request.headers\n    <scrapy.http.Request.headers>`.\n\n    We decided to revert this bug fix, introduced in Scrapy 2.2.0, because it\n    was reported that the current implementation could break existing code.\n\n    If you need to set cookies for a request, use the :class:`Request.cookies\n    <scrapy.http.Request>` parameter.\n\n    A future version of Scrapy will include a new, better implementation of the\n    reverted bug fix.\n\n    (:issue:`4717`, :issue:`4823`)\n\n\n.. _2.4-deprecation-removals:\n\nDeprecation removals\n~~~~~~~~~~~~~~~~~~~~\n\n*   :class:`scrapy.extensions.feedexport.S3FeedStorage` no longer reads the\n    values of ``access_key`` and ``secret_key`` from the running project\n    settings when they are not passed to its ``__init__`` method; you must\n    either pass those parameters to its ``__init__`` method or use\n    :class:`S3FeedStorage.from_crawler\n    <scrapy.extensions.feedexport.S3FeedStorage.from_crawler>`\n    (:issue:`4356`, :issue:`4411`, :issue:`4688`)\n\n*   :attr:`Rule.process_request <scrapy.spiders.crawl.Rule.process_request>`\n    no longer admits callables which expect a single ``request`` parameter,\n    rather than both ``request`` and ``response`` (:issue:`4818`)\n\n\nDeprecations\n~~~~~~~~~~~~\n\n*   In custom :ref:`media pipelines <topics-media-pipeline>`, signatures that\n    do not accept a keyword-only ``item`` parameter in any of the  methods that\n    :ref:`now support this parameter <media-pipeline-item-parameter>` are now\n    deprecated (:issue:`4628`, :issue:`4686`)\n\n*   In custom :ref:`feed storage backend classes <topics-feed-storage>`,\n    ``__init__`` method signatures that do not accept a keyword-only\n    ``feed_options`` parameter are now deprecated (:issue:`547`, :issue:`716`,\n    :issue:`4512`)\n\n*   The :class:`scrapy.utils.python.WeakKeyCache` class is now deprecated\n    (:issue:`4684`, :issue:`4701`)\n\n*   The :func:`scrapy.utils.boto.is_botocore` function is now deprecated, use\n    :func:`scrapy.utils.boto.is_botocore_available` instead (:issue:`4734`,\n    :issue:`4776`)\n\n\nNew features\n~~~~~~~~~~~~\n\n.. _media-pipeline-item-parameter:\n\n*   The following methods of :ref:`media pipelines <topics-media-pipeline>` now\n    accept an ``item`` keyword-only parameter containing the source\n    :ref:`item <topics-items>`:\n\n    -   In :class:`scrapy.pipelines.files.FilesPipeline`:\n\n        -   :meth:`~scrapy.pipelines.files.FilesPipeline.file_downloaded`\n\n        -   :meth:`~scrapy.pipelines.files.FilesPipeline.file_path`\n\n        -   :meth:`~scrapy.pipelines.files.FilesPipeline.media_downloaded`\n\n        -   :meth:`~scrapy.pipelines.files.FilesPipeline.media_to_download`\n\n    -   In :class:`scrapy.pipelines.images.ImagesPipeline`:\n\n        -   :meth:`~scrapy.pipelines.images.ImagesPipeline.file_downloaded`\n\n        -   :meth:`~scrapy.pipelines.images.ImagesPipeline.file_path`\n\n        -   :meth:`~scrapy.pipelines.images.ImagesPipeline.get_images`\n\n        -   :meth:`~scrapy.pipelines.images.ImagesPipeline.image_downloaded`\n\n        -   :meth:`~scrapy.pipelines.images.ImagesPipeline.media_downloaded`\n\n        -   :meth:`~scrapy.pipelines.images.ImagesPipeline.media_to_download`\n\n    (:issue:`4628`, :issue:`4686`)\n\n*   The new ``item_export_kwargs`` key of the :setting:`FEEDS` setting allows\n    to define keyword parameters to pass to :ref:`item exporter classes\n    <topics-exporters>` (:issue:`4606`, :issue:`4768`)\n\n*   :ref:`Feed exports <topics-feed-exports>` gained overwrite support:\n\n    *   When using the :command:`crawl` or :command:`runspider` commands, you\n        can use the ``-O`` option instead of ``-o`` to overwrite the output\n        file\n\n    *   You can use the ``overwrite`` key in the :setting:`FEEDS` setting to\n        configure whether to overwrite the output file (``True``) or append to\n        its content (``False``)\n\n    *   The ``__init__`` and ``from_crawler`` methods of :ref:`feed storage\n        backend classes <topics-feed-storage>` now receive a new keyword-only\n        parameter, ``feed_options``, which is a dictionary of :ref:`feed\n        options <feed-options>`\n\n    (:issue:`547`, :issue:`716`, :issue:`4512`)\n\n*   Zstd-compressed responses are now supported if zstandard_ is installed\n    (:issue:`4831`)\n\n*   In settings, where the import path of a class is required, it is now\n    possible to pass a class object instead (:issue:`3870`, :issue:`3873`).\n\n    This includes also settings where only part of its value is made of an\n    import path, such as :setting:`DOWNLOADER_MIDDLEWARES` or\n    :setting:`DOWNLOAD_HANDLERS`.\n\n*   :ref:`Downloader middlewares <topics-downloader-middleware>` can now\n    override :class:`response.request <scrapy.http.Response.request>`.\n\n    If a :ref:`downloader middleware <topics-downloader-middleware>` returns\n    a :class:`~scrapy.http.Response` object from\n    :meth:`~scrapy.downloadermiddlewares.DownloaderMiddleware.process_response`\n    or\n    :meth:`~scrapy.downloadermiddlewares.DownloaderMiddleware.process_exception`\n    with a custom :class:`~scrapy.http.Request` object assigned to\n    :class:`response.request <scrapy.http.Response.request>`:\n\n    -   The response is handled by the callback of that custom\n        :class:`~scrapy.http.Request` object, instead of being handled by the\n        callback of the original :class:`~scrapy.http.Request` object\n\n    -   That custom :class:`~scrapy.http.Request` object is now sent as the\n        ``request`` argument to the :signal:`response_received` signal, instead\n        of the original :class:`~scrapy.http.Request` object\n\n    (:issue:`4529`, :issue:`4632`)\n\n*   When using the :ref:`FTP feed storage backend <topics-feed-storage-ftp>`:\n\n    -   It is now possible to set the new ``overwrite`` :ref:`feed option\n        <feed-options>` to ``False`` to append to an existing file instead of\n        overwriting it\n\n    -   The FTP password can now be omitted if it is not necessary\n\n    (:issue:`547`, :issue:`716`, :issue:`4512`)\n\n*   The ``__init__`` method of :class:`~scrapy.exporters.CsvItemExporter` now\n    supports an ``errors`` parameter to indicate how to handle encoding errors\n    (:issue:`4755`)\n\n*   When :ref:`using asyncio <using-asyncio>`, it is now possible to\n    :ref:`set a custom asyncio loop <using-custom-loops>` (:issue:`4306`,\n    :issue:`4414`)\n\n*   Serialized requests (see :ref:`topics-jobs`) now support callbacks that are\n    spider methods that delegate on other callable (:issue:`4756`)\n\n*   When a response is larger than :setting:`DOWNLOAD_MAXSIZE`, the logged\n    message is now a warning, instead of an error (:issue:`3874`,\n    :issue:`3886`, :issue:`4752`)\n\n\nBug fixes\n~~~~~~~~~\n\n*   The :command:`genspider` command no longer overwrites existing files\n    unless the ``--force`` option is used (:issue:`4561`, :issue:`4616`,\n    :issue:`4623`)\n\n*   Cookies with an empty value are no longer considered invalid cookies\n    (:issue:`4772`)\n\n*   The :command:`runspider` command now supports files with the ``.pyw`` file\n    extension (:issue:`4643`, :issue:`4646`)\n\n*   The :class:`~scrapy.downloadermiddlewares.httpproxy.HttpProxyMiddleware`\n    middleware now simply ignores unsupported proxy values (:issue:`3331`,\n    :issue:`4778`)\n\n*   Checks for generator callbacks with a ``return`` statement no longer warn\n    about ``return`` statements in nested functions (:issue:`4720`,\n    :issue:`4721`)\n\n*   The system file mode creation mask no longer affects the permissions of\n    files generated using the :command:`startproject` command (:issue:`4722`)\n\n*   :func:`scrapy.utils.iterators.xmliter` now supports namespaced node names\n    (:issue:`861`, :issue:`4746`)\n\n*   :class:`~scrapy.Request` objects can now have ``about:`` URLs, which can\n    work when using a headless browser (:issue:`4835`)\n\n\nDocumentation\n~~~~~~~~~~~~~\n\n*   The :setting:`FEED_URI_PARAMS` setting is now documented (:issue:`4671`,\n    :issue:`4724`)\n\n*   Improved the documentation of\n    :ref:`link extractors <topics-link-extractors>` with an usage example from\n    a spider callback and reference documentation for the\n    :class:`~scrapy.link.Link` class (:issue:`4751`, :issue:`4775`)\n\n*   Clarified the impact of :setting:`CONCURRENT_REQUESTS` when using the\n    :class:`~scrapy.extensions.closespider.CloseSpider` extension\n    (:issue:`4836`)\n\n*   Removed references to Python 2\u2019s ``unicode`` type (:issue:`4547`,\n    :issue:`4703`)\n\n*   We now have an :ref:`official deprecation policy <deprecation-policy>`\n    (:issue:`4705`)\n\n*   Our :ref:`documentation policies <documentation-policies>` now cover usage\n    of Sphinx\u2019s :rst:dir:`versionadded` and :rst:dir:`versionchanged`\n    directives, and we have removed usages referencing Scrapy 1.4.0 and earlier\n    versions (:issue:`3971`, :issue:`4310`)\n\n*   Other documentation cleanups (:issue:`4090`, :issue:`4782`, :issue:`4800`,\n    :issue:`4801`, :issue:`4809`, :issue:`4816`, :issue:`4825`)\n\n\nQuality assurance\n~~~~~~~~~~~~~~~~~\n\n*   Extended typing hints (:issue:`4243`, :issue:`4691`)\n\n*   Added tests for the :command:`check` command (:issue:`4663`)\n\n*   Fixed test failures on Debian (:issue:`4726`, :issue:`4727`, :issue:`4735`)\n\n*   Improved Windows test coverage (:issue:`4723`)\n\n*   Switched to :ref:`formatted string literals <f-strings>` where possible\n    (:issue:`4307`, :issue:`4324`, :issue:`4672`)\n\n*   Modernized :func:`super` usage (:issue:`4707`)\n\n*   Other code and test cleanups (:issue:`1790`, :issue:`3288`, :issue:`4165`,\n    :issue:`4564`, :issue:`4651`, :issue:`4714`, :issue:`4738`, :issue:`4745`,\n    :issue:`4747`, :issue:`4761`, :issue:`4765`, :issue:`4804`, :issue:`4817`,\n    :issue:`4820`, :issue:`4822`, :issue:`4839`)\n\n\n.. _release-2.3.0:\n\nScrapy 2.3.0 (2020-08-04)\n-------------------------\n\nHighlights:\n\n*   :ref:`Feed exports <topics-feed-exports>` now support :ref:`Google Cloud\n    Storage <topics-feed-storage-gcs>` as a storage backend\n\n*   The new :setting:`FEED_EXPORT_BATCH_ITEM_COUNT` setting allows to deliver\n    output items in batches of up to the specified number of items.\n\n    It also serves as a workaround for :ref:`delayed file delivery\n    <delayed-file-delivery>`, which causes Scrapy to only start item delivery\n    after the crawl has finished when using certain storage backends\n    (:ref:`S3 <topics-feed-storage-s3>`, :ref:`FTP <topics-feed-storage-ftp>`,\n    and now :ref:`GCS <topics-feed-storage-gcs>`).\n\n*   The base implementation of :ref:`item loaders <topics-loaders>` has been\n    moved into a separate library, :doc:`itemloaders <itemloaders:index>`,\n    allowing usage from outside Scrapy and a separate release schedule\n\nDeprecation removals\n~~~~~~~~~~~~~~~~~~~~\n\n*   Removed the following classes and their parent modules from\n    ``scrapy.linkextractors``:\n\n    *   ``htmlparser.HtmlParserLinkExtractor``\n    *   ``regex.RegexLinkExtractor``\n    *   ``sgml.BaseSgmlLinkExtractor``\n    *   ``sgml.SgmlLinkExtractor``\n\n    Use\n    :class:`LinkExtractor <scrapy.linkextractors.lxmlhtml.LxmlLinkExtractor>`\n    instead (:issue:`4356`, :issue:`4679`)\n\n\nDeprecations\n~~~~~~~~~~~~\n\n*   The ``scrapy.utils.python.retry_on_eintr`` function is now deprecated\n    (:issue:`4683`)\n\n\nNew features\n~~~~~~~~~~~~\n\n*   :ref:`Feed exports <topics-feed-exports>` support :ref:`Google Cloud\n    Storage <topics-feed-storage-gcs>` (:issue:`685`, :issue:`3608`)\n\n*   New :setting:`FEED_EXPORT_BATCH_ITEM_COUNT` setting for batch deliveries\n    (:issue:`4250`, :issue:`4434`)\n\n*   The :command:`parse` command now allows specifying an output file\n    (:issue:`4317`, :issue:`4377`)\n\n*   :meth:`Request.from_curl <scrapy.http.Request.from_curl>` and\n    :func:`~scrapy.utils.curl.curl_to_request_kwargs` now also support\n    ``--data-raw`` (:issue:`4612`)\n\n*   A ``parse`` callback may now be used in built-in spider subclasses, such\n    as :class:`~scrapy.spiders.CrawlSpider` (:issue:`712`, :issue:`732`,\n    :issue:`781`, :issue:`4254` )\n\n\nBug fixes\n~~~~~~~~~\n\n*   Fixed the :ref:`CSV exporting <topics-feed-format-csv>` of\n    :ref:`dataclass items <dataclass-items>` and :ref:`attr.s items\n    <attrs-items>` (:issue:`4667`, :issue:`4668`)\n\n*   :meth:`Request.from_curl <scrapy.http.Request.from_curl>` and\n    :func:`~scrapy.utils.curl.curl_to_request_kwargs` now set the request\n    method to ``POST`` when a request body is specified and no request method\n    is specified (:issue:`4612`)\n\n*   The processing of ANSI escape sequences in enabled in Windows 10.0.14393\n    and later, where it is required for colored output (:issue:`4393`,\n    :issue:`4403`)\n\n\nDocumentation\n~~~~~~~~~~~~~\n\n*   Updated the `OpenSSL cipher list format`_ link in the documentation about\n    the :setting:`DOWNLOADER_CLIENT_TLS_CIPHERS` setting (:issue:`4653`)\n\n*   Simplified the code example in :ref:`topics-loaders-dataclass`\n    (:issue:`4652`)\n\n.. _OpenSSL cipher list format: https://www.openssl.org/docs/manmaster/man1/openssl-ciphers.html#CIPHER-LIST-FORMAT\n\n\nQuality assurance\n~~~~~~~~~~~~~~~~~\n\n*   The base implementation of :ref:`item loaders <topics-loaders>` has been\n    moved into :doc:`itemloaders <itemloaders:index>` (:issue:`4005`,\n    :issue:`4516`)\n\n*   Fixed a silenced error in some scheduler tests (:issue:`4644`,\n    :issue:`4645`)\n\n*   Renewed the localhost certificate used for SSL tests (:issue:`4650`)\n\n*   Removed cookie-handling code specific to Python 2 (:issue:`4682`)\n\n*   Stopped using Python 2 unicode literal syntax (:issue:`4704`)\n\n*   Stopped using a backlash for line continuation (:issue:`4673`)\n\n*   Removed unneeded entries from the MyPy exception list (:issue:`4690`)\n\n*   Automated tests now pass on Windows as part of our continuous integration\n    system (:issue:`4458`)\n\n*   Automated tests now pass on the latest PyPy version for supported Python\n    versions in our continuous integration system (:issue:`4504`)\n\n\n.. _release-2.2.1:\n\nScrapy 2.2.1 (2020-07-17)\n-------------------------\n\n*   The :command:`startproject` command no longer makes unintended changes to\n    the permissions of files in the destination folder, such as removing\n    execution permissions (:issue:`4662`, :issue:`4666`)\n\n\n.. _release-2.2.0:\n\nScrapy 2.2.0 (2020-06-24)\n-------------------------\n\nHighlights:\n\n* Python 3.5.2+ is required now\n* :ref:`dataclass objects <dataclass-items>` and\n  :ref:`attrs objects <attrs-items>` are now valid :ref:`item types\n  <item-types>`\n* New :meth:`TextResponse.json <scrapy.http.TextResponse.json>` method\n* New :signal:`bytes_received` signal that allows canceling response download\n* :class:`~scrapy.downloadermiddlewares.cookies.CookiesMiddleware` fixes\n\nBackward-incompatible changes\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n*   Support for Python 3.5.0 and 3.5.1 has been dropped; Scrapy now refuses to\n    run with a Python version lower than 3.5.2, which introduced\n    :class:`typing.Type` (:issue:`4615`)\n\n\nDeprecations\n~~~~~~~~~~~~\n\n*   :meth:`TextResponse.body_as_unicode\n    <scrapy.http.TextResponse.body_as_unicode>` is now deprecated, use\n    :attr:`TextResponse.text <scrapy.http.TextResponse.text>` instead\n    (:issue:`4546`, :issue:`4555`, :issue:`4579`)\n\n*   :class:`scrapy.item.BaseItem` is now deprecated, use\n    :class:`scrapy.item.Item` instead (:issue:`4534`)\n\n\nNew features\n~~~~~~~~~~~~\n\n*   :ref:`dataclass objects <dataclass-items>` and\n    :ref:`attrs objects <attrs-items>` are now valid :ref:`item types\n    <item-types>`, and a new itemadapter_ library makes it easy to\n    write code that :ref:`supports any item type <supporting-item-types>`\n    (:issue:`2749`, :issue:`2807`, :issue:`3761`, :issue:`3881`, :issue:`4642`)\n\n*   A new :meth:`TextResponse.json <scrapy.http.TextResponse.json>` method\n    allows to deserialize JSON responses (:issue:`2444`, :issue:`4460`,\n    :issue:`4574`)\n\n*   A new :signal:`bytes_received` signal allows monitoring response download\n    progress and :ref:`stopping downloads <topics-stop-response-download>`\n    (:issue:`4205`, :issue:`4559`)\n\n*   The dictionaries in the result list of a :ref:`media pipeline\n    <topics-media-pipeline>` now include a new key, ``status``, which indicates\n    if the file was downloaded or, if the file was not downloaded, why it was\n    not downloaded; see :meth:`FilesPipeline.get_media_requests\n    <scrapy.pipelines.files.FilesPipeline.get_media_requests>` for more\n    information (:issue:`2893`, :issue:`4486`)\n\n*   When using :ref:`Google Cloud Storage <media-pipeline-gcs>` for\n    a :ref:`media pipeline <topics-media-pipeline>`, a warning is now logged if\n    the configured credentials do not grant the required permissions\n    (:issue:`4346`, :issue:`4508`)\n\n*   :ref:`Link extractors <topics-link-extractors>` are now serializable,\n    as long as you do not use :ref:`lambdas <lambda>` for parameters; for\n    example, you can now pass link extractors in :attr:`Request.cb_kwargs\n    <scrapy.http.Request.cb_kwargs>` or\n    :attr:`Request.meta <scrapy.http.Request.meta>` when :ref:`persisting\n    scheduled requests <topics-jobs>` (:issue:`4554`)\n\n*   Upgraded the :ref:`pickle protocol <pickle-protocols>` that Scrapy uses\n    from protocol 2 to protocol 4, improving serialization capabilities and\n    performance (:issue:`4135`, :issue:`4541`)\n\n*   :func:`scrapy.utils.misc.create_instance` now raises a :exc:`TypeError`\n    exception if the resulting instance is ``None`` (:issue:`4528`,\n    :issue:`4532`)\n\n.. _itemadapter: https://github.com/scrapy/itemadapter\n\n\nBug fixes\n~~~~~~~~~\n\n*   :class:`~scrapy.downloadermiddlewares.cookies.CookiesMiddleware` no longer\n    discards cookies defined in :attr:`Request.headers\n    <scrapy.http.Request.headers>` (:issue:`1992`, :issue:`2400`)\n\n*   :class:`~scrapy.downloadermiddlewares.cookies.CookiesMiddleware` no longer\n    re-encodes cookies defined as :class:`bytes` in the ``cookies`` parameter\n    of the ``__init__`` method of :class:`~scrapy.http.Request`\n    (:issue:`2400`, :issue:`3575`)\n\n*   When :setting:`FEEDS` defines multiple URIs, :setting:`FEED_STORE_EMPTY` is\n    ``False`` and the crawl yields no items, Scrapy no longer stops feed\n    exports after the first URI (:issue:`4621`, :issue:`4626`)\n\n*   :class:`~scrapy.spiders.Spider` callbacks defined using :doc:`coroutine\n    syntax <topics/coroutines>` no longer need to return an iterable, and may\n    instead return a :class:`~scrapy.http.Request` object, an\n    :ref:`item <topics-items>`, or ``None`` (:issue:`4609`)\n\n*   The :command:`startproject` command now ensures that the generated project\n    folders and files have the right permissions (:issue:`4604`)\n\n*   Fix a :exc:`KeyError` exception being sometimes raised from\n    :class:`scrapy.utils.datatypes.LocalWeakReferencedCache` (:issue:`4597`,\n    :issue:`4599`)\n\n*   When :setting:`FEEDS` defines multiple URIs, log messages about items being\n    stored now contain information from the corresponding feed, instead of\n    always containing information about only one of the feeds (:issue:`4619`,\n    :issue:`4629`)\n\n\nDocumentation\n~~~~~~~~~~~~~\n\n*   Added a new section about :ref:`accessing cb_kwargs from errbacks\n    <errback-cb_kwargs>` (:issue:`4598`, :issue:`4634`)\n\n*   Covered chompjs_ in :ref:`topics-parsing-javascript` (:issue:`4556`,\n    :issue:`4562`)\n\n*   Removed from :doc:`topics/coroutines` the warning about the API being\n    experimental (:issue:`4511`, :issue:`4513`)\n\n*   Removed references to unsupported versions of :doc:`Twisted\n    <twisted:index>` (:issue:`4533`)\n\n*   Updated the description of the :ref:`screenshot pipeline example\n    <ScreenshotPipeline>`, which now uses :doc:`coroutine syntax\n    <topics/coroutines>` instead of returning a\n    :class:`~twisted.internet.defer.Deferred` (:issue:`4514`, :issue:`4593`)\n\n*   Removed a misleading import line from the\n    :func:`scrapy.utils.log.configure_logging` code example (:issue:`4510`,\n    :issue:`4587`)\n\n*   The display-on-hover behavior of internal documentation references now also\n    covers links to :ref:`commands <topics-commands>`, :attr:`Request.meta\n    <scrapy.http.Request.meta>` keys, :ref:`settings <topics-settings>` and\n    :ref:`signals <topics-signals>` (:issue:`4495`, :issue:`4563`)\n\n*   It is again possible to download the documentation for offline reading\n    (:issue:`4578`, :issue:`4585`)\n\n*   Removed backslashes preceding ``*args`` and ``**kwargs`` in some function\n    and method signatures (:issue:`4592`, :issue:`4596`)\n\n.. _chompjs: https://github.com/Nykakin/chompjs\n\n\nQuality assurance\n~~~~~~~~~~~~~~~~~\n\n*   Adjusted the code base further to our :ref:`style guidelines\n    <coding-style>` (:issue:`4237`, :issue:`4525`, :issue:`4538`,\n    :issue:`4539`, :issue:`4540`, :issue:`4542`, :issue:`4543`, :issue:`4544`,\n    :issue:`4545`, :issue:`4557`, :issue:`4558`, :issue:`4566`, :issue:`4568`,\n    :issue:`4572`)\n\n*   Removed remnants of Python 2 support (:issue:`4550`, :issue:`4553`,\n    :issue:`4568`)\n\n*   Improved code sharing between the :command:`crawl` and :command:`runspider`\n    commands (:issue:`4548`, :issue:`4552`)\n\n*   Replaced ``chain(*iterable)`` with ``chain.from_iterable(iterable)``\n    (:issue:`4635`)\n\n*   You may now run the :mod:`asyncio` tests with Tox on any Python version\n    (:issue:`4521`)\n\n*   Updated test requirements to reflect an incompatibility with pytest 5.4 and\n    5.4.1 (:issue:`4588`)\n\n*   Improved :class:`~scrapy.spiderloader.SpiderLoader` test coverage for\n    scenarios involving duplicate spider names (:issue:`4549`, :issue:`4560`)\n\n*   Configured Travis CI to also run the tests with Python 3.5.2\n    (:issue:`4518`, :issue:`4615`)\n\n*   Added a `Pylint <https://www.pylint.org/>`_ job to Travis CI\n    (:issue:`3727`)\n\n*   Added a `Mypy <http://mypy-lang.org/>`_ job to Travis CI (:issue:`4637`)\n\n*   Made use of set literals in tests (:issue:`4573`)\n\n*   Cleaned up the Travis CI configuration (:issue:`4517`, :issue:`4519`,\n    :issue:`4522`, :issue:`4537`)\n\n\n.. _release-2.1.0:\n\nScrapy 2.1.0 (2020-04-24)\n-------------------------\n\nHighlights:\n\n* New :setting:`FEEDS` setting to export to multiple feeds\n* New :attr:`Response.ip_address <scrapy.http.Response.ip_address>` attribute\n\nBackward-incompatible changes\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n*   :exc:`AssertionError` exceptions triggered by :ref:`assert <assert>`\n    statements have been replaced by new exception types, to support running\n    Python in optimized mode (see :option:`-O`) without changing Scrapy\u2019s\n    behavior in any unexpected ways.\n\n    If you catch an :exc:`AssertionError` exception from Scrapy, update your\n    code to catch the corresponding new exception.\n\n    (:issue:`4440`)\n\n\nDeprecation removals\n~~~~~~~~~~~~~~~~~~~~\n\n*   The ``LOG_UNSERIALIZABLE_REQUESTS`` setting is no longer supported, use\n    :setting:`SCHEDULER_DEBUG` instead (:issue:`4385`)\n\n*   The ``REDIRECT_MAX_METAREFRESH_DELAY`` setting is no longer supported, use\n    :setting:`METAREFRESH_MAXDELAY` instead (:issue:`4385`)\n\n*   The :class:`~scrapy.downloadermiddlewares.chunked.ChunkedTransferMiddleware`\n    middleware has been removed, including the entire\n    :class:`scrapy.downloadermiddlewares.chunked` module; chunked transfers\n    work out of the box (:issue:`4431`)\n\n*   The ``spiders`` property has been removed from\n    :class:`~scrapy.crawler.Crawler`, use :class:`CrawlerRunner.spider_loader\n    <scrapy.crawler.CrawlerRunner.spider_loader>` or instantiate\n    :setting:`SPIDER_LOADER_CLASS` with your settings instead (:issue:`4398`)\n\n*   The ``MultiValueDict``, ``MultiValueDictKeyError``, and ``SiteNode``\n    classes have been removed from :mod:`scrapy.utils.datatypes`\n    (:issue:`4400`)\n\n\nDeprecations\n~~~~~~~~~~~~\n\n*   The ``FEED_FORMAT`` and ``FEED_URI`` settings have been deprecated in\n    favor of the new :setting:`FEEDS` setting (:issue:`1336`, :issue:`3858`,\n    :issue:`4507`)\n\n\nNew features\n~~~~~~~~~~~~\n\n*   A new setting, :setting:`FEEDS`, allows configuring multiple output feeds\n    with different settings each (:issue:`1336`, :issue:`3858`, :issue:`4507`)\n\n*   The :command:`crawl` and :command:`runspider` commands now support multiple\n    ``-o`` parameters (:issue:`1336`, :issue:`3858`, :issue:`4507`)\n\n*   The :command:`crawl` and :command:`runspider` commands now support\n    specifying an output format by appending ``:<format>`` to the output file\n    (:issue:`1336`, :issue:`3858`, :issue:`4507`)\n\n*   The new :attr:`Response.ip_address <scrapy.http.Response.ip_address>`\n    attribute gives access to the IP address that originated a response\n    (:issue:`3903`, :issue:`3940`)\n\n*   A warning is now issued when a value in\n    :attr:`~scrapy.spiders.Spider.allowed_domains` includes a port\n    (:issue:`50`, :issue:`3198`, :issue:`4413`)\n\n*   Zsh completion now excludes used option aliases from the completion list\n    (:issue:`4438`)\n\n\nBug fixes\n~~~~~~~~~\n\n*   :ref:`Request serialization <request-serialization>` no longer breaks for\n    callbacks that are spider attributes which are assigned a function with a\n    different name (:issue:`4500`)\n\n*   ``None`` values in :attr:`~scrapy.spiders.Spider.allowed_domains` no longer\n    cause a :exc:`TypeError` exception (:issue:`4410`)\n\n*   Zsh completion no longer allows options after arguments (:issue:`4438`)\n\n*   zope.interface 5.0.0 and later versions are now supported\n    (:issue:`4447`, :issue:`4448`)\n\n*   ``Spider.make_requests_from_url``, deprecated in Scrapy 1.4.0, now issues a\n    warning when used (:issue:`4412`)\n\n\nDocumentation\n~~~~~~~~~~~~~\n\n*   Improved the documentation about signals that allow their handlers to\n    return a :class:`~twisted.internet.defer.Deferred` (:issue:`4295`,\n    :issue:`4390`)\n\n*   Our PyPI entry now includes links for our documentation, our source code\n    repository and our issue tracker (:issue:`4456`)\n\n*   Covered the `curl2scrapy <https://michael-shub.github.io/curl2scrapy/>`_\n    service in the documentation (:issue:`4206`, :issue:`4455`)\n\n*   Removed references to the Guppy library, which only works in Python 2\n    (:issue:`4285`, :issue:`4343`)\n\n*   Extended use of InterSphinx to link to Python 3 documentation\n    (:issue:`4444`, :issue:`4445`)\n\n*   Added support for Sphinx 3.0 and later (:issue:`4475`, :issue:`4480`,\n    :issue:`4496`, :issue:`4503`)\n\n\nQuality assurance\n~~~~~~~~~~~~~~~~~\n\n*   Removed warnings about using old, removed settings (:issue:`4404`)\n\n*   Removed a warning about importing\n    :class:`~twisted.internet.testing.StringTransport` from\n    ``twisted.test.proto_helpers`` in Twisted 19.7.0 or newer (:issue:`4409`)\n\n*   Removed outdated Debian package build files (:issue:`4384`)\n\n*   Removed :class:`object` usage as a base class (:issue:`4430`)\n\n*   Removed code that added support for old versions of Twisted that we no\n    longer support (:issue:`4472`)\n\n*   Fixed code style issues (:issue:`4468`, :issue:`4469`, :issue:`4471`,\n    :issue:`4481`)\n\n*   Removed :func:`twisted.internet.defer.returnValue` calls (:issue:`4443`,\n    :issue:`4446`, :issue:`4489`)\n\n\n.. _release-2.0.1:\n\nScrapy 2.0.1 (2020-03-18)\n-------------------------\n\n*   :meth:`Response.follow_all <scrapy.http.Response.follow_all>` now supports\n    an empty URL iterable as input (:issue:`4408`, :issue:`4420`)\n\n*   Removed top-level :mod:`~twisted.internet.reactor` imports to prevent\n    errors about the wrong Twisted reactor being installed when setting a\n    different Twisted reactor using :setting:`TWISTED_REACTOR` (:issue:`4401`,\n    :issue:`4406`)\n\n*   Fixed tests (:issue:`4422`)\n\n\n.. _release-2.0.0:\n\nScrapy 2.0.0 (2020-03-03)\n-------------------------\n\nHighlights:\n\n* Python 2 support has been removed\n* :doc:`Partial <topics/coroutines>` :ref:`coroutine syntax <async>` support\n  and :doc:`experimental <topics/asyncio>` :mod:`asyncio` support\n* New :meth:`Response.follow_all <scrapy.http.Response.follow_all>` method\n* :ref:`FTP support <media-pipeline-ftp>` for media pipelines\n* New :attr:`Response.certificate <scrapy.http.Response.certificate>`\n  attribute\n* IPv6 support through :setting:`DNS_RESOLVER`\n\nBackward-incompatible changes\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n*   Python 2 support has been removed, following `Python 2 end-of-life on\n    January 1, 2020`_ (:issue:`4091`, :issue:`4114`, :issue:`4115`,\n    :issue:`4121`, :issue:`4138`, :issue:`4231`, :issue:`4242`, :issue:`4304`,\n    :issue:`4309`, :issue:`4373`)\n\n*   Retry gaveups (see :setting:`RETRY_TIMES`) are now logged as errors instead\n    of as debug information (:issue:`3171`, :issue:`3566`)\n\n*   File extensions that\n    :class:`LinkExtractor <scrapy.linkextractors.lxmlhtml.LxmlLinkExtractor>`\n    ignores by default now also include ``7z``, ``7zip``, ``apk``, ``bz2``,\n    ``cdr``, ``dmg``, ``ico``, ``iso``, ``tar``, ``tar.gz``, ``webm``, and\n    ``xz`` (:issue:`1837`, :issue:`2067`, :issue:`4066`)\n\n*   The :setting:`METAREFRESH_IGNORE_TAGS` setting is now an empty list by\n    default, following web browser behavior (:issue:`3844`, :issue:`4311`)\n\n*   The\n    :class:`~scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware`\n    now includes spaces after commas in the value of the ``Accept-Encoding``\n    header that it sets, following web browser behavior (:issue:`4293`)\n\n*   The ``__init__`` method of custom download handlers (see\n    :setting:`DOWNLOAD_HANDLERS`) or subclasses of the following downloader\n    handlers  no longer receives a ``settings`` parameter:\n\n    *   :class:`scrapy.core.downloader.handlers.datauri.DataURIDownloadHandler`\n\n    *   :class:`scrapy.core.downloader.handlers.file.FileDownloadHandler`\n\n    Use the ``from_settings`` or ``from_crawler`` class methods to expose such\n    a parameter to your custom download handlers.\n\n    (:issue:`4126`)\n\n*   We have refactored the :class:`scrapy.core.scheduler.Scheduler` class and\n    related queue classes (see :setting:`SCHEDULER_PRIORITY_QUEUE`,\n    :setting:`SCHEDULER_DISK_QUEUE` and :setting:`SCHEDULER_MEMORY_QUEUE`) to\n    make it easier to implement custom scheduler queue classes. See\n    :ref:`2-0-0-scheduler-queue-changes` below for details.\n\n*   Overridden settings are now logged in a different format. This is more in\n    line with similar information logged at startup (:issue:`4199`)\n\n.. _Python 2 end-of-life on January 1, 2020: https://www.python.org/doc/sunset-python-2/\n\n\nDeprecation removals\n~~~~~~~~~~~~~~~~~~~~\n\n*   The :ref:`Scrapy shell <topics-shell>` no longer provides a `sel` proxy\n    object, use :meth:`response.selector <scrapy.http.Response.selector>`\n    instead (:issue:`4347`)\n\n*   LevelDB support has been removed (:issue:`4112`)\n\n*   The following functions have been removed from :mod:`scrapy.utils.python`:\n    ``isbinarytext``, ``is_writable``, ``setattr_default``, ``stringify_dict``\n    (:issue:`4362`)\n\n\nDeprecations\n~~~~~~~~~~~~\n\n*   Using environment variables prefixed with ``SCRAPY_`` to override settings\n    is deprecated (:issue:`4300`, :issue:`4374`, :issue:`4375`)\n\n*   :class:`scrapy.linkextractors.FilteringLinkExtractor` is deprecated, use\n    :class:`scrapy.linkextractors.LinkExtractor\n    <scrapy.linkextractors.lxmlhtml.LxmlLinkExtractor>` instead (:issue:`4045`)\n\n*   The ``noconnect`` query string argument of proxy URLs is deprecated and\n    should be removed from proxy URLs (:issue:`4198`)\n\n*   The :meth:`next <scrapy.utils.python.MutableChain.next>` method of\n    :class:`scrapy.utils.python.MutableChain` is deprecated, use the global\n    :func:`next` function or :meth:`MutableChain.__next__\n    <scrapy.utils.python.MutableChain.__next__>` instead (:issue:`4153`)\n\n\nNew features\n~~~~~~~~~~~~\n\n*   Added :doc:`partial support <topics/coroutines>` for Python\u2019s\n    :ref:`coroutine syntax <async>` and :doc:`experimental support\n    <topics/asyncio>` for :mod:`asyncio` and :mod:`asyncio`-powered libraries\n    (:issue:`4010`, :issue:`4259`, :issue:`4269`, :issue:`4270`, :issue:`4271`,\n    :issue:`4316`, :issue:`4318`)\n\n*   The new :meth:`Response.follow_all <scrapy.http.Response.follow_all>`\n    method offers the same functionality as\n    :meth:`Response.follow <scrapy.http.Response.follow>` but supports an\n    iterable of URLs as input and returns an iterable of requests\n    (:issue:`2582`, :issue:`4057`, :issue:`4286`)\n\n*   :ref:`Media pipelines <topics-media-pipeline>` now support :ref:`FTP\n    storage <media-pipeline-ftp>` (:issue:`3928`, :issue:`3961`)\n\n*   The new :attr:`Response.certificate <scrapy.http.Response.certificate>`\n    attribute exposes the SSL certificate of the server as a\n    :class:`twisted.internet.ssl.Certificate` object for HTTPS responses\n    (:issue:`2726`, :issue:`4054`)\n\n*   A new :setting:`DNS_RESOLVER` setting allows enabling IPv6 support\n    (:issue:`1031`, :issue:`4227`)\n\n*   A new :setting:`SCRAPER_SLOT_MAX_ACTIVE_SIZE` setting allows configuring\n    the existing soft limit that pauses request downloads when the total\n    response data being processed is too high (:issue:`1410`, :issue:`3551`)\n\n*   A new :setting:`TWISTED_REACTOR` setting allows customizing the\n    :mod:`~twisted.internet.reactor` that Scrapy uses, allowing to\n    :doc:`enable asyncio support <topics/asyncio>` or deal with a\n    :ref:`common macOS issue <faq-specific-reactor>` (:issue:`2905`,\n    :issue:`4294`)\n\n*   Scheduler disk and memory queues may now use the class methods\n    ``from_crawler`` or ``from_settings`` (:issue:`3884`)\n\n*   The new :attr:`Response.cb_kwargs <scrapy.http.Response.cb_kwargs>`\n    attribute serves as a shortcut for :attr:`Response.request.cb_kwargs\n    <scrapy.http.Request.cb_kwargs>` (:issue:`4331`)\n\n*   :meth:`Response.follow <scrapy.http.Response.follow>` now supports a\n    ``flags`` parameter, for consistency with :class:`~scrapy.http.Request`\n    (:issue:`4277`, :issue:`4279`)\n\n*   :ref:`Item loader processors <topics-loaders-processors>` can now be\n    regular functions, they no longer need to be methods (:issue:`3899`)\n\n*   :class:`~scrapy.spiders.Rule` now accepts an ``errback`` parameter\n    (:issue:`4000`)\n\n*   :class:`~scrapy.http.Request` no longer requires a ``callback`` parameter\n    when an ``errback`` parameter is specified (:issue:`3586`, :issue:`4008`)\n\n*   :class:`~scrapy.logformatter.LogFormatter` now supports some additional\n    methods:\n\n    *   :class:`~scrapy.logformatter.LogFormatter.download_error` for\n        download errors\n\n    *   :class:`~scrapy.logformatter.LogFormatter.item_error` for exceptions\n        raised during item processing by :ref:`item pipelines\n        <topics-item-pipeline>`\n\n    *   :class:`~scrapy.logformatter.LogFormatter.spider_error` for exceptions\n        raised from :ref:`spider callbacks <topics-spiders>`\n\n    (:issue:`374`, :issue:`3986`, :issue:`3989`, :issue:`4176`, :issue:`4188`)\n\n*   The :setting:`FEED_URI` setting now supports :class:`pathlib.Path` values\n    (:issue:`3731`, :issue:`4074`)\n\n*   A new :signal:`request_left_downloader` signal is sent when a request\n    leaves the downloader (:issue:`4303`)\n\n*   Scrapy logs a warning when it detects a request callback or errback that\n    uses ``yield`` but also returns a value, since the returned value would be\n    lost (:issue:`3484`, :issue:`3869`)\n\n*   :class:`~scrapy.spiders.Spider` objects now raise an :exc:`AttributeError`\n    exception if they do not have a :class:`~scrapy.spiders.Spider.start_urls`\n    attribute nor reimplement :class:`~scrapy.spiders.Spider.start_requests`,\n    but have a ``start_url`` attribute (:issue:`4133`, :issue:`4170`)\n\n*   :class:`~scrapy.exporters.BaseItemExporter` subclasses may now use\n    ``super().__init__(**kwargs)`` instead of ``self._configure(kwargs)`` in\n    their ``__init__`` method, passing ``dont_fail=True`` to the parent\n    ``__init__`` method if needed, and accessing ``kwargs`` at ``self._kwargs``\n    after calling their parent ``__init__`` method (:issue:`4193`,\n    :issue:`4370`)\n\n*   A new ``keep_fragments`` parameter of\n    :func:`scrapy.utils.request.request_fingerprint` allows to generate\n    different fingerprints for requests with different fragments in their URL\n    (:issue:`4104`)\n\n*   Download handlers (see :setting:`DOWNLOAD_HANDLERS`) may now use the\n    ``from_settings`` and ``from_crawler`` class methods that other Scrapy\n    components already supported (:issue:`4126`)\n\n*   :class:`scrapy.utils.python.MutableChain.__iter__` now returns ``self``,\n    `allowing it to be used as a sequence <https://lgtm.com/rules/4850080/>`_\n    (:issue:`4153`)\n\n\nBug fixes\n~~~~~~~~~\n\n*   The :command:`crawl` command now also exits with exit code 1 when an\n    exception happens before the crawling starts (:issue:`4175`, :issue:`4207`)\n\n*   :class:`LinkExtractor.extract_links\n    <scrapy.linkextractors.lxmlhtml.LxmlLinkExtractor.extract_links>` no longer\n    re-encodes the query string or URLs from non-UTF-8 responses in UTF-8\n    (:issue:`998`, :issue:`1403`, :issue:`1949`, :issue:`4321`)\n\n*   The first spider middleware (see :setting:`SPIDER_MIDDLEWARES`) now also\n    processes exceptions raised from callbacks that are generators\n    (:issue:`4260`, :issue:`4272`)\n\n*   Redirects to URLs starting with 3 slashes (``///``) are now supported\n    (:issue:`4032`, :issue:`4042`)\n\n*   :class:`~scrapy.http.Request` no longer accepts strings as ``url`` simply\n    because they have a colon (:issue:`2552`, :issue:`4094`)\n\n*   The correct encoding is now used for attach names in\n    :class:`~scrapy.mail.MailSender` (:issue:`4229`, :issue:`4239`)\n\n*   :class:`~scrapy.dupefilters.RFPDupeFilter`, the default\n    :setting:`DUPEFILTER_CLASS`, no longer writes an extra ``\\r`` character on\n    each line in Windows, which made the size of the ``requests.seen`` file\n    unnecessarily large on that platform (:issue:`4283`)\n\n*   Z shell auto-completion now looks for ``.html`` files, not ``.http`` files,\n    and covers the ``-h`` command-line switch (:issue:`4122`, :issue:`4291`)\n\n*   Adding items to a :class:`scrapy.utils.datatypes.LocalCache` object\n    without a ``limit`` defined no longer raises a :exc:`TypeError` exception\n    (:issue:`4123`)\n\n*   Fixed a typo in the message of the :exc:`ValueError` exception raised when\n    :func:`scrapy.utils.misc.create_instance` gets both ``settings`` and\n    ``crawler`` set to ``None`` (:issue:`4128`)\n\n\nDocumentation\n~~~~~~~~~~~~~\n\n*   API documentation now links to an online, syntax-highlighted view of the\n    corresponding source code (:issue:`4148`)\n\n*   Links to unexisting documentation pages now allow access to the sidebar\n    (:issue:`4152`, :issue:`4169`)\n\n*   Cross-references within our documentation now display a tooltip when\n    hovered (:issue:`4173`, :issue:`4183`)\n\n*   Improved the documentation about :meth:`LinkExtractor.extract_links\n    <scrapy.linkextractors.lxmlhtml.LxmlLinkExtractor.extract_links>` and\n    simplified :ref:`topics-link-extractors` (:issue:`4045`)\n\n*   Clarified how :class:`ItemLoader.item <scrapy.loader.ItemLoader.item>`\n    works (:issue:`3574`, :issue:`4099`)\n\n*   Clarified that :func:`logging.basicConfig` should not be used when also\n    using :class:`~scrapy.crawler.CrawlerProcess` (:issue:`2149`,\n    :issue:`2352`, :issue:`3146`, :issue:`3960`)\n\n*   Clarified the requirements for :class:`~scrapy.http.Request` objects\n    :ref:`when using persistence <request-serialization>` (:issue:`4124`,\n    :issue:`4139`)\n\n*   Clarified how to install a :ref:`custom image pipeline\n    <media-pipeline-example>` (:issue:`4034`, :issue:`4252`)\n\n*   Fixed the signatures of the ``file_path`` method in :ref:`media pipeline\n    <topics-media-pipeline>` examples (:issue:`4290`)\n\n*   Covered a backward-incompatible change in Scrapy 1.7.0 affecting custom\n    :class:`scrapy.core.scheduler.Scheduler` subclasses (:issue:`4274`)\n\n*   Improved the ``README.rst`` and ``CODE_OF_CONDUCT.md`` files\n    (:issue:`4059`)\n\n*   Documentation examples are now checked as part of our test suite and we\n    have fixed some of the issues detected (:issue:`4142`, :issue:`4146`,\n    :issue:`4171`, :issue:`4184`, :issue:`4190`)\n\n*   Fixed logic issues, broken links and typos (:issue:`4247`, :issue:`4258`,\n    :issue:`4282`, :issue:`4288`, :issue:`4305`, :issue:`4308`, :issue:`4323`,\n    :issue:`4338`, :issue:`4359`, :issue:`4361`)\n\n*   Improved consistency when referring to the ``__init__`` method of an object\n    (:issue:`4086`, :issue:`4088`)\n\n*   Fixed an inconsistency between code and output in :ref:`intro-overview`\n    (:issue:`4213`)\n\n*   Extended :mod:`~sphinx.ext.intersphinx` usage (:issue:`4147`,\n    :issue:`4172`, :issue:`4185`, :issue:`4194`, :issue:`4197`)\n\n*   We now use a recent version of Python to build the documentation\n    (:issue:`4140`, :issue:`4249`)\n\n*   Cleaned up documentation (:issue:`4143`, :issue:`4275`)\n\n\nQuality assurance\n~~~~~~~~~~~~~~~~~\n\n*   Re-enabled proxy ``CONNECT`` tests (:issue:`2545`, :issue:`4114`)\n\n*   Added Bandit_ security checks to our test suite (:issue:`4162`,\n    :issue:`4181`)\n\n*   Added Flake8_ style checks to our test suite and applied many of the\n    corresponding changes (:issue:`3944`, :issue:`3945`, :issue:`4137`,\n    :issue:`4157`, :issue:`4167`, :issue:`4174`, :issue:`4186`, :issue:`4195`,\n    :issue:`4238`, :issue:`4246`, :issue:`4355`, :issue:`4360`, :issue:`4365`)\n\n*   Improved test coverage (:issue:`4097`, :issue:`4218`, :issue:`4236`)\n\n*   Started reporting slowest tests, and improved the performance of some of\n    them (:issue:`4163`, :issue:`4164`)\n\n*   Fixed broken tests and refactored some tests (:issue:`4014`, :issue:`4095`,\n    :issue:`4244`, :issue:`4268`, :issue:`4372`)\n\n*   Modified the :doc:`tox <tox:index>` configuration to allow running tests\n    with any Python version, run Bandit_ and Flake8_ tests by default, and\n    enforce a minimum tox version programmatically (:issue:`4179`)\n\n*   Cleaned up code (:issue:`3937`, :issue:`4208`, :issue:`4209`,\n    :issue:`4210`, :issue:`4212`, :issue:`4369`, :issue:`4376`, :issue:`4378`)\n\n.. _Bandit: https://bandit.readthedocs.io/\n.. _Flake8: https://flake8.pycqa.org/en/latest/\n\n\n.. _2-0-0-scheduler-queue-changes:\n\nChanges to scheduler queue classes\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\nThe following changes may impact any custom queue classes of all types:\n\n*   The ``push`` method no longer receives a second positional parameter\n    containing ``request.priority * -1``. If you need that value, get it\n    from the first positional parameter, ``request``, instead, or use\n    the new :meth:`~scrapy.core.scheduler.ScrapyPriorityQueue.priority`\n    method in :class:`scrapy.core.scheduler.ScrapyPriorityQueue`\n    subclasses.\n\nThe following changes may impact custom priority queue classes:\n\n*   In the ``__init__`` method or the ``from_crawler`` or ``from_settings``\n    class methods:\n\n    *   The parameter that used to contain a factory function,\n        ``qfactory``, is now passed as a keyword parameter named\n        ``downstream_queue_cls``.\n\n    *   A new keyword parameter has been added: ``key``. It is a string\n        that is always an empty string for memory queues and indicates the\n        :setting:`JOB_DIR` value for disk queues.\n\n    *   The parameter for disk queues that contains data from the previous\n        crawl, ``startprios`` or ``slot_startprios``, is now passed as a\n        keyword parameter named ``startprios``.\n\n    *   The ``serialize`` parameter is no longer passed. The disk queue\n        class must take care of request serialization on its own before\n        writing to disk, using the\n        :func:`~scrapy.utils.reqser.request_to_dict` and\n        :func:`~scrapy.utils.reqser.request_from_dict` functions from the\n        :mod:`scrapy.utils.reqser` module.\n\nThe following changes may impact custom disk and memory queue classes:\n\n*   The signature of the ``__init__`` method is now\n    ``__init__(self, crawler, key)``.\n\nThe following changes affect specifically the\n:class:`~scrapy.core.scheduler.ScrapyPriorityQueue` and\n:class:`~scrapy.core.scheduler.DownloaderAwarePriorityQueue` classes from\n:mod:`scrapy.core.scheduler` and may affect subclasses:\n\n*   In the ``__init__`` method, most of the changes described above apply.\n\n    ``__init__`` may still receive all parameters as positional parameters,\n    however:\n\n    *   ``downstream_queue_cls``, which replaced ``qfactory``, must be\n        instantiated differently.\n\n        ``qfactory`` was instantiated with a priority value (integer).\n\n        Instances of ``downstream_queue_cls`` should be created using\n        the new\n        :meth:`ScrapyPriorityQueue.qfactory <scrapy.core.scheduler.ScrapyPriorityQueue.qfactory>`\n        or\n        :meth:`DownloaderAwarePriorityQueue.pqfactory <scrapy.core.scheduler.DownloaderAwarePriorityQueue.pqfactory>`\n        methods.\n\n    *   The new ``key`` parameter displaced the ``startprios``\n        parameter 1 position to the right.\n\n*   The following class attributes have been added:\n\n    *   :attr:`~scrapy.core.scheduler.ScrapyPriorityQueue.crawler`\n\n    *   :attr:`~scrapy.core.scheduler.ScrapyPriorityQueue.downstream_queue_cls`\n        (details above)\n\n    *   :attr:`~scrapy.core.scheduler.ScrapyPriorityQueue.key` (details above)\n\n*   The ``serialize`` attribute has been removed (details above)\n\nThe following changes affect specifically the\n:class:`~scrapy.core.scheduler.ScrapyPriorityQueue` class and may affect\nsubclasses:\n\n*   A new :meth:`~scrapy.core.scheduler.ScrapyPriorityQueue.priority`\n    method has been added which, given a request, returns\n    ``request.priority * -1``.\n\n    It is used in :meth:`~scrapy.core.scheduler.ScrapyPriorityQueue.push`\n    to make up for the removal of its ``priority`` parameter.\n\n*   The ``spider`` attribute has been removed. Use\n    :attr:`crawler.spider <scrapy.core.scheduler.ScrapyPriorityQueue.crawler>`\n    instead.\n\nThe following changes affect specifically the\n:class:`~scrapy.core.scheduler.DownloaderAwarePriorityQueue` class and may\naffect subclasses:\n\n*   A new :attr:`~scrapy.core.scheduler.DownloaderAwarePriorityQueue.pqueues`\n    attribute offers a mapping of downloader slot names to the\n    corresponding instances of\n    :attr:`~scrapy.core.scheduler.DownloaderAwarePriorityQueue.downstream_queue_cls`.\n\n(:issue:`3884`)\n\n\n.. _release-1.8.1:\n\nScrapy 1.8.1 (2021-10-05)\n-------------------------\n\n*   **Security bug fix:**\n\n    If you use\n    :class:`~scrapy.downloadermiddlewares.httpauth.HttpAuthMiddleware`\n    (i.e. the ``http_user`` and ``http_pass`` spider attributes) for HTTP\n    authentication, any request exposes your credentials to the request target.\n\n    To prevent unintended exposure of authentication credentials to unintended\n    domains, you must now additionally set a new, additional spider attribute,\n    ``http_auth_domain``, and point it to the specific domain to which the\n    authentication credentials must be sent.\n\n    If the ``http_auth_domain`` spider attribute is not set, the domain of the\n    first request will be considered the HTTP authentication target, and\n    authentication credentials will only be sent in requests targeting that\n    domain.\n\n    If you need to send the same HTTP authentication credentials to multiple\n    domains, you can use :func:`w3lib.http.basic_auth_header` instead to\n    set the value of the ``Authorization`` header of your requests.\n\n    If you *really* want your spider to send the same HTTP authentication\n    credentials to any domain, set the ``http_auth_domain`` spider attribute\n    to ``None``.\n\n    Finally, if you are a user of `scrapy-splash`_, know that this version of\n    Scrapy breaks compatibility with scrapy-splash 0.7.2 and earlier. You will\n    need to upgrade scrapy-splash to a greater version for it to continue to\n    work.\n\n.. _scrapy-splash: https://github.com/scrapy-plugins/scrapy-splash\n\n\n.. _release-1.8.0:\n\nScrapy 1.8.0 (2019-10-28)\n-------------------------\n\nHighlights:\n\n* Dropped Python 3.4 support and updated minimum requirements; made Python 3.8\n  support official\n* New :meth:`Request.from_curl <scrapy.http.Request.from_curl>` class method\n* New :setting:`ROBOTSTXT_PARSER` and :setting:`ROBOTSTXT_USER_AGENT` settings\n* New :setting:`DOWNLOADER_CLIENT_TLS_CIPHERS` and\n  :setting:`DOWNLOADER_CLIENT_TLS_VERBOSE_LOGGING` settings\n\nBackward-incompatible changes\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n*   Python 3.4 is no longer supported, and some of the minimum requirements of\n    Scrapy have also changed:\n\n    *   :doc:`cssselect <cssselect:index>` 0.9.1\n    *   cryptography_ 2.0\n    *   lxml_ 3.5.0\n    *   pyOpenSSL_ 16.2.0\n    *   queuelib_ 1.4.2\n    *   service_identity_ 16.0.0\n    *   six_ 1.10.0\n    *   Twisted_ 17.9.0 (16.0.0 with Python 2)\n    *   zope.interface_ 4.1.3\n\n    (:issue:`3892`)\n\n*   ``JSONRequest`` is now called :class:`~scrapy.http.JsonRequest` for\n    consistency with similar classes (:issue:`3929`, :issue:`3982`)\n\n*   If you are using a custom context factory\n    (:setting:`DOWNLOADER_CLIENTCONTEXTFACTORY`), its ``__init__`` method must\n    accept two new parameters: ``tls_verbose_logging`` and ``tls_ciphers``\n    (:issue:`2111`, :issue:`3392`, :issue:`3442`, :issue:`3450`)\n\n*   :class:`~scrapy.loader.ItemLoader` now turns the values of its input item\n    into lists:\n\n    >>> item = MyItem()\n    >>> item['field'] = 'value1'\n    >>> loader = ItemLoader(item=item)\n    >>> item['field']\n    ['value1']\n\n    This is needed to allow adding values to existing fields\n    (``loader.add_value('field', 'value2')``).\n\n    (:issue:`3804`, :issue:`3819`, :issue:`3897`, :issue:`3976`, :issue:`3998`,\n    :issue:`4036`)\n\nSee also :ref:`1.8-deprecation-removals` below.\n\n\nNew features\n~~~~~~~~~~~~\n\n*   A new :meth:`Request.from_curl <scrapy.http.Request.from_curl>` class\n    method allows :ref:`creating a request from a cURL command\n    <requests-from-curl>` (:issue:`2985`, :issue:`3862`)\n\n*   A new :setting:`ROBOTSTXT_PARSER` setting allows choosing which robots.txt_\n    parser to use. It includes built-in support for\n    :ref:`RobotFileParser <python-robotfileparser>`,\n    :ref:`Protego <protego-parser>` (default), :ref:`Reppy <reppy-parser>`, and\n    :ref:`Robotexclusionrulesparser <rerp-parser>`, and allows you to\n    :ref:`implement support for additional parsers\n    <support-for-new-robots-parser>` (:issue:`754`, :issue:`2669`,\n    :issue:`3796`, :issue:`3935`, :issue:`3969`, :issue:`4006`)\n\n*   A new :setting:`ROBOTSTXT_USER_AGENT` setting allows defining a separate\n    user agent string to use for robots.txt_ parsing (:issue:`3931`,\n    :issue:`3966`)\n\n*   :class:`~scrapy.spiders.Rule` no longer requires a :class:`LinkExtractor\n    <scrapy.linkextractors.lxmlhtml.LxmlLinkExtractor>` parameter\n    (:issue:`781`, :issue:`4016`)\n\n*   Use the new :setting:`DOWNLOADER_CLIENT_TLS_CIPHERS` setting to customize\n    the TLS/SSL ciphers used by the default HTTP/1.1 downloader (:issue:`3392`,\n    :issue:`3442`)\n\n*   Set the new :setting:`DOWNLOADER_CLIENT_TLS_VERBOSE_LOGGING` setting to\n    ``True`` to enable debug-level messages about TLS connection parameters\n    after establishing HTTPS connections (:issue:`2111`, :issue:`3450`)\n\n*   Callbacks that receive keyword arguments\n    (see :attr:`Request.cb_kwargs <scrapy.http.Request.cb_kwargs>`) can now be\n    tested using the new :class:`@cb_kwargs\n    <scrapy.contracts.default.CallbackKeywordArgumentsContract>`\n    :ref:`spider contract <topics-contracts>` (:issue:`3985`, :issue:`3988`)\n\n*   When a :class:`@scrapes <scrapy.contracts.default.ScrapesContract>` spider\n    contract fails, all missing fields are now reported (:issue:`766`,\n    :issue:`3939`)\n\n*   :ref:`Custom log formats <custom-log-formats>` can now drop messages by\n    having the corresponding methods of the configured :setting:`LOG_FORMATTER`\n    return ``None`` (:issue:`3984`, :issue:`3987`)\n\n*   A much improved completion definition is now available for Zsh_\n    (:issue:`4069`)\n\n\nBug fixes\n~~~~~~~~~\n\n*   :meth:`ItemLoader.load_item() <scrapy.loader.ItemLoader.load_item>` no\n    longer makes later calls to :meth:`ItemLoader.get_output_value()\n    <scrapy.loader.ItemLoader.get_output_value>` or\n    :meth:`ItemLoader.load_item() <scrapy.loader.ItemLoader.load_item>` return\n    empty data (:issue:`3804`, :issue:`3819`, :issue:`3897`, :issue:`3976`,\n    :issue:`3998`, :issue:`4036`)\n\n*   Fixed :class:`~scrapy.statscollectors.DummyStatsCollector` raising a\n    :exc:`TypeError` exception (:issue:`4007`, :issue:`4052`)\n\n*   :meth:`FilesPipeline.file_path\n    <scrapy.pipelines.files.FilesPipeline.file_path>` and\n    :meth:`ImagesPipeline.file_path\n    <scrapy.pipelines.images.ImagesPipeline.file_path>` no longer choose\n    file extensions that are not `registered with IANA`_ (:issue:`1287`,\n    :issue:`3953`, :issue:`3954`)\n\n*   When using botocore_ to persist files in S3, all botocore-supported headers\n    are properly mapped now (:issue:`3904`, :issue:`3905`)\n\n*   FTP passwords in :setting:`FEED_URI` containing percent-escaped characters\n    are now properly decoded (:issue:`3941`)\n\n*   A memory-handling and error-handling issue in\n    :func:`scrapy.utils.ssl.get_temp_key_info` has been fixed (:issue:`3920`)\n\n\nDocumentation\n~~~~~~~~~~~~~\n\n*   The documentation now covers how to define and configure a :ref:`custom log\n    format <custom-log-formats>` (:issue:`3616`, :issue:`3660`)\n\n*   API documentation added for :class:`~scrapy.exporters.MarshalItemExporter`\n    and :class:`~scrapy.exporters.PythonItemExporter` (:issue:`3973`)\n\n*   API documentation added for :class:`~scrapy.item.BaseItem` and\n    :class:`~scrapy.item.ItemMeta` (:issue:`3999`)\n\n*   Minor documentation fixes (:issue:`2998`, :issue:`3398`, :issue:`3597`,\n    :issue:`3894`, :issue:`3934`, :issue:`3978`, :issue:`3993`, :issue:`4022`,\n    :issue:`4028`, :issue:`4033`, :issue:`4046`, :issue:`4050`, :issue:`4055`,\n    :issue:`4056`, :issue:`4061`, :issue:`4072`, :issue:`4071`, :issue:`4079`,\n    :issue:`4081`, :issue:`4089`, :issue:`4093`)\n\n\n.. _1.8-deprecation-removals:\n\nDeprecation removals\n~~~~~~~~~~~~~~~~~~~~\n\n*   ``scrapy.xlib`` has been removed (:issue:`4015`)\n\n\n.. _1.8-deprecations:\n\nDeprecations\n~~~~~~~~~~~~\n\n*   The LevelDB_ storage backend\n    (``scrapy.extensions.httpcache.LeveldbCacheStorage``) of\n    :class:`~scrapy.downloadermiddlewares.httpcache.HttpCacheMiddleware` is\n    deprecated (:issue:`4085`, :issue:`4092`)\n\n*   Use of the undocumented ``SCRAPY_PICKLED_SETTINGS_TO_OVERRIDE`` environment\n    variable is deprecated (:issue:`3910`)\n\n*   ``scrapy.item.DictItem`` is deprecated, use :class:`~scrapy.item.Item`\n    instead (:issue:`3999`)\n\n\nOther changes\n~~~~~~~~~~~~~\n\n*   Minimum versions of optional Scrapy requirements that are covered by\n    continuous integration tests have been updated:\n\n    *   botocore_ 1.3.23\n    *   Pillow_ 3.4.2\n\n    Lower versions of these optional requirements may work, but it is not\n    guaranteed (:issue:`3892`)\n\n*   GitHub templates for bug reports and feature requests (:issue:`3126`,\n    :issue:`3471`, :issue:`3749`, :issue:`3754`)\n\n*   Continuous integration fixes (:issue:`3923`)\n\n*   Code cleanup (:issue:`3391`, :issue:`3907`, :issue:`3946`, :issue:`3950`,\n    :issue:`4023`, :issue:`4031`)\n\n\n.. _release-1.7.4:\n\nScrapy 1.7.4 (2019-10-21)\n-------------------------\n\nRevert the fix for :issue:`3804` (:issue:`3819`), which has a few undesired\nside effects (:issue:`3897`, :issue:`3976`).\n\nAs a result, when an item loader is initialized with an item,\n:meth:`ItemLoader.load_item() <scrapy.loader.ItemLoader.load_item>` once again\nmakes later calls to :meth:`ItemLoader.get_output_value()\n<scrapy.loader.ItemLoader.get_output_value>` or :meth:`ItemLoader.load_item()\n<scrapy.loader.ItemLoader.load_item>` return empty data.\n\n\n.. _release-1.7.3:\n\nScrapy 1.7.3 (2019-08-01)\n-------------------------\n\nEnforce lxml 4.3.5 or lower for Python 3.4 (:issue:`3912`, :issue:`3918`).\n\n\n.. _release-1.7.2:\n\nScrapy 1.7.2 (2019-07-23)\n-------------------------\n\nFix Python 2 support (:issue:`3889`, :issue:`3893`, :issue:`3896`).\n\n\n.. _release-1.7.1:\n\nScrapy 1.7.1 (2019-07-18)\n-------------------------\n\nRe-packaging of Scrapy 1.7.0, which was missing some changes in PyPI.\n\n\n.. _release-1.7.0:\n\nScrapy 1.7.0 (2019-07-18)\n-------------------------\n\n.. note:: Make sure you install Scrapy 1.7.1. The Scrapy 1.7.0 package in PyPI\n          is the result of an erroneous commit tagging and does not include all\n          the changes described below.\n\nHighlights:\n\n* Improvements for crawls targeting multiple domains\n* A cleaner way to pass arguments to callbacks\n* A new class for JSON requests\n* Improvements for rule-based spiders\n* New features for feed exports\n\nBackward-incompatible changes\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n*   ``429`` is now part of the :setting:`RETRY_HTTP_CODES` setting by default\n\n    This change is **backward incompatible**. If you don\u2019t want to retry\n    ``429``, you must override :setting:`RETRY_HTTP_CODES` accordingly.\n\n*   :class:`~scrapy.crawler.Crawler`,\n    :class:`CrawlerRunner.crawl <scrapy.crawler.CrawlerRunner.crawl>` and\n    :class:`CrawlerRunner.create_crawler <scrapy.crawler.CrawlerRunner.create_crawler>`\n    no longer accept a :class:`~scrapy.spiders.Spider` subclass instance, they\n    only accept a :class:`~scrapy.spiders.Spider` subclass now.\n\n    :class:`~scrapy.spiders.Spider` subclass instances were never meant to\n    work, and they were not working as one would expect: instead of using the\n    passed :class:`~scrapy.spiders.Spider` subclass instance, their\n    :class:`~scrapy.spiders.Spider.from_crawler` method was called to generate\n    a new instance.\n\n*   Non-default values for the :setting:`SCHEDULER_PRIORITY_QUEUE` setting\n    may stop working. Scheduler priority queue classes now need to handle\n    :class:`~scrapy.http.Request` objects instead of arbitrary Python data\n    structures.\n\n*   An additional ``crawler`` parameter has been added to the ``__init__``\n    method of the :class:`~scrapy.core.scheduler.Scheduler` class. Custom\n    scheduler subclasses which don't accept arbitrary parameters in their\n    ``__init__`` method might break because of this change.\n\n    For more information, see :setting:`SCHEDULER`.\n\nSee also :ref:`1.7-deprecation-removals` below.\n\n\nNew features\n~~~~~~~~~~~~\n\n*   A new scheduler priority queue,\n    ``scrapy.pqueues.DownloaderAwarePriorityQueue``, may be\n    :ref:`enabled <broad-crawls-scheduler-priority-queue>` for a significant\n    scheduling improvement on crawls targeting multiple web domains, at the\n    cost of no :setting:`CONCURRENT_REQUESTS_PER_IP` support (:issue:`3520`)\n\n*   A new :attr:`Request.cb_kwargs <scrapy.http.Request.cb_kwargs>` attribute\n    provides a cleaner way to pass keyword arguments to callback methods\n    (:issue:`1138`, :issue:`3563`)\n\n*   A new :class:`JSONRequest <scrapy.http.JsonRequest>` class offers a more\n    convenient way to build JSON requests (:issue:`3504`, :issue:`3505`)\n\n*   A ``process_request`` callback passed to the :class:`~scrapy.spiders.Rule`\n    ``__init__`` method now receives the :class:`~scrapy.http.Response` object that\n    originated the request as its second argument (:issue:`3682`)\n\n*   A new ``restrict_text`` parameter for the\n    :attr:`LinkExtractor <scrapy.linkextractors.lxmlhtml.LxmlLinkExtractor>`\n    ``__init__`` method allows filtering links by linking text (:issue:`3622`,\n    :issue:`3635`)\n\n*   A new :setting:`FEED_STORAGE_S3_ACL` setting allows defining a custom ACL\n    for feeds exported to Amazon S3 (:issue:`3607`)\n\n*   A new :setting:`FEED_STORAGE_FTP_ACTIVE` setting allows using FTP\u2019s active\n    connection mode for feeds exported to FTP servers (:issue:`3829`)\n\n*   A new :setting:`METAREFRESH_IGNORE_TAGS` setting allows overriding which\n    HTML tags are ignored when searching a response for HTML meta tags that\n    trigger a redirect (:issue:`1422`, :issue:`3768`)\n\n*   A new :reqmeta:`redirect_reasons` request meta key exposes the reason\n    (status code, meta refresh) behind every followed redirect (:issue:`3581`,\n    :issue:`3687`)\n\n*   The ``SCRAPY_CHECK`` variable is now set to the ``true`` string during runs\n    of the :command:`check` command, which allows :ref:`detecting contract\n    check runs from code <detecting-contract-check-runs>` (:issue:`3704`,\n    :issue:`3739`)\n\n*   A new :meth:`Item.deepcopy() <scrapy.item.Item.deepcopy>` method makes it\n    easier to :ref:`deep-copy items <copying-items>` (:issue:`1493`,\n    :issue:`3671`)\n\n*   :class:`~scrapy.extensions.corestats.CoreStats` also logs\n    ``elapsed_time_seconds`` now (:issue:`3638`)\n\n*   Exceptions from :class:`~scrapy.loader.ItemLoader` :ref:`input and output\n    processors <topics-loaders-processors>` are now more verbose\n    (:issue:`3836`, :issue:`3840`)\n\n*   :class:`~scrapy.crawler.Crawler`,\n    :class:`CrawlerRunner.crawl <scrapy.crawler.CrawlerRunner.crawl>` and\n    :class:`CrawlerRunner.create_crawler <scrapy.crawler.CrawlerRunner.create_crawler>`\n    now fail gracefully if they receive a :class:`~scrapy.spiders.Spider`\n    subclass instance instead of the subclass itself (:issue:`2283`,\n    :issue:`3610`, :issue:`3872`)\n\n\nBug fixes\n~~~~~~~~~\n\n*   :meth:`~scrapy.spidermiddlewares.SpiderMiddleware.process_spider_exception`\n    is now also invoked for generators (:issue:`220`, :issue:`2061`)\n\n*   System exceptions like KeyboardInterrupt_ are no longer caught\n    (:issue:`3726`)\n\n*   :meth:`ItemLoader.load_item() <scrapy.loader.ItemLoader.load_item>` no\n    longer makes later calls to :meth:`ItemLoader.get_output_value()\n    <scrapy.loader.ItemLoader.get_output_value>` or\n    :meth:`ItemLoader.load_item() <scrapy.loader.ItemLoader.load_item>` return\n    empty data (:issue:`3804`, :issue:`3819`)\n\n*   The images pipeline (:class:`~scrapy.pipelines.images.ImagesPipeline`) no\n    longer ignores these Amazon S3 settings: :setting:`AWS_ENDPOINT_URL`,\n    :setting:`AWS_REGION_NAME`, :setting:`AWS_USE_SSL`, :setting:`AWS_VERIFY`\n    (:issue:`3625`)\n\n*   Fixed a memory leak in ``scrapy.pipelines.media.MediaPipeline`` affecting,\n    for example, non-200 responses and exceptions from custom middlewares\n    (:issue:`3813`)\n\n*   Requests with private callbacks are now correctly unserialized from disk\n    (:issue:`3790`)\n\n*   :meth:`FormRequest.from_response() <scrapy.http.FormRequest.from_response>`\n    now handles invalid methods like major web browsers (:issue:`3777`,\n    :issue:`3794`)\n\n\nDocumentation\n~~~~~~~~~~~~~\n\n*   A new topic, :ref:`topics-dynamic-content`, covers recommended approaches\n    to read dynamically-loaded data (:issue:`3703`)\n\n*   :ref:`topics-broad-crawls` now features information about memory usage\n    (:issue:`1264`, :issue:`3866`)\n\n*   The documentation of :class:`~scrapy.spiders.Rule` now covers how to access\n    the text of a link when using :class:`~scrapy.spiders.CrawlSpider`\n    (:issue:`3711`, :issue:`3712`)\n\n*   A new section, :ref:`httpcache-storage-custom`, covers writing a custom\n    cache storage backend for\n    :class:`~scrapy.downloadermiddlewares.httpcache.HttpCacheMiddleware`\n    (:issue:`3683`, :issue:`3692`)\n\n*   A new :ref:`FAQ <faq>` entry, :ref:`faq-split-item`, explains what to do\n    when you want to split an item into multiple items from an item pipeline\n    (:issue:`2240`, :issue:`3672`)\n\n*   Updated the :ref:`FAQ entry about crawl order <faq-bfo-dfo>` to explain why\n    the first few requests rarely follow the desired order (:issue:`1739`,\n    :issue:`3621`)\n\n*   The :setting:`LOGSTATS_INTERVAL` setting (:issue:`3730`), the\n    :meth:`FilesPipeline.file_path <scrapy.pipelines.files.FilesPipeline.file_path>`\n    and\n    :meth:`ImagesPipeline.file_path <scrapy.pipelines.images.ImagesPipeline.file_path>`\n    methods (:issue:`2253`, :issue:`3609`) and the\n    :meth:`Crawler.stop() <scrapy.crawler.Crawler.stop>` method (:issue:`3842`)\n    are now documented\n\n*   Some parts of the documentation that were confusing or misleading are now\n    clearer (:issue:`1347`, :issue:`1789`, :issue:`2289`, :issue:`3069`,\n    :issue:`3615`, :issue:`3626`, :issue:`3668`, :issue:`3670`, :issue:`3673`,\n    :issue:`3728`, :issue:`3762`, :issue:`3861`, :issue:`3882`)\n\n*   Minor documentation fixes (:issue:`3648`, :issue:`3649`, :issue:`3662`,\n    :issue:`3674`, :issue:`3676`, :issue:`3694`, :issue:`3724`, :issue:`3764`,\n    :issue:`3767`, :issue:`3791`, :issue:`3797`, :issue:`3806`, :issue:`3812`)\n\n.. _1.7-deprecation-removals:\n\nDeprecation removals\n~~~~~~~~~~~~~~~~~~~~\n\nThe following deprecated APIs have been removed (:issue:`3578`):\n\n*   ``scrapy.conf`` (use :attr:`Crawler.settings\n    <scrapy.crawler.Crawler.settings>`)\n\n*   From ``scrapy.core.downloader.handlers``:\n\n    *   ``http.HttpDownloadHandler`` (use ``http10.HTTP10DownloadHandler``)\n\n*   ``scrapy.loader.ItemLoader._get_values`` (use ``_get_xpathvalues``)\n\n*   ``scrapy.loader.XPathItemLoader`` (use :class:`~scrapy.loader.ItemLoader`)\n\n*   ``scrapy.log`` (see :ref:`topics-logging`)\n\n*   From ``scrapy.pipelines``:\n\n    *   ``files.FilesPipeline.file_key`` (use ``file_path``)\n\n    *   ``images.ImagesPipeline.file_key`` (use ``file_path``)\n\n    *   ``images.ImagesPipeline.image_key`` (use ``file_path``)\n\n    *   ``images.ImagesPipeline.thumb_key`` (use ``thumb_path``)\n\n*   From both ``scrapy.selector`` and ``scrapy.selector.lxmlsel``:\n\n    *   ``HtmlXPathSelector`` (use :class:`~scrapy.selector.Selector`)\n\n    *   ``XmlXPathSelector`` (use :class:`~scrapy.selector.Selector`)\n\n    *   ``XPathSelector`` (use :class:`~scrapy.selector.Selector`)\n\n    *   ``XPathSelectorList`` (use :class:`~scrapy.selector.Selector`)\n\n*   From ``scrapy.selector.csstranslator``:\n\n    *   ``ScrapyGenericTranslator`` (use parsel.csstranslator.GenericTranslator_)\n\n    *   ``ScrapyHTMLTranslator`` (use parsel.csstranslator.HTMLTranslator_)\n\n    *   ``ScrapyXPathExpr`` (use parsel.csstranslator.XPathExpr_)\n\n*   From :class:`~scrapy.selector.Selector`:\n\n    *   ``_root`` (both the ``__init__`` method argument and the object property, use\n        ``root``)\n\n    *   ``extract_unquoted`` (use ``getall``)\n\n    *   ``select`` (use ``xpath``)\n\n*   From :class:`~scrapy.selector.SelectorList`:\n\n    *   ``extract_unquoted`` (use ``getall``)\n\n    *   ``select`` (use ``xpath``)\n\n    *   ``x`` (use ``xpath``)\n\n*   ``scrapy.spiders.BaseSpider`` (use :class:`~scrapy.spiders.Spider`)\n\n*   From :class:`~scrapy.spiders.Spider` (and subclasses):\n\n    *   ``DOWNLOAD_DELAY`` (use :ref:`download_delay\n        <spider-download_delay-attribute>`)\n\n    *   ``set_crawler`` (use :meth:`~scrapy.spiders.Spider.from_crawler`)\n\n*   ``scrapy.spiders.spiders`` (use :class:`~scrapy.spiderloader.SpiderLoader`)\n\n*   ``scrapy.telnet`` (use :mod:`scrapy.extensions.telnet`)\n\n*   From ``scrapy.utils.python``:\n\n    *   ``str_to_unicode`` (use ``to_unicode``)\n\n    *   ``unicode_to_str`` (use ``to_bytes``)\n\n*   ``scrapy.utils.response.body_or_str``\n\nThe following deprecated settings have also been removed (:issue:`3578`):\n\n*   ``SPIDER_MANAGER_CLASS`` (use :setting:`SPIDER_LOADER_CLASS`)\n\n\n.. _1.7-deprecations:\n\nDeprecations\n~~~~~~~~~~~~\n\n*   The ``queuelib.PriorityQueue`` value for the\n    :setting:`SCHEDULER_PRIORITY_QUEUE` setting is deprecated. Use\n    ``scrapy.pqueues.ScrapyPriorityQueue`` instead.\n\n*   ``process_request`` callbacks passed to :class:`~scrapy.spiders.Rule` that\n    do not accept two arguments are deprecated.\n\n*   The following modules are deprecated:\n\n    *   ``scrapy.utils.http`` (use `w3lib.http`_)\n\n    *   ``scrapy.utils.markup`` (use `w3lib.html`_)\n\n    *   ``scrapy.utils.multipart`` (use `urllib3`_)\n\n*   The ``scrapy.utils.datatypes.MergeDict`` class is deprecated for Python 3\n    code bases. Use :class:`~collections.ChainMap` instead. (:issue:`3878`)\n\n*   The ``scrapy.utils.gz.is_gzipped`` function is deprecated. Use\n    ``scrapy.utils.gz.gzip_magic_number`` instead.\n\n.. _urllib3: https://urllib3.readthedocs.io/en/latest/index.html\n.. _w3lib.html: https://w3lib.readthedocs.io/en/latest/w3lib.html#module-w3lib.html\n.. _w3lib.http: https://w3lib.readthedocs.io/en/latest/w3lib.html#module-w3lib.http\n\n\nOther changes\n~~~~~~~~~~~~~\n\n*   It is now possible to run all tests from the same tox_ environment in\n    parallel; the documentation now covers :ref:`this and other ways to run\n    tests <running-tests>` (:issue:`3707`)\n\n*   It is now possible to generate an API documentation coverage report\n    (:issue:`3806`, :issue:`3810`, :issue:`3860`)\n\n*   The :ref:`documentation policies <documentation-policies>` now require\n    docstrings_ (:issue:`3701`) that follow `PEP 257`_ (:issue:`3748`)\n\n*   Internal fixes and cleanup (:issue:`3629`, :issue:`3643`, :issue:`3684`,\n    :issue:`3698`, :issue:`3734`, :issue:`3735`, :issue:`3736`, :issue:`3737`,\n    :issue:`3809`, :issue:`3821`, :issue:`3825`, :issue:`3827`, :issue:`3833`,\n    :issue:`3857`, :issue:`3877`)\n\n.. _release-1.6.0:\n\nScrapy 1.6.0 (2019-01-30)\n-------------------------\n\nHighlights:\n\n* better Windows support;\n* Python 3.7 compatibility;\n* big documentation improvements, including a switch\n  from ``.extract_first()`` + ``.extract()`` API to ``.get()`` + ``.getall()``\n  API;\n* feed exports, FilePipeline and MediaPipeline improvements;\n* better extensibility: :signal:`item_error` and\n  :signal:`request_reached_downloader` signals; ``from_crawler`` support\n  for feed exporters, feed storages and dupefilters.\n* ``scrapy.contracts`` fixes and new features;\n* telnet console security improvements, first released as a\n  backport in :ref:`release-1.5.2`;\n* clean-up of the deprecated code;\n* various bug fixes, small new features and usability improvements across\n  the codebase.\n\nSelector API changes\n~~~~~~~~~~~~~~~~~~~~\n\nWhile these are not changes in Scrapy itself, but rather in the parsel_\nlibrary which Scrapy uses for xpath/css selectors, these changes are\nworth mentioning here. Scrapy now depends on parsel >= 1.5, and\nScrapy documentation is updated to follow recent ``parsel`` API conventions.\n\nMost visible change is that ``.get()`` and ``.getall()`` selector\nmethods are now preferred over ``.extract_first()`` and ``.extract()``.\nWe feel that these new methods result in a more concise and readable code.\nSee :ref:`old-extraction-api` for more details.\n\n.. note::\n    There are currently **no plans** to deprecate ``.extract()``\n    and ``.extract_first()`` methods.\n\nAnother useful new feature is the introduction of ``Selector.attrib`` and\n``SelectorList.attrib`` properties, which make it easier to get\nattributes of HTML elements. See :ref:`selecting-attributes`.\n\nCSS selectors are cached in parsel >= 1.5, which makes them faster\nwhen the same CSS path is used many times. This is very common in\ncase of Scrapy spiders: callbacks are usually called several times,\non different pages.\n\nIf you're using custom ``Selector`` or ``SelectorList`` subclasses,\na **backward incompatible** change in parsel may affect your code.\nSee `parsel changelog`_ for a detailed description, as well as for the\nfull list of improvements.\n\n.. _parsel changelog: https://parsel.readthedocs.io/en/latest/history.html\n\nTelnet console\n~~~~~~~~~~~~~~\n\n**Backward incompatible**: Scrapy's telnet console now requires username\nand password. See :ref:`topics-telnetconsole` for more details. This change\nfixes a **security issue**; see :ref:`release-1.5.2` release notes for details.\n\nNew extensibility features\n~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n* ``from_crawler`` support is added to feed exporters and feed storages. This,\n  among other things, allows to access Scrapy settings from custom feed\n  storages and exporters (:issue:`1605`, :issue:`3348`).\n* ``from_crawler`` support is added to dupefilters (:issue:`2956`); this allows\n  to access e.g. settings or a spider from a dupefilter.\n* :signal:`item_error` is fired when an error happens in a pipeline\n  (:issue:`3256`);\n* :signal:`request_reached_downloader` is fired when Downloader gets\n  a new Request; this signal can be useful e.g. for custom Schedulers\n  (:issue:`3393`).\n* new SitemapSpider :meth:`~.SitemapSpider.sitemap_filter` method which allows\n  to select sitemap entries based on their attributes in SitemapSpider\n  subclasses (:issue:`3512`).\n* Lazy loading of Downloader Handlers is now optional; this enables better\n  initialization error handling in custom Downloader Handlers (:issue:`3394`).\n\nNew FilePipeline and MediaPipeline features\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n* Expose more options for S3FilesStore: :setting:`AWS_ENDPOINT_URL`,\n  :setting:`AWS_USE_SSL`, :setting:`AWS_VERIFY`, :setting:`AWS_REGION_NAME`.\n  For example, this allows to use alternative or self-hosted\n  AWS-compatible providers (:issue:`2609`, :issue:`3548`).\n* ACL support for Google Cloud Storage: :setting:`FILES_STORE_GCS_ACL` and\n  :setting:`IMAGES_STORE_GCS_ACL` (:issue:`3199`).\n\n``scrapy.contracts`` improvements\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n* Exceptions in contracts code are handled better (:issue:`3377`);\n* ``dont_filter=True`` is used for contract requests, which allows to test\n  different callbacks with the same URL (:issue:`3381`);\n* ``request_cls`` attribute in Contract subclasses allow to use different\n  Request classes in contracts, for example FormRequest (:issue:`3383`).\n* Fixed errback handling in contracts, e.g. for cases where a contract\n  is executed for URL which returns non-200 response (:issue:`3371`).\n\nUsability improvements\n~~~~~~~~~~~~~~~~~~~~~~\n\n* more stats for RobotsTxtMiddleware (:issue:`3100`)\n* INFO log level is used to show telnet host/port (:issue:`3115`)\n* a message is added to IgnoreRequest in RobotsTxtMiddleware (:issue:`3113`)\n* better validation of ``url`` argument in ``Response.follow`` (:issue:`3131`)\n* non-zero exit code is returned from Scrapy commands when error happens\n  on spider initialization (:issue:`3226`)\n* Link extraction improvements: \"ftp\" is added to scheme list (:issue:`3152`);\n  \"flv\" is added to common video extensions (:issue:`3165`)\n* better error message when an exporter is disabled (:issue:`3358`);\n* ``scrapy shell --help`` mentions syntax required for local files\n  (``./file.html``) - :issue:`3496`.\n* Referer header value is added to RFPDupeFilter log messages (:issue:`3588`)\n\nBug fixes\n~~~~~~~~~\n\n* fixed issue with extra blank lines in .csv exports under Windows\n  (:issue:`3039`);\n* proper handling of pickling errors in Python 3 when serializing objects\n  for disk queues (:issue:`3082`)\n* flags are now preserved when copying Requests (:issue:`3342`);\n* FormRequest.from_response clickdata shouldn't ignore elements with\n  ``input[type=image]`` (:issue:`3153`).\n* FormRequest.from_response should preserve duplicate keys (:issue:`3247`)\n\nDocumentation improvements\n~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n* Docs are re-written to suggest .get/.getall API instead of\n  .extract/.extract_first. Also, :ref:`topics-selectors` docs are updated\n  and re-structured to match latest parsel docs; they now contain more topics,\n  such as :ref:`selecting-attributes` or :ref:`topics-selectors-css-extensions`\n  (:issue:`3390`).\n* :ref:`topics-developer-tools` is a new tutorial which replaces\n  old Firefox and Firebug tutorials (:issue:`3400`).\n* SCRAPY_PROJECT environment variable is documented (:issue:`3518`);\n* troubleshooting section is added to install instructions (:issue:`3517`);\n* improved links to beginner resources in the tutorial\n  (:issue:`3367`, :issue:`3468`);\n* fixed :setting:`RETRY_HTTP_CODES` default values in docs (:issue:`3335`);\n* remove unused ``DEPTH_STATS`` option from docs (:issue:`3245`);\n* other cleanups (:issue:`3347`, :issue:`3350`, :issue:`3445`, :issue:`3544`,\n  :issue:`3605`).\n\nDeprecation removals\n~~~~~~~~~~~~~~~~~~~~\n\nCompatibility shims for pre-1.0 Scrapy module names are removed\n(:issue:`3318`):\n\n* ``scrapy.command``\n* ``scrapy.contrib`` (with all submodules)\n* ``scrapy.contrib_exp`` (with all submodules)\n* ``scrapy.dupefilter``\n* ``scrapy.linkextractor``\n* ``scrapy.project``\n* ``scrapy.spider``\n* ``scrapy.spidermanager``\n* ``scrapy.squeue``\n* ``scrapy.stats``\n* ``scrapy.statscol``\n* ``scrapy.utils.decorator``\n\nSee :ref:`module-relocations` for more information, or use suggestions\nfrom Scrapy 1.5.x deprecation warnings to update your code.\n\nOther deprecation removals:\n\n* Deprecated scrapy.interfaces.ISpiderManager is removed; please use\n  scrapy.interfaces.ISpiderLoader.\n* Deprecated ``CrawlerSettings`` class is removed (:issue:`3327`).\n* Deprecated ``Settings.overrides`` and ``Settings.defaults`` attributes\n  are removed (:issue:`3327`, :issue:`3359`).\n\nOther improvements, cleanups\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n* All Scrapy tests now pass on Windows; Scrapy testing suite is executed\n  in a Windows environment on CI (:issue:`3315`).\n* Python 3.7 support (:issue:`3326`, :issue:`3150`, :issue:`3547`).\n* Testing and CI fixes (:issue:`3526`, :issue:`3538`, :issue:`3308`,\n  :issue:`3311`, :issue:`3309`, :issue:`3305`, :issue:`3210`, :issue:`3299`)\n* ``scrapy.http.cookies.CookieJar.clear`` accepts \"domain\", \"path\" and \"name\"\n  optional arguments (:issue:`3231`).\n* additional files are included to sdist (:issue:`3495`);\n* code style fixes (:issue:`3405`, :issue:`3304`);\n* unneeded .strip() call is removed (:issue:`3519`);\n* collections.deque is used to store MiddlewareManager methods instead\n  of a list (:issue:`3476`)\n\n.. _release-1.5.2:\n\nScrapy 1.5.2 (2019-01-22)\n-------------------------\n\n* *Security bugfix*: Telnet console extension can be easily exploited by rogue\n  websites POSTing content to http://localhost:6023, we haven't found a way to\n  exploit it from Scrapy, but it is very easy to trick a browser to do so and\n  elevates the risk for local development environment.\n\n  *The fix is backward incompatible*, it enables telnet user-password\n  authentication by default with a random generated password. If you can't\n  upgrade right away, please consider setting :setting:`TELNETCONSOLE_PORT`\n  out of its default value.\n\n  See :ref:`telnet console <topics-telnetconsole>` documentation for more info\n\n* Backport CI build failure under GCE environment due to boto import error.\n\n.. _release-1.5.1:\n\nScrapy 1.5.1 (2018-07-12)\n-------------------------\n\nThis is a maintenance release with important bug fixes, but no new features:\n\n* ``O(N^2)`` gzip decompression issue which affected Python 3 and PyPy\n  is fixed (:issue:`3281`);\n* skipping of TLS validation errors is improved (:issue:`3166`);\n* Ctrl-C handling is fixed in Python 3.5+ (:issue:`3096`);\n* testing fixes (:issue:`3092`, :issue:`3263`);\n* documentation improvements (:issue:`3058`, :issue:`3059`, :issue:`3089`,\n  :issue:`3123`, :issue:`3127`, :issue:`3189`, :issue:`3224`, :issue:`3280`,\n  :issue:`3279`, :issue:`3201`, :issue:`3260`, :issue:`3284`, :issue:`3298`,\n  :issue:`3294`).\n\n\n.. _release-1.5.0:\n\nScrapy 1.5.0 (2017-12-29)\n-------------------------\n\nThis release brings small new features and improvements across the codebase.\nSome highlights:\n\n* Google Cloud Storage is supported in FilesPipeline and ImagesPipeline.\n* Crawling with proxy servers becomes more efficient, as connections\n  to proxies can be reused now.\n* Warnings, exception and logging messages are improved to make debugging\n  easier.\n* ``scrapy parse`` command now allows to set custom request meta via\n  ``--meta`` argument.\n* Compatibility with Python 3.6, PyPy and PyPy3 is improved;\n  PyPy and PyPy3 are now supported officially, by running tests on CI.\n* Better default handling of HTTP 308, 522 and 524 status codes.\n* Documentation is improved, as usual.\n\nBackward Incompatible Changes\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n* Scrapy 1.5 drops support for Python 3.3.\n* Default Scrapy User-Agent now uses https link to scrapy.org (:issue:`2983`).\n  **This is technically backward-incompatible**; override\n  :setting:`USER_AGENT` if you relied on old value.\n* Logging of settings overridden by ``custom_settings`` is fixed;\n  **this is technically backward-incompatible** because the logger\n  changes from ``[scrapy.utils.log]`` to ``[scrapy.crawler]``. If you're\n  parsing Scrapy logs, please update your log parsers (:issue:`1343`).\n* LinkExtractor now ignores ``m4v`` extension by default, this is change\n  in behavior.\n* 522 and 524 status codes are added to ``RETRY_HTTP_CODES`` (:issue:`2851`)\n\nNew features\n~~~~~~~~~~~~\n\n- Support ``<link>`` tags in ``Response.follow`` (:issue:`2785`)\n- Support for ``ptpython`` REPL (:issue:`2654`)\n- Google Cloud Storage support for FilesPipeline and ImagesPipeline\n  (:issue:`2923`).\n- New ``--meta`` option of the \"scrapy parse\" command allows to pass additional\n  request.meta (:issue:`2883`)\n- Populate spider variable when using ``shell.inspect_response`` (:issue:`2812`)\n- Handle HTTP 308 Permanent Redirect (:issue:`2844`)\n- Add 522 and 524 to ``RETRY_HTTP_CODES`` (:issue:`2851`)\n- Log versions information at startup (:issue:`2857`)\n- ``scrapy.mail.MailSender`` now works in Python 3 (it requires Twisted 17.9.0)\n- Connections to proxy servers are reused (:issue:`2743`)\n- Add template for a downloader middleware (:issue:`2755`)\n- Explicit message for NotImplementedError when parse callback not defined\n  (:issue:`2831`)\n- CrawlerProcess got an option to disable installation of root log handler\n  (:issue:`2921`)\n- LinkExtractor now ignores ``m4v`` extension by default\n- Better log messages for responses over :setting:`DOWNLOAD_WARNSIZE` and\n  :setting:`DOWNLOAD_MAXSIZE` limits (:issue:`2927`)\n- Show warning when a URL is put to ``Spider.allowed_domains`` instead of\n  a domain (:issue:`2250`).\n\nBug fixes\n~~~~~~~~~\n\n- Fix logging of settings overridden by ``custom_settings``;\n  **this is technically backward-incompatible** because the logger\n  changes from ``[scrapy.utils.log]`` to ``[scrapy.crawler]``, so please\n  update your log parsers if needed (:issue:`1343`)\n- Default Scrapy User-Agent now uses https link to scrapy.org (:issue:`2983`).\n  **This is technically backward-incompatible**; override\n  :setting:`USER_AGENT` if you relied on old value.\n- Fix PyPy and PyPy3 test failures, support them officially\n  (:issue:`2793`, :issue:`2935`, :issue:`2990`, :issue:`3050`, :issue:`2213`,\n  :issue:`3048`)\n- Fix DNS resolver when ``DNSCACHE_ENABLED=False`` (:issue:`2811`)\n- Add ``cryptography`` for Debian Jessie tox test env (:issue:`2848`)\n- Add verification to check if Request callback is callable (:issue:`2766`)\n- Port ``extras/qpsclient.py`` to Python 3 (:issue:`2849`)\n- Use getfullargspec under the scenes for Python 3 to stop DeprecationWarning\n  (:issue:`2862`)\n- Update deprecated test aliases (:issue:`2876`)\n- Fix ``SitemapSpider`` support for alternate links (:issue:`2853`)\n\nDocs\n~~~~\n\n- Added missing bullet point for the ``AUTOTHROTTLE_TARGET_CONCURRENCY``\n  setting. (:issue:`2756`)\n- Update Contributing docs, document new support channels\n  (:issue:`2762`, issue:`3038`)\n- Include references to Scrapy subreddit in the docs\n- Fix broken links; use https:// for external links\n  (:issue:`2978`, :issue:`2982`, :issue:`2958`)\n- Document CloseSpider extension better (:issue:`2759`)\n- Use ``pymongo.collection.Collection.insert_one()`` in MongoDB example\n  (:issue:`2781`)\n- Spelling mistake and typos\n  (:issue:`2828`, :issue:`2837`, :issue:`2884`, :issue:`2924`)\n- Clarify ``CSVFeedSpider.headers`` documentation (:issue:`2826`)\n- Document ``DontCloseSpider`` exception and clarify ``spider_idle``\n  (:issue:`2791`)\n- Update \"Releases\" section in README (:issue:`2764`)\n- Fix rst syntax in ``DOWNLOAD_FAIL_ON_DATALOSS`` docs (:issue:`2763`)\n- Small fix in description of startproject arguments (:issue:`2866`)\n- Clarify data types in Response.body docs (:issue:`2922`)\n- Add a note about ``request.meta['depth']`` to DepthMiddleware docs (:issue:`2374`)\n- Add a note about ``request.meta['dont_merge_cookies']`` to CookiesMiddleware\n  docs (:issue:`2999`)\n- Up-to-date example of project structure (:issue:`2964`, :issue:`2976`)\n- A better example of ItemExporters usage (:issue:`2989`)\n- Document ``from_crawler`` methods for spider and downloader middlewares\n  (:issue:`3019`)\n\n.. _release-1.4.0:\n\nScrapy 1.4.0 (2017-05-18)\n-------------------------\n\nScrapy 1.4 does not bring that many breathtaking new features\nbut quite a few handy improvements nonetheless.\n\nScrapy now supports anonymous FTP sessions with customizable user and\npassword via the new :setting:`FTP_USER` and :setting:`FTP_PASSWORD` settings.\nAnd if you're using Twisted version 17.1.0 or above, FTP is now available\nwith Python 3.\n\nThere's a new :meth:`response.follow <scrapy.http.TextResponse.follow>` method\nfor creating requests; **it is now a recommended way to create Requests\nin Scrapy spiders**. This method makes it easier to write correct\nspiders; ``response.follow`` has several advantages over creating\n``scrapy.Request`` objects directly:\n\n* it handles relative URLs;\n* it works properly with non-ascii URLs on non-UTF8 pages;\n* in addition to absolute and relative URLs it supports Selectors;\n  for ``<a>`` elements it can also extract their href values.\n\nFor example, instead of this::\n\n    for href in response.css('li.page a::attr(href)').extract():\n        url = response.urljoin(href)\n        yield scrapy.Request(url, self.parse, encoding=response.encoding)\n\nOne can now write this::\n\n    for a in response.css('li.page a'):\n        yield response.follow(a, self.parse)\n\nLink extractors are also improved. They work similarly to what a regular\nmodern browser would do: leading and trailing whitespace are removed\nfrom attributes (think ``href=\"   http://example.com\"``) when building\n``Link`` objects. This whitespace-stripping also happens for ``action``\nattributes with ``FormRequest``.\n\n**Please also note that link extractors do not canonicalize URLs by default\nanymore.** This was puzzling users every now and then, and it's not what\nbrowsers do in fact, so we removed that extra transformation on extracted\nlinks.\n\nFor those of you wanting more control on the ``Referer:`` header that Scrapy\nsends when following links, you can set your own ``Referrer Policy``.\nPrior to Scrapy 1.4, the default ``RefererMiddleware`` would simply and\nblindly set it to the URL of the response that generated the HTTP request\n(which could leak information on your URL seeds).\nBy default, Scrapy now behaves much like your regular browser does.\nAnd this policy is fully customizable with W3C standard values\n(or with something really custom of your own if you wish).\nSee :setting:`REFERRER_POLICY` for details.\n\nTo make Scrapy spiders easier to debug, Scrapy logs more stats by default\nin 1.4: memory usage stats, detailed retry stats, detailed HTTP error code\nstats. A similar change is that HTTP cache path is also visible in logs now.\n\nLast but not least, Scrapy now has the option to make JSON and XML items\nmore human-readable, with newlines between items and even custom indenting\noffset, using the new :setting:`FEED_EXPORT_INDENT` setting.\n\nEnjoy! (Or read on for the rest of changes in this release.)\n\nDeprecations and Backward Incompatible Changes\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Default to ``canonicalize=False`` in\n  :class:`scrapy.linkextractors.LinkExtractor\n  <scrapy.linkextractors.lxmlhtml.LxmlLinkExtractor>`\n  (:issue:`2537`, fixes :issue:`1941` and :issue:`1982`):\n  **warning, this is technically backward-incompatible**\n- Enable memusage extension by default (:issue:`2539`, fixes :issue:`2187`);\n  **this is technically backward-incompatible** so please check if you have\n  any non-default ``MEMUSAGE_***`` options set.\n- ``EDITOR`` environment variable now takes precedence over ``EDITOR``\n  option defined in settings.py (:issue:`1829`); Scrapy default settings\n  no longer depend on environment variables. **This is technically a backward\n  incompatible change**.\n- ``Spider.make_requests_from_url`` is deprecated\n  (:issue:`1728`, fixes :issue:`1495`).\n\nNew Features\n~~~~~~~~~~~~\n\n- Accept proxy credentials in :reqmeta:`proxy` request meta key (:issue:`2526`)\n- Support `brotli`_-compressed content; requires optional `brotlipy`_\n  (:issue:`2535`)\n- New :ref:`response.follow <response-follow-example>` shortcut\n  for creating requests (:issue:`1940`)\n- Added ``flags`` argument and attribute to :class:`Request <scrapy.http.Request>`\n  objects (:issue:`2047`)\n- Support Anonymous FTP (:issue:`2342`)\n- Added ``retry/count``, ``retry/max_reached`` and ``retry/reason_count/<reason>``\n  stats to :class:`RetryMiddleware <scrapy.downloadermiddlewares.retry.RetryMiddleware>`\n  (:issue:`2543`)\n- Added ``httperror/response_ignored_count`` and ``httperror/response_ignored_status_count/<status>``\n  stats to :class:`HttpErrorMiddleware <scrapy.spidermiddlewares.httperror.HttpErrorMiddleware>`\n  (:issue:`2566`)\n- Customizable :setting:`Referrer policy <REFERRER_POLICY>` in\n  :class:`RefererMiddleware <scrapy.spidermiddlewares.referer.RefererMiddleware>`\n  (:issue:`2306`)\n- New ``data:`` URI download handler (:issue:`2334`, fixes :issue:`2156`)\n- Log cache directory when HTTP Cache is used (:issue:`2611`, fixes :issue:`2604`)\n- Warn users when project contains duplicate spider names (fixes :issue:`2181`)\n- ``scrapy.utils.datatypes.CaselessDict`` now accepts ``Mapping`` instances and\n  not only dicts (:issue:`2646`)\n- :ref:`Media downloads <topics-media-pipeline>`, with\n  :class:`~scrapy.pipelines.files.FilesPipeline` or\n  :class:`~scrapy.pipelines.images.ImagesPipeline`, can now optionally handle\n  HTTP redirects using the new :setting:`MEDIA_ALLOW_REDIRECTS` setting\n  (:issue:`2616`, fixes :issue:`2004`)\n- Accept non-complete responses from websites using a new\n  :setting:`DOWNLOAD_FAIL_ON_DATALOSS` setting (:issue:`2590`, fixes :issue:`2586`)\n- Optional pretty-printing of JSON and XML items via\n  :setting:`FEED_EXPORT_INDENT` setting (:issue:`2456`, fixes :issue:`1327`)\n- Allow dropping fields in ``FormRequest.from_response`` formdata when\n  ``None`` value is passed (:issue:`667`)\n- Per-request retry times with the new :reqmeta:`max_retry_times` meta key\n  (:issue:`2642`)\n- ``python -m scrapy`` as a more explicit alternative to ``scrapy`` command\n  (:issue:`2740`)\n\n.. _brotli: https://github.com/google/brotli\n.. _brotlipy: https://github.com/python-hyper/brotlipy/\n\nBug fixes\n~~~~~~~~~\n\n- LinkExtractor now strips leading and trailing whitespaces from attributes\n  (:issue:`2547`, fixes :issue:`1614`)\n- Properly handle whitespaces in action attribute in\n  :class:`~scrapy.http.FormRequest` (:issue:`2548`)\n- Buffer CONNECT response bytes from proxy until all HTTP headers are received\n  (:issue:`2495`, fixes :issue:`2491`)\n- FTP downloader now works on Python 3, provided you use Twisted>=17.1\n  (:issue:`2599`)\n- Use body to choose response type after decompressing content (:issue:`2393`,\n  fixes :issue:`2145`)\n- Always decompress ``Content-Encoding: gzip`` at :class:`HttpCompressionMiddleware\n  <scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware>` stage (:issue:`2391`)\n- Respect custom log level in ``Spider.custom_settings`` (:issue:`2581`,\n  fixes :issue:`1612`)\n- 'make htmlview' fix for macOS (:issue:`2661`)\n- Remove \"commands\" from the command list  (:issue:`2695`)\n- Fix duplicate Content-Length header for POST requests with empty body (:issue:`2677`)\n- Properly cancel large downloads, i.e. above :setting:`DOWNLOAD_MAXSIZE` (:issue:`1616`)\n- ImagesPipeline: fixed processing of transparent PNG images with palette\n  (:issue:`2675`)\n\nCleanups & Refactoring\n~~~~~~~~~~~~~~~~~~~~~~\n\n- Tests: remove temp files and folders (:issue:`2570`),\n  fixed ProjectUtilsTest on macOS (:issue:`2569`),\n  use portable pypy for Linux on Travis CI (:issue:`2710`)\n- Separate building request from ``_requests_to_follow`` in CrawlSpider (:issue:`2562`)\n- Remove \u201cPython 3 progress\u201d badge (:issue:`2567`)\n- Add a couple more lines to ``.gitignore`` (:issue:`2557`)\n- Remove bumpversion prerelease configuration (:issue:`2159`)\n- Add codecov.yml file (:issue:`2750`)\n- Set context factory implementation based on Twisted version (:issue:`2577`,\n  fixes :issue:`2560`)\n- Add omitted ``self`` arguments in default project middleware template (:issue:`2595`)\n- Remove redundant ``slot.add_request()`` call in ExecutionEngine (:issue:`2617`)\n- Catch more specific ``os.error`` exception in\n  ``scrapy.pipelines.files.FSFilesStore`` (:issue:`2644`)\n- Change \"localhost\" test server certificate (:issue:`2720`)\n- Remove unused ``MEMUSAGE_REPORT`` setting (:issue:`2576`)\n\nDocumentation\n~~~~~~~~~~~~~\n\n- Binary mode is required for exporters (:issue:`2564`, fixes :issue:`2553`)\n- Mention issue with :meth:`FormRequest.from_response\n  <scrapy.http.FormRequest.from_response>` due to bug in lxml (:issue:`2572`)\n- Use single quotes uniformly in templates (:issue:`2596`)\n- Document :reqmeta:`ftp_user` and :reqmeta:`ftp_password` meta keys (:issue:`2587`)\n- Removed section on deprecated ``contrib/`` (:issue:`2636`)\n- Recommend Anaconda when installing Scrapy on Windows\n  (:issue:`2477`, fixes :issue:`2475`)\n- FAQ: rewrite note on Python 3 support on Windows (:issue:`2690`)\n- Rearrange selector sections (:issue:`2705`)\n- Remove ``__nonzero__`` from :class:`~scrapy.selector.SelectorList`\n  docs (:issue:`2683`)\n- Mention how to disable request filtering in documentation of\n  :setting:`DUPEFILTER_CLASS` setting (:issue:`2714`)\n- Add sphinx_rtd_theme to docs setup readme (:issue:`2668`)\n- Open file in text mode in JSON item writer example (:issue:`2729`)\n- Clarify ``allowed_domains`` example (:issue:`2670`)\n\n\n.. _release-1.3.3:\n\nScrapy 1.3.3 (2017-03-10)\n-------------------------\n\nBug fixes\n~~~~~~~~~\n\n- Make ``SpiderLoader`` raise ``ImportError`` again by default for missing\n  dependencies and wrong :setting:`SPIDER_MODULES`.\n  These exceptions were silenced as warnings since 1.3.0.\n  A new setting is introduced to toggle between warning or exception if needed ;\n  see :setting:`SPIDER_LOADER_WARN_ONLY` for details.\n\n.. _release-1.3.2:\n\nScrapy 1.3.2 (2017-02-13)\n-------------------------\n\nBug fixes\n~~~~~~~~~\n\n- Preserve request class when converting to/from dicts (utils.reqser) (:issue:`2510`).\n- Use consistent selectors for author field in tutorial (:issue:`2551`).\n- Fix TLS compatibility in Twisted 17+ (:issue:`2558`)\n\n.. _release-1.3.1:\n\nScrapy 1.3.1 (2017-02-08)\n-------------------------\n\nNew features\n~~~~~~~~~~~~\n\n- Support ``'True'`` and ``'False'`` string values for boolean settings (:issue:`2519`);\n  you can now do something like ``scrapy crawl myspider -s REDIRECT_ENABLED=False``.\n- Support kwargs with ``response.xpath()`` to use :ref:`XPath variables <topics-selectors-xpath-variables>`\n  and ad-hoc namespaces declarations ;\n  this requires at least Parsel v1.1 (:issue:`2457`).\n- Add support for Python 3.6 (:issue:`2485`).\n- Run tests on PyPy (warning: some tests still fail, so PyPy is not supported yet).\n\nBug fixes\n~~~~~~~~~\n\n- Enforce ``DNS_TIMEOUT`` setting (:issue:`2496`).\n- Fix :command:`view` command ; it was a regression in v1.3.0 (:issue:`2503`).\n- Fix tests regarding ``*_EXPIRES settings`` with Files/Images pipelines (:issue:`2460`).\n- Fix name of generated pipeline class when using basic project template (:issue:`2466`).\n- Fix compatibility with Twisted 17+ (:issue:`2496`, :issue:`2528`).\n- Fix ``scrapy.Item`` inheritance on Python 3.6 (:issue:`2511`).\n- Enforce numeric values for components order in ``SPIDER_MIDDLEWARES``,\n  ``DOWNLOADER_MIDDLEWARES``, ``EXTENSIONS`` and ``SPIDER_CONTRACTS`` (:issue:`2420`).\n\nDocumentation\n~~~~~~~~~~~~~\n\n- Reword Code of Conduct section and upgrade to Contributor Covenant v1.4\n  (:issue:`2469`).\n- Clarify that passing spider arguments converts them to spider attributes\n  (:issue:`2483`).\n- Document ``formid`` argument on ``FormRequest.from_response()`` (:issue:`2497`).\n- Add .rst extension to README files (:issue:`2507`).\n- Mention LevelDB cache storage backend (:issue:`2525`).\n- Use ``yield`` in sample callback code (:issue:`2533`).\n- Add note about HTML entities decoding with ``.re()/.re_first()`` (:issue:`1704`).\n- Typos (:issue:`2512`, :issue:`2534`, :issue:`2531`).\n\nCleanups\n~~~~~~~~\n\n- Remove redundant check in ``MetaRefreshMiddleware`` (:issue:`2542`).\n- Faster checks in ``LinkExtractor`` for allow/deny patterns (:issue:`2538`).\n- Remove dead code supporting old Twisted versions (:issue:`2544`).\n\n\n.. _release-1.3.0:\n\nScrapy 1.3.0 (2016-12-21)\n-------------------------\n\nThis release comes rather soon after 1.2.2 for one main reason:\nit was found out that releases since 0.18 up to 1.2.2 (included) use\nsome backported code from Twisted (``scrapy.xlib.tx.*``),\neven if newer Twisted modules are available.\nScrapy now uses ``twisted.web.client`` and ``twisted.internet.endpoints`` directly.\n(See also cleanups below.)\n\nAs it is a major change, we wanted to get the bug fix out quickly\nwhile not breaking any projects using the 1.2 series.\n\nNew Features\n~~~~~~~~~~~~\n\n- ``MailSender`` now accepts single strings as values for ``to`` and ``cc``\n  arguments (:issue:`2272`)\n- ``scrapy fetch url``, ``scrapy shell url`` and ``fetch(url)`` inside\n  Scrapy shell now follow HTTP redirections by default (:issue:`2290`);\n  See :command:`fetch` and :command:`shell` for details.\n- ``HttpErrorMiddleware`` now logs errors with ``INFO`` level instead of ``DEBUG``;\n  this is technically **backward incompatible** so please check your log parsers.\n- By default, logger names now use a long-form path, e.g. ``[scrapy.extensions.logstats]``,\n  instead of the shorter \"top-level\" variant of prior releases (e.g. ``[scrapy]``);\n  this is **backward incompatible** if you have log parsers expecting the short\n  logger name part. You can switch back to short logger names using :setting:`LOG_SHORT_NAMES`\n  set to ``True``.\n\nDependencies & Cleanups\n~~~~~~~~~~~~~~~~~~~~~~~\n\n- Scrapy now requires Twisted >= 13.1 which is the case for many Linux\n  distributions already.\n- As a consequence, we got rid of ``scrapy.xlib.tx.*`` modules, which\n  copied some of Twisted code for users stuck with an \"old\" Twisted version\n- ``ChunkedTransferMiddleware`` is deprecated and removed from the default\n  downloader middlewares.\n\n.. _release-1.2.3:\n\nScrapy 1.2.3 (2017-03-03)\n-------------------------\n\n- Packaging fix: disallow unsupported Twisted versions in setup.py\n\n\n.. _release-1.2.2:\n\nScrapy 1.2.2 (2016-12-06)\n-------------------------\n\nBug fixes\n~~~~~~~~~\n\n- Fix a cryptic traceback when a pipeline fails on ``open_spider()`` (:issue:`2011`)\n- Fix embedded IPython shell variables (fixing :issue:`396` that re-appeared\n  in 1.2.0, fixed in :issue:`2418`)\n- A couple of patches when dealing with robots.txt:\n\n  - handle (non-standard) relative sitemap URLs (:issue:`2390`)\n  - handle non-ASCII URLs and User-Agents in Python 2 (:issue:`2373`)\n\nDocumentation\n~~~~~~~~~~~~~\n\n- Document ``\"download_latency\"`` key in ``Request``'s ``meta`` dict (:issue:`2033`)\n- Remove page on (deprecated & unsupported) Ubuntu packages from ToC (:issue:`2335`)\n- A few fixed typos (:issue:`2346`, :issue:`2369`, :issue:`2369`, :issue:`2380`)\n  and clarifications (:issue:`2354`, :issue:`2325`, :issue:`2414`)\n\nOther changes\n~~~~~~~~~~~~~\n\n- Advertize `conda-forge`_ as Scrapy's official conda channel (:issue:`2387`)\n- More helpful error messages when trying to use ``.css()`` or ``.xpath()``\n  on non-Text Responses (:issue:`2264`)\n- ``startproject`` command now generates a sample ``middlewares.py`` file (:issue:`2335`)\n- Add more dependencies' version info in ``scrapy version`` verbose output (:issue:`2404`)\n- Remove all ``*.pyc`` files from source distribution (:issue:`2386`)\n\n.. _conda-forge: https://anaconda.org/conda-forge/scrapy\n\n\n.. _release-1.2.1:\n\nScrapy 1.2.1 (2016-10-21)\n-------------------------\n\nBug fixes\n~~~~~~~~~\n\n- Include OpenSSL's more permissive default ciphers when establishing\n  TLS/SSL connections (:issue:`2314`).\n- Fix \"Location\" HTTP header decoding on non-ASCII URL redirects (:issue:`2321`).\n\nDocumentation\n~~~~~~~~~~~~~\n\n- Fix JsonWriterPipeline example (:issue:`2302`).\n- Various notes: :issue:`2330` on spider names,\n  :issue:`2329` on middleware methods processing order,\n  :issue:`2327` on getting multi-valued HTTP headers as lists.\n\nOther changes\n~~~~~~~~~~~~~\n\n- Removed ``www.`` from ``start_urls`` in built-in spider templates (:issue:`2299`).\n\n\n.. _release-1.2.0:\n\nScrapy 1.2.0 (2016-10-03)\n-------------------------\n\nNew Features\n~~~~~~~~~~~~\n\n- New :setting:`FEED_EXPORT_ENCODING` setting to customize the encoding\n  used when writing items to a file.\n  This can be used to turn off ``\\uXXXX`` escapes in JSON output.\n  This is also useful for those wanting something else than UTF-8\n  for XML or CSV output (:issue:`2034`).\n- ``startproject`` command now supports an optional destination directory\n  to override the default one based on the project name (:issue:`2005`).\n- New :setting:`SCHEDULER_DEBUG` setting to log requests serialization\n  failures (:issue:`1610`).\n- JSON encoder now supports serialization of ``set`` instances (:issue:`2058`).\n- Interpret ``application/json-amazonui-streaming`` as ``TextResponse`` (:issue:`1503`).\n- ``scrapy`` is imported by default when using shell tools (:command:`shell`,\n  :ref:`inspect_response <topics-shell-inspect-response>`) (:issue:`2248`).\n\nBug fixes\n~~~~~~~~~\n\n- DefaultRequestHeaders middleware now runs before UserAgent middleware\n  (:issue:`2088`). **Warning: this is technically backward incompatible**,\n  though we consider this a bug fix.\n- HTTP cache extension and plugins that use the ``.scrapy`` data directory now\n  work outside projects (:issue:`1581`).  **Warning: this is technically\n  backward incompatible**, though we consider this a bug fix.\n- ``Selector`` does not allow passing both ``response`` and ``text`` anymore\n  (:issue:`2153`).\n- Fixed logging of wrong callback name with ``scrapy parse`` (:issue:`2169`).\n- Fix for an odd gzip decompression bug (:issue:`1606`).\n- Fix for selected callbacks when using ``CrawlSpider`` with :command:`scrapy parse <parse>`\n  (:issue:`2225`).\n- Fix for invalid JSON and XML files when spider yields no items (:issue:`872`).\n- Implement ``flush()`` for ``StreamLogger`` avoiding a warning in logs (:issue:`2125`).\n\nRefactoring\n~~~~~~~~~~~\n\n- ``canonicalize_url`` has been moved to `w3lib.url`_ (:issue:`2168`).\n\n.. _w3lib.url: https://w3lib.readthedocs.io/en/latest/w3lib.html#w3lib.url.canonicalize_url\n\nTests & Requirements\n~~~~~~~~~~~~~~~~~~~~\n\nScrapy's new requirements baseline is Debian 8 \"Jessie\". It was previously\nUbuntu 12.04 Precise.\nWhat this means in practice is that we run continuous integration tests\nwith these (main) packages versions at a minimum:\nTwisted 14.0, pyOpenSSL 0.14, lxml 3.4.\n\nScrapy may very well work with older versions of these packages\n(the code base still has switches for older Twisted versions for example)\nbut it is not guaranteed (because it's not tested anymore).\n\nDocumentation\n~~~~~~~~~~~~~\n\n- Grammar fixes: :issue:`2128`, :issue:`1566`.\n- Download stats badge removed from README (:issue:`2160`).\n- New Scrapy :ref:`architecture diagram <topics-architecture>` (:issue:`2165`).\n- Updated ``Response`` parameters documentation (:issue:`2197`).\n- Reworded misleading :setting:`RANDOMIZE_DOWNLOAD_DELAY` description (:issue:`2190`).\n- Add StackOverflow as a support channel (:issue:`2257`).\n\n.. _release-1.1.4:\n\nScrapy 1.1.4 (2017-03-03)\n-------------------------\n\n- Packaging fix: disallow unsupported Twisted versions in setup.py\n\n.. _release-1.1.3:\n\nScrapy 1.1.3 (2016-09-22)\n-------------------------\n\nBug fixes\n~~~~~~~~~\n\n- Class attributes for subclasses of ``ImagesPipeline`` and ``FilesPipeline``\n  work as they did before 1.1.1 (:issue:`2243`, fixes :issue:`2198`)\n\nDocumentation\n~~~~~~~~~~~~~\n\n- :ref:`Overview <intro-overview>` and :ref:`tutorial <intro-tutorial>`\n  rewritten to use http://toscrape.com websites\n  (:issue:`2236`, :issue:`2249`, :issue:`2252`).\n\n.. _release-1.1.2:\n\nScrapy 1.1.2 (2016-08-18)\n-------------------------\n\nBug fixes\n~~~~~~~~~\n\n- Introduce a missing :setting:`IMAGES_STORE_S3_ACL` setting to override\n  the default ACL policy in ``ImagesPipeline`` when uploading images to S3\n  (note that default ACL policy is \"private\" -- instead of \"public-read\" --\n  since Scrapy 1.1.0)\n- :setting:`IMAGES_EXPIRES` default value set back to 90\n  (the regression was introduced in 1.1.1)\n\n.. _release-1.1.1:\n\nScrapy 1.1.1 (2016-07-13)\n-------------------------\n\nBug fixes\n~~~~~~~~~\n\n- Add \"Host\" header in CONNECT requests to HTTPS proxies (:issue:`2069`)\n- Use response ``body`` when choosing response class\n  (:issue:`2001`, fixes :issue:`2000`)\n- Do not fail on canonicalizing URLs with wrong netlocs\n  (:issue:`2038`, fixes :issue:`2010`)\n- a few fixes for ``HttpCompressionMiddleware`` (and ``SitemapSpider``):\n\n  - Do not decode HEAD responses (:issue:`2008`, fixes :issue:`1899`)\n  - Handle charset parameter in gzip Content-Type header\n    (:issue:`2050`, fixes :issue:`2049`)\n  - Do not decompress gzip octet-stream responses\n    (:issue:`2065`, fixes :issue:`2063`)\n\n- Catch (and ignore with a warning) exception when verifying certificate\n  against IP-address hosts (:issue:`2094`, fixes :issue:`2092`)\n- Make ``FilesPipeline`` and ``ImagesPipeline`` backward compatible again\n  regarding the use of legacy class attributes for customization\n  (:issue:`1989`, fixes :issue:`1985`)\n\n\nNew features\n~~~~~~~~~~~~\n\n- Enable genspider command outside project folder (:issue:`2052`)\n- Retry HTTPS CONNECT ``TunnelError`` by default (:issue:`1974`)\n\n\nDocumentation\n~~~~~~~~~~~~~\n\n- ``FEED_TEMPDIR`` setting at lexicographical position (:commit:`9b3c72c`)\n- Use idiomatic ``.extract_first()`` in overview (:issue:`1994`)\n- Update years in copyright notice (:commit:`c2c8036`)\n- Add information and example on errbacks (:issue:`1995`)\n- Use \"url\" variable in downloader middleware example (:issue:`2015`)\n- Grammar fixes (:issue:`2054`, :issue:`2120`)\n- New FAQ entry on using BeautifulSoup in spider callbacks (:issue:`2048`)\n- Add notes about Scrapy not working on Windows with Python 3 (:issue:`2060`)\n- Encourage complete titles in pull requests (:issue:`2026`)\n\nTests\n~~~~~\n\n- Upgrade py.test requirement on Travis CI and Pin pytest-cov to 2.2.1 (:issue:`2095`)\n\n.. _release-1.1.0:\n\nScrapy 1.1.0 (2016-05-11)\n-------------------------\n\nThis 1.1 release brings a lot of interesting features and bug fixes:\n\n- Scrapy 1.1 has beta Python 3 support (requires Twisted >= 15.5). See\n  :ref:`news_betapy3` for more details and some limitations.\n- Hot new features:\n\n  - Item loaders now support nested loaders (:issue:`1467`).\n  - ``FormRequest.from_response`` improvements (:issue:`1382`, :issue:`1137`).\n  - Added setting :setting:`AUTOTHROTTLE_TARGET_CONCURRENCY` and improved\n    AutoThrottle docs (:issue:`1324`).\n  - Added ``response.text`` to get body as unicode (:issue:`1730`).\n  - Anonymous S3 connections (:issue:`1358`).\n  - Deferreds in downloader middlewares (:issue:`1473`). This enables better\n    robots.txt handling (:issue:`1471`).\n  - HTTP caching now follows RFC2616 more closely, added settings\n    :setting:`HTTPCACHE_ALWAYS_STORE` and\n    :setting:`HTTPCACHE_IGNORE_RESPONSE_CACHE_CONTROLS` (:issue:`1151`).\n  - Selectors were extracted to the parsel_ library (:issue:`1409`). This means\n    you can use Scrapy Selectors without Scrapy and also upgrade the\n    selectors engine without needing to upgrade Scrapy.\n  - HTTPS downloader now does TLS protocol negotiation by default,\n    instead of forcing TLS 1.0. You can also set the SSL/TLS method\n    using the new :setting:`DOWNLOADER_CLIENT_TLS_METHOD`.\n\n- These bug fixes may require your attention:\n\n  - Don't retry bad requests (HTTP 400) by default (:issue:`1289`).\n    If you need the old behavior, add ``400`` to :setting:`RETRY_HTTP_CODES`.\n  - Fix shell files argument handling (:issue:`1710`, :issue:`1550`).\n    If you try ``scrapy shell index.html`` it will try to load the URL http://index.html,\n    use ``scrapy shell ./index.html`` to load a local file.\n  - Robots.txt compliance is now enabled by default for newly-created projects\n    (:issue:`1724`). Scrapy will also wait for robots.txt to be downloaded\n    before proceeding with the crawl (:issue:`1735`). If you want to disable\n    this behavior, update :setting:`ROBOTSTXT_OBEY` in ``settings.py`` file\n    after creating a new project.\n  - Exporters now work on unicode, instead of bytes by default (:issue:`1080`).\n    If you use :class:`~scrapy.exporters.PythonItemExporter`, you may want to\n    update your code to disable binary mode which is now deprecated.\n  - Accept XML node names containing dots as valid (:issue:`1533`).\n  - When uploading files or images to S3 (with ``FilesPipeline`` or\n    ``ImagesPipeline``), the default ACL policy is now \"private\" instead\n    of \"public\" **Warning: backward incompatible!**.\n    You can use :setting:`FILES_STORE_S3_ACL` to change it.\n  - We've reimplemented ``canonicalize_url()`` for more correct output,\n    especially for URLs with non-ASCII characters (:issue:`1947`).\n    This could change link extractors output compared to previous Scrapy versions.\n    This may also invalidate some cache entries you could still have from pre-1.1 runs.\n    **Warning: backward incompatible!**.\n\nKeep reading for more details on other improvements and bug fixes.\n\n.. _news_betapy3:\n\nBeta Python 3 Support\n~~~~~~~~~~~~~~~~~~~~~\n\nWe have been `hard at work to make Scrapy run on Python 3\n<https://github.com/scrapy/scrapy/wiki/Python-3-Porting>`_. As a result, now\nyou can run spiders on Python 3.3, 3.4 and 3.5 (Twisted >= 15.5 required). Some\nfeatures are still missing (and some may never be ported).\n\n\nAlmost all builtin extensions/middlewares are expected to work.\nHowever, we are aware of some limitations in Python 3:\n\n- Scrapy does not work on Windows with Python 3\n- Sending emails is not supported\n- FTP download handler is not supported\n- Telnet console is not supported\n\nAdditional New Features and Enhancements\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Scrapy now has a `Code of Conduct`_ (:issue:`1681`).\n- Command line tool now has completion for zsh (:issue:`934`).\n- Improvements to ``scrapy shell``:\n\n  - Support for bpython and configure preferred Python shell via\n    ``SCRAPY_PYTHON_SHELL`` (:issue:`1100`, :issue:`1444`).\n  - Support URLs without scheme (:issue:`1498`)\n    **Warning: backward incompatible!**\n  - Bring back support for relative file path (:issue:`1710`, :issue:`1550`).\n\n- Added :setting:`MEMUSAGE_CHECK_INTERVAL_SECONDS` setting to change default check\n  interval (:issue:`1282`).\n- Download handlers are now lazy-loaded on first request using their\n  scheme (:issue:`1390`, :issue:`1421`).\n- HTTPS download handlers do not force TLS 1.0 anymore; instead,\n  OpenSSL's ``SSLv23_method()/TLS_method()`` is used allowing to try\n  negotiating with the remote hosts the highest TLS protocol version\n  it can (:issue:`1794`, :issue:`1629`).\n- ``RedirectMiddleware`` now skips the status codes from\n  ``handle_httpstatus_list`` on spider attribute\n  or in ``Request``'s ``meta`` key (:issue:`1334`, :issue:`1364`,\n  :issue:`1447`).\n- Form submission:\n\n  - now works with ``<button>`` elements too (:issue:`1469`).\n  - an empty string is now used for submit buttons without a value\n    (:issue:`1472`)\n\n- Dict-like settings now have per-key priorities\n  (:issue:`1135`, :issue:`1149` and :issue:`1586`).\n- Sending non-ASCII emails (:issue:`1662`)\n- ``CloseSpider`` and ``SpiderState`` extensions now get disabled if no relevant\n  setting is set (:issue:`1723`, :issue:`1725`).\n- Added method ``ExecutionEngine.close`` (:issue:`1423`).\n- Added method ``CrawlerRunner.create_crawler`` (:issue:`1528`).\n- Scheduler priority queue can now be customized via\n  :setting:`SCHEDULER_PRIORITY_QUEUE` (:issue:`1822`).\n- ``.pps`` links are now ignored by default in link extractors (:issue:`1835`).\n- temporary data folder for FTP and S3 feed storages can be customized\n  using a new :setting:`FEED_TEMPDIR` setting (:issue:`1847`).\n- ``FilesPipeline`` and ``ImagesPipeline`` settings are now instance attributes\n  instead of class attributes, enabling spider-specific behaviors (:issue:`1891`).\n- ``JsonItemExporter`` now formats opening and closing square brackets\n  on their own line (first and last lines of output file) (:issue:`1950`).\n- If available, ``botocore`` is used for ``S3FeedStorage``, ``S3DownloadHandler``\n  and ``S3FilesStore`` (:issue:`1761`, :issue:`1883`).\n- Tons of documentation updates and related fixes (:issue:`1291`, :issue:`1302`,\n  :issue:`1335`, :issue:`1683`, :issue:`1660`, :issue:`1642`, :issue:`1721`,\n  :issue:`1727`, :issue:`1879`).\n- Other refactoring, optimizations and cleanup (:issue:`1476`, :issue:`1481`,\n  :issue:`1477`, :issue:`1315`, :issue:`1290`, :issue:`1750`, :issue:`1881`).\n\n.. _`Code of Conduct`: https://github.com/scrapy/scrapy/blob/master/CODE_OF_CONDUCT.md\n\n\nDeprecations and Removals\n~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Added ``to_bytes`` and ``to_unicode``, deprecated ``str_to_unicode`` and\n  ``unicode_to_str`` functions (:issue:`778`).\n- ``binary_is_text`` is introduced, to replace use of ``isbinarytext``\n  (but with inverse return value) (:issue:`1851`)\n- The ``optional_features`` set has been removed (:issue:`1359`).\n- The ``--lsprof`` command line option has been removed (:issue:`1689`).\n  **Warning: backward incompatible**, but doesn't break user code.\n- The following datatypes were deprecated (:issue:`1720`):\n\n  + ``scrapy.utils.datatypes.MultiValueDictKeyError``\n  + ``scrapy.utils.datatypes.MultiValueDict``\n  + ``scrapy.utils.datatypes.SiteNode``\n\n- The previously bundled ``scrapy.xlib.pydispatch`` library was deprecated and\n  replaced by `pydispatcher <https://pypi.org/project/PyDispatcher/>`_.\n\n\nRelocations\n~~~~~~~~~~~\n\n- ``telnetconsole`` was relocated to ``extensions/`` (:issue:`1524`).\n\n  + Note: telnet is not enabled on Python 3\n    (https://github.com/scrapy/scrapy/pull/1524#issuecomment-146985595)\n\n.. _parsel: https://github.com/scrapy/parsel\n\n\nBugfixes\n~~~~~~~~\n\n- Scrapy does not retry requests that got a ``HTTP 400 Bad Request``\n  response anymore (:issue:`1289`). **Warning: backward incompatible!**\n- Support empty password for http_proxy config (:issue:`1274`).\n- Interpret ``application/x-json`` as ``TextResponse`` (:issue:`1333`).\n- Support link rel attribute with multiple values (:issue:`1201`).\n- Fixed ``scrapy.http.FormRequest.from_response`` when there is a ``<base>``\n  tag (:issue:`1564`).\n- Fixed :setting:`TEMPLATES_DIR` handling (:issue:`1575`).\n- Various ``FormRequest`` fixes (:issue:`1595`, :issue:`1596`, :issue:`1597`).\n- Makes ``_monkeypatches`` more robust (:issue:`1634`).\n- Fixed bug on ``XMLItemExporter`` with non-string fields in\n  items (:issue:`1738`).\n- Fixed startproject command in macOS (:issue:`1635`).\n- Fixed :class:`~scrapy.exporters.PythonItemExporter` and CSVExporter for\n  non-string item types (:issue:`1737`).\n- Various logging related fixes (:issue:`1294`, :issue:`1419`, :issue:`1263`,\n  :issue:`1624`, :issue:`1654`, :issue:`1722`, :issue:`1726` and :issue:`1303`).\n- Fixed bug in ``utils.template.render_templatefile()`` (:issue:`1212`).\n- sitemaps extraction from ``robots.txt`` is now case-insensitive (:issue:`1902`).\n- HTTPS+CONNECT tunnels could get mixed up when using multiple proxies\n  to same remote host (:issue:`1912`).\n\n.. _release-1.0.7:\n\nScrapy 1.0.7 (2017-03-03)\n-------------------------\n\n- Packaging fix: disallow unsupported Twisted versions in setup.py\n\n.. _release-1.0.6:\n\nScrapy 1.0.6 (2016-05-04)\n-------------------------\n\n- FIX: RetryMiddleware is now robust to non-standard HTTP status codes (:issue:`1857`)\n- FIX: Filestorage HTTP cache was checking wrong modified time (:issue:`1875`)\n- DOC: Support for Sphinx 1.4+ (:issue:`1893`)\n- DOC: Consistency in selectors examples (:issue:`1869`)\n\n.. _release-1.0.5:\n\nScrapy 1.0.5 (2016-02-04)\n-------------------------\n\n- FIX: [Backport] Ignore bogus links in LinkExtractors (fixes :issue:`907`, :commit:`108195e`)\n- TST: Changed buildbot makefile to use 'pytest' (:commit:`1f3d90a`)\n- DOC: Fixed typos in tutorial and media-pipeline (:commit:`808a9ea` and :commit:`803bd87`)\n- DOC: Add AjaxCrawlMiddleware to DOWNLOADER_MIDDLEWARES_BASE in settings docs (:commit:`aa94121`)\n\n.. _release-1.0.4:\n\nScrapy 1.0.4 (2015-12-30)\n-------------------------\n\n- Ignoring xlib/tx folder, depending on Twisted version. (:commit:`7dfa979`)\n- Run on new travis-ci infra (:commit:`6e42f0b`)\n- Spelling fixes (:commit:`823a1cc`)\n- escape nodename in xmliter regex (:commit:`da3c155`)\n- test xml nodename with dots (:commit:`4418fc3`)\n- TST don't use broken Pillow version in tests (:commit:`a55078c`)\n- disable log on version command. closes #1426 (:commit:`86fc330`)\n- disable log on startproject command (:commit:`db4c9fe`)\n- Add PyPI download stats badge (:commit:`df2b944`)\n- don't run tests twice on Travis if a PR is made from a scrapy/scrapy branch (:commit:`a83ab41`)\n- Add Python 3 porting status badge to the README (:commit:`73ac80d`)\n- fixed RFPDupeFilter persistence (:commit:`97d080e`)\n- TST a test to show that dupefilter persistence is not working (:commit:`97f2fb3`)\n- explicit close file on file:// scheme handler (:commit:`d9b4850`)\n- Disable dupefilter in shell (:commit:`c0d0734`)\n- DOC: Add captions to toctrees which appear in sidebar (:commit:`aa239ad`)\n- DOC Removed pywin32 from install instructions as it's already declared as dependency. (:commit:`10eb400`)\n- Added installation notes about using Conda for Windows and other OSes. (:commit:`1c3600a`)\n- Fixed minor grammar issues. (:commit:`7f4ddd5`)\n- fixed a typo in the documentation. (:commit:`b71f677`)\n- Version 1 now exists (:commit:`5456c0e`)\n- fix another invalid xpath error (:commit:`0a1366e`)\n- fix ValueError: Invalid XPath: //div/[id=\"not-exists\"]/text() on selectors.rst (:commit:`ca8d60f`)\n- Typos corrections (:commit:`7067117`)\n- fix typos in downloader-middleware.rst and exceptions.rst, middlware -> middleware (:commit:`32f115c`)\n- Add note to Ubuntu install section about Debian compatibility (:commit:`23fda69`)\n- Replace alternative macOS install workaround with virtualenv (:commit:`98b63ee`)\n- Reference Homebrew's homepage for installation instructions (:commit:`1925db1`)\n- Add oldest supported tox version to contributing docs (:commit:`5d10d6d`)\n- Note in install docs about pip being already included in python>=2.7.9 (:commit:`85c980e`)\n- Add non-python dependencies to Ubuntu install section in the docs (:commit:`fbd010d`)\n- Add macOS installation section to docs (:commit:`d8f4cba`)\n- DOC(ENH): specify path to rtd theme explicitly (:commit:`de73b1a`)\n- minor: scrapy.Spider docs grammar (:commit:`1ddcc7b`)\n- Make common practices sample code match the comments (:commit:`1b85bcf`)\n- nextcall repetitive calls (heartbeats). (:commit:`55f7104`)\n- Backport fix compatibility with Twisted 15.4.0 (:commit:`b262411`)\n- pin pytest to 2.7.3 (:commit:`a6535c2`)\n- Merge pull request #1512 from mgedmin/patch-1 (:commit:`8876111`)\n- Merge pull request #1513 from mgedmin/patch-2 (:commit:`5d4daf8`)\n- Typo (:commit:`f8d0682`)\n- Fix list formatting (:commit:`5f83a93`)\n- fix Scrapy squeue tests after recent changes to queuelib (:commit:`3365c01`)\n- Merge pull request #1475 from rweindl/patch-1 (:commit:`2d688cd`)\n- Update tutorial.rst (:commit:`fbc1f25`)\n- Merge pull request #1449 from rhoekman/patch-1 (:commit:`7d6538c`)\n- Small grammatical change (:commit:`8752294`)\n- Add openssl version to version command (:commit:`13c45ac`)\n\n.. _release-1.0.3:\n\nScrapy 1.0.3 (2015-08-11)\n-------------------------\n\n- add service_identity to Scrapy install_requires (:commit:`cbc2501`)\n- Workaround for travis#296 (:commit:`66af9cd`)\n\n.. _release-1.0.2:\n\nScrapy 1.0.2 (2015-08-06)\n-------------------------\n\n- Twisted 15.3.0 does not raises PicklingError serializing lambda functions (:commit:`b04dd7d`)\n- Minor method name fix (:commit:`6f85c7f`)\n- minor: scrapy.Spider grammar and clarity (:commit:`9c9d2e0`)\n- Put a blurb about support channels in CONTRIBUTING (:commit:`c63882b`)\n- Fixed typos (:commit:`a9ae7b0`)\n- Fix doc reference. (:commit:`7c8a4fe`)\n\n.. _release-1.0.1:\n\nScrapy 1.0.1 (2015-07-01)\n-------------------------\n\n- Unquote request path before passing to FTPClient, it already escape paths (:commit:`cc00ad2`)\n- include tests/ to source distribution in MANIFEST.in (:commit:`eca227e`)\n- DOC Fix SelectJmes documentation (:commit:`b8567bc`)\n- DOC Bring Ubuntu and Archlinux outside of Windows subsection (:commit:`392233f`)\n- DOC remove version suffix from Ubuntu package (:commit:`5303c66`)\n- DOC Update release date for 1.0 (:commit:`c89fa29`)\n\n.. _release-1.0.0:\n\nScrapy 1.0.0 (2015-06-19)\n-------------------------\n\nYou will find a lot of new features and bugfixes in this major release.  Make\nsure to check our updated :ref:`overview <intro-overview>` to get a glance of\nsome of the changes, along with our brushed :ref:`tutorial <intro-tutorial>`.\n\nSupport for returning dictionaries in spiders\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\nDeclaring and returning Scrapy Items is no longer necessary to collect the\nscraped data from your spider, you can now return explicit dictionaries\ninstead.\n\n*Classic version*\n\n::\n\n    class MyItem(scrapy.Item):\n        url = scrapy.Field()\n\n    class MySpider(scrapy.Spider):\n        def parse(self, response):\n            return MyItem(url=response.url)\n\n*New version*\n\n::\n\n    class MySpider(scrapy.Spider):\n        def parse(self, response):\n            return {'url': response.url}\n\nPer-spider settings (GSoC 2014)\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\nLast Google Summer of Code project accomplished an important redesign of the\nmechanism used for populating settings, introducing explicit priorities to\noverride any given setting. As an extension of that goal, we included a new\nlevel of priority for settings that act exclusively for a single spider,\nallowing them to redefine project settings.\n\nStart using it by defining a :attr:`~scrapy.spiders.Spider.custom_settings`\nclass variable in your spider::\n\n    class MySpider(scrapy.Spider):\n        custom_settings = {\n            \"DOWNLOAD_DELAY\": 5.0,\n            \"RETRY_ENABLED\": False,\n        }\n\nRead more about settings population: :ref:`topics-settings`\n\nPython Logging\n~~~~~~~~~~~~~~\n\nScrapy 1.0 has moved away from Twisted logging to support Python built in\u2019s\nas default logging system. We\u2019re maintaining backward compatibility for most\nof the old custom interface to call logging functions, but you\u2019ll get\nwarnings to switch to the Python logging API entirely.\n\n*Old version*\n\n::\n\n    from scrapy import log\n    log.msg('MESSAGE', log.INFO)\n\n*New version*\n\n::\n\n    import logging\n    logging.info('MESSAGE')\n\nLogging with spiders remains the same, but on top of the\n:meth:`~scrapy.spiders.Spider.log` method you\u2019ll have access to a custom\n:attr:`~scrapy.spiders.Spider.logger` created for the spider to issue log\nevents:\n\n::\n\n    class MySpider(scrapy.Spider):\n        def parse(self, response):\n            self.logger.info('Response received')\n\nRead more in the logging documentation: :ref:`topics-logging`\n\nCrawler API refactoring (GSoC 2014)\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\nAnother milestone for last Google Summer of Code was a refactoring of the\ninternal API, seeking a simpler and easier usage. Check new core interface\nin: :ref:`topics-api`\n\nA common situation where you will face these changes is while running Scrapy\nfrom scripts. Here\u2019s a quick example of how to run a Spider manually with the\nnew API:\n\n::\n\n    from scrapy.crawler import CrawlerProcess\n\n    process = CrawlerProcess({\n        'USER_AGENT': 'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)'\n    })\n    process.crawl(MySpider)\n    process.start()\n\nBear in mind this feature is still under development and its API may change\nuntil it reaches a stable status.\n\nSee more examples for scripts running Scrapy: :ref:`topics-practices`\n\n.. _module-relocations:\n\nModule Relocations\n~~~~~~~~~~~~~~~~~~\n\nThere\u2019s been a large rearrangement of modules trying to improve the general\nstructure of Scrapy. Main changes were separating various subpackages into\nnew projects and dissolving both ``scrapy.contrib`` and ``scrapy.contrib_exp``\ninto top level packages. Backward compatibility was kept among internal\nrelocations, while importing deprecated modules expect warnings indicating\ntheir new place.\n\nFull list of relocations\n************************\n\nOutsourced packages\n\n.. note::\n    These extensions went through some minor changes, e.g. some setting names\n    were changed. Please check the documentation in each new repository to\n    get familiar with the new usage.\n\n+-------------------------------------+-------------------------------------+\n| Old location                        | New location                        |\n+=====================================+=====================================+\n| scrapy.commands.deploy              | `scrapyd-client <https://github.com |\n|                                     | /scrapy/scrapyd-client>`_           |\n|                                     | (See other alternatives here:       |\n|                                     | :ref:`topics-deploy`)               |\n+-------------------------------------+-------------------------------------+\n| scrapy.contrib.djangoitem           | `scrapy-djangoitem <https://github. |\n|                                     | com/scrapy-plugins/scrapy-djangoite |\n|                                     | m>`_                                |\n+-------------------------------------+-------------------------------------+\n| scrapy.webservice                   | `scrapy-jsonrpc <https://github.com |\n|                                     | /scrapy-plugins/scrapy-jsonrpc>`_   |\n+-------------------------------------+-------------------------------------+\n\n``scrapy.contrib_exp`` and ``scrapy.contrib`` dissolutions\n\n+-------------------------------------+-------------------------------------+\n| Old location                        | New location                        |\n+=====================================+=====================================+\n| scrapy.contrib\\_exp.downloadermidd\\ | scrapy.downloadermiddlewares.decom\\ |\n| leware.decompression                | pression                            |\n+-------------------------------------+-------------------------------------+\n| scrapy.contrib\\_exp.iterators       | scrapy.utils.iterators              |\n+-------------------------------------+-------------------------------------+\n| scrapy.contrib.downloadermiddleware | scrapy.downloadermiddlewares        |\n+-------------------------------------+-------------------------------------+\n| scrapy.contrib.exporter             | scrapy.exporters                    |\n+-------------------------------------+-------------------------------------+\n| scrapy.contrib.linkextractors       | scrapy.linkextractors               |\n+-------------------------------------+-------------------------------------+\n| scrapy.contrib.loader               | scrapy.loader                       |\n+-------------------------------------+-------------------------------------+\n| scrapy.contrib.loader.processor     | scrapy.loader.processors            |\n+-------------------------------------+-------------------------------------+\n| scrapy.contrib.pipeline             | scrapy.pipelines                    |\n+-------------------------------------+-------------------------------------+\n| scrapy.contrib.spidermiddleware     | scrapy.spidermiddlewares            |\n+-------------------------------------+-------------------------------------+\n| scrapy.contrib.spiders              | scrapy.spiders                      |\n+-------------------------------------+-------------------------------------+\n| * scrapy.contrib.closespider        | scrapy.extensions.\\*                |\n| * scrapy.contrib.corestats          |                                     |\n| * scrapy.contrib.debug              |                                     |\n| * scrapy.contrib.feedexport         |                                     |\n| * scrapy.contrib.httpcache          |                                     |\n| * scrapy.contrib.logstats           |                                     |\n| * scrapy.contrib.memdebug           |                                     |\n| * scrapy.contrib.memusage           |                                     |\n| * scrapy.contrib.spiderstate        |                                     |\n| * scrapy.contrib.statsmailer        |                                     |\n| * scrapy.contrib.throttle           |                                     |\n+-------------------------------------+-------------------------------------+\n\nPlural renames and Modules unification\n\n+-------------------------------------+-------------------------------------+\n| Old location                        | New location                        |\n+=====================================+=====================================+\n| scrapy.command                      | scrapy.commands                     |\n+-------------------------------------+-------------------------------------+\n| scrapy.dupefilter                   | scrapy.dupefilters                  |\n+-------------------------------------+-------------------------------------+\n| scrapy.linkextractor                | scrapy.linkextractors               |\n+-------------------------------------+-------------------------------------+\n| scrapy.spider                       | scrapy.spiders                      |\n+-------------------------------------+-------------------------------------+\n| scrapy.squeue                       | scrapy.squeues                      |\n+-------------------------------------+-------------------------------------+\n| scrapy.statscol                     | scrapy.statscollectors              |\n+-------------------------------------+-------------------------------------+\n| scrapy.utils.decorator              | scrapy.utils.decorators             |\n+-------------------------------------+-------------------------------------+\n\nClass renames\n\n+-------------------------------------+-------------------------------------+\n| Old location                        | New location                        |\n+=====================================+=====================================+\n| scrapy.spidermanager.SpiderManager  | scrapy.spiderloader.SpiderLoader    |\n+-------------------------------------+-------------------------------------+\n\nSettings renames\n\n+-------------------------------------+-------------------------------------+\n| Old location                        | New location                        |\n+=====================================+=====================================+\n| SPIDER\\_MANAGER\\_CLASS              | SPIDER\\_LOADER\\_CLASS               |\n+-------------------------------------+-------------------------------------+\n\nChangelog\n~~~~~~~~~\n\nNew Features and Enhancements\n\n- Python logging (:issue:`1060`, :issue:`1235`, :issue:`1236`, :issue:`1240`,\n  :issue:`1259`, :issue:`1278`, :issue:`1286`)\n- FEED_EXPORT_FIELDS option (:issue:`1159`, :issue:`1224`)\n- Dns cache size and timeout options (:issue:`1132`)\n- support namespace prefix in xmliter_lxml (:issue:`963`)\n- Reactor threadpool max size setting (:issue:`1123`)\n- Allow spiders to return dicts. (:issue:`1081`)\n- Add Response.urljoin() helper (:issue:`1086`)\n- look in ~/.config/scrapy.cfg for user config (:issue:`1098`)\n- handle TLS SNI (:issue:`1101`)\n- Selectorlist extract first (:issue:`624`, :issue:`1145`)\n- Added JmesSelect (:issue:`1016`)\n- add gzip compression to filesystem http cache backend (:issue:`1020`)\n- CSS support in link extractors (:issue:`983`)\n- httpcache dont_cache meta #19 #689 (:issue:`821`)\n- add signal to be sent when request is dropped by the scheduler\n  (:issue:`961`)\n- avoid download large response (:issue:`946`)\n- Allow to specify the quotechar in CSVFeedSpider (:issue:`882`)\n- Add referer to \"Spider error processing\" log message (:issue:`795`)\n- process robots.txt once (:issue:`896`)\n- GSoC Per-spider settings (:issue:`854`)\n- Add project name validation (:issue:`817`)\n- GSoC API cleanup (:issue:`816`, :issue:`1128`, :issue:`1147`,\n  :issue:`1148`, :issue:`1156`, :issue:`1185`, :issue:`1187`, :issue:`1258`,\n  :issue:`1268`, :issue:`1276`, :issue:`1285`, :issue:`1284`)\n- Be more responsive with IO operations (:issue:`1074` and :issue:`1075`)\n- Do leveldb compaction for httpcache on closing (:issue:`1297`)\n\nDeprecations and Removals\n\n- Deprecate htmlparser link extractor (:issue:`1205`)\n- remove deprecated code from FeedExporter (:issue:`1155`)\n- a leftover for.15 compatibility (:issue:`925`)\n- drop support for CONCURRENT_REQUESTS_PER_SPIDER (:issue:`895`)\n- Drop old engine code (:issue:`911`)\n- Deprecate SgmlLinkExtractor (:issue:`777`)\n\nRelocations\n\n- Move exporters/__init__.py to exporters.py (:issue:`1242`)\n- Move base classes to their packages (:issue:`1218`, :issue:`1233`)\n- Module relocation (:issue:`1181`, :issue:`1210`)\n- rename SpiderManager to SpiderLoader (:issue:`1166`)\n- Remove djangoitem (:issue:`1177`)\n- remove scrapy deploy command (:issue:`1102`)\n- dissolve contrib_exp (:issue:`1134`)\n- Deleted bin folder from root, fixes #913 (:issue:`914`)\n- Remove jsonrpc based webservice (:issue:`859`)\n- Move Test cases under project root dir (:issue:`827`, :issue:`841`)\n- Fix backward incompatibility for relocated paths in settings\n  (:issue:`1267`)\n\nDocumentation\n\n- CrawlerProcess documentation (:issue:`1190`)\n- Favoring web scraping over screen scraping in the descriptions\n  (:issue:`1188`)\n- Some improvements for Scrapy tutorial (:issue:`1180`)\n- Documenting Files Pipeline together with Images Pipeline (:issue:`1150`)\n- deployment docs tweaks (:issue:`1164`)\n- Added deployment section covering scrapyd-deploy and shub (:issue:`1124`)\n- Adding more settings to project template (:issue:`1073`)\n- some improvements to overview page (:issue:`1106`)\n- Updated link in docs/topics/architecture.rst (:issue:`647`)\n- DOC reorder topics (:issue:`1022`)\n- updating list of Request.meta special keys (:issue:`1071`)\n- DOC document download_timeout (:issue:`898`)\n- DOC simplify extension docs (:issue:`893`)\n- Leaks docs (:issue:`894`)\n- DOC document from_crawler method for item pipelines (:issue:`904`)\n- Spider_error doesn't support deferreds (:issue:`1292`)\n- Corrections & Sphinx related fixes (:issue:`1220`, :issue:`1219`,\n  :issue:`1196`, :issue:`1172`, :issue:`1171`, :issue:`1169`, :issue:`1160`,\n  :issue:`1154`, :issue:`1127`, :issue:`1112`, :issue:`1105`, :issue:`1041`,\n  :issue:`1082`, :issue:`1033`, :issue:`944`, :issue:`866`, :issue:`864`,\n  :issue:`796`, :issue:`1260`, :issue:`1271`, :issue:`1293`, :issue:`1298`)\n\nBugfixes\n\n- Item multi inheritance fix (:issue:`353`, :issue:`1228`)\n- ItemLoader.load_item: iterate over copy of fields (:issue:`722`)\n- Fix Unhandled error in Deferred (RobotsTxtMiddleware) (:issue:`1131`,\n  :issue:`1197`)\n- Force to read DOWNLOAD_TIMEOUT as int (:issue:`954`)\n- scrapy.utils.misc.load_object should print full traceback (:issue:`902`)\n- Fix bug for \".local\" host name (:issue:`878`)\n- Fix for Enabled extensions, middlewares, pipelines info not printed\n  anymore (:issue:`879`)\n- fix dont_merge_cookies bad behaviour when set to false on meta\n  (:issue:`846`)\n\nPython 3 In Progress Support\n\n- disable scrapy.telnet if twisted.conch is not available (:issue:`1161`)\n- fix Python 3 syntax errors in ajaxcrawl.py (:issue:`1162`)\n- more python3 compatibility changes for urllib (:issue:`1121`)\n- assertItemsEqual was renamed to assertCountEqual in Python 3.\n  (:issue:`1070`)\n- Import unittest.mock if available. (:issue:`1066`)\n- updated deprecated cgi.parse_qsl to use six's parse_qsl (:issue:`909`)\n- Prevent Python 3 port regressions (:issue:`830`)\n- PY3: use MutableMapping for python 3 (:issue:`810`)\n- PY3: use six.BytesIO and six.moves.cStringIO (:issue:`803`)\n- PY3: fix xmlrpclib and email imports (:issue:`801`)\n- PY3: use six for robotparser and urlparse (:issue:`800`)\n- PY3: use six.iterkeys, six.iteritems, and tempfile (:issue:`799`)\n- PY3: fix has_key and use six.moves.configparser (:issue:`798`)\n- PY3: use six.moves.cPickle (:issue:`797`)\n- PY3 make it possible to run some tests in Python3 (:issue:`776`)\n\nTests\n\n- remove unnecessary lines from py3-ignores (:issue:`1243`)\n- Fix remaining warnings from pytest while collecting tests (:issue:`1206`)\n- Add docs build to travis (:issue:`1234`)\n- TST don't collect tests from deprecated modules. (:issue:`1165`)\n- install service_identity package in tests to prevent warnings\n  (:issue:`1168`)\n- Fix deprecated settings API in tests (:issue:`1152`)\n- Add test for webclient with POST method and no body given (:issue:`1089`)\n- py3-ignores.txt supports comments (:issue:`1044`)\n- modernize some of the asserts (:issue:`835`)\n- selector.__repr__ test (:issue:`779`)\n\nCode refactoring\n\n- CSVFeedSpider cleanup: use iterate_spider_output (:issue:`1079`)\n- remove unnecessary check from scrapy.utils.spider.iter_spider_output\n  (:issue:`1078`)\n- Pydispatch pep8 (:issue:`992`)\n- Removed unused 'load=False' parameter from walk_modules() (:issue:`871`)\n- For consistency, use ``job_dir`` helper in ``SpiderState`` extension.\n  (:issue:`805`)\n- rename \"sflo\" local variables to less cryptic \"log_observer\" (:issue:`775`)\n\nScrapy 0.24.6 (2015-04-20)\n--------------------------\n\n- encode invalid xpath with unicode_escape under PY2 (:commit:`07cb3e5`)\n- fix IPython shell scope issue and load IPython user config (:commit:`2c8e573`)\n- Fix small typo in the docs (:commit:`d694019`)\n- Fix small typo (:commit:`f92fa83`)\n- Converted sel.xpath() calls to response.xpath() in Extracting the data (:commit:`c2c6d15`)\n\n\nScrapy 0.24.5 (2015-02-25)\n--------------------------\n\n- Support new _getEndpoint Agent signatures on Twisted 15.0.0 (:commit:`540b9bc`)\n- DOC a couple more references are fixed (:commit:`b4c454b`)\n- DOC fix a reference (:commit:`e3c1260`)\n- t.i.b.ThreadedResolver is now a new-style class (:commit:`9e13f42`)\n- S3DownloadHandler: fix auth for requests with quoted paths/query params (:commit:`cdb9a0b`)\n- fixed the variable types in mailsender documentation (:commit:`bb3a848`)\n- Reset items_scraped instead of item_count (:commit:`edb07a4`)\n- Tentative attention message about what document to read for contributions (:commit:`7ee6f7a`)\n- mitmproxy 0.10.1 needs netlib 0.10.1 too (:commit:`874fcdd`)\n- pin mitmproxy 0.10.1 as >0.11 does not work with tests (:commit:`c6b21f0`)\n- Test the parse command locally instead of against an external url (:commit:`c3a6628`)\n- Patches Twisted issue while closing the connection pool on HTTPDownloadHandler (:commit:`d0bf957`)\n- Updates documentation on dynamic item classes. (:commit:`eeb589a`)\n- Merge pull request #943 from Lazar-T/patch-3 (:commit:`5fdab02`)\n- typo (:commit:`b0ae199`)\n- pywin32 is required by Twisted. closes #937 (:commit:`5cb0cfb`)\n- Update install.rst (:commit:`781286b`)\n- Merge pull request #928 from Lazar-T/patch-1 (:commit:`b415d04`)\n- comma instead of fullstop (:commit:`627b9ba`)\n- Merge pull request #885 from jsma/patch-1 (:commit:`de909ad`)\n- Update request-response.rst (:commit:`3f3263d`)\n- SgmlLinkExtractor - fix for parsing <area> tag with Unicode present (:commit:`49b40f0`)\n\nScrapy 0.24.4 (2014-08-09)\n--------------------------\n\n- pem file is used by mockserver and required by scrapy bench (:commit:`5eddc68`)\n- scrapy bench needs scrapy.tests* (:commit:`d6cb999`)\n\nScrapy 0.24.3 (2014-08-09)\n--------------------------\n\n- no need to waste travis-ci time on py3 for 0.24 (:commit:`8e080c1`)\n- Update installation docs (:commit:`1d0c096`)\n- There is a trove classifier for Scrapy framework! (:commit:`4c701d7`)\n- update other places where w3lib version is mentioned (:commit:`d109c13`)\n- Update w3lib requirement to 1.8.0 (:commit:`39d2ce5`)\n- Use w3lib.html.replace_entities() (remove_entities() is deprecated) (:commit:`180d3ad`)\n- set zip_safe=False (:commit:`a51ee8b`)\n- do not ship tests package (:commit:`ee3b371`)\n- scrapy.bat is not needed anymore (:commit:`c3861cf`)\n- Modernize setup.py (:commit:`362e322`)\n- headers can not handle non-string values (:commit:`94a5c65`)\n- fix ftp test cases (:commit:`a274a7f`)\n- The sum up of travis-ci builds are taking like 50min to complete (:commit:`ae1e2cc`)\n- Update shell.rst typo (:commit:`e49c96a`)\n- removes weird indentation in the shell results (:commit:`1ca489d`)\n- improved explanations, clarified blog post as source, added link for XPath string functions in the spec (:commit:`65c8f05`)\n- renamed UserTimeoutError and ServerTimeouterror #583 (:commit:`037f6ab`)\n- adding some xpath tips to selectors docs (:commit:`2d103e0`)\n- fix tests to account for https://github.com/scrapy/w3lib/pull/23 (:commit:`f8d366a`)\n- get_func_args maximum recursion fix #728 (:commit:`81344ea`)\n- Updated input/output processor example according to #560. (:commit:`f7c4ea8`)\n- Fixed Python syntax in tutorial. (:commit:`db59ed9`)\n- Add test case for tunneling proxy (:commit:`f090260`)\n- Bugfix for leaking Proxy-Authorization header to remote host when using tunneling (:commit:`d8793af`)\n- Extract links from XHTML documents with MIME-Type \"application/xml\" (:commit:`ed1f376`)\n- Merge pull request #793 from roysc/patch-1 (:commit:`91a1106`)\n- Fix typo in commands.rst (:commit:`743e1e2`)\n- better testcase for settings.overrides.setdefault (:commit:`e22daaf`)\n- Using CRLF as line marker according to http 1.1 definition (:commit:`5ec430b`)\n\nScrapy 0.24.2 (2014-07-08)\n--------------------------\n\n- Use a mutable mapping to proxy deprecated settings.overrides and settings.defaults attribute (:commit:`e5e8133`)\n- there is not support for python3 yet (:commit:`3cd6146`)\n- Update python compatible version set to Debian packages (:commit:`fa5d76b`)\n- DOC fix formatting in release notes (:commit:`c6a9e20`)\n\nScrapy 0.24.1 (2014-06-27)\n--------------------------\n\n- Fix deprecated CrawlerSettings and increase backward compatibility with\n  .defaults attribute (:commit:`8e3f20a`)\n\n\nScrapy 0.24.0 (2014-06-26)\n--------------------------\n\nEnhancements\n~~~~~~~~~~~~\n\n- Improve Scrapy top-level namespace (:issue:`494`, :issue:`684`)\n- Add selector shortcuts to responses (:issue:`554`, :issue:`690`)\n- Add new lxml based LinkExtractor to replace unmaintained SgmlLinkExtractor\n  (:issue:`559`, :issue:`761`, :issue:`763`)\n- Cleanup settings API - part of per-spider settings **GSoC project** (:issue:`737`)\n- Add UTF8 encoding header to templates (:issue:`688`, :issue:`762`)\n- Telnet console now binds to 127.0.0.1 by default (:issue:`699`)\n- Update Debian/Ubuntu install instructions (:issue:`509`, :issue:`549`)\n- Disable smart strings in lxml XPath evaluations (:issue:`535`)\n- Restore filesystem based cache as default for http\n  cache middleware (:issue:`541`, :issue:`500`, :issue:`571`)\n- Expose current crawler in Scrapy shell (:issue:`557`)\n- Improve testsuite comparing CSV and XML exporters (:issue:`570`)\n- New ``offsite/filtered`` and ``offsite/domains`` stats (:issue:`566`)\n- Support process_links as generator in CrawlSpider (:issue:`555`)\n- Verbose logging and new stats counters for DupeFilter (:issue:`553`)\n- Add a mimetype parameter to ``MailSender.send()`` (:issue:`602`)\n- Generalize file pipeline log messages (:issue:`622`)\n- Replace unencodeable codepoints with html entities in SGMLLinkExtractor (:issue:`565`)\n- Converted SEP documents to rst format (:issue:`629`, :issue:`630`,\n  :issue:`638`, :issue:`632`, :issue:`636`, :issue:`640`, :issue:`635`,\n  :issue:`634`, :issue:`639`, :issue:`637`, :issue:`631`, :issue:`633`,\n  :issue:`641`, :issue:`642`)\n- Tests and docs for clickdata's nr index in FormRequest (:issue:`646`, :issue:`645`)\n- Allow to disable a downloader handler just like any other component (:issue:`650`)\n- Log when a request is discarded after too many redirections (:issue:`654`)\n- Log error responses if they are not handled by spider callbacks\n  (:issue:`612`, :issue:`656`)\n- Add content-type check to http compression mw (:issue:`193`, :issue:`660`)\n- Run pypy tests using latest pypi from ppa (:issue:`674`)\n- Run test suite using pytest instead of trial (:issue:`679`)\n- Build docs and check for dead links in tox environment (:issue:`687`)\n- Make scrapy.version_info a tuple of integers (:issue:`681`, :issue:`692`)\n- Infer exporter's output format from filename extensions\n  (:issue:`546`, :issue:`659`, :issue:`760`)\n- Support case-insensitive domains in ``url_is_from_any_domain()`` (:issue:`693`)\n- Remove pep8 warnings in project and spider templates (:issue:`698`)\n- Tests and docs for ``request_fingerprint`` function (:issue:`597`)\n- Update SEP-19 for GSoC project ``per-spider settings`` (:issue:`705`)\n- Set exit code to non-zero when contracts fails (:issue:`727`)\n- Add a setting to control what class is instantiated as Downloader component\n  (:issue:`738`)\n- Pass response in ``item_dropped`` signal (:issue:`724`)\n- Improve ``scrapy check`` contracts command (:issue:`733`, :issue:`752`)\n- Document ``spider.closed()`` shortcut (:issue:`719`)\n- Document ``request_scheduled`` signal (:issue:`746`)\n- Add a note about reporting security issues (:issue:`697`)\n- Add LevelDB http cache storage backend (:issue:`626`, :issue:`500`)\n- Sort spider list output of ``scrapy list`` command (:issue:`742`)\n- Multiple documentation enhancements and fixes\n  (:issue:`575`, :issue:`587`, :issue:`590`, :issue:`596`, :issue:`610`,\n  :issue:`617`, :issue:`618`, :issue:`627`, :issue:`613`, :issue:`643`,\n  :issue:`654`, :issue:`675`, :issue:`663`, :issue:`711`, :issue:`714`)\n\nBugfixes\n~~~~~~~~\n\n- Encode unicode URL value when creating Links in RegexLinkExtractor (:issue:`561`)\n- Ignore None values in ItemLoader processors (:issue:`556`)\n- Fix link text when there is an inner tag in SGMLLinkExtractor and\n  HtmlParserLinkExtractor (:issue:`485`, :issue:`574`)\n- Fix wrong checks on subclassing of deprecated classes\n  (:issue:`581`, :issue:`584`)\n- Handle errors caused by inspect.stack() failures (:issue:`582`)\n- Fix a reference to unexistent engine attribute (:issue:`593`, :issue:`594`)\n- Fix dynamic itemclass example usage of type() (:issue:`603`)\n- Use lucasdemarchi/codespell to fix typos (:issue:`628`)\n- Fix default value of attrs argument in SgmlLinkExtractor to be tuple (:issue:`661`)\n- Fix XXE flaw in sitemap reader (:issue:`676`)\n- Fix engine to support filtered start requests (:issue:`707`)\n- Fix offsite middleware case on urls with no hostnames (:issue:`745`)\n- Testsuite doesn't require PIL anymore (:issue:`585`)\n\n\nScrapy 0.22.2 (released 2014-02-14)\n-----------------------------------\n\n- fix a reference to unexistent engine.slots. closes #593 (:commit:`13c099a`)\n- downloaderMW doc typo (spiderMW doc copy remnant) (:commit:`8ae11bf`)\n- Correct typos (:commit:`1346037`)\n\nScrapy 0.22.1 (released 2014-02-08)\n-----------------------------------\n\n- localhost666 can resolve under certain circumstances (:commit:`2ec2279`)\n- test inspect.stack failure (:commit:`cc3eda3`)\n- Handle cases when inspect.stack() fails (:commit:`8cb44f9`)\n- Fix wrong checks on subclassing of deprecated classes. closes #581 (:commit:`46d98d6`)\n- Docs: 4-space indent for final spider example (:commit:`13846de`)\n- Fix HtmlParserLinkExtractor and tests after #485 merge (:commit:`368a946`)\n- BaseSgmlLinkExtractor: Fixed the missing space when the link has an inner tag (:commit:`b566388`)\n- BaseSgmlLinkExtractor: Added unit test of a link with an inner tag (:commit:`c1cb418`)\n- BaseSgmlLinkExtractor: Fixed unknown_endtag() so that it only set current_link=None when the end tag match the opening tag (:commit:`7e4d627`)\n- Fix tests for Travis-CI build (:commit:`76c7e20`)\n- replace unencodable codepoints with html entities. fixes #562 and #285 (:commit:`5f87b17`)\n- RegexLinkExtractor: encode URL unicode value when creating Links (:commit:`d0ee545`)\n- Updated the tutorial crawl output with latest output. (:commit:`8da65de`)\n- Updated shell docs with the crawler reference and fixed the actual shell output. (:commit:`875b9ab`)\n- PEP8 minor edits. (:commit:`f89efaf`)\n- Expose current crawler in the Scrapy shell. (:commit:`5349cec`)\n- Unused re import and PEP8 minor edits. (:commit:`387f414`)\n- Ignore None's values when using the ItemLoader. (:commit:`0632546`)\n- DOC Fixed HTTPCACHE_STORAGE typo in the default value which is now Filesystem instead Dbm. (:commit:`cde9a8c`)\n- show Ubuntu setup instructions as literal code (:commit:`fb5c9c5`)\n- Update Ubuntu installation instructions (:commit:`70fb105`)\n- Merge pull request #550 from stray-leone/patch-1 (:commit:`6f70b6a`)\n- modify the version of Scrapy Ubuntu package (:commit:`725900d`)\n- fix 0.22.0 release date (:commit:`af0219a`)\n- fix typos in news.rst and remove (not released yet) header (:commit:`b7f58f4`)\n\nScrapy 0.22.0 (released 2014-01-17)\n-----------------------------------\n\nEnhancements\n~~~~~~~~~~~~\n\n- [**Backward incompatible**] Switched HTTPCacheMiddleware backend to filesystem (:issue:`541`)\n  To restore old backend set ``HTTPCACHE_STORAGE`` to ``scrapy.contrib.httpcache.DbmCacheStorage``\n- Proxy \\https:// urls using CONNECT method (:issue:`392`, :issue:`397`)\n- Add a middleware to crawl ajax crawleable pages as defined by google (:issue:`343`)\n- Rename scrapy.spider.BaseSpider to scrapy.spider.Spider (:issue:`510`, :issue:`519`)\n- Selectors register EXSLT namespaces by default (:issue:`472`)\n- Unify item loaders similar to selectors renaming (:issue:`461`)\n- Make ``RFPDupeFilter`` class easily subclassable (:issue:`533`)\n- Improve test coverage and forthcoming Python 3 support (:issue:`525`)\n- Promote startup info on settings and middleware to INFO level (:issue:`520`)\n- Support partials in ``get_func_args`` util (:issue:`506`, issue:`504`)\n- Allow running individual tests via tox (:issue:`503`)\n- Update extensions ignored by link extractors (:issue:`498`)\n- Add middleware methods to get files/images/thumbs paths (:issue:`490`)\n- Improve offsite middleware tests (:issue:`478`)\n- Add a way to skip default Referer header set by RefererMiddleware (:issue:`475`)\n- Do not send ``x-gzip`` in default ``Accept-Encoding`` header (:issue:`469`)\n- Support defining http error handling using settings (:issue:`466`)\n- Use modern python idioms wherever you find legacies (:issue:`497`)\n- Improve and correct documentation\n  (:issue:`527`, :issue:`524`, :issue:`521`, :issue:`517`, :issue:`512`, :issue:`505`,\n  :issue:`502`, :issue:`489`, :issue:`465`, :issue:`460`, :issue:`425`, :issue:`536`)\n\nFixes\n~~~~~\n\n- Update Selector class imports in CrawlSpider template (:issue:`484`)\n- Fix unexistent reference to ``engine.slots`` (:issue:`464`)\n- Do not try to call ``body_as_unicode()`` on a non-TextResponse instance (:issue:`462`)\n- Warn when subclassing XPathItemLoader, previously it only warned on\n  instantiation. (:issue:`523`)\n- Warn when subclassing XPathSelector, previously it only warned on\n  instantiation. (:issue:`537`)\n- Multiple fixes to memory stats (:issue:`531`, :issue:`530`, :issue:`529`)\n- Fix overriding url in ``FormRequest.from_response()`` (:issue:`507`)\n- Fix tests runner under pip 1.5 (:issue:`513`)\n- Fix logging error when spider name is unicode (:issue:`479`)\n\nScrapy 0.20.2 (released 2013-12-09)\n-----------------------------------\n\n- Update CrawlSpider Template with Selector changes (:commit:`6d1457d`)\n- fix method name in tutorial. closes GH-480 (:commit:`b4fc359`\n\nScrapy 0.20.1 (released 2013-11-28)\n-----------------------------------\n\n- include_package_data is required to build wheels from published sources (:commit:`5ba1ad5`)\n- process_parallel was leaking the failures on its internal deferreds.  closes #458 (:commit:`419a780`)\n\nScrapy 0.20.0 (released 2013-11-08)\n-----------------------------------\n\nEnhancements\n~~~~~~~~~~~~\n\n- New Selector's API including CSS selectors (:issue:`395` and :issue:`426`),\n- Request/Response url/body attributes are now immutable\n  (modifying them had been deprecated for a long time)\n- :setting:`ITEM_PIPELINES` is now defined as a dict (instead of a list)\n- Sitemap spider can fetch alternate URLs (:issue:`360`)\n- ``Selector.remove_namespaces()`` now remove namespaces from element's attributes. (:issue:`416`)\n- Paved the road for Python 3.3+ (:issue:`435`, :issue:`436`, :issue:`431`, :issue:`452`)\n- New item exporter using native python types with nesting support (:issue:`366`)\n- Tune HTTP1.1 pool size so it matches concurrency defined by settings (:commit:`b43b5f575`)\n- scrapy.mail.MailSender now can connect over TLS or upgrade using STARTTLS (:issue:`327`)\n- New FilesPipeline with functionality factored out from ImagesPipeline (:issue:`370`, :issue:`409`)\n- Recommend Pillow instead of PIL for image handling (:issue:`317`)\n- Added Debian packages for Ubuntu Quantal and Raring (:commit:`86230c0`)\n- Mock server (used for tests) can listen for HTTPS requests (:issue:`410`)\n- Remove multi spider support from multiple core components\n  (:issue:`422`, :issue:`421`, :issue:`420`, :issue:`419`, :issue:`423`, :issue:`418`)\n- Travis-CI now tests Scrapy changes against development versions of ``w3lib`` and ``queuelib`` python packages.\n- Add pypy 2.1 to continuous integration tests (:commit:`ecfa7431`)\n- Pylinted, pep8 and removed old-style exceptions from source (:issue:`430`, :issue:`432`)\n- Use importlib for parametric imports (:issue:`445`)\n- Handle a regression introduced in Python 2.7.5 that affects XmlItemExporter (:issue:`372`)\n- Bugfix crawling shutdown on SIGINT (:issue:`450`)\n- Do not submit ``reset`` type inputs in FormRequest.from_response (:commit:`b326b87`)\n- Do not silence download errors when request errback raises an exception (:commit:`684cfc0`)\n\nBugfixes\n~~~~~~~~\n\n- Fix tests under Django 1.6 (:commit:`b6bed44c`)\n- Lot of bugfixes to retry middleware under disconnections using HTTP 1.1 download handler\n- Fix inconsistencies among Twisted releases (:issue:`406`)\n- Fix Scrapy shell bugs (:issue:`418`, :issue:`407`)\n- Fix invalid variable name in setup.py (:issue:`429`)\n- Fix tutorial references (:issue:`387`)\n- Improve request-response docs (:issue:`391`)\n- Improve best practices docs (:issue:`399`, :issue:`400`, :issue:`401`, :issue:`402`)\n- Improve django integration docs (:issue:`404`)\n- Document ``bindaddress`` request meta (:commit:`37c24e01d7`)\n- Improve ``Request`` class documentation (:issue:`226`)\n\nOther\n~~~~~\n\n- Dropped Python 2.6 support (:issue:`448`)\n- Add :doc:`cssselect <cssselect:index>` python package as install dependency\n- Drop libxml2 and multi selector's backend support, `lxml`_ is required from now on.\n- Minimum Twisted version increased to 10.0.0, dropped Twisted 8.0 support.\n- Running test suite now requires ``mock`` python library (:issue:`390`)\n\n\nThanks\n~~~~~~\n\nThanks to everyone who contribute to this release!\n\nList of contributors sorted by number of commits::\n\n     69 Daniel Gra\u00f1a <dangra@...>\n     37 Pablo Hoffman <pablo@...>\n     13 Mikhail Korobov <kmike84@...>\n      9 Alex Cepoi <alex.cepoi@...>\n      9 alexanderlukanin13 <alexander.lukanin.13@...>\n      8 Rolando Espinoza La fuente <darkrho@...>\n      8 Lukasz Biedrycki <lukasz.biedrycki@...>\n      6 Nicolas Ramirez <nramirez.uy@...>\n      3 Paul Tremberth <paul.tremberth@...>\n      2 Martin Olveyra <molveyra@...>\n      2 Stefan <misc@...>\n      2 Rolando Espinoza <darkrho@...>\n      2 Loren Davie <loren@...>\n      2 irgmedeiros <irgmedeiros@...>\n      1 Stefan Koch <taikano@...>\n      1 Stefan <cct@...>\n      1 scraperdragon <dragon@...>\n      1 Kumara Tharmalingam <ktharmal@...>\n      1 Francesco Piccinno <stack.box@...>\n      1 Marcos Campal <duendex@...>\n      1 Dragon Dave <dragon@...>\n      1 Capi Etheriel <barraponto@...>\n      1 cacovsky <amarquesferraz@...>\n      1 Berend Iwema <berend@...>\n\nScrapy 0.18.4 (released 2013-10-10)\n-----------------------------------\n\n- IPython refuses to update the namespace. fix #396 (:commit:`3d32c4f`)\n- Fix AlreadyCalledError replacing a request in shell command. closes #407 (:commit:`b1d8919`)\n- Fix start_requests laziness and early hangs (:commit:`89faf52`)\n\nScrapy 0.18.3 (released 2013-10-03)\n-----------------------------------\n\n- fix regression on lazy evaluation of start requests (:commit:`12693a5`)\n- forms: do not submit reset inputs (:commit:`e429f63`)\n- increase unittest timeouts to decrease travis false positive failures (:commit:`912202e`)\n- backport master fixes to json exporter (:commit:`cfc2d46`)\n- Fix permission and set umask before generating sdist tarball (:commit:`06149e0`)\n\nScrapy 0.18.2 (released 2013-09-03)\n-----------------------------------\n\n- Backport ``scrapy check`` command fixes and backward compatible multi\n  crawler process(:issue:`339`)\n\nScrapy 0.18.1 (released 2013-08-27)\n-----------------------------------\n\n- remove extra import added by cherry picked changes (:commit:`d20304e`)\n- fix crawling tests under twisted pre 11.0.0 (:commit:`1994f38`)\n- py26 can not format zero length fields {} (:commit:`abf756f`)\n- test PotentiaDataLoss errors on unbound responses (:commit:`b15470d`)\n- Treat responses without content-length or Transfer-Encoding as good responses (:commit:`c4bf324`)\n- do no include ResponseFailed if http11 handler is not enabled (:commit:`6cbe684`)\n- New HTTP client wraps connection lost in ResponseFailed exception. fix #373 (:commit:`1a20bba`)\n- limit travis-ci build matrix (:commit:`3b01bb8`)\n- Merge pull request #375 from peterarenot/patch-1 (:commit:`fa766d7`)\n- Fixed so it refers to the correct folder (:commit:`3283809`)\n- added Quantal & Raring to support Ubuntu releases (:commit:`1411923`)\n- fix retry middleware which didn't retry certain connection errors after the upgrade to http1 client, closes GH-373 (:commit:`bb35ed0`)\n- fix XmlItemExporter in Python 2.7.4 and 2.7.5 (:commit:`de3e451`)\n- minor updates to 0.18 release notes (:commit:`c45e5f1`)\n- fix contributors list format (:commit:`0b60031`)\n\nScrapy 0.18.0 (released 2013-08-09)\n-----------------------------------\n\n- Lot of improvements to testsuite run using Tox, including a way to test on pypi\n- Handle GET parameters for AJAX crawleable urls (:commit:`3fe2a32`)\n- Use lxml recover option to parse sitemaps (:issue:`347`)\n- Bugfix cookie merging by hostname and not by netloc (:issue:`352`)\n- Support disabling ``HttpCompressionMiddleware`` using a flag setting (:issue:`359`)\n- Support xml namespaces using ``iternodes`` parser in ``XMLFeedSpider`` (:issue:`12`)\n- Support ``dont_cache`` request meta flag (:issue:`19`)\n- Bugfix ``scrapy.utils.gz.gunzip`` broken by changes in python 2.7.4 (:commit:`4dc76e`)\n- Bugfix url encoding on ``SgmlLinkExtractor`` (:issue:`24`)\n- Bugfix ``TakeFirst`` processor shouldn't discard zero (0) value (:issue:`59`)\n- Support nested items in xml exporter (:issue:`66`)\n- Improve cookies handling performance (:issue:`77`)\n- Log dupe filtered requests once (:issue:`105`)\n- Split redirection middleware into status and meta based middlewares (:issue:`78`)\n- Use HTTP1.1 as default downloader handler (:issue:`109` and :issue:`318`)\n- Support xpath form selection on ``FormRequest.from_response`` (:issue:`185`)\n- Bugfix unicode decoding error on ``SgmlLinkExtractor`` (:issue:`199`)\n- Bugfix signal dispatching on pypi interpreter (:issue:`205`)\n- Improve request delay and concurrency handling (:issue:`206`)\n- Add RFC2616 cache policy to ``HttpCacheMiddleware`` (:issue:`212`)\n- Allow customization of messages logged by engine (:issue:`214`)\n- Multiples improvements to ``DjangoItem`` (:issue:`217`, :issue:`218`, :issue:`221`)\n- Extend Scrapy commands using setuptools entry points (:issue:`260`)\n- Allow spider ``allowed_domains`` value to be set/tuple (:issue:`261`)\n- Support ``settings.getdict`` (:issue:`269`)\n- Simplify internal ``scrapy.core.scraper`` slot handling (:issue:`271`)\n- Added ``Item.copy`` (:issue:`290`)\n- Collect idle downloader slots (:issue:`297`)\n- Add ``ftp://`` scheme downloader handler (:issue:`329`)\n- Added downloader benchmark webserver and spider tools :ref:`benchmarking`\n- Moved persistent (on disk) queues to a separate project (queuelib_) which Scrapy now depends on\n- Add Scrapy commands using external libraries (:issue:`260`)\n- Added ``--pdb`` option to ``scrapy`` command line tool\n- Added :meth:`XPathSelector.remove_namespaces <scrapy.selector.Selector.remove_namespaces>` which allows to remove all namespaces from XML documents for convenience (to work with namespace-less XPaths). Documented in :ref:`topics-selectors`.\n- Several improvements to spider contracts\n- New default middleware named MetaRefreshMiddldeware that handles meta-refresh html tag redirections,\n- MetaRefreshMiddldeware and RedirectMiddleware have different priorities to address #62\n- added from_crawler method to spiders\n- added system tests with mock server\n- more improvements to macOS compatibility (thanks Alex Cepoi)\n- several more cleanups to singletons and multi-spider support (thanks Nicolas Ramirez)\n- support custom download slots\n- added --spider option to \"shell\" command.\n- log overridden settings when Scrapy starts\n\nThanks to everyone who contribute to this release. Here is a list of\ncontributors sorted by number of commits::\n\n    130 Pablo Hoffman <pablo@...>\n     97 Daniel Gra\u00f1a <dangra@...>\n     20 Nicol\u00e1s Ram\u00edrez <nramirez.uy@...>\n     13 Mikhail Korobov <kmike84@...>\n     12 Pedro Faustino <pedrobandim@...>\n     11 Steven Almeroth <sroth77@...>\n      5 Rolando Espinoza La fuente <darkrho@...>\n      4 Michal Danilak <mimino.coder@...>\n      4 Alex Cepoi <alex.cepoi@...>\n      4 Alexandr N Zamaraev (aka tonal) <tonal@...>\n      3 paul <paul.tremberth@...>\n      3 Martin Olveyra <molveyra@...>\n      3 Jordi Llonch <llonchj@...>\n      3 arijitchakraborty <myself.arijit@...>\n      2 Shane Evans <shane.evans@...>\n      2 joehillen <joehillen@...>\n      2 Hart <HartSimha@...>\n      2 Dan <ellisd23@...>\n      1 Zuhao Wan <wanzuhao@...>\n      1 whodatninja <blake@...>\n      1 vkrest <v.krestiannykov@...>\n      1 tpeng <pengtaoo@...>\n      1 Tom Mortimer-Jones <tom@...>\n      1 Rocio Aramberri <roschegel@...>\n      1 Pedro <pedro@...>\n      1 notsobad <wangxiaohugg@...>\n      1 Natan L <kuyanatan.nlao@...>\n      1 Mark Grey <mark.grey@...>\n      1 Luan <luanpab@...>\n      1 Libor Nenad\u00e1l <libor.nenadal@...>\n      1 Juan M Uys <opyate@...>\n      1 Jonas Brunsgaard <jonas.brunsgaard@...>\n      1 Ilya Baryshev <baryshev@...>\n      1 Hasnain Lakhani <m.hasnain.lakhani@...>\n      1 Emanuel Schorsch <emschorsch@...>\n      1 Chris Tilden <chris.tilden@...>\n      1 Capi Etheriel <barraponto@...>\n      1 cacovsky <amarquesferraz@...>\n      1 Berend Iwema <berend@...>\n\n\nScrapy 0.16.5 (released 2013-05-30)\n-----------------------------------\n\n- obey request method when Scrapy deploy is redirected to a new endpoint (:commit:`8c4fcee`)\n- fix inaccurate downloader middleware documentation. refs #280 (:commit:`40667cb`)\n- doc: remove links to diveintopython.org, which is no longer available. closes #246 (:commit:`bd58bfa`)\n- Find form nodes in invalid html5 documents (:commit:`e3d6945`)\n- Fix typo labeling attrs type bool instead of list (:commit:`a274276`)\n\nScrapy 0.16.4 (released 2013-01-23)\n-----------------------------------\n\n- fixes spelling errors in documentation (:commit:`6d2b3aa`)\n- add doc about disabling an extension. refs #132 (:commit:`c90de33`)\n- Fixed error message formatting. log.err() doesn't support cool formatting and when error occurred, the message was:    \"ERROR: Error processing %(item)s\" (:commit:`c16150c`)\n- lint and improve images pipeline error logging (:commit:`56b45fc`)\n- fixed doc typos (:commit:`243be84`)\n- add documentation topics: Broad Crawls & Common Practices (:commit:`1fbb715`)\n- fix bug in Scrapy parse command when spider is not specified explicitly. closes #209 (:commit:`c72e682`)\n- Update docs/topics/commands.rst (:commit:`28eac7a`)\n\nScrapy 0.16.3 (released 2012-12-07)\n-----------------------------------\n\n- Remove concurrency limitation when using download delays and still ensure inter-request delays are enforced (:commit:`487b9b5`)\n- add error details when image pipeline fails (:commit:`8232569`)\n- improve macOS compatibility (:commit:`8dcf8aa`)\n- setup.py: use README.rst to populate long_description (:commit:`7b5310d`)\n- doc: removed obsolete references to ClientForm (:commit:`80f9bb6`)\n- correct docs for default storage backend (:commit:`2aa491b`)\n- doc: removed broken proxyhub link from FAQ (:commit:`bdf61c4`)\n- Fixed docs typo in SpiderOpenCloseLogging example (:commit:`7184094`)\n\n\nScrapy 0.16.2 (released 2012-11-09)\n-----------------------------------\n\n- Scrapy contracts: python2.6 compat (:commit:`a4a9199`)\n- Scrapy contracts verbose option (:commit:`ec41673`)\n- proper unittest-like output for Scrapy contracts (:commit:`86635e4`)\n- added open_in_browser to debugging doc (:commit:`c9b690d`)\n- removed reference to global Scrapy stats from settings doc (:commit:`dd55067`)\n- Fix SpiderState bug in Windows platforms (:commit:`58998f4`)\n\n\nScrapy 0.16.1 (released 2012-10-26)\n-----------------------------------\n\n- fixed LogStats extension, which got broken after a wrong merge before the 0.16 release (:commit:`8c780fd`)\n- better backward compatibility for scrapy.conf.settings (:commit:`3403089`)\n- extended documentation on how to access crawler stats from extensions (:commit:`c4da0b5`)\n- removed .hgtags (no longer needed now that Scrapy uses git) (:commit:`d52c188`)\n- fix dashes under rst headers (:commit:`fa4f7f9`)\n- set release date for 0.16.0 in news (:commit:`e292246`)\n\n\nScrapy 0.16.0 (released 2012-10-18)\n-----------------------------------\n\nScrapy changes:\n\n- added :ref:`topics-contracts`, a mechanism for testing spiders in a formal/reproducible way\n- added options ``-o`` and ``-t`` to the :command:`runspider` command\n- documented :doc:`topics/autothrottle` and added to extensions installed by default. You still need to enable it with :setting:`AUTOTHROTTLE_ENABLED`\n- major Stats Collection refactoring: removed separation of global/per-spider stats, removed stats-related signals (``stats_spider_opened``, etc). Stats are much simpler now, backward compatibility is kept on the Stats Collector API and signals.\n- added :meth:`~scrapy.spidermiddlewares.SpiderMiddleware.process_start_requests` method to spider middlewares\n- dropped Signals singleton. Signals should now be accessed through the Crawler.signals attribute. See the signals documentation for more info.\n- dropped Stats Collector singleton. Stats can now be accessed through the Crawler.stats attribute. See the stats collection documentation for more info.\n- documented :ref:`topics-api`\n- ``lxml`` is now the default selectors backend instead of ``libxml2``\n- ported FormRequest.from_response() to use `lxml`_ instead of `ClientForm`_\n- removed modules: ``scrapy.xlib.BeautifulSoup`` and ``scrapy.xlib.ClientForm``\n- SitemapSpider: added support for sitemap urls ending in .xml and .xml.gz, even if they advertise a wrong content type (:commit:`10ed28b`)\n- StackTraceDump extension: also dump trackref live references (:commit:`fe2ce93`)\n- nested items now fully supported in JSON and JSONLines exporters\n- added :reqmeta:`cookiejar` Request meta key to support multiple cookie sessions per spider\n- decoupled encoding detection code to `w3lib.encoding`_, and ported Scrapy code to use that module\n- dropped support for Python 2.5. See https://blog.scrapinghub.com/2012/02/27/scrapy-0-15-dropping-support-for-python-2-5/\n- dropped support for Twisted 2.5\n- added :setting:`REFERER_ENABLED` setting, to control referer middleware\n- changed default user agent to: ``Scrapy/VERSION (+http://scrapy.org)``\n- removed (undocumented) ``HTMLImageLinkExtractor`` class from ``scrapy.contrib.linkextractors.image``\n- removed per-spider settings (to be replaced by instantiating multiple crawler objects)\n- ``USER_AGENT`` spider attribute will no longer work, use ``user_agent`` attribute instead\n- ``DOWNLOAD_TIMEOUT`` spider attribute will no longer work, use ``download_timeout`` attribute instead\n- removed ``ENCODING_ALIASES`` setting, as encoding auto-detection has been moved to the `w3lib`_ library\n- promoted :ref:`topics-djangoitem` to main contrib\n- LogFormatter method now return dicts(instead of strings) to support lazy formatting (:issue:`164`, :commit:`dcef7b0`)\n- downloader handlers (:setting:`DOWNLOAD_HANDLERS` setting) now receive settings as the first argument of the ``__init__`` method\n- replaced memory usage acounting with (more portable) `resource`_ module, removed ``scrapy.utils.memory`` module\n- removed signal: ``scrapy.mail.mail_sent``\n- removed ``TRACK_REFS`` setting, now :ref:`trackrefs <topics-leaks-trackrefs>` is always enabled\n- DBM is now the default storage backend for HTTP cache middleware\n- number of log messages (per level) are now tracked through Scrapy stats (stat name: ``log_count/LEVEL``)\n- number received responses are now tracked through Scrapy stats (stat name: ``response_received_count``)\n- removed ``scrapy.log.started`` attribute\n\nScrapy 0.14.4\n-------------\n\n- added precise to supported Ubuntu distros (:commit:`b7e46df`)\n- fixed bug in json-rpc webservice reported in https://groups.google.com/forum/#!topic/scrapy-users/qgVBmFybNAQ/discussion. also removed no longer supported 'run' command from extras/scrapy-ws.py (:commit:`340fbdb`)\n- meta tag attributes for content-type http equiv can be in any order. #123 (:commit:`0cb68af`)\n- replace \"import Image\" by more standard \"from PIL import Image\". closes #88 (:commit:`4d17048`)\n- return trial status as bin/runtests.sh exit value. #118 (:commit:`b7b2e7f`)\n\nScrapy 0.14.3\n-------------\n\n- forgot to include pydispatch license. #118 (:commit:`fd85f9c`)\n- include egg files used by testsuite in source distribution. #118 (:commit:`c897793`)\n- update docstring in project template to avoid confusion with genspider command, which may be considered as an advanced feature. refs #107 (:commit:`2548dcc`)\n- added note to docs/topics/firebug.rst about google directory being shut down (:commit:`668e352`)\n- don't discard slot when empty, just save in another dict in order to recycle if needed again. (:commit:`8e9f607`)\n- do not fail handling unicode xpaths in libxml2 backed selectors (:commit:`b830e95`)\n- fixed minor mistake in Request objects documentation (:commit:`bf3c9ee`)\n- fixed minor defect in link extractors documentation (:commit:`ba14f38`)\n- removed some obsolete remaining code related to sqlite support in Scrapy (:commit:`0665175`)\n\nScrapy 0.14.2\n-------------\n\n- move buffer pointing to start of file before computing checksum. refs #92 (:commit:`6a5bef2`)\n- Compute image checksum before persisting images. closes #92 (:commit:`9817df1`)\n- remove leaking references in cached failures (:commit:`673a120`)\n- fixed bug in MemoryUsage extension: get_engine_status() takes exactly 1 argument (0 given) (:commit:`11133e9`)\n- fixed struct.error on http compression middleware. closes #87 (:commit:`1423140`)\n- ajax crawling wasn't expanding for unicode urls (:commit:`0de3fb4`)\n- Catch start_requests iterator errors. refs #83 (:commit:`454a21d`)\n- Speed-up libxml2 XPathSelector (:commit:`2fbd662`)\n- updated versioning doc according to recent changes (:commit:`0a070f5`)\n- scrapyd: fixed documentation link (:commit:`2b4e4c3`)\n- extras/makedeb.py: no longer obtaining version from git (:commit:`caffe0e`)\n\nScrapy 0.14.1\n-------------\n\n- extras/makedeb.py: no longer obtaining version from git (:commit:`caffe0e`)\n- bumped version to 0.14.1 (:commit:`6cb9e1c`)\n- fixed reference to tutorial directory (:commit:`4b86bd6`)\n- doc: removed duplicated callback argument from Request.replace() (:commit:`1aeccdd`)\n- fixed formatting of scrapyd doc (:commit:`8bf19e6`)\n- Dump stacks for all running threads and fix engine status dumped by StackTraceDump extension (:commit:`14a8e6e`)\n- added comment about why we disable ssl on boto images upload (:commit:`5223575`)\n- SSL handshaking hangs when doing too many parallel connections to S3 (:commit:`63d583d`)\n- change tutorial to follow changes on dmoz site (:commit:`bcb3198`)\n- Avoid _disconnectedDeferred AttributeError exception in Twisted>=11.1.0 (:commit:`98f3f87`)\n- allow spider to set autothrottle max concurrency (:commit:`175a4b5`)\n\nScrapy 0.14\n-----------\n\nNew features and settings\n~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Support for `AJAX crawleable urls`_\n- New persistent scheduler that stores requests on disk, allowing to suspend and resume crawls (:rev:`2737`)\n- added ``-o`` option to ``scrapy crawl``, a shortcut for dumping scraped items into a file (or standard output using ``-``)\n- Added support for passing custom settings to Scrapyd ``schedule.json`` api (:rev:`2779`, :rev:`2783`)\n- New ``ChunkedTransferMiddleware`` (enabled by default) to support `chunked transfer encoding`_ (:rev:`2769`)\n- Add boto 2.0 support for S3 downloader handler (:rev:`2763`)\n- Added `marshal`_ to formats supported by feed exports (:rev:`2744`)\n- In request errbacks, offending requests are now received in ``failure.request`` attribute (:rev:`2738`)\n- Big downloader refactoring to support per domain/ip concurrency limits (:rev:`2732`)\n   - ``CONCURRENT_REQUESTS_PER_SPIDER`` setting has been deprecated and replaced by:\n      - :setting:`CONCURRENT_REQUESTS`, :setting:`CONCURRENT_REQUESTS_PER_DOMAIN`, :setting:`CONCURRENT_REQUESTS_PER_IP`\n   - check the documentation for more details\n- Added builtin caching DNS resolver (:rev:`2728`)\n- Moved Amazon AWS-related components/extensions (SQS spider queue, SimpleDB stats collector) to a separate project: [scaws](https://github.com/scrapinghub/scaws) (:rev:`2706`, :rev:`2714`)\n- Moved spider queues to scrapyd: ``scrapy.spiderqueue`` -> ``scrapyd.spiderqueue`` (:rev:`2708`)\n- Moved sqlite utils to scrapyd: ``scrapy.utils.sqlite`` -> ``scrapyd.sqlite`` (:rev:`2781`)\n- Real support for returning iterators on ``start_requests()`` method. The iterator is now consumed during the crawl when the spider is getting idle (:rev:`2704`)\n- Added :setting:`REDIRECT_ENABLED` setting to quickly enable/disable the redirect middleware (:rev:`2697`)\n- Added :setting:`RETRY_ENABLED` setting to quickly enable/disable the retry middleware (:rev:`2694`)\n- Added ``CloseSpider`` exception to manually close spiders (:rev:`2691`)\n- Improved encoding detection by adding support for HTML5 meta charset declaration (:rev:`2690`)\n- Refactored close spider behavior to wait for all downloads to finish and be processed by spiders, before closing the spider (:rev:`2688`)\n- Added ``SitemapSpider`` (see documentation in Spiders page) (:rev:`2658`)\n- Added ``LogStats`` extension for periodically logging basic stats (like crawled pages and scraped items) (:rev:`2657`)\n- Make handling of gzipped responses more robust (#319, :rev:`2643`). Now Scrapy will try and decompress as much as possible from a gzipped response, instead of failing with an ``IOError``.\n- Simplified !MemoryDebugger extension to use stats for dumping memory debugging info (:rev:`2639`)\n- Added new command to edit spiders: ``scrapy edit`` (:rev:`2636`) and ``-e`` flag to ``genspider`` command that uses it (:rev:`2653`)\n- Changed default representation of items to pretty-printed dicts. (:rev:`2631`). This improves default logging by making log more readable in the default case, for both Scraped and Dropped lines.\n- Added :signal:`spider_error` signal (:rev:`2628`)\n- Added :setting:`COOKIES_ENABLED` setting (:rev:`2625`)\n- Stats are now dumped to Scrapy log (default value of :setting:`STATS_DUMP` setting has been changed to ``True``). This is to make Scrapy users more aware of Scrapy stats and the data that is collected there.\n- Added support for dynamically adjusting download delay and maximum concurrent requests (:rev:`2599`)\n- Added new DBM HTTP cache storage backend (:rev:`2576`)\n- Added ``listjobs.json`` API to Scrapyd (:rev:`2571`)\n- ``CsvItemExporter``: added ``join_multivalued`` parameter (:rev:`2578`)\n- Added namespace support to ``xmliter_lxml`` (:rev:`2552`)\n- Improved cookies middleware by making ``COOKIES_DEBUG`` nicer and documenting it (:rev:`2579`)\n- Several improvements to Scrapyd and Link extractors\n\nCode rearranged and removed\n~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Merged item passed and item scraped concepts, as they have often proved confusing in the past. This means: (:rev:`2630`)\n   - original item_scraped signal was removed\n   - original item_passed signal was renamed to item_scraped\n   - old log lines ``Scraped Item...`` were removed\n   - old log lines ``Passed Item...`` were renamed to ``Scraped Item...`` lines and downgraded to ``DEBUG`` level\n- Reduced Scrapy codebase by striping part of Scrapy code into two new libraries:\n   - `w3lib`_ (several functions from ``scrapy.utils.{http,markup,multipart,response,url}``, done in :rev:`2584`)\n   - `scrapely`_ (was ``scrapy.contrib.ibl``, done in :rev:`2586`)\n- Removed unused function: ``scrapy.utils.request.request_info()`` (:rev:`2577`)\n- Removed googledir project from ``examples/googledir``. There's now a new example project called ``dirbot`` available on GitHub: https://github.com/scrapy/dirbot\n- Removed support for default field values in Scrapy items (:rev:`2616`)\n- Removed experimental crawlspider v2 (:rev:`2632`)\n- Removed scheduler middleware to simplify architecture. Duplicates filter is now done in the scheduler itself, using the same dupe filtering class as before (``DUPEFILTER_CLASS`` setting) (:rev:`2640`)\n- Removed support for passing urls to ``scrapy crawl`` command (use ``scrapy parse`` instead) (:rev:`2704`)\n- Removed deprecated Execution Queue (:rev:`2704`)\n- Removed (undocumented) spider context extension (from scrapy.contrib.spidercontext) (:rev:`2780`)\n- removed ``CONCURRENT_SPIDERS`` setting (use scrapyd maxproc instead) (:rev:`2789`)\n- Renamed attributes of core components: downloader.sites -> downloader.slots, scraper.sites -> scraper.slots (:rev:`2717`, :rev:`2718`)\n- Renamed setting ``CLOSESPIDER_ITEMPASSED`` to :setting:`CLOSESPIDER_ITEMCOUNT` (:rev:`2655`). Backward compatibility kept.\n\nScrapy 0.12\n-----------\n\nThe numbers like #NNN reference tickets in the old issue tracker (Trac) which is no longer available.\n\nNew features and improvements\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Passed item is now sent in the ``item`` argument of the :signal:`item_passed\n  <item_scraped>` (#273)\n- Added verbose option to ``scrapy version`` command, useful for bug reports (#298)\n- HTTP cache now stored by default in the project data dir (#279)\n- Added project data storage directory (#276, #277)\n- Documented file structure of Scrapy projects (see command-line tool doc)\n- New lxml backend for XPath selectors (#147)\n- Per-spider settings (#245)\n- Support exit codes to signal errors in Scrapy commands (#248)\n- Added ``-c`` argument to ``scrapy shell`` command\n- Made ``libxml2`` optional (#260)\n- New ``deploy`` command (#261)\n- Added :setting:`CLOSESPIDER_PAGECOUNT` setting (#253)\n- Added :setting:`CLOSESPIDER_ERRORCOUNT` setting (#254)\n\nScrapyd changes\n~~~~~~~~~~~~~~~\n\n- Scrapyd now uses one process per spider\n- It stores one log file per spider run, and rotate them keeping the latest 5 logs per spider (by default)\n- A minimal web ui was added, available at http://localhost:6800 by default\n- There is now a ``scrapy server`` command to start a Scrapyd server of the current project\n\nChanges to settings\n~~~~~~~~~~~~~~~~~~~\n\n- added ``HTTPCACHE_ENABLED`` setting (False by default) to enable HTTP cache middleware\n- changed ``HTTPCACHE_EXPIRATION_SECS`` semantics: now zero means \"never expire\".\n\nDeprecated/obsoleted functionality\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Deprecated ``runserver`` command in favor of ``server`` command which starts a Scrapyd server. See also: Scrapyd changes\n- Deprecated ``queue`` command in favor of using Scrapyd ``schedule.json`` API. See also: Scrapyd changes\n- Removed the !LxmlItemLoader (experimental contrib which never graduated to main contrib)\n\nScrapy 0.10\n-----------\n\nThe numbers like #NNN reference tickets in the old issue tracker (Trac) which is no longer available.\n\nNew features and improvements\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- New Scrapy service called ``scrapyd`` for deploying Scrapy crawlers in production (#218) (documentation available)\n- Simplified Images pipeline usage which doesn't require subclassing your own images pipeline now (#217)\n- Scrapy shell now shows the Scrapy log by default (#206)\n- Refactored execution queue in a common base code and pluggable backends called \"spider queues\" (#220)\n- New persistent spider queue (based on SQLite) (#198), available by default, which allows to start Scrapy in server mode and then schedule spiders to run.\n- Added documentation for Scrapy command-line tool and all its available sub-commands. (documentation available)\n- Feed exporters with pluggable backends (#197) (documentation available)\n- Deferred signals (#193)\n- Added two new methods to item pipeline open_spider(), close_spider() with deferred support (#195)\n- Support for overriding default request headers per spider (#181)\n- Replaced default Spider Manager with one with similar functionality but not depending on Twisted Plugins (#186)\n- Split Debian package into two packages - the library and the service (#187)\n- Scrapy log refactoring (#188)\n- New extension for keeping persistent spider contexts among different runs (#203)\n- Added ``dont_redirect`` request.meta key for avoiding redirects (#233)\n- Added ``dont_retry`` request.meta key for avoiding retries (#234)\n\nCommand-line tool changes\n~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- New ``scrapy`` command which replaces the old ``scrapy-ctl.py`` (#199)\n  - there is only one global ``scrapy`` command now, instead of one ``scrapy-ctl.py`` per project\n  - Added ``scrapy.bat`` script for running more conveniently from Windows\n- Added bash completion to command-line tool (#210)\n- Renamed command ``start`` to ``runserver`` (#209)\n\nAPI changes\n~~~~~~~~~~~\n\n- ``url`` and ``body`` attributes of Request objects are now read-only (#230)\n- ``Request.copy()`` and ``Request.replace()`` now also copies their ``callback`` and ``errback`` attributes (#231)\n- Removed ``UrlFilterMiddleware`` from ``scrapy.contrib`` (already disabled by default)\n- Offsite middleware doesn't filter out any request coming from a spider that doesn't have a allowed_domains attribute (#225)\n- Removed Spider Manager ``load()`` method. Now spiders are loaded in the ``__init__`` method itself.\n- Changes to Scrapy Manager (now called \"Crawler\"):\n   - ``scrapy.core.manager.ScrapyManager`` class renamed to ``scrapy.crawler.Crawler``\n   - ``scrapy.core.manager.scrapymanager`` singleton moved to ``scrapy.project.crawler``\n- Moved module: ``scrapy.contrib.spidermanager`` to ``scrapy.spidermanager``\n- Spider Manager singleton moved from ``scrapy.spider.spiders`` to the ``spiders` attribute of ``scrapy.project.crawler`` singleton.\n- moved Stats Collector classes: (#204)\n   - ``scrapy.stats.collector.StatsCollector`` to ``scrapy.statscol.StatsCollector``\n   - ``scrapy.stats.collector.SimpledbStatsCollector`` to ``scrapy.contrib.statscol.SimpledbStatsCollector``\n- default per-command settings are now specified in the ``default_settings`` attribute of command object class (#201)\n- changed arguments of Item pipeline ``process_item()`` method from ``(spider, item)`` to ``(item, spider)``\n   - backward compatibility kept (with deprecation warning)\n- moved ``scrapy.core.signals`` module to ``scrapy.signals``\n   - backward compatibility kept (with deprecation warning)\n- moved ``scrapy.core.exceptions`` module to ``scrapy.exceptions``\n   - backward compatibility kept (with deprecation warning)\n- added ``handles_request()`` class method to ``BaseSpider``\n- dropped ``scrapy.log.exc()`` function (use ``scrapy.log.err()`` instead)\n- dropped ``component`` argument of ``scrapy.log.msg()`` function\n- dropped ``scrapy.log.log_level`` attribute\n- Added ``from_settings()`` class methods to Spider Manager, and Item Pipeline Manager\n\nChanges to settings\n~~~~~~~~~~~~~~~~~~~\n\n- Added ``HTTPCACHE_IGNORE_SCHEMES`` setting to ignore certain schemes on !HttpCacheMiddleware (#225)\n- Added ``SPIDER_QUEUE_CLASS`` setting which defines the spider queue to use (#220)\n- Added ``KEEP_ALIVE`` setting (#220)\n- Removed ``SERVICE_QUEUE`` setting (#220)\n- Removed ``COMMANDS_SETTINGS_MODULE`` setting (#201)\n- Renamed ``REQUEST_HANDLERS`` to ``DOWNLOAD_HANDLERS`` and make download handlers classes (instead of functions)\n\nScrapy 0.9\n----------\n\nThe numbers like #NNN reference tickets in the old issue tracker (Trac) which is no longer available.\n\nNew features and improvements\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Added SMTP-AUTH support to scrapy.mail\n- New settings added: ``MAIL_USER``, ``MAIL_PASS`` (:rev:`2065` | #149)\n- Added new scrapy-ctl view command - To view URL in the browser, as seen by Scrapy (:rev:`2039`)\n- Added web service for controlling Scrapy process (this also deprecates the web console. (:rev:`2053` | #167)\n- Support for running Scrapy as a service, for production systems (:rev:`1988`, :rev:`2054`, :rev:`2055`, :rev:`2056`, :rev:`2057` | #168)\n- Added wrapper induction library (documentation only available in source code for now). (:rev:`2011`)\n- Simplified and improved response encoding support (:rev:`1961`, :rev:`1969`)\n- Added ``LOG_ENCODING`` setting (:rev:`1956`, documentation available)\n- Added ``RANDOMIZE_DOWNLOAD_DELAY`` setting (enabled by default) (:rev:`1923`, doc available)\n- ``MailSender`` is no longer IO-blocking (:rev:`1955` | #146)\n- Linkextractors and new Crawlspider now handle relative base tag urls (:rev:`1960` | #148)\n- Several improvements to Item Loaders and processors (:rev:`2022`, :rev:`2023`, :rev:`2024`, :rev:`2025`, :rev:`2026`, :rev:`2027`, :rev:`2028`, :rev:`2029`, :rev:`2030`)\n- Added support for adding variables to telnet console (:rev:`2047` | #165)\n- Support for requests without callbacks (:rev:`2050` | #166)\n\nAPI changes\n~~~~~~~~~~~\n\n- Change ``Spider.domain_name`` to ``Spider.name`` (SEP-012, :rev:`1975`)\n- ``Response.encoding`` is now the detected encoding (:rev:`1961`)\n- ``HttpErrorMiddleware`` now returns None or raises an exception (:rev:`2006` | #157)\n- ``scrapy.command`` modules relocation (:rev:`2035`, :rev:`2036`, :rev:`2037`)\n- Added ``ExecutionQueue`` for feeding spiders to scrape (:rev:`2034`)\n- Removed ``ExecutionEngine`` singleton (:rev:`2039`)\n- Ported ``S3ImagesStore`` (images pipeline) to use boto and threads (:rev:`2033`)\n- Moved module: ``scrapy.management.telnet`` to ``scrapy.telnet`` (:rev:`2047`)\n\nChanges to default settings\n~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Changed default ``SCHEDULER_ORDER`` to ``DFO`` (:rev:`1939`)\n\nScrapy 0.8\n----------\n\nThe numbers like #NNN reference tickets in the old issue tracker (Trac) which is no longer available.\n\nNew features\n~~~~~~~~~~~~\n\n- Added DEFAULT_RESPONSE_ENCODING setting (:rev:`1809`)\n- Added ``dont_click`` argument to ``FormRequest.from_response()`` method (:rev:`1813`, :rev:`1816`)\n- Added ``clickdata`` argument to ``FormRequest.from_response()`` method (:rev:`1802`, :rev:`1803`)\n- Added support for HTTP proxies (``HttpProxyMiddleware``) (:rev:`1781`, :rev:`1785`)\n- Offsite spider middleware now logs messages when filtering out requests (:rev:`1841`)\n\nBackward-incompatible changes\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Changed ``scrapy.utils.response.get_meta_refresh()`` signature (:rev:`1804`)\n- Removed deprecated ``scrapy.item.ScrapedItem`` class - use ``scrapy.item.Item instead`` (:rev:`1838`)\n- Removed deprecated ``scrapy.xpath`` module - use ``scrapy.selector`` instead. (:rev:`1836`)\n- Removed deprecated ``core.signals.domain_open`` signal - use ``core.signals.domain_opened`` instead (:rev:`1822`)\n- ``log.msg()`` now receives a ``spider`` argument (:rev:`1822`)\n   - Old domain argument has been deprecated and will be removed in 0.9. For spiders, you should always use the ``spider`` argument and pass spider references. If you really want to pass a string, use the ``component`` argument instead.\n- Changed core signals ``domain_opened``, ``domain_closed``, ``domain_idle``\n- Changed Item pipeline to use spiders instead of domains\n   -  The ``domain`` argument of  ``process_item()`` item pipeline method was changed to  ``spider``, the new signature is: ``process_item(spider, item)`` (:rev:`1827` | #105)\n   - To quickly port your code (to work with Scrapy 0.8) just use ``spider.domain_name`` where you previously used ``domain``.\n- Changed Stats API to use spiders instead of domains (:rev:`1849` | #113)\n   - ``StatsCollector`` was changed to receive spider references (instead of domains) in its methods (``set_value``, ``inc_value``, etc).\n   - added ``StatsCollector.iter_spider_stats()`` method\n   - removed ``StatsCollector.list_domains()`` method\n   - Also, Stats signals were renamed and now pass around spider references (instead of domains). Here's a summary of the changes:\n   - To quickly port your code (to work with Scrapy 0.8) just use ``spider.domain_name`` where you previously used ``domain``. ``spider_stats`` contains exactly the same data as ``domain_stats``.\n- ``CloseDomain`` extension moved to ``scrapy.contrib.closespider.CloseSpider`` (:rev:`1833`)\n   - Its settings were also renamed:\n      - ``CLOSEDOMAIN_TIMEOUT`` to ``CLOSESPIDER_TIMEOUT``\n      - ``CLOSEDOMAIN_ITEMCOUNT`` to ``CLOSESPIDER_ITEMCOUNT``\n- Removed deprecated ``SCRAPYSETTINGS_MODULE`` environment variable - use ``SCRAPY_SETTINGS_MODULE`` instead (:rev:`1840`)\n- Renamed setting: ``REQUESTS_PER_DOMAIN`` to ``CONCURRENT_REQUESTS_PER_SPIDER`` (:rev:`1830`, :rev:`1844`)\n- Renamed setting: ``CONCURRENT_DOMAINS`` to ``CONCURRENT_SPIDERS`` (:rev:`1830`)\n- Refactored HTTP Cache middleware\n- HTTP Cache middleware has been heavilty refactored, retaining the same functionality except for the domain sectorization which was removed. (:rev:`1843` )\n- Renamed exception: ``DontCloseDomain`` to ``DontCloseSpider`` (:rev:`1859` | #120)\n- Renamed extension: ``DelayedCloseDomain`` to ``SpiderCloseDelay`` (:rev:`1861` | #121)\n- Removed obsolete ``scrapy.utils.markup.remove_escape_chars`` function - use ``scrapy.utils.markup.replace_escape_chars`` instead (:rev:`1865`)\n\nScrapy 0.7\n----------\n\nFirst release of Scrapy.\n\n\n.. _AJAX crawleable urls: https://developers.google.com/search/docs/ajax-crawling/docs/getting-started?csw=1\n.. _botocore: https://github.com/boto/botocore\n.. _chunked transfer encoding: https://en.wikipedia.org/wiki/Chunked_transfer_encoding\n.. _ClientForm: http://wwwsearch.sourceforge.net/old/ClientForm/\n.. _Creating a pull request: https://help.github.com/en/articles/creating-a-pull-request\n.. _cryptography: https://cryptography.io/en/latest/\n.. _docstrings: https://docs.python.org/3/glossary.html#term-docstring\n.. _KeyboardInterrupt: https://docs.python.org/3/library/exceptions.html#KeyboardInterrupt\n.. _LevelDB: https://github.com/google/leveldb\n.. _lxml: https://lxml.de/\n.. _marshal: https://docs.python.org/2/library/marshal.html\n.. _parsel.csstranslator.GenericTranslator: https://parsel.readthedocs.io/en/latest/parsel.html#parsel.csstranslator.GenericTranslator\n.. _parsel.csstranslator.HTMLTranslator: https://parsel.readthedocs.io/en/latest/parsel.html#parsel.csstranslator.HTMLTranslator\n.. _parsel.csstranslator.XPathExpr: https://parsel.readthedocs.io/en/latest/parsel.html#parsel.csstranslator.XPathExpr\n.. _PEP 257: https://www.python.org/dev/peps/pep-0257/\n.. _Pillow: https://python-pillow.org/\n.. _pyOpenSSL: https://www.pyopenssl.org/en/stable/\n.. _queuelib: https://github.com/scrapy/queuelib\n.. _registered with IANA: https://www.iana.org/assignments/media-types/media-types.xhtml\n.. _resource: https://docs.python.org/2/library/resource.html\n.. _robots.txt: https://www.robotstxt.org/\n.. _scrapely: https://github.com/scrapy/scrapely\n.. _scrapy-bench: https://github.com/scrapy/scrapy-bench\n.. _service_identity: https://service-identity.readthedocs.io/en/stable/\n.. _six: https://six.readthedocs.io/\n.. _tox: https://pypi.org/project/tox/\n.. _Twisted: https://twistedmatrix.com/trac/\n.. _w3lib: https://github.com/scrapy/w3lib\n.. _w3lib.encoding: https://github.com/scrapy/w3lib/blob/master/w3lib/encoding.py\n.. _What is cacheable: https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.9.1\n.. _zope.interface: https://zopeinterface.readthedocs.io/en/latest/\n.. _Zsh: https://www.zsh.org/\n.. _zstandard: https://pypi.org/project/zstandard/\n", "import logging\nfrom urllib.parse import urljoin, urlparse\n\nfrom w3lib.url import safe_url_string\n\nfrom scrapy.http import HtmlResponse\nfrom scrapy.utils.response import get_meta_refresh\nfrom scrapy.exceptions import IgnoreRequest, NotConfigured\n\n\nlogger = logging.getLogger(__name__)\n\n\nclass BaseRedirectMiddleware:\n\n    enabled_setting = 'REDIRECT_ENABLED'\n\n    def __init__(self, settings):\n        if not settings.getbool(self.enabled_setting):\n            raise NotConfigured\n\n        self.max_redirect_times = settings.getint('REDIRECT_MAX_TIMES')\n        self.priority_adjust = settings.getint('REDIRECT_PRIORITY_ADJUST')\n\n    @classmethod\n    def from_crawler(cls, crawler):\n        return cls(crawler.settings)\n\n    def _redirect(self, redirected, request, spider, reason):\n        ttl = request.meta.setdefault('redirect_ttl', self.max_redirect_times)\n        redirects = request.meta.get('redirect_times', 0) + 1\n\n        if ttl and redirects <= self.max_redirect_times:\n            redirected.meta['redirect_times'] = redirects\n            redirected.meta['redirect_ttl'] = ttl - 1\n            redirected.meta['redirect_urls'] = request.meta.get('redirect_urls', []) + [request.url]\n            redirected.meta['redirect_reasons'] = request.meta.get('redirect_reasons', []) + [reason]\n            redirected.dont_filter = request.dont_filter\n            redirected.priority = request.priority + self.priority_adjust\n            logger.debug(\"Redirecting (%(reason)s) to %(redirected)s from %(request)s\",\n                         {'reason': reason, 'redirected': redirected, 'request': request},\n                         extra={'spider': spider})\n            return redirected\n        else:\n            logger.debug(\"Discarding %(request)s: max redirections reached\",\n                         {'request': request}, extra={'spider': spider})\n            raise IgnoreRequest(\"max redirections reached\")\n\n    def _redirect_request_using_get(self, request, redirect_url):\n        redirected = request.replace(url=redirect_url, method='GET', body='')\n        redirected.headers.pop('Content-Type', None)\n        redirected.headers.pop('Content-Length', None)\n        return redirected\n\n\nclass RedirectMiddleware(BaseRedirectMiddleware):\n    \"\"\"\n    Handle redirection of requests based on response status\n    and meta-refresh html tag.\n    \"\"\"\n\n    def process_response(self, request, response, spider):\n        if (\n            request.meta.get('dont_redirect', False)\n            or response.status in getattr(spider, 'handle_httpstatus_list', [])\n            or response.status in request.meta.get('handle_httpstatus_list', [])\n            or request.meta.get('handle_httpstatus_all', False)\n        ):\n            return response\n\n        allowed_status = (301, 302, 303, 307, 308)\n        if 'Location' not in response.headers or response.status not in allowed_status:\n            return response\n\n        location = safe_url_string(response.headers['Location'])\n        if response.headers['Location'].startswith(b'//'):\n            request_scheme = urlparse(request.url).scheme\n            location = request_scheme + '://' + location.lstrip('/')\n\n        redirected_url = urljoin(request.url, location)\n\n        if response.status in (301, 307, 308) or request.method == 'HEAD':\n            redirected = request.replace(url=redirected_url)\n            return self._redirect(redirected, request, spider, response.status)\n\n        redirected = self._redirect_request_using_get(request, redirected_url)\n        return self._redirect(redirected, request, spider, response.status)\n\n\nclass MetaRefreshMiddleware(BaseRedirectMiddleware):\n\n    enabled_setting = 'METAREFRESH_ENABLED'\n\n    def __init__(self, settings):\n        super().__init__(settings)\n        self._ignore_tags = settings.getlist('METAREFRESH_IGNORE_TAGS')\n        self._maxdelay = settings.getint('METAREFRESH_MAXDELAY')\n\n    def process_response(self, request, response, spider):\n        if (\n            request.meta.get('dont_redirect', False)\n            or request.method == 'HEAD'\n            or not isinstance(response, HtmlResponse)\n        ):\n            return response\n\n        interval, url = get_meta_refresh(response,\n                                         ignore_tags=self._ignore_tags)\n        if url and interval < self._maxdelay:\n            redirected = self._redirect_request_using_get(request, url)\n            return self._redirect(redirected, request, spider, 'meta refresh')\n\n        return response\n", "import logging\nfrom testfixtures import LogCapture\nfrom unittest import TestCase\n\nimport pytest\n\nfrom scrapy.downloadermiddlewares.cookies import CookiesMiddleware\nfrom scrapy.downloadermiddlewares.defaultheaders import DefaultHeadersMiddleware\nfrom scrapy.exceptions import NotConfigured\nfrom scrapy.http import Response, Request\nfrom scrapy.spiders import Spider\nfrom scrapy.utils.python import to_bytes\nfrom scrapy.utils.test import get_crawler\n\n\nclass CookiesMiddlewareTest(TestCase):\n\n    def assertCookieValEqual(self, first, second, msg=None):\n        def split_cookies(cookies):\n            return sorted([s.strip() for s in to_bytes(cookies).split(b\";\")])\n        return self.assertEqual(split_cookies(first), split_cookies(second), msg=msg)\n\n    def setUp(self):\n        self.spider = Spider('foo')\n        self.mw = CookiesMiddleware()\n\n    def tearDown(self):\n        del self.mw\n\n    def test_basic(self):\n        req = Request('http://scrapytest.org/')\n        assert self.mw.process_request(req, self.spider) is None\n        assert 'Cookie' not in req.headers\n\n        headers = {'Set-Cookie': 'C1=value1; path=/'}\n        res = Response('http://scrapytest.org/', headers=headers)\n        assert self.mw.process_response(req, res, self.spider) is res\n\n        req2 = Request('http://scrapytest.org/sub1/')\n        assert self.mw.process_request(req2, self.spider) is None\n        self.assertEqual(req2.headers.get('Cookie'), b\"C1=value1\")\n\n    def test_setting_false_cookies_enabled(self):\n        self.assertRaises(\n            NotConfigured,\n            CookiesMiddleware.from_crawler,\n            get_crawler(settings_dict={'COOKIES_ENABLED': False})\n        )\n\n    def test_setting_default_cookies_enabled(self):\n        self.assertIsInstance(\n            CookiesMiddleware.from_crawler(get_crawler()),\n            CookiesMiddleware\n        )\n\n    def test_setting_true_cookies_enabled(self):\n        self.assertIsInstance(\n            CookiesMiddleware.from_crawler(\n                get_crawler(settings_dict={'COOKIES_ENABLED': True})\n            ),\n            CookiesMiddleware\n        )\n\n    def test_setting_enabled_cookies_debug(self):\n        crawler = get_crawler(settings_dict={'COOKIES_DEBUG': True})\n        mw = CookiesMiddleware.from_crawler(crawler)\n        with LogCapture(\n            'scrapy.downloadermiddlewares.cookies',\n            propagate=False,\n            level=logging.DEBUG,\n        ) as log:\n            req = Request('http://scrapytest.org/')\n            res = Response('http://scrapytest.org/', headers={'Set-Cookie': 'C1=value1; path=/'})\n            mw.process_response(req, res, crawler.spider)\n            req2 = Request('http://scrapytest.org/sub1/')\n            mw.process_request(req2, crawler.spider)\n\n            log.check(\n                ('scrapy.downloadermiddlewares.cookies',\n                 'DEBUG',\n                 'Received cookies from: <200 http://scrapytest.org/>\\n'\n                 'Set-Cookie: C1=value1; path=/\\n'),\n                ('scrapy.downloadermiddlewares.cookies',\n                 'DEBUG',\n                 'Sending cookies to: <GET http://scrapytest.org/sub1/>\\n'\n                 'Cookie: C1=value1\\n'),\n            )\n\n    def test_setting_disabled_cookies_debug(self):\n        crawler = get_crawler(settings_dict={'COOKIES_DEBUG': False})\n        mw = CookiesMiddleware.from_crawler(crawler)\n        with LogCapture(\n            'scrapy.downloadermiddlewares.cookies',\n            propagate=False,\n            level=logging.DEBUG,\n        ) as log:\n            req = Request('http://scrapytest.org/')\n            res = Response('http://scrapytest.org/', headers={'Set-Cookie': 'C1=value1; path=/'})\n            mw.process_response(req, res, crawler.spider)\n            req2 = Request('http://scrapytest.org/sub1/')\n            mw.process_request(req2, crawler.spider)\n\n            log.check()\n\n    def test_do_not_break_on_non_utf8_header(self):\n        req = Request('http://scrapytest.org/')\n        assert self.mw.process_request(req, self.spider) is None\n        assert 'Cookie' not in req.headers\n\n        headers = {'Set-Cookie': b'C1=in\\xa3valid; path=/', 'Other': b'ignore\\xa3me'}\n        res = Response('http://scrapytest.org/', headers=headers)\n        assert self.mw.process_response(req, res, self.spider) is res\n\n        req2 = Request('http://scrapytest.org/sub1/')\n        assert self.mw.process_request(req2, self.spider) is None\n        self.assertIn('Cookie', req2.headers)\n\n    def test_dont_merge_cookies(self):\n        # merge some cookies into jar\n        headers = {'Set-Cookie': 'C1=value1; path=/'}\n        req = Request('http://scrapytest.org/')\n        res = Response('http://scrapytest.org/', headers=headers)\n        assert self.mw.process_response(req, res, self.spider) is res\n\n        # test Cookie header is not seted to request\n        req = Request('http://scrapytest.org/dontmerge', meta={'dont_merge_cookies': 1})\n        assert self.mw.process_request(req, self.spider) is None\n        assert 'Cookie' not in req.headers\n\n        # check that returned cookies are not merged back to jar\n        res = Response(\n            'http://scrapytest.org/dontmerge',\n            headers={'Set-Cookie': 'dont=mergeme; path=/'},\n        )\n        assert self.mw.process_response(req, res, self.spider) is res\n\n        # check that cookies are merged back\n        req = Request('http://scrapytest.org/mergeme')\n        assert self.mw.process_request(req, self.spider) is None\n        self.assertEqual(req.headers.get('Cookie'), b'C1=value1')\n\n        # check that cookies are merged when dont_merge_cookies is passed as 0\n        req = Request('http://scrapytest.org/mergeme', meta={'dont_merge_cookies': 0})\n        assert self.mw.process_request(req, self.spider) is None\n        self.assertEqual(req.headers.get('Cookie'), b'C1=value1')\n\n    def test_complex_cookies(self):\n        # merge some cookies into jar\n        cookies = [\n            {'name': 'C1', 'value': 'value1', 'path': '/foo', 'domain': 'scrapytest.org'},\n            {'name': 'C2', 'value': 'value2', 'path': '/bar', 'domain': 'scrapytest.org'},\n            {'name': 'C3', 'value': 'value3', 'path': '/foo', 'domain': 'scrapytest.org'},\n            {'name': 'C4', 'value': 'value4', 'path': '/foo', 'domain': 'scrapy.org'},\n        ]\n\n        req = Request('http://scrapytest.org/', cookies=cookies)\n        self.mw.process_request(req, self.spider)\n\n        # embed C1 and C3 for scrapytest.org/foo\n        req = Request('http://scrapytest.org/foo')\n        self.mw.process_request(req, self.spider)\n        assert req.headers.get('Cookie') in (b'C1=value1; C3=value3', b'C3=value3; C1=value1')\n\n        # embed C2 for scrapytest.org/bar\n        req = Request('http://scrapytest.org/bar')\n        self.mw.process_request(req, self.spider)\n        self.assertEqual(req.headers.get('Cookie'), b'C2=value2')\n\n        # embed nothing for scrapytest.org/baz\n        req = Request('http://scrapytest.org/baz')\n        self.mw.process_request(req, self.spider)\n        assert 'Cookie' not in req.headers\n\n    def test_merge_request_cookies(self):\n        req = Request('http://scrapytest.org/', cookies={'galleta': 'salada'})\n        assert self.mw.process_request(req, self.spider) is None\n        self.assertEqual(req.headers.get('Cookie'), b'galleta=salada')\n\n        headers = {'Set-Cookie': 'C1=value1; path=/'}\n        res = Response('http://scrapytest.org/', headers=headers)\n        assert self.mw.process_response(req, res, self.spider) is res\n\n        req2 = Request('http://scrapytest.org/sub1/')\n        assert self.mw.process_request(req2, self.spider) is None\n\n        self.assertCookieValEqual(req2.headers.get('Cookie'), b\"C1=value1; galleta=salada\")\n\n    def test_cookiejar_key(self):\n        req = Request(\n            'http://scrapytest.org/',\n            cookies={'galleta': 'salada'},\n            meta={'cookiejar': \"store1\"},\n        )\n        assert self.mw.process_request(req, self.spider) is None\n        self.assertEqual(req.headers.get('Cookie'), b'galleta=salada')\n\n        headers = {'Set-Cookie': 'C1=value1; path=/'}\n        res = Response('http://scrapytest.org/', headers=headers, request=req)\n        assert self.mw.process_response(req, res, self.spider) is res\n\n        req2 = Request('http://scrapytest.org/', meta=res.meta)\n        assert self.mw.process_request(req2, self.spider) is None\n        self.assertCookieValEqual(req2.headers.get('Cookie'), b'C1=value1; galleta=salada')\n\n        req3 = Request(\n            'http://scrapytest.org/',\n            cookies={'galleta': 'dulce'},\n            meta={'cookiejar': \"store2\"},\n        )\n        assert self.mw.process_request(req3, self.spider) is None\n        self.assertEqual(req3.headers.get('Cookie'), b'galleta=dulce')\n\n        headers = {'Set-Cookie': 'C2=value2; path=/'}\n        res2 = Response('http://scrapytest.org/', headers=headers, request=req3)\n        assert self.mw.process_response(req3, res2, self.spider) is res2\n\n        req4 = Request('http://scrapytest.org/', meta=res2.meta)\n        assert self.mw.process_request(req4, self.spider) is None\n        self.assertCookieValEqual(req4.headers.get('Cookie'), b'C2=value2; galleta=dulce')\n\n        # cookies from hosts with port\n        req5_1 = Request('http://scrapytest.org:1104/')\n        assert self.mw.process_request(req5_1, self.spider) is None\n\n        headers = {'Set-Cookie': 'C1=value1; path=/'}\n        res5_1 = Response('http://scrapytest.org:1104/', headers=headers, request=req5_1)\n        assert self.mw.process_response(req5_1, res5_1, self.spider) is res5_1\n\n        req5_2 = Request('http://scrapytest.org:1104/some-redirected-path')\n        assert self.mw.process_request(req5_2, self.spider) is None\n        self.assertEqual(req5_2.headers.get('Cookie'), b'C1=value1')\n\n        req5_3 = Request('http://scrapytest.org/some-redirected-path')\n        assert self.mw.process_request(req5_3, self.spider) is None\n        self.assertEqual(req5_3.headers.get('Cookie'), b'C1=value1')\n\n        # skip cookie retrieval for not http request\n        req6 = Request('file:///scrapy/sometempfile')\n        assert self.mw.process_request(req6, self.spider) is None\n        self.assertEqual(req6.headers.get('Cookie'), None)\n\n    def test_local_domain(self):\n        request = Request(\"http://example-host/\", cookies={'currencyCookie': 'USD'})\n        assert self.mw.process_request(request, self.spider) is None\n        self.assertIn('Cookie', request.headers)\n        self.assertEqual(b'currencyCookie=USD', request.headers['Cookie'])\n\n    @pytest.mark.xfail(reason=\"Cookie header is not currently being processed\")\n    def test_keep_cookie_from_default_request_headers_middleware(self):\n        DEFAULT_REQUEST_HEADERS = dict(Cookie='default=value; asdf=qwerty')\n        mw_default_headers = DefaultHeadersMiddleware(DEFAULT_REQUEST_HEADERS.items())\n        # overwrite with values from 'cookies' request argument\n        req1 = Request('http://example.org', cookies={'default': 'something'})\n        assert mw_default_headers.process_request(req1, self.spider) is None\n        assert self.mw.process_request(req1, self.spider) is None\n        self.assertCookieValEqual(req1.headers['Cookie'], b'default=something; asdf=qwerty')\n        # keep both\n        req2 = Request('http://example.com', cookies={'a': 'b'})\n        assert mw_default_headers.process_request(req2, self.spider) is None\n        assert self.mw.process_request(req2, self.spider) is None\n        self.assertCookieValEqual(req2.headers['Cookie'], b'default=value; a=b; asdf=qwerty')\n\n    @pytest.mark.xfail(reason=\"Cookie header is not currently being processed\")\n    def test_keep_cookie_header(self):\n        # keep only cookies from 'Cookie' request header\n        req1 = Request('http://scrapytest.org', headers={'Cookie': 'a=b; c=d'})\n        assert self.mw.process_request(req1, self.spider) is None\n        self.assertCookieValEqual(req1.headers['Cookie'], 'a=b; c=d')\n        # keep cookies from both 'Cookie' request header and 'cookies' keyword\n        req2 = Request('http://scrapytest.org', headers={'Cookie': 'a=b; c=d'}, cookies={'e': 'f'})\n        assert self.mw.process_request(req2, self.spider) is None\n        self.assertCookieValEqual(req2.headers['Cookie'], 'a=b; c=d; e=f')\n        # overwrite values from 'Cookie' request header with 'cookies' keyword\n        req3 = Request(\n            'http://scrapytest.org',\n            headers={'Cookie': 'a=b; c=d'},\n            cookies={'a': 'new', 'e': 'f'},\n        )\n        assert self.mw.process_request(req3, self.spider) is None\n        self.assertCookieValEqual(req3.headers['Cookie'], 'a=new; c=d; e=f')\n\n    def test_request_cookies_encoding(self):\n        # 1) UTF8-encoded bytes\n        req1 = Request('http://example.org', cookies={'a': '\u00e1'.encode('utf8')})\n        assert self.mw.process_request(req1, self.spider) is None\n        self.assertCookieValEqual(req1.headers['Cookie'], b'a=\\xc3\\xa1')\n\n        # 2) Non UTF8-encoded bytes\n        req2 = Request('http://example.org', cookies={'a': '\u00e1'.encode('latin1')})\n        assert self.mw.process_request(req2, self.spider) is None\n        self.assertCookieValEqual(req2.headers['Cookie'], b'a=\\xc3\\xa1')\n\n        # 3) String\n        req3 = Request('http://example.org', cookies={'a': '\u00e1'})\n        assert self.mw.process_request(req3, self.spider) is None\n        self.assertCookieValEqual(req3.headers['Cookie'], b'a=\\xc3\\xa1')\n\n    @pytest.mark.xfail(reason=\"Cookie header is not currently being processed\")\n    def test_request_headers_cookie_encoding(self):\n        # 1) UTF8-encoded bytes\n        req1 = Request('http://example.org', headers={'Cookie': 'a=\u00e1'.encode('utf8')})\n        assert self.mw.process_request(req1, self.spider) is None\n        self.assertCookieValEqual(req1.headers['Cookie'], b'a=\\xc3\\xa1')\n\n        # 2) Non UTF8-encoded bytes\n        req2 = Request('http://example.org', headers={'Cookie': 'a=\u00e1'.encode('latin1')})\n        assert self.mw.process_request(req2, self.spider) is None\n        self.assertCookieValEqual(req2.headers['Cookie'], b'a=\\xc3\\xa1')\n\n        # 3) String\n        req3 = Request('http://example.org', headers={'Cookie': 'a=\u00e1'})\n        assert self.mw.process_request(req3, self.spider) is None\n        self.assertCookieValEqual(req3.headers['Cookie'], b'a=\\xc3\\xa1')\n\n    def test_invalid_cookies(self):\n        \"\"\"\n        Invalid cookies are logged as warnings and discarded\n        \"\"\"\n        with LogCapture(\n            'scrapy.downloadermiddlewares.cookies',\n            propagate=False,\n            level=logging.INFO,\n        ) as lc:\n            cookies1 = [{'value': 'bar'}, {'name': 'key', 'value': 'value1'}]\n            req1 = Request('http://example.org/1', cookies=cookies1)\n            assert self.mw.process_request(req1, self.spider) is None\n            cookies2 = [{'name': 'foo'}, {'name': 'key', 'value': 'value2'}]\n            req2 = Request('http://example.org/2', cookies=cookies2)\n            assert self.mw.process_request(req2, self.spider) is None\n            cookies3 = [{'name': 'foo', 'value': None}, {'name': 'key', 'value': ''}]\n            req3 = Request('http://example.org/3', cookies=cookies3)\n            assert self.mw.process_request(req3, self.spider) is None\n            lc.check(\n                (\"scrapy.downloadermiddlewares.cookies\",\n                 \"WARNING\",\n                 \"Invalid cookie found in request <GET http://example.org/1>:\"\n                 \" {'value': 'bar'} ('name' is missing)\"),\n                (\"scrapy.downloadermiddlewares.cookies\",\n                 \"WARNING\",\n                 \"Invalid cookie found in request <GET http://example.org/2>:\"\n                 \" {'name': 'foo'} ('value' is missing)\"),\n                (\"scrapy.downloadermiddlewares.cookies\",\n                 \"WARNING\",\n                 \"Invalid cookie found in request <GET http://example.org/3>:\"\n                 \" {'name': 'foo', 'value': None} ('value' is missing)\"),\n            )\n        self.assertCookieValEqual(req1.headers['Cookie'], 'key=value1')\n        self.assertCookieValEqual(req2.headers['Cookie'], 'key=value2')\n        self.assertCookieValEqual(req3.headers['Cookie'], 'key=')\n\n    def test_primitive_type_cookies(self):\n        # Boolean\n        req1 = Request('http://example.org', cookies={'a': True})\n        assert self.mw.process_request(req1, self.spider) is None\n        self.assertCookieValEqual(req1.headers['Cookie'], b'a=True')\n\n        # Float\n        req2 = Request('http://example.org', cookies={'a': 9.5})\n        assert self.mw.process_request(req2, self.spider) is None\n        self.assertCookieValEqual(req2.headers['Cookie'], b'a=9.5')\n\n        # Integer\n        req3 = Request('http://example.org', cookies={'a': 10})\n        assert self.mw.process_request(req3, self.spider) is None\n        self.assertCookieValEqual(req3.headers['Cookie'], b'a=10')\n\n        # String\n        req4 = Request('http://example.org', cookies={'a': 'b'})\n        assert self.mw.process_request(req4, self.spider) is None\n        self.assertCookieValEqual(req4.headers['Cookie'], b'a=b')\n"], "fixing_code": [".. _news:\n\nRelease notes\n=============\n\n.. _release-2.6.0:\n\nScrapy 2.6.0 (2022-03-01)\n-------------------------\n\nHighlights:\n\n*   :ref:`Security fixes for cookie handling <2.6-security-fixes>`\n\n*   Python 3.10 support\n\n*   :ref:`asyncio support <using-asyncio>` is no longer considered\n    experimental, and works out-of-the-box on Windows regardless of your Python\n    version\n\n*   Feed exports now support :class:`pathlib.Path` output paths and per-feed\n    :ref:`item filtering <item-filter>` and\n    :ref:`post-processing <post-processing>`\n\n.. _2.6-security-fixes:\n\nSecurity bug fixes\n~~~~~~~~~~~~~~~~~~\n\n-   When a :class:`~scrapy.http.Request` object with cookies defined gets a\n    redirect response causing a new :class:`~scrapy.http.Request` object to be\n    scheduled, the cookies defined in the original\n    :class:`~scrapy.http.Request` object are no longer copied into the new\n    :class:`~scrapy.http.Request` object.\n\n    If you manually set the ``Cookie`` header on a\n    :class:`~scrapy.http.Request` object and the domain name of the redirect\n    URL is not an exact match for the domain of the URL of the original\n    :class:`~scrapy.http.Request` object, your ``Cookie`` header is now dropped\n    from the new :class:`~scrapy.http.Request` object.\n\n    The old behavior could be exploited by an attacker to gain access to your\n    cookies. Please, see the `cjvr-mfj7-j4j8 security advisory`_ for more\n    information.\n\n    .. _cjvr-mfj7-j4j8 security advisory: https://github.com/scrapy/scrapy/security/advisories/GHSA-cjvr-mfj7-j4j8\n\n    .. note:: It is still possible to enable the sharing of cookies between\n              different domains with a shared domain suffix (e.g.\n              ``example.com`` and any subdomain) by defining the shared domain\n              suffix (e.g. ``example.com``) as the cookie domain when defining\n              your cookies. See the documentation of the\n              :class:`~scrapy.http.Request` class for more information.\n\n\nModified requirements\n~~~~~~~~~~~~~~~~~~~~~\n\n-   The h2_ dependency is now optional, only needed to\n    :ref:`enable HTTP/2 support <http2>`. (:issue:`5113`)\n\n    .. _h2: https://pypi.org/project/h2/\n\n\nBackward-incompatible changes\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n-   The ``formdata`` parameter of :class:`~scrapy.FormRequest`, if specified\n    for a non-POST request, now overrides the URL query string, instead of\n    being appended to it. (:issue:`2919`, :issue:`3579`)\n\n-   When a function is assigned to the :setting:`FEED_URI_PARAMS` setting, now\n    the return value of that function, and not the ``params`` input parameter,\n    will determine the feed URI parameters, unless that return value is\n    ``None``. (:issue:`4962`, :issue:`4966`)\n\n-   In :class:`scrapy.core.engine.ExecutionEngine`, methods\n    :meth:`~scrapy.core.engine.ExecutionEngine.crawl`,\n    :meth:`~scrapy.core.engine.ExecutionEngine.download`,\n    :meth:`~scrapy.core.engine.ExecutionEngine.schedule`,\n    and :meth:`~scrapy.core.engine.ExecutionEngine.spider_is_idle`\n    now raise :exc:`RuntimeError` if called before\n    :meth:`~scrapy.core.engine.ExecutionEngine.open_spider`. (:issue:`5090`)\n\n    These methods used to assume that\n    :attr:`ExecutionEngine.slot <scrapy.core.engine.ExecutionEngine.slot>` had\n    been defined by a prior call to\n    :meth:`~scrapy.core.engine.ExecutionEngine.open_spider`, so they were\n    raising :exc:`AttributeError` instead.\n\n-   If the API of the configured :ref:`scheduler <topics-scheduler>` does not\n    meet expectations, :exc:`TypeError` is now raised at startup time. Before,\n    other exceptions would be raised at run time. (:issue:`3559`)\n\n\nDeprecation removals\n~~~~~~~~~~~~~~~~~~~~\n\n-   ``scrapy.http.TextResponse.body_as_unicode``, deprecated in Scrapy 2.2, has\n    now been removed. (:issue:`5393`)\n\n-   ``scrapy.item.BaseItem``, deprecated in Scrapy 2.2, has now been removed.\n    (:issue:`5398`)\n\n-   ``scrapy.item.DictItem``, deprecated in Scrapy 1.8, has now been removed.\n    (:issue:`5398`)\n\n-   ``scrapy.Spider.make_requests_from_url``, deprecated in Scrapy 1.4, has now\n    been removed. (:issue:`4178`, :issue:`4356`)\n\n\nDeprecations\n~~~~~~~~~~~~\n\n-   When a function is assigned to the :setting:`FEED_URI_PARAMS` setting,\n    returning ``None`` or modifying the ``params`` input parameter is now\n    deprecated. Return a new dictionary instead. (:issue:`4962`, :issue:`4966`)\n\n-   :mod:`scrapy.utils.reqser` is deprecated. (:issue:`5130`)\n\n    -   Instead of :func:`~scrapy.utils.reqser.request_to_dict`, use the new\n        :meth:`Request.to_dict <scrapy.http.Request.to_dict>` method.\n\n    -   Instead of :func:`~scrapy.utils.reqser.request_from_dict`, use the new\n        :func:`scrapy.utils.request.request_from_dict` function.\n\n-   In :mod:`scrapy.squeues`, the following queue classes are deprecated:\n    :class:`~scrapy.squeues.PickleFifoDiskQueueNonRequest`,\n    :class:`~scrapy.squeues.PickleLifoDiskQueueNonRequest`,\n    :class:`~scrapy.squeues.MarshalFifoDiskQueueNonRequest`,\n    and :class:`~scrapy.squeues.MarshalLifoDiskQueueNonRequest`. You should\n    instead use:\n    :class:`~scrapy.squeues.PickleFifoDiskQueue`,\n    :class:`~scrapy.squeues.PickleLifoDiskQueue`,\n    :class:`~scrapy.squeues.MarshalFifoDiskQueue`,\n    and :class:`~scrapy.squeues.MarshalLifoDiskQueue`. (:issue:`5117`)\n\n-   Many aspects of :class:`scrapy.core.engine.ExecutionEngine` that come from\n    a time when this class could handle multiple :class:`~scrapy.Spider`\n    objects at a time have been deprecated. (:issue:`5090`)\n\n    -   The :meth:`~scrapy.core.engine.ExecutionEngine.has_capacity` method\n        is deprecated.\n\n    -   The :meth:`~scrapy.core.engine.ExecutionEngine.schedule` method is\n        deprecated, use :meth:`~scrapy.core.engine.ExecutionEngine.crawl` or\n        :meth:`~scrapy.core.engine.ExecutionEngine.download` instead.\n\n    -   The :attr:`~scrapy.core.engine.ExecutionEngine.open_spiders` attribute\n        is deprecated, use :attr:`~scrapy.core.engine.ExecutionEngine.spider`\n        instead.\n\n    -   The ``spider`` parameter is deprecated for the following methods:\n\n        -   :meth:`~scrapy.core.engine.ExecutionEngine.spider_is_idle`\n\n        -   :meth:`~scrapy.core.engine.ExecutionEngine.crawl`\n\n        -   :meth:`~scrapy.core.engine.ExecutionEngine.download`\n\n        Instead, call :meth:`~scrapy.core.engine.ExecutionEngine.open_spider`\n        first to set the :class:`~scrapy.Spider` object.\n\n\nNew features\n~~~~~~~~~~~~\n\n-   You can now use :ref:`item filtering <item-filter>` to control which items\n    are exported to each output feed. (:issue:`4575`, :issue:`5178`,\n    :issue:`5161`, :issue:`5203`)\n\n-   You can now apply :ref:`post-processing <post-processing>` to feeds, and\n    :ref:`built-in post-processing plugins <builtin-plugins>` are provided for\n    output file compression. (:issue:`2174`, :issue:`5168`, :issue:`5190`)\n\n-   The :setting:`FEEDS` setting now supports :class:`pathlib.Path` objects as\n    keys. (:issue:`5383`, :issue:`5384`)\n\n-   Enabling :ref:`asyncio <using-asyncio>` while using Windows and Python 3.8\n    or later will automatically switch the asyncio event loop to one that\n    allows Scrapy to work. See :ref:`asyncio-windows`. (:issue:`4976`,\n    :issue:`5315`)\n\n-   The :command:`genspider` command now supports a start URL instead of a\n    domain name. (:issue:`4439`)\n\n-   :mod:`scrapy.utils.defer` gained 2 new functions,\n    :func:`~scrapy.utils.defer.deferred_to_future` and\n    :func:`~scrapy.utils.defer.maybe_deferred_to_future`, to help :ref:`await\n    on Deferreds when using the asyncio reactor <asyncio-await-dfd>`.\n    (:issue:`5288`)\n\n-   :ref:`Amazon S3 feed export storage <topics-feed-storage-s3>` gained\n    support for `temporary security credentials`_\n    (:setting:`AWS_SESSION_TOKEN`) and endpoint customization\n    (:setting:`AWS_ENDPOINT_URL`). (:issue:`4998`, :issue:`5210`)\n\n    .. _temporary security credentials: https://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html#temporary-access-keys\n\n-   New :setting:`LOG_FILE_APPEND` setting to allow truncating the log file.\n    (:issue:`5279`)\n\n-   :attr:`Request.cookies <scrapy.Request.cookies>` values that are\n    :class:`bool`, :class:`float` or :class:`int` are cast to :class:`str`.\n    (:issue:`5252`, :issue:`5253`)\n\n-   You may now raise :exc:`~scrapy.exceptions.CloseSpider` from a handler of\n    the :signal:`spider_idle` signal to customize the reason why the spider is\n    stopping. (:issue:`5191`)\n\n-   When using\n    :class:`~scrapy.downloadermiddlewares.httpproxy.HttpProxyMiddleware`, the\n    proxy URL for non-HTTPS HTTP/1.1 requests no longer needs to include a URL\n    scheme. (:issue:`4505`, :issue:`4649`)\n\n-   All built-in queues now expose a ``peek`` method that returns the next\n    queue object (like ``pop``) but does not remove the returned object from\n    the queue. (:issue:`5112`)\n\n    If the underlying queue does not support peeking (e.g. because you are not\n    using ``queuelib`` 1.6.1 or later), the ``peek`` method raises\n    :exc:`NotImplementedError`.\n\n-   :class:`~scrapy.http.Request` and :class:`~scrapy.http.Response` now have\n    an ``attributes`` attribute that makes subclassing easier. For\n    :class:`~scrapy.http.Request`, it also allows subclasses to work with\n    :func:`scrapy.utils.request.request_from_dict`. (:issue:`1877`,\n    :issue:`5130`, :issue:`5218`)\n\n-   The :meth:`~scrapy.core.scheduler.BaseScheduler.open` and\n    :meth:`~scrapy.core.scheduler.BaseScheduler.close` methods of the\n    :ref:`scheduler <topics-scheduler>` are now optional. (:issue:`3559`)\n\n-   HTTP/1.1 :exc:`~scrapy.core.downloader.handlers.http11.TunnelError`\n    exceptions now only truncate response bodies longer than 1000 characters,\n    instead of those longer than 32 characters, making it easier to debug such\n    errors. (:issue:`4881`, :issue:`5007`)\n\n-   :class:`~scrapy.loader.ItemLoader` now supports non-text responses.\n    (:issue:`5145`, :issue:`5269`)\n\n\nBug fixes\n~~~~~~~~~\n\n-   The :setting:`TWISTED_REACTOR` and :setting:`ASYNCIO_EVENT_LOOP` settings\n    are no longer ignored if defined in :attr:`~scrapy.Spider.custom_settings`.\n    (:issue:`4485`, :issue:`5352`)\n\n-   Removed a module-level Twisted reactor import that could prevent\n    :ref:`using the asyncio reactor <using-asyncio>`. (:issue:`5357`)\n\n-   The :command:`startproject` command works with existing folders again.\n    (:issue:`4665`, :issue:`4676`)\n\n-   The :setting:`FEED_URI_PARAMS` setting now behaves as documented.\n    (:issue:`4962`, :issue:`4966`)\n\n-   :attr:`Request.cb_kwargs <scrapy.Request.cb_kwargs>` once again allows the\n    ``callback`` keyword. (:issue:`5237`, :issue:`5251`, :issue:`5264`)\n\n-   Made :func:`scrapy.utils.response.open_in_browser` support more complex\n    HTML. (:issue:`5319`, :issue:`5320`)\n\n-   Fixed :attr:`CSVFeedSpider.quotechar\n    <scrapy.spiders.CSVFeedSpider.quotechar>` being interpreted as the CSV file\n    encoding. (:issue:`5391`, :issue:`5394`)\n\n-   Added missing setuptools_ to the list of dependencies. (:issue:`5122`)\n\n    .. _setuptools: https://pypi.org/project/setuptools/\n\n-   :class:`LinkExtractor <scrapy.linkextractors.lxmlhtml.LxmlLinkExtractor>`\n    now also works as expected with links that have comma-separated ``rel``\n    attribute values including ``nofollow``. (:issue:`5225`)\n\n-   Fixed a :exc:`TypeError` that could be raised during :ref:`feed export\n    <topics-feed-exports>` parameter parsing. (:issue:`5359`)\n\n\nDocumentation\n~~~~~~~~~~~~~\n\n-   :ref:`asyncio support <using-asyncio>` is no longer considered\n    experimental. (:issue:`5332`)\n\n-   Included :ref:`Windows-specific help for asyncio usage <asyncio-windows>`.\n    (:issue:`4976`, :issue:`5315`)\n\n-   Rewrote :ref:`topics-headless-browsing` with up-to-date best practices.\n    (:issue:`4484`, :issue:`4613`)\n\n-   Documented :ref:`local file naming in media pipelines\n    <topics-file-naming>`. (:issue:`5069`, :issue:`5152`)\n\n-   :ref:`faq` now covers spider file name collision issues. (:issue:`2680`,\n    :issue:`3669`)\n\n-   Provided better context and instructions to disable the\n    :setting:`URLLENGTH_LIMIT` setting. (:issue:`5135`, :issue:`5250`)\n\n-   Documented that :ref:`reppy-parser` does not support Python 3.9+.\n    (:issue:`5226`, :issue:`5231`)\n\n-   Documented :ref:`the scheduler component <topics-scheduler>`.\n    (:issue:`3537`, :issue:`3559`)\n\n-   Documented the method used by :ref:`media pipelines\n    <topics-media-pipeline>` to :ref:`determine if a file has expired\n    <file-expiration>`. (:issue:`5120`, :issue:`5254`)\n\n-   :ref:`run-multiple-spiders` now features\n    :func:`scrapy.utils.project.get_project_settings` usage. (:issue:`5070`)\n\n-   :ref:`run-multiple-spiders` now covers what happens when you define\n    different per-spider values for some settings that cannot differ at run\n    time. (:issue:`4485`, :issue:`5352`)\n\n-   Extended the documentation of the\n    :class:`~scrapy.extensions.statsmailer.StatsMailer` extension.\n    (:issue:`5199`, :issue:`5217`)\n\n-   Added :setting:`JOBDIR` to :ref:`topics-settings`. (:issue:`5173`,\n    :issue:`5224`)\n\n-   Documented :attr:`Spider.attribute <scrapy.Spider.attribute>`.\n    (:issue:`5174`, :issue:`5244`)\n\n-   Documented :attr:`TextResponse.urljoin <scrapy.http.TextResponse.urljoin>`.\n    (:issue:`1582`)\n\n-   Added the ``body_length`` parameter to the documented signature of the\n    :signal:`headers_received` signal. (:issue:`5270`)\n\n-   Clarified :meth:`SelectorList.get <scrapy.selector.SelectorList.get>` usage\n    in the :ref:`tutorial <intro-tutorial>`. (:issue:`5256`)\n\n-   The documentation now features the shortest import path of classes with\n    multiple import paths. (:issue:`2733`, :issue:`5099`)\n\n-   ``quotes.toscrape.com`` references now use HTTPS instead of HTTP.\n    (:issue:`5395`, :issue:`5396`)\n\n-   Added a link to `our Discord server <https://discord.gg/mv3yErfpvq>`_\n    to :ref:`getting-help`. (:issue:`5421`, :issue:`5422`)\n\n-   The pronunciation of the project name is now :ref:`officially\n    <intro-overview>` /\u2566\u0142skre\u2554\u00acpa\u2554\u00ac/. (:issue:`5280`, :issue:`5281`)\n\n-   Added the Scrapy logo to the README. (:issue:`5255`, :issue:`5258`)\n\n-   Fixed issues and implemented minor improvements. (:issue:`3155`,\n    :issue:`4335`, :issue:`5074`, :issue:`5098`, :issue:`5134`, :issue:`5180`,\n    :issue:`5194`, :issue:`5239`, :issue:`5266`, :issue:`5271`, :issue:`5273`,\n    :issue:`5274`, :issue:`5276`, :issue:`5347`, :issue:`5356`, :issue:`5414`,\n    :issue:`5415`, :issue:`5416`, :issue:`5419`, :issue:`5420`)\n\n\nQuality Assurance\n~~~~~~~~~~~~~~~~~\n\n-   Added support for Python 3.10. (:issue:`5212`, :issue:`5221`,\n    :issue:`5265`)\n\n-   Significantly reduced memory usage by\n    :func:`scrapy.utils.response.response_httprepr`, used by the\n    :class:`~scrapy.downloadermiddlewares.stats.DownloaderStats` downloader\n    middleware, which is enabled by default. (:issue:`4964`, :issue:`4972`)\n\n-   Removed uses of the deprecated :mod:`optparse` module. (:issue:`5366`,\n    :issue:`5374`)\n\n-   Extended typing hints. (:issue:`5077`, :issue:`5090`, :issue:`5100`,\n    :issue:`5108`, :issue:`5171`, :issue:`5215`, :issue:`5334`)\n\n-   Improved tests, fixed CI issues, removed unused code. (:issue:`5094`,\n    :issue:`5157`, :issue:`5162`, :issue:`5198`, :issue:`5207`, :issue:`5208`,\n    :issue:`5229`, :issue:`5298`, :issue:`5299`, :issue:`5310`, :issue:`5316`,\n    :issue:`5333`, :issue:`5388`, :issue:`5389`, :issue:`5400`, :issue:`5401`,\n    :issue:`5404`, :issue:`5405`, :issue:`5407`, :issue:`5410`, :issue:`5412`,\n    :issue:`5425`, :issue:`5427`)\n\n-   Implemented improvements for contributors. (:issue:`5080`, :issue:`5082`,\n    :issue:`5177`, :issue:`5200`)\n\n-   Implemented cleanups. (:issue:`5095`, :issue:`5106`, :issue:`5209`,\n    :issue:`5228`, :issue:`5235`, :issue:`5245`, :issue:`5246`, :issue:`5292`,\n    :issue:`5314`, :issue:`5322`)\n\n\n.. _release-2.5.1:\n\nScrapy 2.5.1 (2021-10-05)\n-------------------------\n\n*   **Security bug fix:**\n\n    If you use\n    :class:`~scrapy.downloadermiddlewares.httpauth.HttpAuthMiddleware`\n    (i.e. the ``http_user`` and ``http_pass`` spider attributes) for HTTP\n    authentication, any request exposes your credentials to the request target.\n\n    To prevent unintended exposure of authentication credentials to unintended\n    domains, you must now additionally set a new, additional spider attribute,\n    ``http_auth_domain``, and point it to the specific domain to which the\n    authentication credentials must be sent.\n\n    If the ``http_auth_domain`` spider attribute is not set, the domain of the\n    first request will be considered the HTTP authentication target, and\n    authentication credentials will only be sent in requests targeting that\n    domain.\n\n    If you need to send the same HTTP authentication credentials to multiple\n    domains, you can use :func:`w3lib.http.basic_auth_header` instead to\n    set the value of the ``Authorization`` header of your requests.\n\n    If you *really* want your spider to send the same HTTP authentication\n    credentials to any domain, set the ``http_auth_domain`` spider attribute\n    to ``None``.\n\n    Finally, if you are a user of `scrapy-splash`_, know that this version of\n    Scrapy breaks compatibility with scrapy-splash 0.7.2 and earlier. You will\n    need to upgrade scrapy-splash to a greater version for it to continue to\n    work.\n\n.. _scrapy-splash: https://github.com/scrapy-plugins/scrapy-splash\n\n\n.. _release-2.5.0:\n\nScrapy 2.5.0 (2021-04-06)\n-------------------------\n\nHighlights:\n\n-   Official Python 3.9 support\n\n-   Experimental :ref:`HTTP/2 support <http2>`\n\n-   New :func:`~scrapy.downloadermiddlewares.retry.get_retry_request` function\n    to retry requests from spider callbacks\n\n-   New :class:`~scrapy.signals.headers_received` signal that allows stopping\n    downloads early\n\n-   New :class:`Response.protocol <scrapy.http.Response.protocol>` attribute\n\nDeprecation removals\n~~~~~~~~~~~~~~~~~~~~\n\n-   Removed all code that :ref:`was deprecated in 1.7.0 <1.7-deprecations>` and\n    had not :ref:`already been removed in 2.4.0 <2.4-deprecation-removals>`.\n    (:issue:`4901`)\n\n-   Removed support for the ``SCRAPY_PICKLED_SETTINGS_TO_OVERRIDE`` environment\n    variable, :ref:`deprecated in 1.8.0 <1.8-deprecations>`. (:issue:`4912`)\n\n\nDeprecations\n~~~~~~~~~~~~\n\n-   The :mod:`scrapy.utils.py36` module is now deprecated in favor of\n    :mod:`scrapy.utils.asyncgen`. (:issue:`4900`)\n\n\nNew features\n~~~~~~~~~~~~\n\n-   Experimental :ref:`HTTP/2 support <http2>` through a new download handler\n    that can be assigned to the ``https`` protocol in the\n    :setting:`DOWNLOAD_HANDLERS` setting.\n    (:issue:`1854`, :issue:`4769`, :issue:`5058`, :issue:`5059`, :issue:`5066`)\n\n-   The new :func:`scrapy.downloadermiddlewares.retry.get_retry_request`\n    function may be used from spider callbacks or middlewares to handle the\n    retrying of a request beyond the scenarios that\n    :class:`~scrapy.downloadermiddlewares.retry.RetryMiddleware` supports.\n    (:issue:`3590`, :issue:`3685`, :issue:`4902`)\n\n-   The new :class:`~scrapy.signals.headers_received` signal gives early access\n    to response headers and allows :ref:`stopping downloads\n    <topics-stop-response-download>`.\n    (:issue:`1772`, :issue:`4897`)\n\n-   The new :attr:`Response.protocol <scrapy.http.Response.protocol>`\n    attribute gives access to the string that identifies the protocol used to\n    download a response. (:issue:`4878`)\n\n-   :ref:`Stats <topics-stats>` now include the following entries that indicate\n    the number of successes and failures in storing\n    :ref:`feeds <topics-feed-exports>`::\n\n        feedexport/success_count/<storage type>\n        feedexport/failed_count/<storage type>\n\n    Where ``<storage type>`` is the feed storage backend class name, such as\n    :class:`~scrapy.extensions.feedexport.FileFeedStorage` or\n    :class:`~scrapy.extensions.feedexport.FTPFeedStorage`.\n\n    (:issue:`3947`, :issue:`4850`)\n\n-   The :class:`~scrapy.spidermiddlewares.urllength.UrlLengthMiddleware` spider\n    middleware now logs ignored URLs with ``INFO`` :ref:`logging level\n    <levels>` instead of ``DEBUG``, and it now includes the following entry\n    into :ref:`stats <topics-stats>` to keep track of the number of ignored\n    URLs::\n\n        urllength/request_ignored_count\n\n    (:issue:`5036`)\n\n-   The\n    :class:`~scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware`\n    downloader middleware now logs the number of decompressed responses and the\n    total count of resulting bytes::\n\n        httpcompression/response_bytes\n        httpcompression/response_count\n\n    (:issue:`4797`, :issue:`4799`)\n\n\nBug fixes\n~~~~~~~~~\n\n-   Fixed installation on PyPy installing PyDispatcher in addition to\n    PyPyDispatcher, which could prevent Scrapy from working depending on which\n    package got imported. (:issue:`4710`, :issue:`4814`)\n\n-   When inspecting a callback to check if it is a generator that also returns\n    a value, an exception is no longer raised if the callback has a docstring\n    with lower indentation than the following code.\n    (:issue:`4477`, :issue:`4935`)\n\n-   The `Content-Length <https://tools.ietf.org/html/rfc2616#section-14.13>`_\n    header is no longer omitted from responses when using the default, HTTP/1.1\n    download handler (see :setting:`DOWNLOAD_HANDLERS`).\n    (:issue:`5009`, :issue:`5034`, :issue:`5045`, :issue:`5057`, :issue:`5062`)\n\n-   Setting the :reqmeta:`handle_httpstatus_all` request meta key to ``False``\n    now has the same effect as not setting it at all, instead of having the\n    same effect as setting it to ``True``.\n    (:issue:`3851`, :issue:`4694`)\n\n\nDocumentation\n~~~~~~~~~~~~~\n\n-   Added instructions to :ref:`install Scrapy in Windows using pip\n    <intro-install-windows>`.\n    (:issue:`4715`, :issue:`4736`)\n\n-   Logging documentation now includes :ref:`additional ways to filter logs\n    <topics-logging-advanced-customization>`.\n    (:issue:`4216`, :issue:`4257`, :issue:`4965`)\n\n-   Covered how to deal with long lists of allowed domains in the :ref:`FAQ\n    <faq>`. (:issue:`2263`, :issue:`3667`)\n\n-   Covered scrapy-bench_ in :ref:`benchmarking`.\n    (:issue:`4996`, :issue:`5016`)\n\n-   Clarified that one :ref:`extension <topics-extensions>` instance is created\n    per crawler.\n    (:issue:`5014`)\n\n-   Fixed some errors in examples.\n    (:issue:`4829`, :issue:`4830`, :issue:`4907`, :issue:`4909`,\n    :issue:`5008`)\n\n-   Fixed some external links, typos, and so on.\n    (:issue:`4892`, :issue:`4899`, :issue:`4936`, :issue:`4942`, :issue:`5005`,\n    :issue:`5063`)\n\n-   The :ref:`list of Request.meta keys <topics-request-meta>` is now sorted\n    alphabetically.\n    (:issue:`5061`, :issue:`5065`)\n\n-   Updated references to Scrapinghub, which is now called Zyte.\n    (:issue:`4973`, :issue:`5072`)\n\n-   Added a mention to contributors in the README. (:issue:`4956`)\n\n-   Reduced the top margin of lists. (:issue:`4974`)\n\n\nQuality Assurance\n~~~~~~~~~~~~~~~~~\n\n-   Made Python 3.9 support official (:issue:`4757`, :issue:`4759`)\n\n-   Extended typing hints (:issue:`4895`)\n\n-   Fixed deprecated uses of the Twisted API.\n    (:issue:`4940`, :issue:`4950`, :issue:`5073`)\n\n-   Made our tests run with the new pip resolver.\n    (:issue:`4710`, :issue:`4814`)\n\n-   Added tests to ensure that :ref:`coroutine support <coroutine-support>`\n    is tested. (:issue:`4987`)\n\n-   Migrated from Travis CI to GitHub Actions. (:issue:`4924`)\n\n-   Fixed CI issues.\n    (:issue:`4986`, :issue:`5020`, :issue:`5022`, :issue:`5027`, :issue:`5052`,\n    :issue:`5053`)\n\n-   Implemented code refactorings, style fixes and cleanups.\n    (:issue:`4911`, :issue:`4982`, :issue:`5001`, :issue:`5002`, :issue:`5076`)\n\n\n.. _release-2.4.1:\n\nScrapy 2.4.1 (2020-11-17)\n-------------------------\n\n-   Fixed :ref:`feed exports <topics-feed-exports>` overwrite support (:issue:`4845`, :issue:`4857`, :issue:`4859`)\n\n-   Fixed the AsyncIO event loop handling, which could make code hang\n    (:issue:`4855`, :issue:`4872`)\n\n-   Fixed the IPv6-capable DNS resolver\n    :class:`~scrapy.resolver.CachingHostnameResolver` for download handlers\n    that call\n    :meth:`reactor.resolve <twisted.internet.interfaces.IReactorCore.resolve>`\n    (:issue:`4802`, :issue:`4803`)\n\n-   Fixed the output of the :command:`genspider` command showing placeholders\n    instead of the import path of the generated spider module (:issue:`4874`)\n\n-   Migrated Windows CI from Azure Pipelines to GitHub Actions (:issue:`4869`,\n    :issue:`4876`)\n\n\n.. _release-2.4.0:\n\nScrapy 2.4.0 (2020-10-11)\n-------------------------\n\nHighlights:\n\n*   Python 3.5 support has been dropped.\n\n*   The ``file_path`` method of :ref:`media pipelines <topics-media-pipeline>`\n    can now access the source :ref:`item <topics-items>`.\n\n    This allows you to set a download file path based on item data.\n\n*   The new ``item_export_kwargs`` key of the :setting:`FEEDS` setting allows\n    to define keyword parameters to pass to :ref:`item exporter classes\n    <topics-exporters>`\n\n*   You can now choose whether :ref:`feed exports <topics-feed-exports>`\n    overwrite or append to the output file.\n\n    For example, when using the :command:`crawl` or :command:`runspider`\n    commands, you can use the ``-O`` option instead of ``-o`` to overwrite the\n    output file.\n\n*   Zstd-compressed responses are now supported if zstandard_ is installed.\n\n*   In settings, where the import path of a class is required, it is now\n    possible to pass a class object instead.\n\nModified requirements\n~~~~~~~~~~~~~~~~~~~~~\n\n*   Python 3.6 or greater is now required; support for Python 3.5 has been\n    dropped\n\n    As a result:\n\n    -   When using PyPy, PyPy 7.2.0 or greater :ref:`is now required\n        <faq-python-versions>`\n\n    -   For Amazon S3 storage support in :ref:`feed exports\n        <topics-feed-storage-s3>` or :ref:`media pipelines\n        <media-pipelines-s3>`, botocore_ 1.4.87 or greater is now required\n\n    -   To use the :ref:`images pipeline <images-pipeline>`, Pillow_ 4.0.0 or\n        greater is now required\n\n    (:issue:`4718`, :issue:`4732`, :issue:`4733`, :issue:`4742`, :issue:`4743`,\n    :issue:`4764`)\n\n\nBackward-incompatible changes\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n*   :class:`~scrapy.downloadermiddlewares.cookies.CookiesMiddleware` once again\n    discards cookies defined in :attr:`Request.headers\n    <scrapy.http.Request.headers>`.\n\n    We decided to revert this bug fix, introduced in Scrapy 2.2.0, because it\n    was reported that the current implementation could break existing code.\n\n    If you need to set cookies for a request, use the :class:`Request.cookies\n    <scrapy.http.Request>` parameter.\n\n    A future version of Scrapy will include a new, better implementation of the\n    reverted bug fix.\n\n    (:issue:`4717`, :issue:`4823`)\n\n\n.. _2.4-deprecation-removals:\n\nDeprecation removals\n~~~~~~~~~~~~~~~~~~~~\n\n*   :class:`scrapy.extensions.feedexport.S3FeedStorage` no longer reads the\n    values of ``access_key`` and ``secret_key`` from the running project\n    settings when they are not passed to its ``__init__`` method; you must\n    either pass those parameters to its ``__init__`` method or use\n    :class:`S3FeedStorage.from_crawler\n    <scrapy.extensions.feedexport.S3FeedStorage.from_crawler>`\n    (:issue:`4356`, :issue:`4411`, :issue:`4688`)\n\n*   :attr:`Rule.process_request <scrapy.spiders.crawl.Rule.process_request>`\n    no longer admits callables which expect a single ``request`` parameter,\n    rather than both ``request`` and ``response`` (:issue:`4818`)\n\n\nDeprecations\n~~~~~~~~~~~~\n\n*   In custom :ref:`media pipelines <topics-media-pipeline>`, signatures that\n    do not accept a keyword-only ``item`` parameter in any of the  methods that\n    :ref:`now support this parameter <media-pipeline-item-parameter>` are now\n    deprecated (:issue:`4628`, :issue:`4686`)\n\n*   In custom :ref:`feed storage backend classes <topics-feed-storage>`,\n    ``__init__`` method signatures that do not accept a keyword-only\n    ``feed_options`` parameter are now deprecated (:issue:`547`, :issue:`716`,\n    :issue:`4512`)\n\n*   The :class:`scrapy.utils.python.WeakKeyCache` class is now deprecated\n    (:issue:`4684`, :issue:`4701`)\n\n*   The :func:`scrapy.utils.boto.is_botocore` function is now deprecated, use\n    :func:`scrapy.utils.boto.is_botocore_available` instead (:issue:`4734`,\n    :issue:`4776`)\n\n\nNew features\n~~~~~~~~~~~~\n\n.. _media-pipeline-item-parameter:\n\n*   The following methods of :ref:`media pipelines <topics-media-pipeline>` now\n    accept an ``item`` keyword-only parameter containing the source\n    :ref:`item <topics-items>`:\n\n    -   In :class:`scrapy.pipelines.files.FilesPipeline`:\n\n        -   :meth:`~scrapy.pipelines.files.FilesPipeline.file_downloaded`\n\n        -   :meth:`~scrapy.pipelines.files.FilesPipeline.file_path`\n\n        -   :meth:`~scrapy.pipelines.files.FilesPipeline.media_downloaded`\n\n        -   :meth:`~scrapy.pipelines.files.FilesPipeline.media_to_download`\n\n    -   In :class:`scrapy.pipelines.images.ImagesPipeline`:\n\n        -   :meth:`~scrapy.pipelines.images.ImagesPipeline.file_downloaded`\n\n        -   :meth:`~scrapy.pipelines.images.ImagesPipeline.file_path`\n\n        -   :meth:`~scrapy.pipelines.images.ImagesPipeline.get_images`\n\n        -   :meth:`~scrapy.pipelines.images.ImagesPipeline.image_downloaded`\n\n        -   :meth:`~scrapy.pipelines.images.ImagesPipeline.media_downloaded`\n\n        -   :meth:`~scrapy.pipelines.images.ImagesPipeline.media_to_download`\n\n    (:issue:`4628`, :issue:`4686`)\n\n*   The new ``item_export_kwargs`` key of the :setting:`FEEDS` setting allows\n    to define keyword parameters to pass to :ref:`item exporter classes\n    <topics-exporters>` (:issue:`4606`, :issue:`4768`)\n\n*   :ref:`Feed exports <topics-feed-exports>` gained overwrite support:\n\n    *   When using the :command:`crawl` or :command:`runspider` commands, you\n        can use the ``-O`` option instead of ``-o`` to overwrite the output\n        file\n\n    *   You can use the ``overwrite`` key in the :setting:`FEEDS` setting to\n        configure whether to overwrite the output file (``True``) or append to\n        its content (``False``)\n\n    *   The ``__init__`` and ``from_crawler`` methods of :ref:`feed storage\n        backend classes <topics-feed-storage>` now receive a new keyword-only\n        parameter, ``feed_options``, which is a dictionary of :ref:`feed\n        options <feed-options>`\n\n    (:issue:`547`, :issue:`716`, :issue:`4512`)\n\n*   Zstd-compressed responses are now supported if zstandard_ is installed\n    (:issue:`4831`)\n\n*   In settings, where the import path of a class is required, it is now\n    possible to pass a class object instead (:issue:`3870`, :issue:`3873`).\n\n    This includes also settings where only part of its value is made of an\n    import path, such as :setting:`DOWNLOADER_MIDDLEWARES` or\n    :setting:`DOWNLOAD_HANDLERS`.\n\n*   :ref:`Downloader middlewares <topics-downloader-middleware>` can now\n    override :class:`response.request <scrapy.http.Response.request>`.\n\n    If a :ref:`downloader middleware <topics-downloader-middleware>` returns\n    a :class:`~scrapy.http.Response` object from\n    :meth:`~scrapy.downloadermiddlewares.DownloaderMiddleware.process_response`\n    or\n    :meth:`~scrapy.downloadermiddlewares.DownloaderMiddleware.process_exception`\n    with a custom :class:`~scrapy.http.Request` object assigned to\n    :class:`response.request <scrapy.http.Response.request>`:\n\n    -   The response is handled by the callback of that custom\n        :class:`~scrapy.http.Request` object, instead of being handled by the\n        callback of the original :class:`~scrapy.http.Request` object\n\n    -   That custom :class:`~scrapy.http.Request` object is now sent as the\n        ``request`` argument to the :signal:`response_received` signal, instead\n        of the original :class:`~scrapy.http.Request` object\n\n    (:issue:`4529`, :issue:`4632`)\n\n*   When using the :ref:`FTP feed storage backend <topics-feed-storage-ftp>`:\n\n    -   It is now possible to set the new ``overwrite`` :ref:`feed option\n        <feed-options>` to ``False`` to append to an existing file instead of\n        overwriting it\n\n    -   The FTP password can now be omitted if it is not necessary\n\n    (:issue:`547`, :issue:`716`, :issue:`4512`)\n\n*   The ``__init__`` method of :class:`~scrapy.exporters.CsvItemExporter` now\n    supports an ``errors`` parameter to indicate how to handle encoding errors\n    (:issue:`4755`)\n\n*   When :ref:`using asyncio <using-asyncio>`, it is now possible to\n    :ref:`set a custom asyncio loop <using-custom-loops>` (:issue:`4306`,\n    :issue:`4414`)\n\n*   Serialized requests (see :ref:`topics-jobs`) now support callbacks that are\n    spider methods that delegate on other callable (:issue:`4756`)\n\n*   When a response is larger than :setting:`DOWNLOAD_MAXSIZE`, the logged\n    message is now a warning, instead of an error (:issue:`3874`,\n    :issue:`3886`, :issue:`4752`)\n\n\nBug fixes\n~~~~~~~~~\n\n*   The :command:`genspider` command no longer overwrites existing files\n    unless the ``--force`` option is used (:issue:`4561`, :issue:`4616`,\n    :issue:`4623`)\n\n*   Cookies with an empty value are no longer considered invalid cookies\n    (:issue:`4772`)\n\n*   The :command:`runspider` command now supports files with the ``.pyw`` file\n    extension (:issue:`4643`, :issue:`4646`)\n\n*   The :class:`~scrapy.downloadermiddlewares.httpproxy.HttpProxyMiddleware`\n    middleware now simply ignores unsupported proxy values (:issue:`3331`,\n    :issue:`4778`)\n\n*   Checks for generator callbacks with a ``return`` statement no longer warn\n    about ``return`` statements in nested functions (:issue:`4720`,\n    :issue:`4721`)\n\n*   The system file mode creation mask no longer affects the permissions of\n    files generated using the :command:`startproject` command (:issue:`4722`)\n\n*   :func:`scrapy.utils.iterators.xmliter` now supports namespaced node names\n    (:issue:`861`, :issue:`4746`)\n\n*   :class:`~scrapy.Request` objects can now have ``about:`` URLs, which can\n    work when using a headless browser (:issue:`4835`)\n\n\nDocumentation\n~~~~~~~~~~~~~\n\n*   The :setting:`FEED_URI_PARAMS` setting is now documented (:issue:`4671`,\n    :issue:`4724`)\n\n*   Improved the documentation of\n    :ref:`link extractors <topics-link-extractors>` with an usage example from\n    a spider callback and reference documentation for the\n    :class:`~scrapy.link.Link` class (:issue:`4751`, :issue:`4775`)\n\n*   Clarified the impact of :setting:`CONCURRENT_REQUESTS` when using the\n    :class:`~scrapy.extensions.closespider.CloseSpider` extension\n    (:issue:`4836`)\n\n*   Removed references to Python 2\u014c\u0106\u00d6s ``unicode`` type (:issue:`4547`,\n    :issue:`4703`)\n\n*   We now have an :ref:`official deprecation policy <deprecation-policy>`\n    (:issue:`4705`)\n\n*   Our :ref:`documentation policies <documentation-policies>` now cover usage\n    of Sphinx\u014c\u0106\u00d6s :rst:dir:`versionadded` and :rst:dir:`versionchanged`\n    directives, and we have removed usages referencing Scrapy 1.4.0 and earlier\n    versions (:issue:`3971`, :issue:`4310`)\n\n*   Other documentation cleanups (:issue:`4090`, :issue:`4782`, :issue:`4800`,\n    :issue:`4801`, :issue:`4809`, :issue:`4816`, :issue:`4825`)\n\n\nQuality assurance\n~~~~~~~~~~~~~~~~~\n\n*   Extended typing hints (:issue:`4243`, :issue:`4691`)\n\n*   Added tests for the :command:`check` command (:issue:`4663`)\n\n*   Fixed test failures on Debian (:issue:`4726`, :issue:`4727`, :issue:`4735`)\n\n*   Improved Windows test coverage (:issue:`4723`)\n\n*   Switched to :ref:`formatted string literals <f-strings>` where possible\n    (:issue:`4307`, :issue:`4324`, :issue:`4672`)\n\n*   Modernized :func:`super` usage (:issue:`4707`)\n\n*   Other code and test cleanups (:issue:`1790`, :issue:`3288`, :issue:`4165`,\n    :issue:`4564`, :issue:`4651`, :issue:`4714`, :issue:`4738`, :issue:`4745`,\n    :issue:`4747`, :issue:`4761`, :issue:`4765`, :issue:`4804`, :issue:`4817`,\n    :issue:`4820`, :issue:`4822`, :issue:`4839`)\n\n\n.. _release-2.3.0:\n\nScrapy 2.3.0 (2020-08-04)\n-------------------------\n\nHighlights:\n\n*   :ref:`Feed exports <topics-feed-exports>` now support :ref:`Google Cloud\n    Storage <topics-feed-storage-gcs>` as a storage backend\n\n*   The new :setting:`FEED_EXPORT_BATCH_ITEM_COUNT` setting allows to deliver\n    output items in batches of up to the specified number of items.\n\n    It also serves as a workaround for :ref:`delayed file delivery\n    <delayed-file-delivery>`, which causes Scrapy to only start item delivery\n    after the crawl has finished when using certain storage backends\n    (:ref:`S3 <topics-feed-storage-s3>`, :ref:`FTP <topics-feed-storage-ftp>`,\n    and now :ref:`GCS <topics-feed-storage-gcs>`).\n\n*   The base implementation of :ref:`item loaders <topics-loaders>` has been\n    moved into a separate library, :doc:`itemloaders <itemloaders:index>`,\n    allowing usage from outside Scrapy and a separate release schedule\n\nDeprecation removals\n~~~~~~~~~~~~~~~~~~~~\n\n*   Removed the following classes and their parent modules from\n    ``scrapy.linkextractors``:\n\n    *   ``htmlparser.HtmlParserLinkExtractor``\n    *   ``regex.RegexLinkExtractor``\n    *   ``sgml.BaseSgmlLinkExtractor``\n    *   ``sgml.SgmlLinkExtractor``\n\n    Use\n    :class:`LinkExtractor <scrapy.linkextractors.lxmlhtml.LxmlLinkExtractor>`\n    instead (:issue:`4356`, :issue:`4679`)\n\n\nDeprecations\n~~~~~~~~~~~~\n\n*   The ``scrapy.utils.python.retry_on_eintr`` function is now deprecated\n    (:issue:`4683`)\n\n\nNew features\n~~~~~~~~~~~~\n\n*   :ref:`Feed exports <topics-feed-exports>` support :ref:`Google Cloud\n    Storage <topics-feed-storage-gcs>` (:issue:`685`, :issue:`3608`)\n\n*   New :setting:`FEED_EXPORT_BATCH_ITEM_COUNT` setting for batch deliveries\n    (:issue:`4250`, :issue:`4434`)\n\n*   The :command:`parse` command now allows specifying an output file\n    (:issue:`4317`, :issue:`4377`)\n\n*   :meth:`Request.from_curl <scrapy.http.Request.from_curl>` and\n    :func:`~scrapy.utils.curl.curl_to_request_kwargs` now also support\n    ``--data-raw`` (:issue:`4612`)\n\n*   A ``parse`` callback may now be used in built-in spider subclasses, such\n    as :class:`~scrapy.spiders.CrawlSpider` (:issue:`712`, :issue:`732`,\n    :issue:`781`, :issue:`4254` )\n\n\nBug fixes\n~~~~~~~~~\n\n*   Fixed the :ref:`CSV exporting <topics-feed-format-csv>` of\n    :ref:`dataclass items <dataclass-items>` and :ref:`attr.s items\n    <attrs-items>` (:issue:`4667`, :issue:`4668`)\n\n*   :meth:`Request.from_curl <scrapy.http.Request.from_curl>` and\n    :func:`~scrapy.utils.curl.curl_to_request_kwargs` now set the request\n    method to ``POST`` when a request body is specified and no request method\n    is specified (:issue:`4612`)\n\n*   The processing of ANSI escape sequences in enabled in Windows 10.0.14393\n    and later, where it is required for colored output (:issue:`4393`,\n    :issue:`4403`)\n\n\nDocumentation\n~~~~~~~~~~~~~\n\n*   Updated the `OpenSSL cipher list format`_ link in the documentation about\n    the :setting:`DOWNLOADER_CLIENT_TLS_CIPHERS` setting (:issue:`4653`)\n\n*   Simplified the code example in :ref:`topics-loaders-dataclass`\n    (:issue:`4652`)\n\n.. _OpenSSL cipher list format: https://www.openssl.org/docs/manmaster/man1/openssl-ciphers.html#CIPHER-LIST-FORMAT\n\n\nQuality assurance\n~~~~~~~~~~~~~~~~~\n\n*   The base implementation of :ref:`item loaders <topics-loaders>` has been\n    moved into :doc:`itemloaders <itemloaders:index>` (:issue:`4005`,\n    :issue:`4516`)\n\n*   Fixed a silenced error in some scheduler tests (:issue:`4644`,\n    :issue:`4645`)\n\n*   Renewed the localhost certificate used for SSL tests (:issue:`4650`)\n\n*   Removed cookie-handling code specific to Python 2 (:issue:`4682`)\n\n*   Stopped using Python 2 unicode literal syntax (:issue:`4704`)\n\n*   Stopped using a backlash for line continuation (:issue:`4673`)\n\n*   Removed unneeded entries from the MyPy exception list (:issue:`4690`)\n\n*   Automated tests now pass on Windows as part of our continuous integration\n    system (:issue:`4458`)\n\n*   Automated tests now pass on the latest PyPy version for supported Python\n    versions in our continuous integration system (:issue:`4504`)\n\n\n.. _release-2.2.1:\n\nScrapy 2.2.1 (2020-07-17)\n-------------------------\n\n*   The :command:`startproject` command no longer makes unintended changes to\n    the permissions of files in the destination folder, such as removing\n    execution permissions (:issue:`4662`, :issue:`4666`)\n\n\n.. _release-2.2.0:\n\nScrapy 2.2.0 (2020-06-24)\n-------------------------\n\nHighlights:\n\n* Python 3.5.2+ is required now\n* :ref:`dataclass objects <dataclass-items>` and\n  :ref:`attrs objects <attrs-items>` are now valid :ref:`item types\n  <item-types>`\n* New :meth:`TextResponse.json <scrapy.http.TextResponse.json>` method\n* New :signal:`bytes_received` signal that allows canceling response download\n* :class:`~scrapy.downloadermiddlewares.cookies.CookiesMiddleware` fixes\n\nBackward-incompatible changes\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n*   Support for Python 3.5.0 and 3.5.1 has been dropped; Scrapy now refuses to\n    run with a Python version lower than 3.5.2, which introduced\n    :class:`typing.Type` (:issue:`4615`)\n\n\nDeprecations\n~~~~~~~~~~~~\n\n*   :meth:`TextResponse.body_as_unicode\n    <scrapy.http.TextResponse.body_as_unicode>` is now deprecated, use\n    :attr:`TextResponse.text <scrapy.http.TextResponse.text>` instead\n    (:issue:`4546`, :issue:`4555`, :issue:`4579`)\n\n*   :class:`scrapy.item.BaseItem` is now deprecated, use\n    :class:`scrapy.item.Item` instead (:issue:`4534`)\n\n\nNew features\n~~~~~~~~~~~~\n\n*   :ref:`dataclass objects <dataclass-items>` and\n    :ref:`attrs objects <attrs-items>` are now valid :ref:`item types\n    <item-types>`, and a new itemadapter_ library makes it easy to\n    write code that :ref:`supports any item type <supporting-item-types>`\n    (:issue:`2749`, :issue:`2807`, :issue:`3761`, :issue:`3881`, :issue:`4642`)\n\n*   A new :meth:`TextResponse.json <scrapy.http.TextResponse.json>` method\n    allows to deserialize JSON responses (:issue:`2444`, :issue:`4460`,\n    :issue:`4574`)\n\n*   A new :signal:`bytes_received` signal allows monitoring response download\n    progress and :ref:`stopping downloads <topics-stop-response-download>`\n    (:issue:`4205`, :issue:`4559`)\n\n*   The dictionaries in the result list of a :ref:`media pipeline\n    <topics-media-pipeline>` now include a new key, ``status``, which indicates\n    if the file was downloaded or, if the file was not downloaded, why it was\n    not downloaded; see :meth:`FilesPipeline.get_media_requests\n    <scrapy.pipelines.files.FilesPipeline.get_media_requests>` for more\n    information (:issue:`2893`, :issue:`4486`)\n\n*   When using :ref:`Google Cloud Storage <media-pipeline-gcs>` for\n    a :ref:`media pipeline <topics-media-pipeline>`, a warning is now logged if\n    the configured credentials do not grant the required permissions\n    (:issue:`4346`, :issue:`4508`)\n\n*   :ref:`Link extractors <topics-link-extractors>` are now serializable,\n    as long as you do not use :ref:`lambdas <lambda>` for parameters; for\n    example, you can now pass link extractors in :attr:`Request.cb_kwargs\n    <scrapy.http.Request.cb_kwargs>` or\n    :attr:`Request.meta <scrapy.http.Request.meta>` when :ref:`persisting\n    scheduled requests <topics-jobs>` (:issue:`4554`)\n\n*   Upgraded the :ref:`pickle protocol <pickle-protocols>` that Scrapy uses\n    from protocol 2 to protocol 4, improving serialization capabilities and\n    performance (:issue:`4135`, :issue:`4541`)\n\n*   :func:`scrapy.utils.misc.create_instance` now raises a :exc:`TypeError`\n    exception if the resulting instance is ``None`` (:issue:`4528`,\n    :issue:`4532`)\n\n.. _itemadapter: https://github.com/scrapy/itemadapter\n\n\nBug fixes\n~~~~~~~~~\n\n*   :class:`~scrapy.downloadermiddlewares.cookies.CookiesMiddleware` no longer\n    discards cookies defined in :attr:`Request.headers\n    <scrapy.http.Request.headers>` (:issue:`1992`, :issue:`2400`)\n\n*   :class:`~scrapy.downloadermiddlewares.cookies.CookiesMiddleware` no longer\n    re-encodes cookies defined as :class:`bytes` in the ``cookies`` parameter\n    of the ``__init__`` method of :class:`~scrapy.http.Request`\n    (:issue:`2400`, :issue:`3575`)\n\n*   When :setting:`FEEDS` defines multiple URIs, :setting:`FEED_STORE_EMPTY` is\n    ``False`` and the crawl yields no items, Scrapy no longer stops feed\n    exports after the first URI (:issue:`4621`, :issue:`4626`)\n\n*   :class:`~scrapy.spiders.Spider` callbacks defined using :doc:`coroutine\n    syntax <topics/coroutines>` no longer need to return an iterable, and may\n    instead return a :class:`~scrapy.http.Request` object, an\n    :ref:`item <topics-items>`, or ``None`` (:issue:`4609`)\n\n*   The :command:`startproject` command now ensures that the generated project\n    folders and files have the right permissions (:issue:`4604`)\n\n*   Fix a :exc:`KeyError` exception being sometimes raised from\n    :class:`scrapy.utils.datatypes.LocalWeakReferencedCache` (:issue:`4597`,\n    :issue:`4599`)\n\n*   When :setting:`FEEDS` defines multiple URIs, log messages about items being\n    stored now contain information from the corresponding feed, instead of\n    always containing information about only one of the feeds (:issue:`4619`,\n    :issue:`4629`)\n\n\nDocumentation\n~~~~~~~~~~~~~\n\n*   Added a new section about :ref:`accessing cb_kwargs from errbacks\n    <errback-cb_kwargs>` (:issue:`4598`, :issue:`4634`)\n\n*   Covered chompjs_ in :ref:`topics-parsing-javascript` (:issue:`4556`,\n    :issue:`4562`)\n\n*   Removed from :doc:`topics/coroutines` the warning about the API being\n    experimental (:issue:`4511`, :issue:`4513`)\n\n*   Removed references to unsupported versions of :doc:`Twisted\n    <twisted:index>` (:issue:`4533`)\n\n*   Updated the description of the :ref:`screenshot pipeline example\n    <ScreenshotPipeline>`, which now uses :doc:`coroutine syntax\n    <topics/coroutines>` instead of returning a\n    :class:`~twisted.internet.defer.Deferred` (:issue:`4514`, :issue:`4593`)\n\n*   Removed a misleading import line from the\n    :func:`scrapy.utils.log.configure_logging` code example (:issue:`4510`,\n    :issue:`4587`)\n\n*   The display-on-hover behavior of internal documentation references now also\n    covers links to :ref:`commands <topics-commands>`, :attr:`Request.meta\n    <scrapy.http.Request.meta>` keys, :ref:`settings <topics-settings>` and\n    :ref:`signals <topics-signals>` (:issue:`4495`, :issue:`4563`)\n\n*   It is again possible to download the documentation for offline reading\n    (:issue:`4578`, :issue:`4585`)\n\n*   Removed backslashes preceding ``*args`` and ``**kwargs`` in some function\n    and method signatures (:issue:`4592`, :issue:`4596`)\n\n.. _chompjs: https://github.com/Nykakin/chompjs\n\n\nQuality assurance\n~~~~~~~~~~~~~~~~~\n\n*   Adjusted the code base further to our :ref:`style guidelines\n    <coding-style>` (:issue:`4237`, :issue:`4525`, :issue:`4538`,\n    :issue:`4539`, :issue:`4540`, :issue:`4542`, :issue:`4543`, :issue:`4544`,\n    :issue:`4545`, :issue:`4557`, :issue:`4558`, :issue:`4566`, :issue:`4568`,\n    :issue:`4572`)\n\n*   Removed remnants of Python 2 support (:issue:`4550`, :issue:`4553`,\n    :issue:`4568`)\n\n*   Improved code sharing between the :command:`crawl` and :command:`runspider`\n    commands (:issue:`4548`, :issue:`4552`)\n\n*   Replaced ``chain(*iterable)`` with ``chain.from_iterable(iterable)``\n    (:issue:`4635`)\n\n*   You may now run the :mod:`asyncio` tests with Tox on any Python version\n    (:issue:`4521`)\n\n*   Updated test requirements to reflect an incompatibility with pytest 5.4 and\n    5.4.1 (:issue:`4588`)\n\n*   Improved :class:`~scrapy.spiderloader.SpiderLoader` test coverage for\n    scenarios involving duplicate spider names (:issue:`4549`, :issue:`4560`)\n\n*   Configured Travis CI to also run the tests with Python 3.5.2\n    (:issue:`4518`, :issue:`4615`)\n\n*   Added a `Pylint <https://www.pylint.org/>`_ job to Travis CI\n    (:issue:`3727`)\n\n*   Added a `Mypy <http://mypy-lang.org/>`_ job to Travis CI (:issue:`4637`)\n\n*   Made use of set literals in tests (:issue:`4573`)\n\n*   Cleaned up the Travis CI configuration (:issue:`4517`, :issue:`4519`,\n    :issue:`4522`, :issue:`4537`)\n\n\n.. _release-2.1.0:\n\nScrapy 2.1.0 (2020-04-24)\n-------------------------\n\nHighlights:\n\n* New :setting:`FEEDS` setting to export to multiple feeds\n* New :attr:`Response.ip_address <scrapy.http.Response.ip_address>` attribute\n\nBackward-incompatible changes\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n*   :exc:`AssertionError` exceptions triggered by :ref:`assert <assert>`\n    statements have been replaced by new exception types, to support running\n    Python in optimized mode (see :option:`-O`) without changing Scrapy\u014c\u0106\u00d6s\n    behavior in any unexpected ways.\n\n    If you catch an :exc:`AssertionError` exception from Scrapy, update your\n    code to catch the corresponding new exception.\n\n    (:issue:`4440`)\n\n\nDeprecation removals\n~~~~~~~~~~~~~~~~~~~~\n\n*   The ``LOG_UNSERIALIZABLE_REQUESTS`` setting is no longer supported, use\n    :setting:`SCHEDULER_DEBUG` instead (:issue:`4385`)\n\n*   The ``REDIRECT_MAX_METAREFRESH_DELAY`` setting is no longer supported, use\n    :setting:`METAREFRESH_MAXDELAY` instead (:issue:`4385`)\n\n*   The :class:`~scrapy.downloadermiddlewares.chunked.ChunkedTransferMiddleware`\n    middleware has been removed, including the entire\n    :class:`scrapy.downloadermiddlewares.chunked` module; chunked transfers\n    work out of the box (:issue:`4431`)\n\n*   The ``spiders`` property has been removed from\n    :class:`~scrapy.crawler.Crawler`, use :class:`CrawlerRunner.spider_loader\n    <scrapy.crawler.CrawlerRunner.spider_loader>` or instantiate\n    :setting:`SPIDER_LOADER_CLASS` with your settings instead (:issue:`4398`)\n\n*   The ``MultiValueDict``, ``MultiValueDictKeyError``, and ``SiteNode``\n    classes have been removed from :mod:`scrapy.utils.datatypes`\n    (:issue:`4400`)\n\n\nDeprecations\n~~~~~~~~~~~~\n\n*   The ``FEED_FORMAT`` and ``FEED_URI`` settings have been deprecated in\n    favor of the new :setting:`FEEDS` setting (:issue:`1336`, :issue:`3858`,\n    :issue:`4507`)\n\n\nNew features\n~~~~~~~~~~~~\n\n*   A new setting, :setting:`FEEDS`, allows configuring multiple output feeds\n    with different settings each (:issue:`1336`, :issue:`3858`, :issue:`4507`)\n\n*   The :command:`crawl` and :command:`runspider` commands now support multiple\n    ``-o`` parameters (:issue:`1336`, :issue:`3858`, :issue:`4507`)\n\n*   The :command:`crawl` and :command:`runspider` commands now support\n    specifying an output format by appending ``:<format>`` to the output file\n    (:issue:`1336`, :issue:`3858`, :issue:`4507`)\n\n*   The new :attr:`Response.ip_address <scrapy.http.Response.ip_address>`\n    attribute gives access to the IP address that originated a response\n    (:issue:`3903`, :issue:`3940`)\n\n*   A warning is now issued when a value in\n    :attr:`~scrapy.spiders.Spider.allowed_domains` includes a port\n    (:issue:`50`, :issue:`3198`, :issue:`4413`)\n\n*   Zsh completion now excludes used option aliases from the completion list\n    (:issue:`4438`)\n\n\nBug fixes\n~~~~~~~~~\n\n*   :ref:`Request serialization <request-serialization>` no longer breaks for\n    callbacks that are spider attributes which are assigned a function with a\n    different name (:issue:`4500`)\n\n*   ``None`` values in :attr:`~scrapy.spiders.Spider.allowed_domains` no longer\n    cause a :exc:`TypeError` exception (:issue:`4410`)\n\n*   Zsh completion no longer allows options after arguments (:issue:`4438`)\n\n*   zope.interface 5.0.0 and later versions are now supported\n    (:issue:`4447`, :issue:`4448`)\n\n*   ``Spider.make_requests_from_url``, deprecated in Scrapy 1.4.0, now issues a\n    warning when used (:issue:`4412`)\n\n\nDocumentation\n~~~~~~~~~~~~~\n\n*   Improved the documentation about signals that allow their handlers to\n    return a :class:`~twisted.internet.defer.Deferred` (:issue:`4295`,\n    :issue:`4390`)\n\n*   Our PyPI entry now includes links for our documentation, our source code\n    repository and our issue tracker (:issue:`4456`)\n\n*   Covered the `curl2scrapy <https://michael-shub.github.io/curl2scrapy/>`_\n    service in the documentation (:issue:`4206`, :issue:`4455`)\n\n*   Removed references to the Guppy library, which only works in Python 2\n    (:issue:`4285`, :issue:`4343`)\n\n*   Extended use of InterSphinx to link to Python 3 documentation\n    (:issue:`4444`, :issue:`4445`)\n\n*   Added support for Sphinx 3.0 and later (:issue:`4475`, :issue:`4480`,\n    :issue:`4496`, :issue:`4503`)\n\n\nQuality assurance\n~~~~~~~~~~~~~~~~~\n\n*   Removed warnings about using old, removed settings (:issue:`4404`)\n\n*   Removed a warning about importing\n    :class:`~twisted.internet.testing.StringTransport` from\n    ``twisted.test.proto_helpers`` in Twisted 19.7.0 or newer (:issue:`4409`)\n\n*   Removed outdated Debian package build files (:issue:`4384`)\n\n*   Removed :class:`object` usage as a base class (:issue:`4430`)\n\n*   Removed code that added support for old versions of Twisted that we no\n    longer support (:issue:`4472`)\n\n*   Fixed code style issues (:issue:`4468`, :issue:`4469`, :issue:`4471`,\n    :issue:`4481`)\n\n*   Removed :func:`twisted.internet.defer.returnValue` calls (:issue:`4443`,\n    :issue:`4446`, :issue:`4489`)\n\n\n.. _release-2.0.1:\n\nScrapy 2.0.1 (2020-03-18)\n-------------------------\n\n*   :meth:`Response.follow_all <scrapy.http.Response.follow_all>` now supports\n    an empty URL iterable as input (:issue:`4408`, :issue:`4420`)\n\n*   Removed top-level :mod:`~twisted.internet.reactor` imports to prevent\n    errors about the wrong Twisted reactor being installed when setting a\n    different Twisted reactor using :setting:`TWISTED_REACTOR` (:issue:`4401`,\n    :issue:`4406`)\n\n*   Fixed tests (:issue:`4422`)\n\n\n.. _release-2.0.0:\n\nScrapy 2.0.0 (2020-03-03)\n-------------------------\n\nHighlights:\n\n* Python 2 support has been removed\n* :doc:`Partial <topics/coroutines>` :ref:`coroutine syntax <async>` support\n  and :doc:`experimental <topics/asyncio>` :mod:`asyncio` support\n* New :meth:`Response.follow_all <scrapy.http.Response.follow_all>` method\n* :ref:`FTP support <media-pipeline-ftp>` for media pipelines\n* New :attr:`Response.certificate <scrapy.http.Response.certificate>`\n  attribute\n* IPv6 support through :setting:`DNS_RESOLVER`\n\nBackward-incompatible changes\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n*   Python 2 support has been removed, following `Python 2 end-of-life on\n    January 1, 2020`_ (:issue:`4091`, :issue:`4114`, :issue:`4115`,\n    :issue:`4121`, :issue:`4138`, :issue:`4231`, :issue:`4242`, :issue:`4304`,\n    :issue:`4309`, :issue:`4373`)\n\n*   Retry gaveups (see :setting:`RETRY_TIMES`) are now logged as errors instead\n    of as debug information (:issue:`3171`, :issue:`3566`)\n\n*   File extensions that\n    :class:`LinkExtractor <scrapy.linkextractors.lxmlhtml.LxmlLinkExtractor>`\n    ignores by default now also include ``7z``, ``7zip``, ``apk``, ``bz2``,\n    ``cdr``, ``dmg``, ``ico``, ``iso``, ``tar``, ``tar.gz``, ``webm``, and\n    ``xz`` (:issue:`1837`, :issue:`2067`, :issue:`4066`)\n\n*   The :setting:`METAREFRESH_IGNORE_TAGS` setting is now an empty list by\n    default, following web browser behavior (:issue:`3844`, :issue:`4311`)\n\n*   The\n    :class:`~scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware`\n    now includes spaces after commas in the value of the ``Accept-Encoding``\n    header that it sets, following web browser behavior (:issue:`4293`)\n\n*   The ``__init__`` method of custom download handlers (see\n    :setting:`DOWNLOAD_HANDLERS`) or subclasses of the following downloader\n    handlers  no longer receives a ``settings`` parameter:\n\n    *   :class:`scrapy.core.downloader.handlers.datauri.DataURIDownloadHandler`\n\n    *   :class:`scrapy.core.downloader.handlers.file.FileDownloadHandler`\n\n    Use the ``from_settings`` or ``from_crawler`` class methods to expose such\n    a parameter to your custom download handlers.\n\n    (:issue:`4126`)\n\n*   We have refactored the :class:`scrapy.core.scheduler.Scheduler` class and\n    related queue classes (see :setting:`SCHEDULER_PRIORITY_QUEUE`,\n    :setting:`SCHEDULER_DISK_QUEUE` and :setting:`SCHEDULER_MEMORY_QUEUE`) to\n    make it easier to implement custom scheduler queue classes. See\n    :ref:`2-0-0-scheduler-queue-changes` below for details.\n\n*   Overridden settings are now logged in a different format. This is more in\n    line with similar information logged at startup (:issue:`4199`)\n\n.. _Python 2 end-of-life on January 1, 2020: https://www.python.org/doc/sunset-python-2/\n\n\nDeprecation removals\n~~~~~~~~~~~~~~~~~~~~\n\n*   The :ref:`Scrapy shell <topics-shell>` no longer provides a `sel` proxy\n    object, use :meth:`response.selector <scrapy.http.Response.selector>`\n    instead (:issue:`4347`)\n\n*   LevelDB support has been removed (:issue:`4112`)\n\n*   The following functions have been removed from :mod:`scrapy.utils.python`:\n    ``isbinarytext``, ``is_writable``, ``setattr_default``, ``stringify_dict``\n    (:issue:`4362`)\n\n\nDeprecations\n~~~~~~~~~~~~\n\n*   Using environment variables prefixed with ``SCRAPY_`` to override settings\n    is deprecated (:issue:`4300`, :issue:`4374`, :issue:`4375`)\n\n*   :class:`scrapy.linkextractors.FilteringLinkExtractor` is deprecated, use\n    :class:`scrapy.linkextractors.LinkExtractor\n    <scrapy.linkextractors.lxmlhtml.LxmlLinkExtractor>` instead (:issue:`4045`)\n\n*   The ``noconnect`` query string argument of proxy URLs is deprecated and\n    should be removed from proxy URLs (:issue:`4198`)\n\n*   The :meth:`next <scrapy.utils.python.MutableChain.next>` method of\n    :class:`scrapy.utils.python.MutableChain` is deprecated, use the global\n    :func:`next` function or :meth:`MutableChain.__next__\n    <scrapy.utils.python.MutableChain.__next__>` instead (:issue:`4153`)\n\n\nNew features\n~~~~~~~~~~~~\n\n*   Added :doc:`partial support <topics/coroutines>` for Python\u014c\u0106\u00d6s\n    :ref:`coroutine syntax <async>` and :doc:`experimental support\n    <topics/asyncio>` for :mod:`asyncio` and :mod:`asyncio`-powered libraries\n    (:issue:`4010`, :issue:`4259`, :issue:`4269`, :issue:`4270`, :issue:`4271`,\n    :issue:`4316`, :issue:`4318`)\n\n*   The new :meth:`Response.follow_all <scrapy.http.Response.follow_all>`\n    method offers the same functionality as\n    :meth:`Response.follow <scrapy.http.Response.follow>` but supports an\n    iterable of URLs as input and returns an iterable of requests\n    (:issue:`2582`, :issue:`4057`, :issue:`4286`)\n\n*   :ref:`Media pipelines <topics-media-pipeline>` now support :ref:`FTP\n    storage <media-pipeline-ftp>` (:issue:`3928`, :issue:`3961`)\n\n*   The new :attr:`Response.certificate <scrapy.http.Response.certificate>`\n    attribute exposes the SSL certificate of the server as a\n    :class:`twisted.internet.ssl.Certificate` object for HTTPS responses\n    (:issue:`2726`, :issue:`4054`)\n\n*   A new :setting:`DNS_RESOLVER` setting allows enabling IPv6 support\n    (:issue:`1031`, :issue:`4227`)\n\n*   A new :setting:`SCRAPER_SLOT_MAX_ACTIVE_SIZE` setting allows configuring\n    the existing soft limit that pauses request downloads when the total\n    response data being processed is too high (:issue:`1410`, :issue:`3551`)\n\n*   A new :setting:`TWISTED_REACTOR` setting allows customizing the\n    :mod:`~twisted.internet.reactor` that Scrapy uses, allowing to\n    :doc:`enable asyncio support <topics/asyncio>` or deal with a\n    :ref:`common macOS issue <faq-specific-reactor>` (:issue:`2905`,\n    :issue:`4294`)\n\n*   Scheduler disk and memory queues may now use the class methods\n    ``from_crawler`` or ``from_settings`` (:issue:`3884`)\n\n*   The new :attr:`Response.cb_kwargs <scrapy.http.Response.cb_kwargs>`\n    attribute serves as a shortcut for :attr:`Response.request.cb_kwargs\n    <scrapy.http.Request.cb_kwargs>` (:issue:`4331`)\n\n*   :meth:`Response.follow <scrapy.http.Response.follow>` now supports a\n    ``flags`` parameter, for consistency with :class:`~scrapy.http.Request`\n    (:issue:`4277`, :issue:`4279`)\n\n*   :ref:`Item loader processors <topics-loaders-processors>` can now be\n    regular functions, they no longer need to be methods (:issue:`3899`)\n\n*   :class:`~scrapy.spiders.Rule` now accepts an ``errback`` parameter\n    (:issue:`4000`)\n\n*   :class:`~scrapy.http.Request` no longer requires a ``callback`` parameter\n    when an ``errback`` parameter is specified (:issue:`3586`, :issue:`4008`)\n\n*   :class:`~scrapy.logformatter.LogFormatter` now supports some additional\n    methods:\n\n    *   :class:`~scrapy.logformatter.LogFormatter.download_error` for\n        download errors\n\n    *   :class:`~scrapy.logformatter.LogFormatter.item_error` for exceptions\n        raised during item processing by :ref:`item pipelines\n        <topics-item-pipeline>`\n\n    *   :class:`~scrapy.logformatter.LogFormatter.spider_error` for exceptions\n        raised from :ref:`spider callbacks <topics-spiders>`\n\n    (:issue:`374`, :issue:`3986`, :issue:`3989`, :issue:`4176`, :issue:`4188`)\n\n*   The :setting:`FEED_URI` setting now supports :class:`pathlib.Path` values\n    (:issue:`3731`, :issue:`4074`)\n\n*   A new :signal:`request_left_downloader` signal is sent when a request\n    leaves the downloader (:issue:`4303`)\n\n*   Scrapy logs a warning when it detects a request callback or errback that\n    uses ``yield`` but also returns a value, since the returned value would be\n    lost (:issue:`3484`, :issue:`3869`)\n\n*   :class:`~scrapy.spiders.Spider` objects now raise an :exc:`AttributeError`\n    exception if they do not have a :class:`~scrapy.spiders.Spider.start_urls`\n    attribute nor reimplement :class:`~scrapy.spiders.Spider.start_requests`,\n    but have a ``start_url`` attribute (:issue:`4133`, :issue:`4170`)\n\n*   :class:`~scrapy.exporters.BaseItemExporter` subclasses may now use\n    ``super().__init__(**kwargs)`` instead of ``self._configure(kwargs)`` in\n    their ``__init__`` method, passing ``dont_fail=True`` to the parent\n    ``__init__`` method if needed, and accessing ``kwargs`` at ``self._kwargs``\n    after calling their parent ``__init__`` method (:issue:`4193`,\n    :issue:`4370`)\n\n*   A new ``keep_fragments`` parameter of\n    :func:`scrapy.utils.request.request_fingerprint` allows to generate\n    different fingerprints for requests with different fragments in their URL\n    (:issue:`4104`)\n\n*   Download handlers (see :setting:`DOWNLOAD_HANDLERS`) may now use the\n    ``from_settings`` and ``from_crawler`` class methods that other Scrapy\n    components already supported (:issue:`4126`)\n\n*   :class:`scrapy.utils.python.MutableChain.__iter__` now returns ``self``,\n    `allowing it to be used as a sequence <https://lgtm.com/rules/4850080/>`_\n    (:issue:`4153`)\n\n\nBug fixes\n~~~~~~~~~\n\n*   The :command:`crawl` command now also exits with exit code 1 when an\n    exception happens before the crawling starts (:issue:`4175`, :issue:`4207`)\n\n*   :class:`LinkExtractor.extract_links\n    <scrapy.linkextractors.lxmlhtml.LxmlLinkExtractor.extract_links>` no longer\n    re-encodes the query string or URLs from non-UTF-8 responses in UTF-8\n    (:issue:`998`, :issue:`1403`, :issue:`1949`, :issue:`4321`)\n\n*   The first spider middleware (see :setting:`SPIDER_MIDDLEWARES`) now also\n    processes exceptions raised from callbacks that are generators\n    (:issue:`4260`, :issue:`4272`)\n\n*   Redirects to URLs starting with 3 slashes (``///``) are now supported\n    (:issue:`4032`, :issue:`4042`)\n\n*   :class:`~scrapy.http.Request` no longer accepts strings as ``url`` simply\n    because they have a colon (:issue:`2552`, :issue:`4094`)\n\n*   The correct encoding is now used for attach names in\n    :class:`~scrapy.mail.MailSender` (:issue:`4229`, :issue:`4239`)\n\n*   :class:`~scrapy.dupefilters.RFPDupeFilter`, the default\n    :setting:`DUPEFILTER_CLASS`, no longer writes an extra ``\\r`` character on\n    each line in Windows, which made the size of the ``requests.seen`` file\n    unnecessarily large on that platform (:issue:`4283`)\n\n*   Z shell auto-completion now looks for ``.html`` files, not ``.http`` files,\n    and covers the ``-h`` command-line switch (:issue:`4122`, :issue:`4291`)\n\n*   Adding items to a :class:`scrapy.utils.datatypes.LocalCache` object\n    without a ``limit`` defined no longer raises a :exc:`TypeError` exception\n    (:issue:`4123`)\n\n*   Fixed a typo in the message of the :exc:`ValueError` exception raised when\n    :func:`scrapy.utils.misc.create_instance` gets both ``settings`` and\n    ``crawler`` set to ``None`` (:issue:`4128`)\n\n\nDocumentation\n~~~~~~~~~~~~~\n\n*   API documentation now links to an online, syntax-highlighted view of the\n    corresponding source code (:issue:`4148`)\n\n*   Links to unexisting documentation pages now allow access to the sidebar\n    (:issue:`4152`, :issue:`4169`)\n\n*   Cross-references within our documentation now display a tooltip when\n    hovered (:issue:`4173`, :issue:`4183`)\n\n*   Improved the documentation about :meth:`LinkExtractor.extract_links\n    <scrapy.linkextractors.lxmlhtml.LxmlLinkExtractor.extract_links>` and\n    simplified :ref:`topics-link-extractors` (:issue:`4045`)\n\n*   Clarified how :class:`ItemLoader.item <scrapy.loader.ItemLoader.item>`\n    works (:issue:`3574`, :issue:`4099`)\n\n*   Clarified that :func:`logging.basicConfig` should not be used when also\n    using :class:`~scrapy.crawler.CrawlerProcess` (:issue:`2149`,\n    :issue:`2352`, :issue:`3146`, :issue:`3960`)\n\n*   Clarified the requirements for :class:`~scrapy.http.Request` objects\n    :ref:`when using persistence <request-serialization>` (:issue:`4124`,\n    :issue:`4139`)\n\n*   Clarified how to install a :ref:`custom image pipeline\n    <media-pipeline-example>` (:issue:`4034`, :issue:`4252`)\n\n*   Fixed the signatures of the ``file_path`` method in :ref:`media pipeline\n    <topics-media-pipeline>` examples (:issue:`4290`)\n\n*   Covered a backward-incompatible change in Scrapy 1.7.0 affecting custom\n    :class:`scrapy.core.scheduler.Scheduler` subclasses (:issue:`4274`)\n\n*   Improved the ``README.rst`` and ``CODE_OF_CONDUCT.md`` files\n    (:issue:`4059`)\n\n*   Documentation examples are now checked as part of our test suite and we\n    have fixed some of the issues detected (:issue:`4142`, :issue:`4146`,\n    :issue:`4171`, :issue:`4184`, :issue:`4190`)\n\n*   Fixed logic issues, broken links and typos (:issue:`4247`, :issue:`4258`,\n    :issue:`4282`, :issue:`4288`, :issue:`4305`, :issue:`4308`, :issue:`4323`,\n    :issue:`4338`, :issue:`4359`, :issue:`4361`)\n\n*   Improved consistency when referring to the ``__init__`` method of an object\n    (:issue:`4086`, :issue:`4088`)\n\n*   Fixed an inconsistency between code and output in :ref:`intro-overview`\n    (:issue:`4213`)\n\n*   Extended :mod:`~sphinx.ext.intersphinx` usage (:issue:`4147`,\n    :issue:`4172`, :issue:`4185`, :issue:`4194`, :issue:`4197`)\n\n*   We now use a recent version of Python to build the documentation\n    (:issue:`4140`, :issue:`4249`)\n\n*   Cleaned up documentation (:issue:`4143`, :issue:`4275`)\n\n\nQuality assurance\n~~~~~~~~~~~~~~~~~\n\n*   Re-enabled proxy ``CONNECT`` tests (:issue:`2545`, :issue:`4114`)\n\n*   Added Bandit_ security checks to our test suite (:issue:`4162`,\n    :issue:`4181`)\n\n*   Added Flake8_ style checks to our test suite and applied many of the\n    corresponding changes (:issue:`3944`, :issue:`3945`, :issue:`4137`,\n    :issue:`4157`, :issue:`4167`, :issue:`4174`, :issue:`4186`, :issue:`4195`,\n    :issue:`4238`, :issue:`4246`, :issue:`4355`, :issue:`4360`, :issue:`4365`)\n\n*   Improved test coverage (:issue:`4097`, :issue:`4218`, :issue:`4236`)\n\n*   Started reporting slowest tests, and improved the performance of some of\n    them (:issue:`4163`, :issue:`4164`)\n\n*   Fixed broken tests and refactored some tests (:issue:`4014`, :issue:`4095`,\n    :issue:`4244`, :issue:`4268`, :issue:`4372`)\n\n*   Modified the :doc:`tox <tox:index>` configuration to allow running tests\n    with any Python version, run Bandit_ and Flake8_ tests by default, and\n    enforce a minimum tox version programmatically (:issue:`4179`)\n\n*   Cleaned up code (:issue:`3937`, :issue:`4208`, :issue:`4209`,\n    :issue:`4210`, :issue:`4212`, :issue:`4369`, :issue:`4376`, :issue:`4378`)\n\n.. _Bandit: https://bandit.readthedocs.io/\n.. _Flake8: https://flake8.pycqa.org/en/latest/\n\n\n.. _2-0-0-scheduler-queue-changes:\n\nChanges to scheduler queue classes\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\nThe following changes may impact any custom queue classes of all types:\n\n*   The ``push`` method no longer receives a second positional parameter\n    containing ``request.priority * -1``. If you need that value, get it\n    from the first positional parameter, ``request``, instead, or use\n    the new :meth:`~scrapy.core.scheduler.ScrapyPriorityQueue.priority`\n    method in :class:`scrapy.core.scheduler.ScrapyPriorityQueue`\n    subclasses.\n\nThe following changes may impact custom priority queue classes:\n\n*   In the ``__init__`` method or the ``from_crawler`` or ``from_settings``\n    class methods:\n\n    *   The parameter that used to contain a factory function,\n        ``qfactory``, is now passed as a keyword parameter named\n        ``downstream_queue_cls``.\n\n    *   A new keyword parameter has been added: ``key``. It is a string\n        that is always an empty string for memory queues and indicates the\n        :setting:`JOB_DIR` value for disk queues.\n\n    *   The parameter for disk queues that contains data from the previous\n        crawl, ``startprios`` or ``slot_startprios``, is now passed as a\n        keyword parameter named ``startprios``.\n\n    *   The ``serialize`` parameter is no longer passed. The disk queue\n        class must take care of request serialization on its own before\n        writing to disk, using the\n        :func:`~scrapy.utils.reqser.request_to_dict` and\n        :func:`~scrapy.utils.reqser.request_from_dict` functions from the\n        :mod:`scrapy.utils.reqser` module.\n\nThe following changes may impact custom disk and memory queue classes:\n\n*   The signature of the ``__init__`` method is now\n    ``__init__(self, crawler, key)``.\n\nThe following changes affect specifically the\n:class:`~scrapy.core.scheduler.ScrapyPriorityQueue` and\n:class:`~scrapy.core.scheduler.DownloaderAwarePriorityQueue` classes from\n:mod:`scrapy.core.scheduler` and may affect subclasses:\n\n*   In the ``__init__`` method, most of the changes described above apply.\n\n    ``__init__`` may still receive all parameters as positional parameters,\n    however:\n\n    *   ``downstream_queue_cls``, which replaced ``qfactory``, must be\n        instantiated differently.\n\n        ``qfactory`` was instantiated with a priority value (integer).\n\n        Instances of ``downstream_queue_cls`` should be created using\n        the new\n        :meth:`ScrapyPriorityQueue.qfactory <scrapy.core.scheduler.ScrapyPriorityQueue.qfactory>`\n        or\n        :meth:`DownloaderAwarePriorityQueue.pqfactory <scrapy.core.scheduler.DownloaderAwarePriorityQueue.pqfactory>`\n        methods.\n\n    *   The new ``key`` parameter displaced the ``startprios``\n        parameter 1 position to the right.\n\n*   The following class attributes have been added:\n\n    *   :attr:`~scrapy.core.scheduler.ScrapyPriorityQueue.crawler`\n\n    *   :attr:`~scrapy.core.scheduler.ScrapyPriorityQueue.downstream_queue_cls`\n        (details above)\n\n    *   :attr:`~scrapy.core.scheduler.ScrapyPriorityQueue.key` (details above)\n\n*   The ``serialize`` attribute has been removed (details above)\n\nThe following changes affect specifically the\n:class:`~scrapy.core.scheduler.ScrapyPriorityQueue` class and may affect\nsubclasses:\n\n*   A new :meth:`~scrapy.core.scheduler.ScrapyPriorityQueue.priority`\n    method has been added which, given a request, returns\n    ``request.priority * -1``.\n\n    It is used in :meth:`~scrapy.core.scheduler.ScrapyPriorityQueue.push`\n    to make up for the removal of its ``priority`` parameter.\n\n*   The ``spider`` attribute has been removed. Use\n    :attr:`crawler.spider <scrapy.core.scheduler.ScrapyPriorityQueue.crawler>`\n    instead.\n\nThe following changes affect specifically the\n:class:`~scrapy.core.scheduler.DownloaderAwarePriorityQueue` class and may\naffect subclasses:\n\n*   A new :attr:`~scrapy.core.scheduler.DownloaderAwarePriorityQueue.pqueues`\n    attribute offers a mapping of downloader slot names to the\n    corresponding instances of\n    :attr:`~scrapy.core.scheduler.DownloaderAwarePriorityQueue.downstream_queue_cls`.\n\n(:issue:`3884`)\n\n.. _release-1.8.2:\n\nScrapy 1.8.2 (2022-03-01)\n-------------------------\n\n**Security bug fixes:**\n\n-   When a :class:`~scrapy.http.Request` object with cookies defined gets a\n    redirect response causing a new :class:`~scrapy.http.Request` object to be\n    scheduled, the cookies defined in the original\n    :class:`~scrapy.http.Request` object are no longer copied into the new\n    :class:`~scrapy.http.Request` object.\n\n    If you manually set the ``Cookie`` header on a\n    :class:`~scrapy.http.Request` object and the domain name of the redirect\n    URL is not an exact match for the domain of the URL of the original\n    :class:`~scrapy.http.Request` object, your ``Cookie`` header is now dropped\n    from the new :class:`~scrapy.http.Request` object.\n\n    The old behavior could be exploited by an attacker to gain access to your\n    cookies. Please, see the `cjvr-mfj7-j4j8 security advisory`_ for more\n    information.\n\n    .. _cjvr-mfj7-j4j8 security advisory: https://github.com/scrapy/scrapy/security/advisories/GHSA-cjvr-mfj7-j4j8\n\n    .. note:: It is still possible to enable the sharing of cookies between\n              different domains with a shared domain suffix (e.g.\n              ``example.com`` and any subdomain) by defining the shared domain\n              suffix (e.g. ``example.com``) as the cookie domain when defining\n              your cookies. See the documentation of the\n              :class:`~scrapy.http.Request` class for more information.\n\n\n.. _release-1.8.1:\n\nScrapy 1.8.1 (2021-10-05)\n-------------------------\n\n*   **Security bug fix:**\n\n    If you use\n    :class:`~scrapy.downloadermiddlewares.httpauth.HttpAuthMiddleware`\n    (i.e. the ``http_user`` and ``http_pass`` spider attributes) for HTTP\n    authentication, any request exposes your credentials to the request target.\n\n    To prevent unintended exposure of authentication credentials to unintended\n    domains, you must now additionally set a new, additional spider attribute,\n    ``http_auth_domain``, and point it to the specific domain to which the\n    authentication credentials must be sent.\n\n    If the ``http_auth_domain`` spider attribute is not set, the domain of the\n    first request will be considered the HTTP authentication target, and\n    authentication credentials will only be sent in requests targeting that\n    domain.\n\n    If you need to send the same HTTP authentication credentials to multiple\n    domains, you can use :func:`w3lib.http.basic_auth_header` instead to\n    set the value of the ``Authorization`` header of your requests.\n\n    If you *really* want your spider to send the same HTTP authentication\n    credentials to any domain, set the ``http_auth_domain`` spider attribute\n    to ``None``.\n\n    Finally, if you are a user of `scrapy-splash`_, know that this version of\n    Scrapy breaks compatibility with scrapy-splash 0.7.2 and earlier. You will\n    need to upgrade scrapy-splash to a greater version for it to continue to\n    work.\n\n.. _scrapy-splash: https://github.com/scrapy-plugins/scrapy-splash\n\n\n.. _release-1.8.0:\n\nScrapy 1.8.0 (2019-10-28)\n-------------------------\n\nHighlights:\n\n* Dropped Python 3.4 support and updated minimum requirements; made Python 3.8\n  support official\n* New :meth:`Request.from_curl <scrapy.http.Request.from_curl>` class method\n* New :setting:`ROBOTSTXT_PARSER` and :setting:`ROBOTSTXT_USER_AGENT` settings\n* New :setting:`DOWNLOADER_CLIENT_TLS_CIPHERS` and\n  :setting:`DOWNLOADER_CLIENT_TLS_VERBOSE_LOGGING` settings\n\nBackward-incompatible changes\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n*   Python 3.4 is no longer supported, and some of the minimum requirements of\n    Scrapy have also changed:\n\n    *   :doc:`cssselect <cssselect:index>` 0.9.1\n    *   cryptography_ 2.0\n    *   lxml_ 3.5.0\n    *   pyOpenSSL_ 16.2.0\n    *   queuelib_ 1.4.2\n    *   service_identity_ 16.0.0\n    *   six_ 1.10.0\n    *   Twisted_ 17.9.0 (16.0.0 with Python 2)\n    *   zope.interface_ 4.1.3\n\n    (:issue:`3892`)\n\n*   ``JSONRequest`` is now called :class:`~scrapy.http.JsonRequest` for\n    consistency with similar classes (:issue:`3929`, :issue:`3982`)\n\n*   If you are using a custom context factory\n    (:setting:`DOWNLOADER_CLIENTCONTEXTFACTORY`), its ``__init__`` method must\n    accept two new parameters: ``tls_verbose_logging`` and ``tls_ciphers``\n    (:issue:`2111`, :issue:`3392`, :issue:`3442`, :issue:`3450`)\n\n*   :class:`~scrapy.loader.ItemLoader` now turns the values of its input item\n    into lists:\n\n    >>> item = MyItem()\n    >>> item['field'] = 'value1'\n    >>> loader = ItemLoader(item=item)\n    >>> item['field']\n    ['value1']\n\n    This is needed to allow adding values to existing fields\n    (``loader.add_value('field', 'value2')``).\n\n    (:issue:`3804`, :issue:`3819`, :issue:`3897`, :issue:`3976`, :issue:`3998`,\n    :issue:`4036`)\n\nSee also :ref:`1.8-deprecation-removals` below.\n\n\nNew features\n~~~~~~~~~~~~\n\n*   A new :meth:`Request.from_curl <scrapy.http.Request.from_curl>` class\n    method allows :ref:`creating a request from a cURL command\n    <requests-from-curl>` (:issue:`2985`, :issue:`3862`)\n\n*   A new :setting:`ROBOTSTXT_PARSER` setting allows choosing which robots.txt_\n    parser to use. It includes built-in support for\n    :ref:`RobotFileParser <python-robotfileparser>`,\n    :ref:`Protego <protego-parser>` (default), :ref:`Reppy <reppy-parser>`, and\n    :ref:`Robotexclusionrulesparser <rerp-parser>`, and allows you to\n    :ref:`implement support for additional parsers\n    <support-for-new-robots-parser>` (:issue:`754`, :issue:`2669`,\n    :issue:`3796`, :issue:`3935`, :issue:`3969`, :issue:`4006`)\n\n*   A new :setting:`ROBOTSTXT_USER_AGENT` setting allows defining a separate\n    user agent string to use for robots.txt_ parsing (:issue:`3931`,\n    :issue:`3966`)\n\n*   :class:`~scrapy.spiders.Rule` no longer requires a :class:`LinkExtractor\n    <scrapy.linkextractors.lxmlhtml.LxmlLinkExtractor>` parameter\n    (:issue:`781`, :issue:`4016`)\n\n*   Use the new :setting:`DOWNLOADER_CLIENT_TLS_CIPHERS` setting to customize\n    the TLS/SSL ciphers used by the default HTTP/1.1 downloader (:issue:`3392`,\n    :issue:`3442`)\n\n*   Set the new :setting:`DOWNLOADER_CLIENT_TLS_VERBOSE_LOGGING` setting to\n    ``True`` to enable debug-level messages about TLS connection parameters\n    after establishing HTTPS connections (:issue:`2111`, :issue:`3450`)\n\n*   Callbacks that receive keyword arguments\n    (see :attr:`Request.cb_kwargs <scrapy.http.Request.cb_kwargs>`) can now be\n    tested using the new :class:`@cb_kwargs\n    <scrapy.contracts.default.CallbackKeywordArgumentsContract>`\n    :ref:`spider contract <topics-contracts>` (:issue:`3985`, :issue:`3988`)\n\n*   When a :class:`@scrapes <scrapy.contracts.default.ScrapesContract>` spider\n    contract fails, all missing fields are now reported (:issue:`766`,\n    :issue:`3939`)\n\n*   :ref:`Custom log formats <custom-log-formats>` can now drop messages by\n    having the corresponding methods of the configured :setting:`LOG_FORMATTER`\n    return ``None`` (:issue:`3984`, :issue:`3987`)\n\n*   A much improved completion definition is now available for Zsh_\n    (:issue:`4069`)\n\n\nBug fixes\n~~~~~~~~~\n\n*   :meth:`ItemLoader.load_item() <scrapy.loader.ItemLoader.load_item>` no\n    longer makes later calls to :meth:`ItemLoader.get_output_value()\n    <scrapy.loader.ItemLoader.get_output_value>` or\n    :meth:`ItemLoader.load_item() <scrapy.loader.ItemLoader.load_item>` return\n    empty data (:issue:`3804`, :issue:`3819`, :issue:`3897`, :issue:`3976`,\n    :issue:`3998`, :issue:`4036`)\n\n*   Fixed :class:`~scrapy.statscollectors.DummyStatsCollector` raising a\n    :exc:`TypeError` exception (:issue:`4007`, :issue:`4052`)\n\n*   :meth:`FilesPipeline.file_path\n    <scrapy.pipelines.files.FilesPipeline.file_path>` and\n    :meth:`ImagesPipeline.file_path\n    <scrapy.pipelines.images.ImagesPipeline.file_path>` no longer choose\n    file extensions that are not `registered with IANA`_ (:issue:`1287`,\n    :issue:`3953`, :issue:`3954`)\n\n*   When using botocore_ to persist files in S3, all botocore-supported headers\n    are properly mapped now (:issue:`3904`, :issue:`3905`)\n\n*   FTP passwords in :setting:`FEED_URI` containing percent-escaped characters\n    are now properly decoded (:issue:`3941`)\n\n*   A memory-handling and error-handling issue in\n    :func:`scrapy.utils.ssl.get_temp_key_info` has been fixed (:issue:`3920`)\n\n\nDocumentation\n~~~~~~~~~~~~~\n\n*   The documentation now covers how to define and configure a :ref:`custom log\n    format <custom-log-formats>` (:issue:`3616`, :issue:`3660`)\n\n*   API documentation added for :class:`~scrapy.exporters.MarshalItemExporter`\n    and :class:`~scrapy.exporters.PythonItemExporter` (:issue:`3973`)\n\n*   API documentation added for :class:`~scrapy.item.BaseItem` and\n    :class:`~scrapy.item.ItemMeta` (:issue:`3999`)\n\n*   Minor documentation fixes (:issue:`2998`, :issue:`3398`, :issue:`3597`,\n    :issue:`3894`, :issue:`3934`, :issue:`3978`, :issue:`3993`, :issue:`4022`,\n    :issue:`4028`, :issue:`4033`, :issue:`4046`, :issue:`4050`, :issue:`4055`,\n    :issue:`4056`, :issue:`4061`, :issue:`4072`, :issue:`4071`, :issue:`4079`,\n    :issue:`4081`, :issue:`4089`, :issue:`4093`)\n\n\n.. _1.8-deprecation-removals:\n\nDeprecation removals\n~~~~~~~~~~~~~~~~~~~~\n\n*   ``scrapy.xlib`` has been removed (:issue:`4015`)\n\n\n.. _1.8-deprecations:\n\nDeprecations\n~~~~~~~~~~~~\n\n*   The LevelDB_ storage backend\n    (``scrapy.extensions.httpcache.LeveldbCacheStorage``) of\n    :class:`~scrapy.downloadermiddlewares.httpcache.HttpCacheMiddleware` is\n    deprecated (:issue:`4085`, :issue:`4092`)\n\n*   Use of the undocumented ``SCRAPY_PICKLED_SETTINGS_TO_OVERRIDE`` environment\n    variable is deprecated (:issue:`3910`)\n\n*   ``scrapy.item.DictItem`` is deprecated, use :class:`~scrapy.item.Item`\n    instead (:issue:`3999`)\n\n\nOther changes\n~~~~~~~~~~~~~\n\n*   Minimum versions of optional Scrapy requirements that are covered by\n    continuous integration tests have been updated:\n\n    *   botocore_ 1.3.23\n    *   Pillow_ 3.4.2\n\n    Lower versions of these optional requirements may work, but it is not\n    guaranteed (:issue:`3892`)\n\n*   GitHub templates for bug reports and feature requests (:issue:`3126`,\n    :issue:`3471`, :issue:`3749`, :issue:`3754`)\n\n*   Continuous integration fixes (:issue:`3923`)\n\n*   Code cleanup (:issue:`3391`, :issue:`3907`, :issue:`3946`, :issue:`3950`,\n    :issue:`4023`, :issue:`4031`)\n\n\n.. _release-1.7.4:\n\nScrapy 1.7.4 (2019-10-21)\n-------------------------\n\nRevert the fix for :issue:`3804` (:issue:`3819`), which has a few undesired\nside effects (:issue:`3897`, :issue:`3976`).\n\nAs a result, when an item loader is initialized with an item,\n:meth:`ItemLoader.load_item() <scrapy.loader.ItemLoader.load_item>` once again\nmakes later calls to :meth:`ItemLoader.get_output_value()\n<scrapy.loader.ItemLoader.get_output_value>` or :meth:`ItemLoader.load_item()\n<scrapy.loader.ItemLoader.load_item>` return empty data.\n\n\n.. _release-1.7.3:\n\nScrapy 1.7.3 (2019-08-01)\n-------------------------\n\nEnforce lxml 4.3.5 or lower for Python 3.4 (:issue:`3912`, :issue:`3918`).\n\n\n.. _release-1.7.2:\n\nScrapy 1.7.2 (2019-07-23)\n-------------------------\n\nFix Python 2 support (:issue:`3889`, :issue:`3893`, :issue:`3896`).\n\n\n.. _release-1.7.1:\n\nScrapy 1.7.1 (2019-07-18)\n-------------------------\n\nRe-packaging of Scrapy 1.7.0, which was missing some changes in PyPI.\n\n\n.. _release-1.7.0:\n\nScrapy 1.7.0 (2019-07-18)\n-------------------------\n\n.. note:: Make sure you install Scrapy 1.7.1. The Scrapy 1.7.0 package in PyPI\n          is the result of an erroneous commit tagging and does not include all\n          the changes described below.\n\nHighlights:\n\n* Improvements for crawls targeting multiple domains\n* A cleaner way to pass arguments to callbacks\n* A new class for JSON requests\n* Improvements for rule-based spiders\n* New features for feed exports\n\nBackward-incompatible changes\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n*   ``429`` is now part of the :setting:`RETRY_HTTP_CODES` setting by default\n\n    This change is **backward incompatible**. If you don\u014c\u0106\u00d6t want to retry\n    ``429``, you must override :setting:`RETRY_HTTP_CODES` accordingly.\n\n*   :class:`~scrapy.crawler.Crawler`,\n    :class:`CrawlerRunner.crawl <scrapy.crawler.CrawlerRunner.crawl>` and\n    :class:`CrawlerRunner.create_crawler <scrapy.crawler.CrawlerRunner.create_crawler>`\n    no longer accept a :class:`~scrapy.spiders.Spider` subclass instance, they\n    only accept a :class:`~scrapy.spiders.Spider` subclass now.\n\n    :class:`~scrapy.spiders.Spider` subclass instances were never meant to\n    work, and they were not working as one would expect: instead of using the\n    passed :class:`~scrapy.spiders.Spider` subclass instance, their\n    :class:`~scrapy.spiders.Spider.from_crawler` method was called to generate\n    a new instance.\n\n*   Non-default values for the :setting:`SCHEDULER_PRIORITY_QUEUE` setting\n    may stop working. Scheduler priority queue classes now need to handle\n    :class:`~scrapy.http.Request` objects instead of arbitrary Python data\n    structures.\n\n*   An additional ``crawler`` parameter has been added to the ``__init__``\n    method of the :class:`~scrapy.core.scheduler.Scheduler` class. Custom\n    scheduler subclasses which don't accept arbitrary parameters in their\n    ``__init__`` method might break because of this change.\n\n    For more information, see :setting:`SCHEDULER`.\n\nSee also :ref:`1.7-deprecation-removals` below.\n\n\nNew features\n~~~~~~~~~~~~\n\n*   A new scheduler priority queue,\n    ``scrapy.pqueues.DownloaderAwarePriorityQueue``, may be\n    :ref:`enabled <broad-crawls-scheduler-priority-queue>` for a significant\n    scheduling improvement on crawls targeting multiple web domains, at the\n    cost of no :setting:`CONCURRENT_REQUESTS_PER_IP` support (:issue:`3520`)\n\n*   A new :attr:`Request.cb_kwargs <scrapy.http.Request.cb_kwargs>` attribute\n    provides a cleaner way to pass keyword arguments to callback methods\n    (:issue:`1138`, :issue:`3563`)\n\n*   A new :class:`JSONRequest <scrapy.http.JsonRequest>` class offers a more\n    convenient way to build JSON requests (:issue:`3504`, :issue:`3505`)\n\n*   A ``process_request`` callback passed to the :class:`~scrapy.spiders.Rule`\n    ``__init__`` method now receives the :class:`~scrapy.http.Response` object that\n    originated the request as its second argument (:issue:`3682`)\n\n*   A new ``restrict_text`` parameter for the\n    :attr:`LinkExtractor <scrapy.linkextractors.lxmlhtml.LxmlLinkExtractor>`\n    ``__init__`` method allows filtering links by linking text (:issue:`3622`,\n    :issue:`3635`)\n\n*   A new :setting:`FEED_STORAGE_S3_ACL` setting allows defining a custom ACL\n    for feeds exported to Amazon S3 (:issue:`3607`)\n\n*   A new :setting:`FEED_STORAGE_FTP_ACTIVE` setting allows using FTP\u014c\u0106\u00d6s active\n    connection mode for feeds exported to FTP servers (:issue:`3829`)\n\n*   A new :setting:`METAREFRESH_IGNORE_TAGS` setting allows overriding which\n    HTML tags are ignored when searching a response for HTML meta tags that\n    trigger a redirect (:issue:`1422`, :issue:`3768`)\n\n*   A new :reqmeta:`redirect_reasons` request meta key exposes the reason\n    (status code, meta refresh) behind every followed redirect (:issue:`3581`,\n    :issue:`3687`)\n\n*   The ``SCRAPY_CHECK`` variable is now set to the ``true`` string during runs\n    of the :command:`check` command, which allows :ref:`detecting contract\n    check runs from code <detecting-contract-check-runs>` (:issue:`3704`,\n    :issue:`3739`)\n\n*   A new :meth:`Item.deepcopy() <scrapy.item.Item.deepcopy>` method makes it\n    easier to :ref:`deep-copy items <copying-items>` (:issue:`1493`,\n    :issue:`3671`)\n\n*   :class:`~scrapy.extensions.corestats.CoreStats` also logs\n    ``elapsed_time_seconds`` now (:issue:`3638`)\n\n*   Exceptions from :class:`~scrapy.loader.ItemLoader` :ref:`input and output\n    processors <topics-loaders-processors>` are now more verbose\n    (:issue:`3836`, :issue:`3840`)\n\n*   :class:`~scrapy.crawler.Crawler`,\n    :class:`CrawlerRunner.crawl <scrapy.crawler.CrawlerRunner.crawl>` and\n    :class:`CrawlerRunner.create_crawler <scrapy.crawler.CrawlerRunner.create_crawler>`\n    now fail gracefully if they receive a :class:`~scrapy.spiders.Spider`\n    subclass instance instead of the subclass itself (:issue:`2283`,\n    :issue:`3610`, :issue:`3872`)\n\n\nBug fixes\n~~~~~~~~~\n\n*   :meth:`~scrapy.spidermiddlewares.SpiderMiddleware.process_spider_exception`\n    is now also invoked for generators (:issue:`220`, :issue:`2061`)\n\n*   System exceptions like KeyboardInterrupt_ are no longer caught\n    (:issue:`3726`)\n\n*   :meth:`ItemLoader.load_item() <scrapy.loader.ItemLoader.load_item>` no\n    longer makes later calls to :meth:`ItemLoader.get_output_value()\n    <scrapy.loader.ItemLoader.get_output_value>` or\n    :meth:`ItemLoader.load_item() <scrapy.loader.ItemLoader.load_item>` return\n    empty data (:issue:`3804`, :issue:`3819`)\n\n*   The images pipeline (:class:`~scrapy.pipelines.images.ImagesPipeline`) no\n    longer ignores these Amazon S3 settings: :setting:`AWS_ENDPOINT_URL`,\n    :setting:`AWS_REGION_NAME`, :setting:`AWS_USE_SSL`, :setting:`AWS_VERIFY`\n    (:issue:`3625`)\n\n*   Fixed a memory leak in ``scrapy.pipelines.media.MediaPipeline`` affecting,\n    for example, non-200 responses and exceptions from custom middlewares\n    (:issue:`3813`)\n\n*   Requests with private callbacks are now correctly unserialized from disk\n    (:issue:`3790`)\n\n*   :meth:`FormRequest.from_response() <scrapy.http.FormRequest.from_response>`\n    now handles invalid methods like major web browsers (:issue:`3777`,\n    :issue:`3794`)\n\n\nDocumentation\n~~~~~~~~~~~~~\n\n*   A new topic, :ref:`topics-dynamic-content`, covers recommended approaches\n    to read dynamically-loaded data (:issue:`3703`)\n\n*   :ref:`topics-broad-crawls` now features information about memory usage\n    (:issue:`1264`, :issue:`3866`)\n\n*   The documentation of :class:`~scrapy.spiders.Rule` now covers how to access\n    the text of a link when using :class:`~scrapy.spiders.CrawlSpider`\n    (:issue:`3711`, :issue:`3712`)\n\n*   A new section, :ref:`httpcache-storage-custom`, covers writing a custom\n    cache storage backend for\n    :class:`~scrapy.downloadermiddlewares.httpcache.HttpCacheMiddleware`\n    (:issue:`3683`, :issue:`3692`)\n\n*   A new :ref:`FAQ <faq>` entry, :ref:`faq-split-item`, explains what to do\n    when you want to split an item into multiple items from an item pipeline\n    (:issue:`2240`, :issue:`3672`)\n\n*   Updated the :ref:`FAQ entry about crawl order <faq-bfo-dfo>` to explain why\n    the first few requests rarely follow the desired order (:issue:`1739`,\n    :issue:`3621`)\n\n*   The :setting:`LOGSTATS_INTERVAL` setting (:issue:`3730`), the\n    :meth:`FilesPipeline.file_path <scrapy.pipelines.files.FilesPipeline.file_path>`\n    and\n    :meth:`ImagesPipeline.file_path <scrapy.pipelines.images.ImagesPipeline.file_path>`\n    methods (:issue:`2253`, :issue:`3609`) and the\n    :meth:`Crawler.stop() <scrapy.crawler.Crawler.stop>` method (:issue:`3842`)\n    are now documented\n\n*   Some parts of the documentation that were confusing or misleading are now\n    clearer (:issue:`1347`, :issue:`1789`, :issue:`2289`, :issue:`3069`,\n    :issue:`3615`, :issue:`3626`, :issue:`3668`, :issue:`3670`, :issue:`3673`,\n    :issue:`3728`, :issue:`3762`, :issue:`3861`, :issue:`3882`)\n\n*   Minor documentation fixes (:issue:`3648`, :issue:`3649`, :issue:`3662`,\n    :issue:`3674`, :issue:`3676`, :issue:`3694`, :issue:`3724`, :issue:`3764`,\n    :issue:`3767`, :issue:`3791`, :issue:`3797`, :issue:`3806`, :issue:`3812`)\n\n.. _1.7-deprecation-removals:\n\nDeprecation removals\n~~~~~~~~~~~~~~~~~~~~\n\nThe following deprecated APIs have been removed (:issue:`3578`):\n\n*   ``scrapy.conf`` (use :attr:`Crawler.settings\n    <scrapy.crawler.Crawler.settings>`)\n\n*   From ``scrapy.core.downloader.handlers``:\n\n    *   ``http.HttpDownloadHandler`` (use ``http10.HTTP10DownloadHandler``)\n\n*   ``scrapy.loader.ItemLoader._get_values`` (use ``_get_xpathvalues``)\n\n*   ``scrapy.loader.XPathItemLoader`` (use :class:`~scrapy.loader.ItemLoader`)\n\n*   ``scrapy.log`` (see :ref:`topics-logging`)\n\n*   From ``scrapy.pipelines``:\n\n    *   ``files.FilesPipeline.file_key`` (use ``file_path``)\n\n    *   ``images.ImagesPipeline.file_key`` (use ``file_path``)\n\n    *   ``images.ImagesPipeline.image_key`` (use ``file_path``)\n\n    *   ``images.ImagesPipeline.thumb_key`` (use ``thumb_path``)\n\n*   From both ``scrapy.selector`` and ``scrapy.selector.lxmlsel``:\n\n    *   ``HtmlXPathSelector`` (use :class:`~scrapy.selector.Selector`)\n\n    *   ``XmlXPathSelector`` (use :class:`~scrapy.selector.Selector`)\n\n    *   ``XPathSelector`` (use :class:`~scrapy.selector.Selector`)\n\n    *   ``XPathSelectorList`` (use :class:`~scrapy.selector.Selector`)\n\n*   From ``scrapy.selector.csstranslator``:\n\n    *   ``ScrapyGenericTranslator`` (use parsel.csstranslator.GenericTranslator_)\n\n    *   ``ScrapyHTMLTranslator`` (use parsel.csstranslator.HTMLTranslator_)\n\n    *   ``ScrapyXPathExpr`` (use parsel.csstranslator.XPathExpr_)\n\n*   From :class:`~scrapy.selector.Selector`:\n\n    *   ``_root`` (both the ``__init__`` method argument and the object property, use\n        ``root``)\n\n    *   ``extract_unquoted`` (use ``getall``)\n\n    *   ``select`` (use ``xpath``)\n\n*   From :class:`~scrapy.selector.SelectorList`:\n\n    *   ``extract_unquoted`` (use ``getall``)\n\n    *   ``select`` (use ``xpath``)\n\n    *   ``x`` (use ``xpath``)\n\n*   ``scrapy.spiders.BaseSpider`` (use :class:`~scrapy.spiders.Spider`)\n\n*   From :class:`~scrapy.spiders.Spider` (and subclasses):\n\n    *   ``DOWNLOAD_DELAY`` (use :ref:`download_delay\n        <spider-download_delay-attribute>`)\n\n    *   ``set_crawler`` (use :meth:`~scrapy.spiders.Spider.from_crawler`)\n\n*   ``scrapy.spiders.spiders`` (use :class:`~scrapy.spiderloader.SpiderLoader`)\n\n*   ``scrapy.telnet`` (use :mod:`scrapy.extensions.telnet`)\n\n*   From ``scrapy.utils.python``:\n\n    *   ``str_to_unicode`` (use ``to_unicode``)\n\n    *   ``unicode_to_str`` (use ``to_bytes``)\n\n*   ``scrapy.utils.response.body_or_str``\n\nThe following deprecated settings have also been removed (:issue:`3578`):\n\n*   ``SPIDER_MANAGER_CLASS`` (use :setting:`SPIDER_LOADER_CLASS`)\n\n\n.. _1.7-deprecations:\n\nDeprecations\n~~~~~~~~~~~~\n\n*   The ``queuelib.PriorityQueue`` value for the\n    :setting:`SCHEDULER_PRIORITY_QUEUE` setting is deprecated. Use\n    ``scrapy.pqueues.ScrapyPriorityQueue`` instead.\n\n*   ``process_request`` callbacks passed to :class:`~scrapy.spiders.Rule` that\n    do not accept two arguments are deprecated.\n\n*   The following modules are deprecated:\n\n    *   ``scrapy.utils.http`` (use `w3lib.http`_)\n\n    *   ``scrapy.utils.markup`` (use `w3lib.html`_)\n\n    *   ``scrapy.utils.multipart`` (use `urllib3`_)\n\n*   The ``scrapy.utils.datatypes.MergeDict`` class is deprecated for Python 3\n    code bases. Use :class:`~collections.ChainMap` instead. (:issue:`3878`)\n\n*   The ``scrapy.utils.gz.is_gzipped`` function is deprecated. Use\n    ``scrapy.utils.gz.gzip_magic_number`` instead.\n\n.. _urllib3: https://urllib3.readthedocs.io/en/latest/index.html\n.. _w3lib.html: https://w3lib.readthedocs.io/en/latest/w3lib.html#module-w3lib.html\n.. _w3lib.http: https://w3lib.readthedocs.io/en/latest/w3lib.html#module-w3lib.http\n\n\nOther changes\n~~~~~~~~~~~~~\n\n*   It is now possible to run all tests from the same tox_ environment in\n    parallel; the documentation now covers :ref:`this and other ways to run\n    tests <running-tests>` (:issue:`3707`)\n\n*   It is now possible to generate an API documentation coverage report\n    (:issue:`3806`, :issue:`3810`, :issue:`3860`)\n\n*   The :ref:`documentation policies <documentation-policies>` now require\n    docstrings_ (:issue:`3701`) that follow `PEP 257`_ (:issue:`3748`)\n\n*   Internal fixes and cleanup (:issue:`3629`, :issue:`3643`, :issue:`3684`,\n    :issue:`3698`, :issue:`3734`, :issue:`3735`, :issue:`3736`, :issue:`3737`,\n    :issue:`3809`, :issue:`3821`, :issue:`3825`, :issue:`3827`, :issue:`3833`,\n    :issue:`3857`, :issue:`3877`)\n\n.. _release-1.6.0:\n\nScrapy 1.6.0 (2019-01-30)\n-------------------------\n\nHighlights:\n\n* better Windows support;\n* Python 3.7 compatibility;\n* big documentation improvements, including a switch\n  from ``.extract_first()`` + ``.extract()`` API to ``.get()`` + ``.getall()``\n  API;\n* feed exports, FilePipeline and MediaPipeline improvements;\n* better extensibility: :signal:`item_error` and\n  :signal:`request_reached_downloader` signals; ``from_crawler`` support\n  for feed exporters, feed storages and dupefilters.\n* ``scrapy.contracts`` fixes and new features;\n* telnet console security improvements, first released as a\n  backport in :ref:`release-1.5.2`;\n* clean-up of the deprecated code;\n* various bug fixes, small new features and usability improvements across\n  the codebase.\n\nSelector API changes\n~~~~~~~~~~~~~~~~~~~~\n\nWhile these are not changes in Scrapy itself, but rather in the parsel_\nlibrary which Scrapy uses for xpath/css selectors, these changes are\nworth mentioning here. Scrapy now depends on parsel >= 1.5, and\nScrapy documentation is updated to follow recent ``parsel`` API conventions.\n\nMost visible change is that ``.get()`` and ``.getall()`` selector\nmethods are now preferred over ``.extract_first()`` and ``.extract()``.\nWe feel that these new methods result in a more concise and readable code.\nSee :ref:`old-extraction-api` for more details.\n\n.. note::\n    There are currently **no plans** to deprecate ``.extract()``\n    and ``.extract_first()`` methods.\n\nAnother useful new feature is the introduction of ``Selector.attrib`` and\n``SelectorList.attrib`` properties, which make it easier to get\nattributes of HTML elements. See :ref:`selecting-attributes`.\n\nCSS selectors are cached in parsel >= 1.5, which makes them faster\nwhen the same CSS path is used many times. This is very common in\ncase of Scrapy spiders: callbacks are usually called several times,\non different pages.\n\nIf you're using custom ``Selector`` or ``SelectorList`` subclasses,\na **backward incompatible** change in parsel may affect your code.\nSee `parsel changelog`_ for a detailed description, as well as for the\nfull list of improvements.\n\n.. _parsel changelog: https://parsel.readthedocs.io/en/latest/history.html\n\nTelnet console\n~~~~~~~~~~~~~~\n\n**Backward incompatible**: Scrapy's telnet console now requires username\nand password. See :ref:`topics-telnetconsole` for more details. This change\nfixes a **security issue**; see :ref:`release-1.5.2` release notes for details.\n\nNew extensibility features\n~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n* ``from_crawler`` support is added to feed exporters and feed storages. This,\n  among other things, allows to access Scrapy settings from custom feed\n  storages and exporters (:issue:`1605`, :issue:`3348`).\n* ``from_crawler`` support is added to dupefilters (:issue:`2956`); this allows\n  to access e.g. settings or a spider from a dupefilter.\n* :signal:`item_error` is fired when an error happens in a pipeline\n  (:issue:`3256`);\n* :signal:`request_reached_downloader` is fired when Downloader gets\n  a new Request; this signal can be useful e.g. for custom Schedulers\n  (:issue:`3393`).\n* new SitemapSpider :meth:`~.SitemapSpider.sitemap_filter` method which allows\n  to select sitemap entries based on their attributes in SitemapSpider\n  subclasses (:issue:`3512`).\n* Lazy loading of Downloader Handlers is now optional; this enables better\n  initialization error handling in custom Downloader Handlers (:issue:`3394`).\n\nNew FilePipeline and MediaPipeline features\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n* Expose more options for S3FilesStore: :setting:`AWS_ENDPOINT_URL`,\n  :setting:`AWS_USE_SSL`, :setting:`AWS_VERIFY`, :setting:`AWS_REGION_NAME`.\n  For example, this allows to use alternative or self-hosted\n  AWS-compatible providers (:issue:`2609`, :issue:`3548`).\n* ACL support for Google Cloud Storage: :setting:`FILES_STORE_GCS_ACL` and\n  :setting:`IMAGES_STORE_GCS_ACL` (:issue:`3199`).\n\n``scrapy.contracts`` improvements\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n* Exceptions in contracts code are handled better (:issue:`3377`);\n* ``dont_filter=True`` is used for contract requests, which allows to test\n  different callbacks with the same URL (:issue:`3381`);\n* ``request_cls`` attribute in Contract subclasses allow to use different\n  Request classes in contracts, for example FormRequest (:issue:`3383`).\n* Fixed errback handling in contracts, e.g. for cases where a contract\n  is executed for URL which returns non-200 response (:issue:`3371`).\n\nUsability improvements\n~~~~~~~~~~~~~~~~~~~~~~\n\n* more stats for RobotsTxtMiddleware (:issue:`3100`)\n* INFO log level is used to show telnet host/port (:issue:`3115`)\n* a message is added to IgnoreRequest in RobotsTxtMiddleware (:issue:`3113`)\n* better validation of ``url`` argument in ``Response.follow`` (:issue:`3131`)\n* non-zero exit code is returned from Scrapy commands when error happens\n  on spider initialization (:issue:`3226`)\n* Link extraction improvements: \"ftp\" is added to scheme list (:issue:`3152`);\n  \"flv\" is added to common video extensions (:issue:`3165`)\n* better error message when an exporter is disabled (:issue:`3358`);\n* ``scrapy shell --help`` mentions syntax required for local files\n  (``./file.html``) - :issue:`3496`.\n* Referer header value is added to RFPDupeFilter log messages (:issue:`3588`)\n\nBug fixes\n~~~~~~~~~\n\n* fixed issue with extra blank lines in .csv exports under Windows\n  (:issue:`3039`);\n* proper handling of pickling errors in Python 3 when serializing objects\n  for disk queues (:issue:`3082`)\n* flags are now preserved when copying Requests (:issue:`3342`);\n* FormRequest.from_response clickdata shouldn't ignore elements with\n  ``input[type=image]`` (:issue:`3153`).\n* FormRequest.from_response should preserve duplicate keys (:issue:`3247`)\n\nDocumentation improvements\n~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n* Docs are re-written to suggest .get/.getall API instead of\n  .extract/.extract_first. Also, :ref:`topics-selectors` docs are updated\n  and re-structured to match latest parsel docs; they now contain more topics,\n  such as :ref:`selecting-attributes` or :ref:`topics-selectors-css-extensions`\n  (:issue:`3390`).\n* :ref:`topics-developer-tools` is a new tutorial which replaces\n  old Firefox and Firebug tutorials (:issue:`3400`).\n* SCRAPY_PROJECT environment variable is documented (:issue:`3518`);\n* troubleshooting section is added to install instructions (:issue:`3517`);\n* improved links to beginner resources in the tutorial\n  (:issue:`3367`, :issue:`3468`);\n* fixed :setting:`RETRY_HTTP_CODES` default values in docs (:issue:`3335`);\n* remove unused ``DEPTH_STATS`` option from docs (:issue:`3245`);\n* other cleanups (:issue:`3347`, :issue:`3350`, :issue:`3445`, :issue:`3544`,\n  :issue:`3605`).\n\nDeprecation removals\n~~~~~~~~~~~~~~~~~~~~\n\nCompatibility shims for pre-1.0 Scrapy module names are removed\n(:issue:`3318`):\n\n* ``scrapy.command``\n* ``scrapy.contrib`` (with all submodules)\n* ``scrapy.contrib_exp`` (with all submodules)\n* ``scrapy.dupefilter``\n* ``scrapy.linkextractor``\n* ``scrapy.project``\n* ``scrapy.spider``\n* ``scrapy.spidermanager``\n* ``scrapy.squeue``\n* ``scrapy.stats``\n* ``scrapy.statscol``\n* ``scrapy.utils.decorator``\n\nSee :ref:`module-relocations` for more information, or use suggestions\nfrom Scrapy 1.5.x deprecation warnings to update your code.\n\nOther deprecation removals:\n\n* Deprecated scrapy.interfaces.ISpiderManager is removed; please use\n  scrapy.interfaces.ISpiderLoader.\n* Deprecated ``CrawlerSettings`` class is removed (:issue:`3327`).\n* Deprecated ``Settings.overrides`` and ``Settings.defaults`` attributes\n  are removed (:issue:`3327`, :issue:`3359`).\n\nOther improvements, cleanups\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n* All Scrapy tests now pass on Windows; Scrapy testing suite is executed\n  in a Windows environment on CI (:issue:`3315`).\n* Python 3.7 support (:issue:`3326`, :issue:`3150`, :issue:`3547`).\n* Testing and CI fixes (:issue:`3526`, :issue:`3538`, :issue:`3308`,\n  :issue:`3311`, :issue:`3309`, :issue:`3305`, :issue:`3210`, :issue:`3299`)\n* ``scrapy.http.cookies.CookieJar.clear`` accepts \"domain\", \"path\" and \"name\"\n  optional arguments (:issue:`3231`).\n* additional files are included to sdist (:issue:`3495`);\n* code style fixes (:issue:`3405`, :issue:`3304`);\n* unneeded .strip() call is removed (:issue:`3519`);\n* collections.deque is used to store MiddlewareManager methods instead\n  of a list (:issue:`3476`)\n\n.. _release-1.5.2:\n\nScrapy 1.5.2 (2019-01-22)\n-------------------------\n\n* *Security bugfix*: Telnet console extension can be easily exploited by rogue\n  websites POSTing content to http://localhost:6023, we haven't found a way to\n  exploit it from Scrapy, but it is very easy to trick a browser to do so and\n  elevates the risk for local development environment.\n\n  *The fix is backward incompatible*, it enables telnet user-password\n  authentication by default with a random generated password. If you can't\n  upgrade right away, please consider setting :setting:`TELNETCONSOLE_PORT`\n  out of its default value.\n\n  See :ref:`telnet console <topics-telnetconsole>` documentation for more info\n\n* Backport CI build failure under GCE environment due to boto import error.\n\n.. _release-1.5.1:\n\nScrapy 1.5.1 (2018-07-12)\n-------------------------\n\nThis is a maintenance release with important bug fixes, but no new features:\n\n* ``O(N^2)`` gzip decompression issue which affected Python 3 and PyPy\n  is fixed (:issue:`3281`);\n* skipping of TLS validation errors is improved (:issue:`3166`);\n* Ctrl-C handling is fixed in Python 3.5+ (:issue:`3096`);\n* testing fixes (:issue:`3092`, :issue:`3263`);\n* documentation improvements (:issue:`3058`, :issue:`3059`, :issue:`3089`,\n  :issue:`3123`, :issue:`3127`, :issue:`3189`, :issue:`3224`, :issue:`3280`,\n  :issue:`3279`, :issue:`3201`, :issue:`3260`, :issue:`3284`, :issue:`3298`,\n  :issue:`3294`).\n\n\n.. _release-1.5.0:\n\nScrapy 1.5.0 (2017-12-29)\n-------------------------\n\nThis release brings small new features and improvements across the codebase.\nSome highlights:\n\n* Google Cloud Storage is supported in FilesPipeline and ImagesPipeline.\n* Crawling with proxy servers becomes more efficient, as connections\n  to proxies can be reused now.\n* Warnings, exception and logging messages are improved to make debugging\n  easier.\n* ``scrapy parse`` command now allows to set custom request meta via\n  ``--meta`` argument.\n* Compatibility with Python 3.6, PyPy and PyPy3 is improved;\n  PyPy and PyPy3 are now supported officially, by running tests on CI.\n* Better default handling of HTTP 308, 522 and 524 status codes.\n* Documentation is improved, as usual.\n\nBackward Incompatible Changes\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n* Scrapy 1.5 drops support for Python 3.3.\n* Default Scrapy User-Agent now uses https link to scrapy.org (:issue:`2983`).\n  **This is technically backward-incompatible**; override\n  :setting:`USER_AGENT` if you relied on old value.\n* Logging of settings overridden by ``custom_settings`` is fixed;\n  **this is technically backward-incompatible** because the logger\n  changes from ``[scrapy.utils.log]`` to ``[scrapy.crawler]``. If you're\n  parsing Scrapy logs, please update your log parsers (:issue:`1343`).\n* LinkExtractor now ignores ``m4v`` extension by default, this is change\n  in behavior.\n* 522 and 524 status codes are added to ``RETRY_HTTP_CODES`` (:issue:`2851`)\n\nNew features\n~~~~~~~~~~~~\n\n- Support ``<link>`` tags in ``Response.follow`` (:issue:`2785`)\n- Support for ``ptpython`` REPL (:issue:`2654`)\n- Google Cloud Storage support for FilesPipeline and ImagesPipeline\n  (:issue:`2923`).\n- New ``--meta`` option of the \"scrapy parse\" command allows to pass additional\n  request.meta (:issue:`2883`)\n- Populate spider variable when using ``shell.inspect_response`` (:issue:`2812`)\n- Handle HTTP 308 Permanent Redirect (:issue:`2844`)\n- Add 522 and 524 to ``RETRY_HTTP_CODES`` (:issue:`2851`)\n- Log versions information at startup (:issue:`2857`)\n- ``scrapy.mail.MailSender`` now works in Python 3 (it requires Twisted 17.9.0)\n- Connections to proxy servers are reused (:issue:`2743`)\n- Add template for a downloader middleware (:issue:`2755`)\n- Explicit message for NotImplementedError when parse callback not defined\n  (:issue:`2831`)\n- CrawlerProcess got an option to disable installation of root log handler\n  (:issue:`2921`)\n- LinkExtractor now ignores ``m4v`` extension by default\n- Better log messages for responses over :setting:`DOWNLOAD_WARNSIZE` and\n  :setting:`DOWNLOAD_MAXSIZE` limits (:issue:`2927`)\n- Show warning when a URL is put to ``Spider.allowed_domains`` instead of\n  a domain (:issue:`2250`).\n\nBug fixes\n~~~~~~~~~\n\n- Fix logging of settings overridden by ``custom_settings``;\n  **this is technically backward-incompatible** because the logger\n  changes from ``[scrapy.utils.log]`` to ``[scrapy.crawler]``, so please\n  update your log parsers if needed (:issue:`1343`)\n- Default Scrapy User-Agent now uses https link to scrapy.org (:issue:`2983`).\n  **This is technically backward-incompatible**; override\n  :setting:`USER_AGENT` if you relied on old value.\n- Fix PyPy and PyPy3 test failures, support them officially\n  (:issue:`2793`, :issue:`2935`, :issue:`2990`, :issue:`3050`, :issue:`2213`,\n  :issue:`3048`)\n- Fix DNS resolver when ``DNSCACHE_ENABLED=False`` (:issue:`2811`)\n- Add ``cryptography`` for Debian Jessie tox test env (:issue:`2848`)\n- Add verification to check if Request callback is callable (:issue:`2766`)\n- Port ``extras/qpsclient.py`` to Python 3 (:issue:`2849`)\n- Use getfullargspec under the scenes for Python 3 to stop DeprecationWarning\n  (:issue:`2862`)\n- Update deprecated test aliases (:issue:`2876`)\n- Fix ``SitemapSpider`` support for alternate links (:issue:`2853`)\n\nDocs\n~~~~\n\n- Added missing bullet point for the ``AUTOTHROTTLE_TARGET_CONCURRENCY``\n  setting. (:issue:`2756`)\n- Update Contributing docs, document new support channels\n  (:issue:`2762`, issue:`3038`)\n- Include references to Scrapy subreddit in the docs\n- Fix broken links; use https:// for external links\n  (:issue:`2978`, :issue:`2982`, :issue:`2958`)\n- Document CloseSpider extension better (:issue:`2759`)\n- Use ``pymongo.collection.Collection.insert_one()`` in MongoDB example\n  (:issue:`2781`)\n- Spelling mistake and typos\n  (:issue:`2828`, :issue:`2837`, :issue:`2884`, :issue:`2924`)\n- Clarify ``CSVFeedSpider.headers`` documentation (:issue:`2826`)\n- Document ``DontCloseSpider`` exception and clarify ``spider_idle``\n  (:issue:`2791`)\n- Update \"Releases\" section in README (:issue:`2764`)\n- Fix rst syntax in ``DOWNLOAD_FAIL_ON_DATALOSS`` docs (:issue:`2763`)\n- Small fix in description of startproject arguments (:issue:`2866`)\n- Clarify data types in Response.body docs (:issue:`2922`)\n- Add a note about ``request.meta['depth']`` to DepthMiddleware docs (:issue:`2374`)\n- Add a note about ``request.meta['dont_merge_cookies']`` to CookiesMiddleware\n  docs (:issue:`2999`)\n- Up-to-date example of project structure (:issue:`2964`, :issue:`2976`)\n- A better example of ItemExporters usage (:issue:`2989`)\n- Document ``from_crawler`` methods for spider and downloader middlewares\n  (:issue:`3019`)\n\n.. _release-1.4.0:\n\nScrapy 1.4.0 (2017-05-18)\n-------------------------\n\nScrapy 1.4 does not bring that many breathtaking new features\nbut quite a few handy improvements nonetheless.\n\nScrapy now supports anonymous FTP sessions with customizable user and\npassword via the new :setting:`FTP_USER` and :setting:`FTP_PASSWORD` settings.\nAnd if you're using Twisted version 17.1.0 or above, FTP is now available\nwith Python 3.\n\nThere's a new :meth:`response.follow <scrapy.http.TextResponse.follow>` method\nfor creating requests; **it is now a recommended way to create Requests\nin Scrapy spiders**. This method makes it easier to write correct\nspiders; ``response.follow`` has several advantages over creating\n``scrapy.Request`` objects directly:\n\n* it handles relative URLs;\n* it works properly with non-ascii URLs on non-UTF8 pages;\n* in addition to absolute and relative URLs it supports Selectors;\n  for ``<a>`` elements it can also extract their href values.\n\nFor example, instead of this::\n\n    for href in response.css('li.page a::attr(href)').extract():\n        url = response.urljoin(href)\n        yield scrapy.Request(url, self.parse, encoding=response.encoding)\n\nOne can now write this::\n\n    for a in response.css('li.page a'):\n        yield response.follow(a, self.parse)\n\nLink extractors are also improved. They work similarly to what a regular\nmodern browser would do: leading and trailing whitespace are removed\nfrom attributes (think ``href=\"   http://example.com\"``) when building\n``Link`` objects. This whitespace-stripping also happens for ``action``\nattributes with ``FormRequest``.\n\n**Please also note that link extractors do not canonicalize URLs by default\nanymore.** This was puzzling users every now and then, and it's not what\nbrowsers do in fact, so we removed that extra transformation on extracted\nlinks.\n\nFor those of you wanting more control on the ``Referer:`` header that Scrapy\nsends when following links, you can set your own ``Referrer Policy``.\nPrior to Scrapy 1.4, the default ``RefererMiddleware`` would simply and\nblindly set it to the URL of the response that generated the HTTP request\n(which could leak information on your URL seeds).\nBy default, Scrapy now behaves much like your regular browser does.\nAnd this policy is fully customizable with W3C standard values\n(or with something really custom of your own if you wish).\nSee :setting:`REFERRER_POLICY` for details.\n\nTo make Scrapy spiders easier to debug, Scrapy logs more stats by default\nin 1.4: memory usage stats, detailed retry stats, detailed HTTP error code\nstats. A similar change is that HTTP cache path is also visible in logs now.\n\nLast but not least, Scrapy now has the option to make JSON and XML items\nmore human-readable, with newlines between items and even custom indenting\noffset, using the new :setting:`FEED_EXPORT_INDENT` setting.\n\nEnjoy! (Or read on for the rest of changes in this release.)\n\nDeprecations and Backward Incompatible Changes\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Default to ``canonicalize=False`` in\n  :class:`scrapy.linkextractors.LinkExtractor\n  <scrapy.linkextractors.lxmlhtml.LxmlLinkExtractor>`\n  (:issue:`2537`, fixes :issue:`1941` and :issue:`1982`):\n  **warning, this is technically backward-incompatible**\n- Enable memusage extension by default (:issue:`2539`, fixes :issue:`2187`);\n  **this is technically backward-incompatible** so please check if you have\n  any non-default ``MEMUSAGE_***`` options set.\n- ``EDITOR`` environment variable now takes precedence over ``EDITOR``\n  option defined in settings.py (:issue:`1829`); Scrapy default settings\n  no longer depend on environment variables. **This is technically a backward\n  incompatible change**.\n- ``Spider.make_requests_from_url`` is deprecated\n  (:issue:`1728`, fixes :issue:`1495`).\n\nNew Features\n~~~~~~~~~~~~\n\n- Accept proxy credentials in :reqmeta:`proxy` request meta key (:issue:`2526`)\n- Support `brotli`_-compressed content; requires optional `brotlipy`_\n  (:issue:`2535`)\n- New :ref:`response.follow <response-follow-example>` shortcut\n  for creating requests (:issue:`1940`)\n- Added ``flags`` argument and attribute to :class:`Request <scrapy.http.Request>`\n  objects (:issue:`2047`)\n- Support Anonymous FTP (:issue:`2342`)\n- Added ``retry/count``, ``retry/max_reached`` and ``retry/reason_count/<reason>``\n  stats to :class:`RetryMiddleware <scrapy.downloadermiddlewares.retry.RetryMiddleware>`\n  (:issue:`2543`)\n- Added ``httperror/response_ignored_count`` and ``httperror/response_ignored_status_count/<status>``\n  stats to :class:`HttpErrorMiddleware <scrapy.spidermiddlewares.httperror.HttpErrorMiddleware>`\n  (:issue:`2566`)\n- Customizable :setting:`Referrer policy <REFERRER_POLICY>` in\n  :class:`RefererMiddleware <scrapy.spidermiddlewares.referer.RefererMiddleware>`\n  (:issue:`2306`)\n- New ``data:`` URI download handler (:issue:`2334`, fixes :issue:`2156`)\n- Log cache directory when HTTP Cache is used (:issue:`2611`, fixes :issue:`2604`)\n- Warn users when project contains duplicate spider names (fixes :issue:`2181`)\n- ``scrapy.utils.datatypes.CaselessDict`` now accepts ``Mapping`` instances and\n  not only dicts (:issue:`2646`)\n- :ref:`Media downloads <topics-media-pipeline>`, with\n  :class:`~scrapy.pipelines.files.FilesPipeline` or\n  :class:`~scrapy.pipelines.images.ImagesPipeline`, can now optionally handle\n  HTTP redirects using the new :setting:`MEDIA_ALLOW_REDIRECTS` setting\n  (:issue:`2616`, fixes :issue:`2004`)\n- Accept non-complete responses from websites using a new\n  :setting:`DOWNLOAD_FAIL_ON_DATALOSS` setting (:issue:`2590`, fixes :issue:`2586`)\n- Optional pretty-printing of JSON and XML items via\n  :setting:`FEED_EXPORT_INDENT` setting (:issue:`2456`, fixes :issue:`1327`)\n- Allow dropping fields in ``FormRequest.from_response`` formdata when\n  ``None`` value is passed (:issue:`667`)\n- Per-request retry times with the new :reqmeta:`max_retry_times` meta key\n  (:issue:`2642`)\n- ``python -m scrapy`` as a more explicit alternative to ``scrapy`` command\n  (:issue:`2740`)\n\n.. _brotli: https://github.com/google/brotli\n.. _brotlipy: https://github.com/python-hyper/brotlipy/\n\nBug fixes\n~~~~~~~~~\n\n- LinkExtractor now strips leading and trailing whitespaces from attributes\n  (:issue:`2547`, fixes :issue:`1614`)\n- Properly handle whitespaces in action attribute in\n  :class:`~scrapy.http.FormRequest` (:issue:`2548`)\n- Buffer CONNECT response bytes from proxy until all HTTP headers are received\n  (:issue:`2495`, fixes :issue:`2491`)\n- FTP downloader now works on Python 3, provided you use Twisted>=17.1\n  (:issue:`2599`)\n- Use body to choose response type after decompressing content (:issue:`2393`,\n  fixes :issue:`2145`)\n- Always decompress ``Content-Encoding: gzip`` at :class:`HttpCompressionMiddleware\n  <scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware>` stage (:issue:`2391`)\n- Respect custom log level in ``Spider.custom_settings`` (:issue:`2581`,\n  fixes :issue:`1612`)\n- 'make htmlview' fix for macOS (:issue:`2661`)\n- Remove \"commands\" from the command list  (:issue:`2695`)\n- Fix duplicate Content-Length header for POST requests with empty body (:issue:`2677`)\n- Properly cancel large downloads, i.e. above :setting:`DOWNLOAD_MAXSIZE` (:issue:`1616`)\n- ImagesPipeline: fixed processing of transparent PNG images with palette\n  (:issue:`2675`)\n\nCleanups & Refactoring\n~~~~~~~~~~~~~~~~~~~~~~\n\n- Tests: remove temp files and folders (:issue:`2570`),\n  fixed ProjectUtilsTest on macOS (:issue:`2569`),\n  use portable pypy for Linux on Travis CI (:issue:`2710`)\n- Separate building request from ``_requests_to_follow`` in CrawlSpider (:issue:`2562`)\n- Remove \u014c\u0106\u00a3Python 3 progress\u014c\u0106\u00d8 badge (:issue:`2567`)\n- Add a couple more lines to ``.gitignore`` (:issue:`2557`)\n- Remove bumpversion prerelease configuration (:issue:`2159`)\n- Add codecov.yml file (:issue:`2750`)\n- Set context factory implementation based on Twisted version (:issue:`2577`,\n  fixes :issue:`2560`)\n- Add omitted ``self`` arguments in default project middleware template (:issue:`2595`)\n- Remove redundant ``slot.add_request()`` call in ExecutionEngine (:issue:`2617`)\n- Catch more specific ``os.error`` exception in\n  ``scrapy.pipelines.files.FSFilesStore`` (:issue:`2644`)\n- Change \"localhost\" test server certificate (:issue:`2720`)\n- Remove unused ``MEMUSAGE_REPORT`` setting (:issue:`2576`)\n\nDocumentation\n~~~~~~~~~~~~~\n\n- Binary mode is required for exporters (:issue:`2564`, fixes :issue:`2553`)\n- Mention issue with :meth:`FormRequest.from_response\n  <scrapy.http.FormRequest.from_response>` due to bug in lxml (:issue:`2572`)\n- Use single quotes uniformly in templates (:issue:`2596`)\n- Document :reqmeta:`ftp_user` and :reqmeta:`ftp_password` meta keys (:issue:`2587`)\n- Removed section on deprecated ``contrib/`` (:issue:`2636`)\n- Recommend Anaconda when installing Scrapy on Windows\n  (:issue:`2477`, fixes :issue:`2475`)\n- FAQ: rewrite note on Python 3 support on Windows (:issue:`2690`)\n- Rearrange selector sections (:issue:`2705`)\n- Remove ``__nonzero__`` from :class:`~scrapy.selector.SelectorList`\n  docs (:issue:`2683`)\n- Mention how to disable request filtering in documentation of\n  :setting:`DUPEFILTER_CLASS` setting (:issue:`2714`)\n- Add sphinx_rtd_theme to docs setup readme (:issue:`2668`)\n- Open file in text mode in JSON item writer example (:issue:`2729`)\n- Clarify ``allowed_domains`` example (:issue:`2670`)\n\n\n.. _release-1.3.3:\n\nScrapy 1.3.3 (2017-03-10)\n-------------------------\n\nBug fixes\n~~~~~~~~~\n\n- Make ``SpiderLoader`` raise ``ImportError`` again by default for missing\n  dependencies and wrong :setting:`SPIDER_MODULES`.\n  These exceptions were silenced as warnings since 1.3.0.\n  A new setting is introduced to toggle between warning or exception if needed ;\n  see :setting:`SPIDER_LOADER_WARN_ONLY` for details.\n\n.. _release-1.3.2:\n\nScrapy 1.3.2 (2017-02-13)\n-------------------------\n\nBug fixes\n~~~~~~~~~\n\n- Preserve request class when converting to/from dicts (utils.reqser) (:issue:`2510`).\n- Use consistent selectors for author field in tutorial (:issue:`2551`).\n- Fix TLS compatibility in Twisted 17+ (:issue:`2558`)\n\n.. _release-1.3.1:\n\nScrapy 1.3.1 (2017-02-08)\n-------------------------\n\nNew features\n~~~~~~~~~~~~\n\n- Support ``'True'`` and ``'False'`` string values for boolean settings (:issue:`2519`);\n  you can now do something like ``scrapy crawl myspider -s REDIRECT_ENABLED=False``.\n- Support kwargs with ``response.xpath()`` to use :ref:`XPath variables <topics-selectors-xpath-variables>`\n  and ad-hoc namespaces declarations ;\n  this requires at least Parsel v1.1 (:issue:`2457`).\n- Add support for Python 3.6 (:issue:`2485`).\n- Run tests on PyPy (warning: some tests still fail, so PyPy is not supported yet).\n\nBug fixes\n~~~~~~~~~\n\n- Enforce ``DNS_TIMEOUT`` setting (:issue:`2496`).\n- Fix :command:`view` command ; it was a regression in v1.3.0 (:issue:`2503`).\n- Fix tests regarding ``*_EXPIRES settings`` with Files/Images pipelines (:issue:`2460`).\n- Fix name of generated pipeline class when using basic project template (:issue:`2466`).\n- Fix compatibility with Twisted 17+ (:issue:`2496`, :issue:`2528`).\n- Fix ``scrapy.Item`` inheritance on Python 3.6 (:issue:`2511`).\n- Enforce numeric values for components order in ``SPIDER_MIDDLEWARES``,\n  ``DOWNLOADER_MIDDLEWARES``, ``EXTENSIONS`` and ``SPIDER_CONTRACTS`` (:issue:`2420`).\n\nDocumentation\n~~~~~~~~~~~~~\n\n- Reword Code of Conduct section and upgrade to Contributor Covenant v1.4\n  (:issue:`2469`).\n- Clarify that passing spider arguments converts them to spider attributes\n  (:issue:`2483`).\n- Document ``formid`` argument on ``FormRequest.from_response()`` (:issue:`2497`).\n- Add .rst extension to README files (:issue:`2507`).\n- Mention LevelDB cache storage backend (:issue:`2525`).\n- Use ``yield`` in sample callback code (:issue:`2533`).\n- Add note about HTML entities decoding with ``.re()/.re_first()`` (:issue:`1704`).\n- Typos (:issue:`2512`, :issue:`2534`, :issue:`2531`).\n\nCleanups\n~~~~~~~~\n\n- Remove redundant check in ``MetaRefreshMiddleware`` (:issue:`2542`).\n- Faster checks in ``LinkExtractor`` for allow/deny patterns (:issue:`2538`).\n- Remove dead code supporting old Twisted versions (:issue:`2544`).\n\n\n.. _release-1.3.0:\n\nScrapy 1.3.0 (2016-12-21)\n-------------------------\n\nThis release comes rather soon after 1.2.2 for one main reason:\nit was found out that releases since 0.18 up to 1.2.2 (included) use\nsome backported code from Twisted (``scrapy.xlib.tx.*``),\neven if newer Twisted modules are available.\nScrapy now uses ``twisted.web.client`` and ``twisted.internet.endpoints`` directly.\n(See also cleanups below.)\n\nAs it is a major change, we wanted to get the bug fix out quickly\nwhile not breaking any projects using the 1.2 series.\n\nNew Features\n~~~~~~~~~~~~\n\n- ``MailSender`` now accepts single strings as values for ``to`` and ``cc``\n  arguments (:issue:`2272`)\n- ``scrapy fetch url``, ``scrapy shell url`` and ``fetch(url)`` inside\n  Scrapy shell now follow HTTP redirections by default (:issue:`2290`);\n  See :command:`fetch` and :command:`shell` for details.\n- ``HttpErrorMiddleware`` now logs errors with ``INFO`` level instead of ``DEBUG``;\n  this is technically **backward incompatible** so please check your log parsers.\n- By default, logger names now use a long-form path, e.g. ``[scrapy.extensions.logstats]``,\n  instead of the shorter \"top-level\" variant of prior releases (e.g. ``[scrapy]``);\n  this is **backward incompatible** if you have log parsers expecting the short\n  logger name part. You can switch back to short logger names using :setting:`LOG_SHORT_NAMES`\n  set to ``True``.\n\nDependencies & Cleanups\n~~~~~~~~~~~~~~~~~~~~~~~\n\n- Scrapy now requires Twisted >= 13.1 which is the case for many Linux\n  distributions already.\n- As a consequence, we got rid of ``scrapy.xlib.tx.*`` modules, which\n  copied some of Twisted code for users stuck with an \"old\" Twisted version\n- ``ChunkedTransferMiddleware`` is deprecated and removed from the default\n  downloader middlewares.\n\n.. _release-1.2.3:\n\nScrapy 1.2.3 (2017-03-03)\n-------------------------\n\n- Packaging fix: disallow unsupported Twisted versions in setup.py\n\n\n.. _release-1.2.2:\n\nScrapy 1.2.2 (2016-12-06)\n-------------------------\n\nBug fixes\n~~~~~~~~~\n\n- Fix a cryptic traceback when a pipeline fails on ``open_spider()`` (:issue:`2011`)\n- Fix embedded IPython shell variables (fixing :issue:`396` that re-appeared\n  in 1.2.0, fixed in :issue:`2418`)\n- A couple of patches when dealing with robots.txt:\n\n  - handle (non-standard) relative sitemap URLs (:issue:`2390`)\n  - handle non-ASCII URLs and User-Agents in Python 2 (:issue:`2373`)\n\nDocumentation\n~~~~~~~~~~~~~\n\n- Document ``\"download_latency\"`` key in ``Request``'s ``meta`` dict (:issue:`2033`)\n- Remove page on (deprecated & unsupported) Ubuntu packages from ToC (:issue:`2335`)\n- A few fixed typos (:issue:`2346`, :issue:`2369`, :issue:`2369`, :issue:`2380`)\n  and clarifications (:issue:`2354`, :issue:`2325`, :issue:`2414`)\n\nOther changes\n~~~~~~~~~~~~~\n\n- Advertize `conda-forge`_ as Scrapy's official conda channel (:issue:`2387`)\n- More helpful error messages when trying to use ``.css()`` or ``.xpath()``\n  on non-Text Responses (:issue:`2264`)\n- ``startproject`` command now generates a sample ``middlewares.py`` file (:issue:`2335`)\n- Add more dependencies' version info in ``scrapy version`` verbose output (:issue:`2404`)\n- Remove all ``*.pyc`` files from source distribution (:issue:`2386`)\n\n.. _conda-forge: https://anaconda.org/conda-forge/scrapy\n\n\n.. _release-1.2.1:\n\nScrapy 1.2.1 (2016-10-21)\n-------------------------\n\nBug fixes\n~~~~~~~~~\n\n- Include OpenSSL's more permissive default ciphers when establishing\n  TLS/SSL connections (:issue:`2314`).\n- Fix \"Location\" HTTP header decoding on non-ASCII URL redirects (:issue:`2321`).\n\nDocumentation\n~~~~~~~~~~~~~\n\n- Fix JsonWriterPipeline example (:issue:`2302`).\n- Various notes: :issue:`2330` on spider names,\n  :issue:`2329` on middleware methods processing order,\n  :issue:`2327` on getting multi-valued HTTP headers as lists.\n\nOther changes\n~~~~~~~~~~~~~\n\n- Removed ``www.`` from ``start_urls`` in built-in spider templates (:issue:`2299`).\n\n\n.. _release-1.2.0:\n\nScrapy 1.2.0 (2016-10-03)\n-------------------------\n\nNew Features\n~~~~~~~~~~~~\n\n- New :setting:`FEED_EXPORT_ENCODING` setting to customize the encoding\n  used when writing items to a file.\n  This can be used to turn off ``\\uXXXX`` escapes in JSON output.\n  This is also useful for those wanting something else than UTF-8\n  for XML or CSV output (:issue:`2034`).\n- ``startproject`` command now supports an optional destination directory\n  to override the default one based on the project name (:issue:`2005`).\n- New :setting:`SCHEDULER_DEBUG` setting to log requests serialization\n  failures (:issue:`1610`).\n- JSON encoder now supports serialization of ``set`` instances (:issue:`2058`).\n- Interpret ``application/json-amazonui-streaming`` as ``TextResponse`` (:issue:`1503`).\n- ``scrapy`` is imported by default when using shell tools (:command:`shell`,\n  :ref:`inspect_response <topics-shell-inspect-response>`) (:issue:`2248`).\n\nBug fixes\n~~~~~~~~~\n\n- DefaultRequestHeaders middleware now runs before UserAgent middleware\n  (:issue:`2088`). **Warning: this is technically backward incompatible**,\n  though we consider this a bug fix.\n- HTTP cache extension and plugins that use the ``.scrapy`` data directory now\n  work outside projects (:issue:`1581`).  **Warning: this is technically\n  backward incompatible**, though we consider this a bug fix.\n- ``Selector`` does not allow passing both ``response`` and ``text`` anymore\n  (:issue:`2153`).\n- Fixed logging of wrong callback name with ``scrapy parse`` (:issue:`2169`).\n- Fix for an odd gzip decompression bug (:issue:`1606`).\n- Fix for selected callbacks when using ``CrawlSpider`` with :command:`scrapy parse <parse>`\n  (:issue:`2225`).\n- Fix for invalid JSON and XML files when spider yields no items (:issue:`872`).\n- Implement ``flush()`` for ``StreamLogger`` avoiding a warning in logs (:issue:`2125`).\n\nRefactoring\n~~~~~~~~~~~\n\n- ``canonicalize_url`` has been moved to `w3lib.url`_ (:issue:`2168`).\n\n.. _w3lib.url: https://w3lib.readthedocs.io/en/latest/w3lib.html#w3lib.url.canonicalize_url\n\nTests & Requirements\n~~~~~~~~~~~~~~~~~~~~\n\nScrapy's new requirements baseline is Debian 8 \"Jessie\". It was previously\nUbuntu 12.04 Precise.\nWhat this means in practice is that we run continuous integration tests\nwith these (main) packages versions at a minimum:\nTwisted 14.0, pyOpenSSL 0.14, lxml 3.4.\n\nScrapy may very well work with older versions of these packages\n(the code base still has switches for older Twisted versions for example)\nbut it is not guaranteed (because it's not tested anymore).\n\nDocumentation\n~~~~~~~~~~~~~\n\n- Grammar fixes: :issue:`2128`, :issue:`1566`.\n- Download stats badge removed from README (:issue:`2160`).\n- New Scrapy :ref:`architecture diagram <topics-architecture>` (:issue:`2165`).\n- Updated ``Response`` parameters documentation (:issue:`2197`).\n- Reworded misleading :setting:`RANDOMIZE_DOWNLOAD_DELAY` description (:issue:`2190`).\n- Add StackOverflow as a support channel (:issue:`2257`).\n\n.. _release-1.1.4:\n\nScrapy 1.1.4 (2017-03-03)\n-------------------------\n\n- Packaging fix: disallow unsupported Twisted versions in setup.py\n\n.. _release-1.1.3:\n\nScrapy 1.1.3 (2016-09-22)\n-------------------------\n\nBug fixes\n~~~~~~~~~\n\n- Class attributes for subclasses of ``ImagesPipeline`` and ``FilesPipeline``\n  work as they did before 1.1.1 (:issue:`2243`, fixes :issue:`2198`)\n\nDocumentation\n~~~~~~~~~~~~~\n\n- :ref:`Overview <intro-overview>` and :ref:`tutorial <intro-tutorial>`\n  rewritten to use http://toscrape.com websites\n  (:issue:`2236`, :issue:`2249`, :issue:`2252`).\n\n.. _release-1.1.2:\n\nScrapy 1.1.2 (2016-08-18)\n-------------------------\n\nBug fixes\n~~~~~~~~~\n\n- Introduce a missing :setting:`IMAGES_STORE_S3_ACL` setting to override\n  the default ACL policy in ``ImagesPipeline`` when uploading images to S3\n  (note that default ACL policy is \"private\" -- instead of \"public-read\" --\n  since Scrapy 1.1.0)\n- :setting:`IMAGES_EXPIRES` default value set back to 90\n  (the regression was introduced in 1.1.1)\n\n.. _release-1.1.1:\n\nScrapy 1.1.1 (2016-07-13)\n-------------------------\n\nBug fixes\n~~~~~~~~~\n\n- Add \"Host\" header in CONNECT requests to HTTPS proxies (:issue:`2069`)\n- Use response ``body`` when choosing response class\n  (:issue:`2001`, fixes :issue:`2000`)\n- Do not fail on canonicalizing URLs with wrong netlocs\n  (:issue:`2038`, fixes :issue:`2010`)\n- a few fixes for ``HttpCompressionMiddleware`` (and ``SitemapSpider``):\n\n  - Do not decode HEAD responses (:issue:`2008`, fixes :issue:`1899`)\n  - Handle charset parameter in gzip Content-Type header\n    (:issue:`2050`, fixes :issue:`2049`)\n  - Do not decompress gzip octet-stream responses\n    (:issue:`2065`, fixes :issue:`2063`)\n\n- Catch (and ignore with a warning) exception when verifying certificate\n  against IP-address hosts (:issue:`2094`, fixes :issue:`2092`)\n- Make ``FilesPipeline`` and ``ImagesPipeline`` backward compatible again\n  regarding the use of legacy class attributes for customization\n  (:issue:`1989`, fixes :issue:`1985`)\n\n\nNew features\n~~~~~~~~~~~~\n\n- Enable genspider command outside project folder (:issue:`2052`)\n- Retry HTTPS CONNECT ``TunnelError`` by default (:issue:`1974`)\n\n\nDocumentation\n~~~~~~~~~~~~~\n\n- ``FEED_TEMPDIR`` setting at lexicographical position (:commit:`9b3c72c`)\n- Use idiomatic ``.extract_first()`` in overview (:issue:`1994`)\n- Update years in copyright notice (:commit:`c2c8036`)\n- Add information and example on errbacks (:issue:`1995`)\n- Use \"url\" variable in downloader middleware example (:issue:`2015`)\n- Grammar fixes (:issue:`2054`, :issue:`2120`)\n- New FAQ entry on using BeautifulSoup in spider callbacks (:issue:`2048`)\n- Add notes about Scrapy not working on Windows with Python 3 (:issue:`2060`)\n- Encourage complete titles in pull requests (:issue:`2026`)\n\nTests\n~~~~~\n\n- Upgrade py.test requirement on Travis CI and Pin pytest-cov to 2.2.1 (:issue:`2095`)\n\n.. _release-1.1.0:\n\nScrapy 1.1.0 (2016-05-11)\n-------------------------\n\nThis 1.1 release brings a lot of interesting features and bug fixes:\n\n- Scrapy 1.1 has beta Python 3 support (requires Twisted >= 15.5). See\n  :ref:`news_betapy3` for more details and some limitations.\n- Hot new features:\n\n  - Item loaders now support nested loaders (:issue:`1467`).\n  - ``FormRequest.from_response`` improvements (:issue:`1382`, :issue:`1137`).\n  - Added setting :setting:`AUTOTHROTTLE_TARGET_CONCURRENCY` and improved\n    AutoThrottle docs (:issue:`1324`).\n  - Added ``response.text`` to get body as unicode (:issue:`1730`).\n  - Anonymous S3 connections (:issue:`1358`).\n  - Deferreds in downloader middlewares (:issue:`1473`). This enables better\n    robots.txt handling (:issue:`1471`).\n  - HTTP caching now follows RFC2616 more closely, added settings\n    :setting:`HTTPCACHE_ALWAYS_STORE` and\n    :setting:`HTTPCACHE_IGNORE_RESPONSE_CACHE_CONTROLS` (:issue:`1151`).\n  - Selectors were extracted to the parsel_ library (:issue:`1409`). This means\n    you can use Scrapy Selectors without Scrapy and also upgrade the\n    selectors engine without needing to upgrade Scrapy.\n  - HTTPS downloader now does TLS protocol negotiation by default,\n    instead of forcing TLS 1.0. You can also set the SSL/TLS method\n    using the new :setting:`DOWNLOADER_CLIENT_TLS_METHOD`.\n\n- These bug fixes may require your attention:\n\n  - Don't retry bad requests (HTTP 400) by default (:issue:`1289`).\n    If you need the old behavior, add ``400`` to :setting:`RETRY_HTTP_CODES`.\n  - Fix shell files argument handling (:issue:`1710`, :issue:`1550`).\n    If you try ``scrapy shell index.html`` it will try to load the URL http://index.html,\n    use ``scrapy shell ./index.html`` to load a local file.\n  - Robots.txt compliance is now enabled by default for newly-created projects\n    (:issue:`1724`). Scrapy will also wait for robots.txt to be downloaded\n    before proceeding with the crawl (:issue:`1735`). If you want to disable\n    this behavior, update :setting:`ROBOTSTXT_OBEY` in ``settings.py`` file\n    after creating a new project.\n  - Exporters now work on unicode, instead of bytes by default (:issue:`1080`).\n    If you use :class:`~scrapy.exporters.PythonItemExporter`, you may want to\n    update your code to disable binary mode which is now deprecated.\n  - Accept XML node names containing dots as valid (:issue:`1533`).\n  - When uploading files or images to S3 (with ``FilesPipeline`` or\n    ``ImagesPipeline``), the default ACL policy is now \"private\" instead\n    of \"public\" **Warning: backward incompatible!**.\n    You can use :setting:`FILES_STORE_S3_ACL` to change it.\n  - We've reimplemented ``canonicalize_url()`` for more correct output,\n    especially for URLs with non-ASCII characters (:issue:`1947`).\n    This could change link extractors output compared to previous Scrapy versions.\n    This may also invalidate some cache entries you could still have from pre-1.1 runs.\n    **Warning: backward incompatible!**.\n\nKeep reading for more details on other improvements and bug fixes.\n\n.. _news_betapy3:\n\nBeta Python 3 Support\n~~~~~~~~~~~~~~~~~~~~~\n\nWe have been `hard at work to make Scrapy run on Python 3\n<https://github.com/scrapy/scrapy/wiki/Python-3-Porting>`_. As a result, now\nyou can run spiders on Python 3.3, 3.4 and 3.5 (Twisted >= 15.5 required). Some\nfeatures are still missing (and some may never be ported).\n\n\nAlmost all builtin extensions/middlewares are expected to work.\nHowever, we are aware of some limitations in Python 3:\n\n- Scrapy does not work on Windows with Python 3\n- Sending emails is not supported\n- FTP download handler is not supported\n- Telnet console is not supported\n\nAdditional New Features and Enhancements\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Scrapy now has a `Code of Conduct`_ (:issue:`1681`).\n- Command line tool now has completion for zsh (:issue:`934`).\n- Improvements to ``scrapy shell``:\n\n  - Support for bpython and configure preferred Python shell via\n    ``SCRAPY_PYTHON_SHELL`` (:issue:`1100`, :issue:`1444`).\n  - Support URLs without scheme (:issue:`1498`)\n    **Warning: backward incompatible!**\n  - Bring back support for relative file path (:issue:`1710`, :issue:`1550`).\n\n- Added :setting:`MEMUSAGE_CHECK_INTERVAL_SECONDS` setting to change default check\n  interval (:issue:`1282`).\n- Download handlers are now lazy-loaded on first request using their\n  scheme (:issue:`1390`, :issue:`1421`).\n- HTTPS download handlers do not force TLS 1.0 anymore; instead,\n  OpenSSL's ``SSLv23_method()/TLS_method()`` is used allowing to try\n  negotiating with the remote hosts the highest TLS protocol version\n  it can (:issue:`1794`, :issue:`1629`).\n- ``RedirectMiddleware`` now skips the status codes from\n  ``handle_httpstatus_list`` on spider attribute\n  or in ``Request``'s ``meta`` key (:issue:`1334`, :issue:`1364`,\n  :issue:`1447`).\n- Form submission:\n\n  - now works with ``<button>`` elements too (:issue:`1469`).\n  - an empty string is now used for submit buttons without a value\n    (:issue:`1472`)\n\n- Dict-like settings now have per-key priorities\n  (:issue:`1135`, :issue:`1149` and :issue:`1586`).\n- Sending non-ASCII emails (:issue:`1662`)\n- ``CloseSpider`` and ``SpiderState`` extensions now get disabled if no relevant\n  setting is set (:issue:`1723`, :issue:`1725`).\n- Added method ``ExecutionEngine.close`` (:issue:`1423`).\n- Added method ``CrawlerRunner.create_crawler`` (:issue:`1528`).\n- Scheduler priority queue can now be customized via\n  :setting:`SCHEDULER_PRIORITY_QUEUE` (:issue:`1822`).\n- ``.pps`` links are now ignored by default in link extractors (:issue:`1835`).\n- temporary data folder for FTP and S3 feed storages can be customized\n  using a new :setting:`FEED_TEMPDIR` setting (:issue:`1847`).\n- ``FilesPipeline`` and ``ImagesPipeline`` settings are now instance attributes\n  instead of class attributes, enabling spider-specific behaviors (:issue:`1891`).\n- ``JsonItemExporter`` now formats opening and closing square brackets\n  on their own line (first and last lines of output file) (:issue:`1950`).\n- If available, ``botocore`` is used for ``S3FeedStorage``, ``S3DownloadHandler``\n  and ``S3FilesStore`` (:issue:`1761`, :issue:`1883`).\n- Tons of documentation updates and related fixes (:issue:`1291`, :issue:`1302`,\n  :issue:`1335`, :issue:`1683`, :issue:`1660`, :issue:`1642`, :issue:`1721`,\n  :issue:`1727`, :issue:`1879`).\n- Other refactoring, optimizations and cleanup (:issue:`1476`, :issue:`1481`,\n  :issue:`1477`, :issue:`1315`, :issue:`1290`, :issue:`1750`, :issue:`1881`).\n\n.. _`Code of Conduct`: https://github.com/scrapy/scrapy/blob/master/CODE_OF_CONDUCT.md\n\n\nDeprecations and Removals\n~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Added ``to_bytes`` and ``to_unicode``, deprecated ``str_to_unicode`` and\n  ``unicode_to_str`` functions (:issue:`778`).\n- ``binary_is_text`` is introduced, to replace use of ``isbinarytext``\n  (but with inverse return value) (:issue:`1851`)\n- The ``optional_features`` set has been removed (:issue:`1359`).\n- The ``--lsprof`` command line option has been removed (:issue:`1689`).\n  **Warning: backward incompatible**, but doesn't break user code.\n- The following datatypes were deprecated (:issue:`1720`):\n\n  + ``scrapy.utils.datatypes.MultiValueDictKeyError``\n  + ``scrapy.utils.datatypes.MultiValueDict``\n  + ``scrapy.utils.datatypes.SiteNode``\n\n- The previously bundled ``scrapy.xlib.pydispatch`` library was deprecated and\n  replaced by `pydispatcher <https://pypi.org/project/PyDispatcher/>`_.\n\n\nRelocations\n~~~~~~~~~~~\n\n- ``telnetconsole`` was relocated to ``extensions/`` (:issue:`1524`).\n\n  + Note: telnet is not enabled on Python 3\n    (https://github.com/scrapy/scrapy/pull/1524#issuecomment-146985595)\n\n.. _parsel: https://github.com/scrapy/parsel\n\n\nBugfixes\n~~~~~~~~\n\n- Scrapy does not retry requests that got a ``HTTP 400 Bad Request``\n  response anymore (:issue:`1289`). **Warning: backward incompatible!**\n- Support empty password for http_proxy config (:issue:`1274`).\n- Interpret ``application/x-json`` as ``TextResponse`` (:issue:`1333`).\n- Support link rel attribute with multiple values (:issue:`1201`).\n- Fixed ``scrapy.http.FormRequest.from_response`` when there is a ``<base>``\n  tag (:issue:`1564`).\n- Fixed :setting:`TEMPLATES_DIR` handling (:issue:`1575`).\n- Various ``FormRequest`` fixes (:issue:`1595`, :issue:`1596`, :issue:`1597`).\n- Makes ``_monkeypatches`` more robust (:issue:`1634`).\n- Fixed bug on ``XMLItemExporter`` with non-string fields in\n  items (:issue:`1738`).\n- Fixed startproject command in macOS (:issue:`1635`).\n- Fixed :class:`~scrapy.exporters.PythonItemExporter` and CSVExporter for\n  non-string item types (:issue:`1737`).\n- Various logging related fixes (:issue:`1294`, :issue:`1419`, :issue:`1263`,\n  :issue:`1624`, :issue:`1654`, :issue:`1722`, :issue:`1726` and :issue:`1303`).\n- Fixed bug in ``utils.template.render_templatefile()`` (:issue:`1212`).\n- sitemaps extraction from ``robots.txt`` is now case-insensitive (:issue:`1902`).\n- HTTPS+CONNECT tunnels could get mixed up when using multiple proxies\n  to same remote host (:issue:`1912`).\n\n.. _release-1.0.7:\n\nScrapy 1.0.7 (2017-03-03)\n-------------------------\n\n- Packaging fix: disallow unsupported Twisted versions in setup.py\n\n.. _release-1.0.6:\n\nScrapy 1.0.6 (2016-05-04)\n-------------------------\n\n- FIX: RetryMiddleware is now robust to non-standard HTTP status codes (:issue:`1857`)\n- FIX: Filestorage HTTP cache was checking wrong modified time (:issue:`1875`)\n- DOC: Support for Sphinx 1.4+ (:issue:`1893`)\n- DOC: Consistency in selectors examples (:issue:`1869`)\n\n.. _release-1.0.5:\n\nScrapy 1.0.5 (2016-02-04)\n-------------------------\n\n- FIX: [Backport] Ignore bogus links in LinkExtractors (fixes :issue:`907`, :commit:`108195e`)\n- TST: Changed buildbot makefile to use 'pytest' (:commit:`1f3d90a`)\n- DOC: Fixed typos in tutorial and media-pipeline (:commit:`808a9ea` and :commit:`803bd87`)\n- DOC: Add AjaxCrawlMiddleware to DOWNLOADER_MIDDLEWARES_BASE in settings docs (:commit:`aa94121`)\n\n.. _release-1.0.4:\n\nScrapy 1.0.4 (2015-12-30)\n-------------------------\n\n- Ignoring xlib/tx folder, depending on Twisted version. (:commit:`7dfa979`)\n- Run on new travis-ci infra (:commit:`6e42f0b`)\n- Spelling fixes (:commit:`823a1cc`)\n- escape nodename in xmliter regex (:commit:`da3c155`)\n- test xml nodename with dots (:commit:`4418fc3`)\n- TST don't use broken Pillow version in tests (:commit:`a55078c`)\n- disable log on version command. closes #1426 (:commit:`86fc330`)\n- disable log on startproject command (:commit:`db4c9fe`)\n- Add PyPI download stats badge (:commit:`df2b944`)\n- don't run tests twice on Travis if a PR is made from a scrapy/scrapy branch (:commit:`a83ab41`)\n- Add Python 3 porting status badge to the README (:commit:`73ac80d`)\n- fixed RFPDupeFilter persistence (:commit:`97d080e`)\n- TST a test to show that dupefilter persistence is not working (:commit:`97f2fb3`)\n- explicit close file on file:// scheme handler (:commit:`d9b4850`)\n- Disable dupefilter in shell (:commit:`c0d0734`)\n- DOC: Add captions to toctrees which appear in sidebar (:commit:`aa239ad`)\n- DOC Removed pywin32 from install instructions as it's already declared as dependency. (:commit:`10eb400`)\n- Added installation notes about using Conda for Windows and other OSes. (:commit:`1c3600a`)\n- Fixed minor grammar issues. (:commit:`7f4ddd5`)\n- fixed a typo in the documentation. (:commit:`b71f677`)\n- Version 1 now exists (:commit:`5456c0e`)\n- fix another invalid xpath error (:commit:`0a1366e`)\n- fix ValueError: Invalid XPath: //div/[id=\"not-exists\"]/text() on selectors.rst (:commit:`ca8d60f`)\n- Typos corrections (:commit:`7067117`)\n- fix typos in downloader-middleware.rst and exceptions.rst, middlware -> middleware (:commit:`32f115c`)\n- Add note to Ubuntu install section about Debian compatibility (:commit:`23fda69`)\n- Replace alternative macOS install workaround with virtualenv (:commit:`98b63ee`)\n- Reference Homebrew's homepage for installation instructions (:commit:`1925db1`)\n- Add oldest supported tox version to contributing docs (:commit:`5d10d6d`)\n- Note in install docs about pip being already included in python>=2.7.9 (:commit:`85c980e`)\n- Add non-python dependencies to Ubuntu install section in the docs (:commit:`fbd010d`)\n- Add macOS installation section to docs (:commit:`d8f4cba`)\n- DOC(ENH): specify path to rtd theme explicitly (:commit:`de73b1a`)\n- minor: scrapy.Spider docs grammar (:commit:`1ddcc7b`)\n- Make common practices sample code match the comments (:commit:`1b85bcf`)\n- nextcall repetitive calls (heartbeats). (:commit:`55f7104`)\n- Backport fix compatibility with Twisted 15.4.0 (:commit:`b262411`)\n- pin pytest to 2.7.3 (:commit:`a6535c2`)\n- Merge pull request #1512 from mgedmin/patch-1 (:commit:`8876111`)\n- Merge pull request #1513 from mgedmin/patch-2 (:commit:`5d4daf8`)\n- Typo (:commit:`f8d0682`)\n- Fix list formatting (:commit:`5f83a93`)\n- fix Scrapy squeue tests after recent changes to queuelib (:commit:`3365c01`)\n- Merge pull request #1475 from rweindl/patch-1 (:commit:`2d688cd`)\n- Update tutorial.rst (:commit:`fbc1f25`)\n- Merge pull request #1449 from rhoekman/patch-1 (:commit:`7d6538c`)\n- Small grammatical change (:commit:`8752294`)\n- Add openssl version to version command (:commit:`13c45ac`)\n\n.. _release-1.0.3:\n\nScrapy 1.0.3 (2015-08-11)\n-------------------------\n\n- add service_identity to Scrapy install_requires (:commit:`cbc2501`)\n- Workaround for travis#296 (:commit:`66af9cd`)\n\n.. _release-1.0.2:\n\nScrapy 1.0.2 (2015-08-06)\n-------------------------\n\n- Twisted 15.3.0 does not raises PicklingError serializing lambda functions (:commit:`b04dd7d`)\n- Minor method name fix (:commit:`6f85c7f`)\n- minor: scrapy.Spider grammar and clarity (:commit:`9c9d2e0`)\n- Put a blurb about support channels in CONTRIBUTING (:commit:`c63882b`)\n- Fixed typos (:commit:`a9ae7b0`)\n- Fix doc reference. (:commit:`7c8a4fe`)\n\n.. _release-1.0.1:\n\nScrapy 1.0.1 (2015-07-01)\n-------------------------\n\n- Unquote request path before passing to FTPClient, it already escape paths (:commit:`cc00ad2`)\n- include tests/ to source distribution in MANIFEST.in (:commit:`eca227e`)\n- DOC Fix SelectJmes documentation (:commit:`b8567bc`)\n- DOC Bring Ubuntu and Archlinux outside of Windows subsection (:commit:`392233f`)\n- DOC remove version suffix from Ubuntu package (:commit:`5303c66`)\n- DOC Update release date for 1.0 (:commit:`c89fa29`)\n\n.. _release-1.0.0:\n\nScrapy 1.0.0 (2015-06-19)\n-------------------------\n\nYou will find a lot of new features and bugfixes in this major release.  Make\nsure to check our updated :ref:`overview <intro-overview>` to get a glance of\nsome of the changes, along with our brushed :ref:`tutorial <intro-tutorial>`.\n\nSupport for returning dictionaries in spiders\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\nDeclaring and returning Scrapy Items is no longer necessary to collect the\nscraped data from your spider, you can now return explicit dictionaries\ninstead.\n\n*Classic version*\n\n::\n\n    class MyItem(scrapy.Item):\n        url = scrapy.Field()\n\n    class MySpider(scrapy.Spider):\n        def parse(self, response):\n            return MyItem(url=response.url)\n\n*New version*\n\n::\n\n    class MySpider(scrapy.Spider):\n        def parse(self, response):\n            return {'url': response.url}\n\nPer-spider settings (GSoC 2014)\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\nLast Google Summer of Code project accomplished an important redesign of the\nmechanism used for populating settings, introducing explicit priorities to\noverride any given setting. As an extension of that goal, we included a new\nlevel of priority for settings that act exclusively for a single spider,\nallowing them to redefine project settings.\n\nStart using it by defining a :attr:`~scrapy.spiders.Spider.custom_settings`\nclass variable in your spider::\n\n    class MySpider(scrapy.Spider):\n        custom_settings = {\n            \"DOWNLOAD_DELAY\": 5.0,\n            \"RETRY_ENABLED\": False,\n        }\n\nRead more about settings population: :ref:`topics-settings`\n\nPython Logging\n~~~~~~~~~~~~~~\n\nScrapy 1.0 has moved away from Twisted logging to support Python built in\u014c\u0106\u00d6s\nas default logging system. We\u014c\u0106\u00d6re maintaining backward compatibility for most\nof the old custom interface to call logging functions, but you\u014c\u0106\u00d6ll get\nwarnings to switch to the Python logging API entirely.\n\n*Old version*\n\n::\n\n    from scrapy import log\n    log.msg('MESSAGE', log.INFO)\n\n*New version*\n\n::\n\n    import logging\n    logging.info('MESSAGE')\n\nLogging with spiders remains the same, but on top of the\n:meth:`~scrapy.spiders.Spider.log` method you\u014c\u0106\u00d6ll have access to a custom\n:attr:`~scrapy.spiders.Spider.logger` created for the spider to issue log\nevents:\n\n::\n\n    class MySpider(scrapy.Spider):\n        def parse(self, response):\n            self.logger.info('Response received')\n\nRead more in the logging documentation: :ref:`topics-logging`\n\nCrawler API refactoring (GSoC 2014)\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\nAnother milestone for last Google Summer of Code was a refactoring of the\ninternal API, seeking a simpler and easier usage. Check new core interface\nin: :ref:`topics-api`\n\nA common situation where you will face these changes is while running Scrapy\nfrom scripts. Here\u014c\u0106\u00d6s a quick example of how to run a Spider manually with the\nnew API:\n\n::\n\n    from scrapy.crawler import CrawlerProcess\n\n    process = CrawlerProcess({\n        'USER_AGENT': 'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)'\n    })\n    process.crawl(MySpider)\n    process.start()\n\nBear in mind this feature is still under development and its API may change\nuntil it reaches a stable status.\n\nSee more examples for scripts running Scrapy: :ref:`topics-practices`\n\n.. _module-relocations:\n\nModule Relocations\n~~~~~~~~~~~~~~~~~~\n\nThere\u014c\u0106\u00d6s been a large rearrangement of modules trying to improve the general\nstructure of Scrapy. Main changes were separating various subpackages into\nnew projects and dissolving both ``scrapy.contrib`` and ``scrapy.contrib_exp``\ninto top level packages. Backward compatibility was kept among internal\nrelocations, while importing deprecated modules expect warnings indicating\ntheir new place.\n\nFull list of relocations\n************************\n\nOutsourced packages\n\n.. note::\n    These extensions went through some minor changes, e.g. some setting names\n    were changed. Please check the documentation in each new repository to\n    get familiar with the new usage.\n\n+-------------------------------------+-------------------------------------+\n| Old location                        | New location                        |\n+=====================================+=====================================+\n| scrapy.commands.deploy              | `scrapyd-client <https://github.com |\n|                                     | /scrapy/scrapyd-client>`_           |\n|                                     | (See other alternatives here:       |\n|                                     | :ref:`topics-deploy`)               |\n+-------------------------------------+-------------------------------------+\n| scrapy.contrib.djangoitem           | `scrapy-djangoitem <https://github. |\n|                                     | com/scrapy-plugins/scrapy-djangoite |\n|                                     | m>`_                                |\n+-------------------------------------+-------------------------------------+\n| scrapy.webservice                   | `scrapy-jsonrpc <https://github.com |\n|                                     | /scrapy-plugins/scrapy-jsonrpc>`_   |\n+-------------------------------------+-------------------------------------+\n\n``scrapy.contrib_exp`` and ``scrapy.contrib`` dissolutions\n\n+-------------------------------------+-------------------------------------+\n| Old location                        | New location                        |\n+=====================================+=====================================+\n| scrapy.contrib\\_exp.downloadermidd\\ | scrapy.downloadermiddlewares.decom\\ |\n| leware.decompression                | pression                            |\n+-------------------------------------+-------------------------------------+\n| scrapy.contrib\\_exp.iterators       | scrapy.utils.iterators              |\n+-------------------------------------+-------------------------------------+\n| scrapy.contrib.downloadermiddleware | scrapy.downloadermiddlewares        |\n+-------------------------------------+-------------------------------------+\n| scrapy.contrib.exporter             | scrapy.exporters                    |\n+-------------------------------------+-------------------------------------+\n| scrapy.contrib.linkextractors       | scrapy.linkextractors               |\n+-------------------------------------+-------------------------------------+\n| scrapy.contrib.loader               | scrapy.loader                       |\n+-------------------------------------+-------------------------------------+\n| scrapy.contrib.loader.processor     | scrapy.loader.processors            |\n+-------------------------------------+-------------------------------------+\n| scrapy.contrib.pipeline             | scrapy.pipelines                    |\n+-------------------------------------+-------------------------------------+\n| scrapy.contrib.spidermiddleware     | scrapy.spidermiddlewares            |\n+-------------------------------------+-------------------------------------+\n| scrapy.contrib.spiders              | scrapy.spiders                      |\n+-------------------------------------+-------------------------------------+\n| * scrapy.contrib.closespider        | scrapy.extensions.\\*                |\n| * scrapy.contrib.corestats          |                                     |\n| * scrapy.contrib.debug              |                                     |\n| * scrapy.contrib.feedexport         |                                     |\n| * scrapy.contrib.httpcache          |                                     |\n| * scrapy.contrib.logstats           |                                     |\n| * scrapy.contrib.memdebug           |                                     |\n| * scrapy.contrib.memusage           |                                     |\n| * scrapy.contrib.spiderstate        |                                     |\n| * scrapy.contrib.statsmailer        |                                     |\n| * scrapy.contrib.throttle           |                                     |\n+-------------------------------------+-------------------------------------+\n\nPlural renames and Modules unification\n\n+-------------------------------------+-------------------------------------+\n| Old location                        | New location                        |\n+=====================================+=====================================+\n| scrapy.command                      | scrapy.commands                     |\n+-------------------------------------+-------------------------------------+\n| scrapy.dupefilter                   | scrapy.dupefilters                  |\n+-------------------------------------+-------------------------------------+\n| scrapy.linkextractor                | scrapy.linkextractors               |\n+-------------------------------------+-------------------------------------+\n| scrapy.spider                       | scrapy.spiders                      |\n+-------------------------------------+-------------------------------------+\n| scrapy.squeue                       | scrapy.squeues                      |\n+-------------------------------------+-------------------------------------+\n| scrapy.statscol                     | scrapy.statscollectors              |\n+-------------------------------------+-------------------------------------+\n| scrapy.utils.decorator              | scrapy.utils.decorators             |\n+-------------------------------------+-------------------------------------+\n\nClass renames\n\n+-------------------------------------+-------------------------------------+\n| Old location                        | New location                        |\n+=====================================+=====================================+\n| scrapy.spidermanager.SpiderManager  | scrapy.spiderloader.SpiderLoader    |\n+-------------------------------------+-------------------------------------+\n\nSettings renames\n\n+-------------------------------------+-------------------------------------+\n| Old location                        | New location                        |\n+=====================================+=====================================+\n| SPIDER\\_MANAGER\\_CLASS              | SPIDER\\_LOADER\\_CLASS               |\n+-------------------------------------+-------------------------------------+\n\nChangelog\n~~~~~~~~~\n\nNew Features and Enhancements\n\n- Python logging (:issue:`1060`, :issue:`1235`, :issue:`1236`, :issue:`1240`,\n  :issue:`1259`, :issue:`1278`, :issue:`1286`)\n- FEED_EXPORT_FIELDS option (:issue:`1159`, :issue:`1224`)\n- Dns cache size and timeout options (:issue:`1132`)\n- support namespace prefix in xmliter_lxml (:issue:`963`)\n- Reactor threadpool max size setting (:issue:`1123`)\n- Allow spiders to return dicts. (:issue:`1081`)\n- Add Response.urljoin() helper (:issue:`1086`)\n- look in ~/.config/scrapy.cfg for user config (:issue:`1098`)\n- handle TLS SNI (:issue:`1101`)\n- Selectorlist extract first (:issue:`624`, :issue:`1145`)\n- Added JmesSelect (:issue:`1016`)\n- add gzip compression to filesystem http cache backend (:issue:`1020`)\n- CSS support in link extractors (:issue:`983`)\n- httpcache dont_cache meta #19 #689 (:issue:`821`)\n- add signal to be sent when request is dropped by the scheduler\n  (:issue:`961`)\n- avoid download large response (:issue:`946`)\n- Allow to specify the quotechar in CSVFeedSpider (:issue:`882`)\n- Add referer to \"Spider error processing\" log message (:issue:`795`)\n- process robots.txt once (:issue:`896`)\n- GSoC Per-spider settings (:issue:`854`)\n- Add project name validation (:issue:`817`)\n- GSoC API cleanup (:issue:`816`, :issue:`1128`, :issue:`1147`,\n  :issue:`1148`, :issue:`1156`, :issue:`1185`, :issue:`1187`, :issue:`1258`,\n  :issue:`1268`, :issue:`1276`, :issue:`1285`, :issue:`1284`)\n- Be more responsive with IO operations (:issue:`1074` and :issue:`1075`)\n- Do leveldb compaction for httpcache on closing (:issue:`1297`)\n\nDeprecations and Removals\n\n- Deprecate htmlparser link extractor (:issue:`1205`)\n- remove deprecated code from FeedExporter (:issue:`1155`)\n- a leftover for.15 compatibility (:issue:`925`)\n- drop support for CONCURRENT_REQUESTS_PER_SPIDER (:issue:`895`)\n- Drop old engine code (:issue:`911`)\n- Deprecate SgmlLinkExtractor (:issue:`777`)\n\nRelocations\n\n- Move exporters/__init__.py to exporters.py (:issue:`1242`)\n- Move base classes to their packages (:issue:`1218`, :issue:`1233`)\n- Module relocation (:issue:`1181`, :issue:`1210`)\n- rename SpiderManager to SpiderLoader (:issue:`1166`)\n- Remove djangoitem (:issue:`1177`)\n- remove scrapy deploy command (:issue:`1102`)\n- dissolve contrib_exp (:issue:`1134`)\n- Deleted bin folder from root, fixes #913 (:issue:`914`)\n- Remove jsonrpc based webservice (:issue:`859`)\n- Move Test cases under project root dir (:issue:`827`, :issue:`841`)\n- Fix backward incompatibility for relocated paths in settings\n  (:issue:`1267`)\n\nDocumentation\n\n- CrawlerProcess documentation (:issue:`1190`)\n- Favoring web scraping over screen scraping in the descriptions\n  (:issue:`1188`)\n- Some improvements for Scrapy tutorial (:issue:`1180`)\n- Documenting Files Pipeline together with Images Pipeline (:issue:`1150`)\n- deployment docs tweaks (:issue:`1164`)\n- Added deployment section covering scrapyd-deploy and shub (:issue:`1124`)\n- Adding more settings to project template (:issue:`1073`)\n- some improvements to overview page (:issue:`1106`)\n- Updated link in docs/topics/architecture.rst (:issue:`647`)\n- DOC reorder topics (:issue:`1022`)\n- updating list of Request.meta special keys (:issue:`1071`)\n- DOC document download_timeout (:issue:`898`)\n- DOC simplify extension docs (:issue:`893`)\n- Leaks docs (:issue:`894`)\n- DOC document from_crawler method for item pipelines (:issue:`904`)\n- Spider_error doesn't support deferreds (:issue:`1292`)\n- Corrections & Sphinx related fixes (:issue:`1220`, :issue:`1219`,\n  :issue:`1196`, :issue:`1172`, :issue:`1171`, :issue:`1169`, :issue:`1160`,\n  :issue:`1154`, :issue:`1127`, :issue:`1112`, :issue:`1105`, :issue:`1041`,\n  :issue:`1082`, :issue:`1033`, :issue:`944`, :issue:`866`, :issue:`864`,\n  :issue:`796`, :issue:`1260`, :issue:`1271`, :issue:`1293`, :issue:`1298`)\n\nBugfixes\n\n- Item multi inheritance fix (:issue:`353`, :issue:`1228`)\n- ItemLoader.load_item: iterate over copy of fields (:issue:`722`)\n- Fix Unhandled error in Deferred (RobotsTxtMiddleware) (:issue:`1131`,\n  :issue:`1197`)\n- Force to read DOWNLOAD_TIMEOUT as int (:issue:`954`)\n- scrapy.utils.misc.load_object should print full traceback (:issue:`902`)\n- Fix bug for \".local\" host name (:issue:`878`)\n- Fix for Enabled extensions, middlewares, pipelines info not printed\n  anymore (:issue:`879`)\n- fix dont_merge_cookies bad behaviour when set to false on meta\n  (:issue:`846`)\n\nPython 3 In Progress Support\n\n- disable scrapy.telnet if twisted.conch is not available (:issue:`1161`)\n- fix Python 3 syntax errors in ajaxcrawl.py (:issue:`1162`)\n- more python3 compatibility changes for urllib (:issue:`1121`)\n- assertItemsEqual was renamed to assertCountEqual in Python 3.\n  (:issue:`1070`)\n- Import unittest.mock if available. (:issue:`1066`)\n- updated deprecated cgi.parse_qsl to use six's parse_qsl (:issue:`909`)\n- Prevent Python 3 port regressions (:issue:`830`)\n- PY3: use MutableMapping for python 3 (:issue:`810`)\n- PY3: use six.BytesIO and six.moves.cStringIO (:issue:`803`)\n- PY3: fix xmlrpclib and email imports (:issue:`801`)\n- PY3: use six for robotparser and urlparse (:issue:`800`)\n- PY3: use six.iterkeys, six.iteritems, and tempfile (:issue:`799`)\n- PY3: fix has_key and use six.moves.configparser (:issue:`798`)\n- PY3: use six.moves.cPickle (:issue:`797`)\n- PY3 make it possible to run some tests in Python3 (:issue:`776`)\n\nTests\n\n- remove unnecessary lines from py3-ignores (:issue:`1243`)\n- Fix remaining warnings from pytest while collecting tests (:issue:`1206`)\n- Add docs build to travis (:issue:`1234`)\n- TST don't collect tests from deprecated modules. (:issue:`1165`)\n- install service_identity package in tests to prevent warnings\n  (:issue:`1168`)\n- Fix deprecated settings API in tests (:issue:`1152`)\n- Add test for webclient with POST method and no body given (:issue:`1089`)\n- py3-ignores.txt supports comments (:issue:`1044`)\n- modernize some of the asserts (:issue:`835`)\n- selector.__repr__ test (:issue:`779`)\n\nCode refactoring\n\n- CSVFeedSpider cleanup: use iterate_spider_output (:issue:`1079`)\n- remove unnecessary check from scrapy.utils.spider.iter_spider_output\n  (:issue:`1078`)\n- Pydispatch pep8 (:issue:`992`)\n- Removed unused 'load=False' parameter from walk_modules() (:issue:`871`)\n- For consistency, use ``job_dir`` helper in ``SpiderState`` extension.\n  (:issue:`805`)\n- rename \"sflo\" local variables to less cryptic \"log_observer\" (:issue:`775`)\n\nScrapy 0.24.6 (2015-04-20)\n--------------------------\n\n- encode invalid xpath with unicode_escape under PY2 (:commit:`07cb3e5`)\n- fix IPython shell scope issue and load IPython user config (:commit:`2c8e573`)\n- Fix small typo in the docs (:commit:`d694019`)\n- Fix small typo (:commit:`f92fa83`)\n- Converted sel.xpath() calls to response.xpath() in Extracting the data (:commit:`c2c6d15`)\n\n\nScrapy 0.24.5 (2015-02-25)\n--------------------------\n\n- Support new _getEndpoint Agent signatures on Twisted 15.0.0 (:commit:`540b9bc`)\n- DOC a couple more references are fixed (:commit:`b4c454b`)\n- DOC fix a reference (:commit:`e3c1260`)\n- t.i.b.ThreadedResolver is now a new-style class (:commit:`9e13f42`)\n- S3DownloadHandler: fix auth for requests with quoted paths/query params (:commit:`cdb9a0b`)\n- fixed the variable types in mailsender documentation (:commit:`bb3a848`)\n- Reset items_scraped instead of item_count (:commit:`edb07a4`)\n- Tentative attention message about what document to read for contributions (:commit:`7ee6f7a`)\n- mitmproxy 0.10.1 needs netlib 0.10.1 too (:commit:`874fcdd`)\n- pin mitmproxy 0.10.1 as >0.11 does not work with tests (:commit:`c6b21f0`)\n- Test the parse command locally instead of against an external url (:commit:`c3a6628`)\n- Patches Twisted issue while closing the connection pool on HTTPDownloadHandler (:commit:`d0bf957`)\n- Updates documentation on dynamic item classes. (:commit:`eeb589a`)\n- Merge pull request #943 from Lazar-T/patch-3 (:commit:`5fdab02`)\n- typo (:commit:`b0ae199`)\n- pywin32 is required by Twisted. closes #937 (:commit:`5cb0cfb`)\n- Update install.rst (:commit:`781286b`)\n- Merge pull request #928 from Lazar-T/patch-1 (:commit:`b415d04`)\n- comma instead of fullstop (:commit:`627b9ba`)\n- Merge pull request #885 from jsma/patch-1 (:commit:`de909ad`)\n- Update request-response.rst (:commit:`3f3263d`)\n- SgmlLinkExtractor - fix for parsing <area> tag with Unicode present (:commit:`49b40f0`)\n\nScrapy 0.24.4 (2014-08-09)\n--------------------------\n\n- pem file is used by mockserver and required by scrapy bench (:commit:`5eddc68`)\n- scrapy bench needs scrapy.tests* (:commit:`d6cb999`)\n\nScrapy 0.24.3 (2014-08-09)\n--------------------------\n\n- no need to waste travis-ci time on py3 for 0.24 (:commit:`8e080c1`)\n- Update installation docs (:commit:`1d0c096`)\n- There is a trove classifier for Scrapy framework! (:commit:`4c701d7`)\n- update other places where w3lib version is mentioned (:commit:`d109c13`)\n- Update w3lib requirement to 1.8.0 (:commit:`39d2ce5`)\n- Use w3lib.html.replace_entities() (remove_entities() is deprecated) (:commit:`180d3ad`)\n- set zip_safe=False (:commit:`a51ee8b`)\n- do not ship tests package (:commit:`ee3b371`)\n- scrapy.bat is not needed anymore (:commit:`c3861cf`)\n- Modernize setup.py (:commit:`362e322`)\n- headers can not handle non-string values (:commit:`94a5c65`)\n- fix ftp test cases (:commit:`a274a7f`)\n- The sum up of travis-ci builds are taking like 50min to complete (:commit:`ae1e2cc`)\n- Update shell.rst typo (:commit:`e49c96a`)\n- removes weird indentation in the shell results (:commit:`1ca489d`)\n- improved explanations, clarified blog post as source, added link for XPath string functions in the spec (:commit:`65c8f05`)\n- renamed UserTimeoutError and ServerTimeouterror #583 (:commit:`037f6ab`)\n- adding some xpath tips to selectors docs (:commit:`2d103e0`)\n- fix tests to account for https://github.com/scrapy/w3lib/pull/23 (:commit:`f8d366a`)\n- get_func_args maximum recursion fix #728 (:commit:`81344ea`)\n- Updated input/output processor example according to #560. (:commit:`f7c4ea8`)\n- Fixed Python syntax in tutorial. (:commit:`db59ed9`)\n- Add test case for tunneling proxy (:commit:`f090260`)\n- Bugfix for leaking Proxy-Authorization header to remote host when using tunneling (:commit:`d8793af`)\n- Extract links from XHTML documents with MIME-Type \"application/xml\" (:commit:`ed1f376`)\n- Merge pull request #793 from roysc/patch-1 (:commit:`91a1106`)\n- Fix typo in commands.rst (:commit:`743e1e2`)\n- better testcase for settings.overrides.setdefault (:commit:`e22daaf`)\n- Using CRLF as line marker according to http 1.1 definition (:commit:`5ec430b`)\n\nScrapy 0.24.2 (2014-07-08)\n--------------------------\n\n- Use a mutable mapping to proxy deprecated settings.overrides and settings.defaults attribute (:commit:`e5e8133`)\n- there is not support for python3 yet (:commit:`3cd6146`)\n- Update python compatible version set to Debian packages (:commit:`fa5d76b`)\n- DOC fix formatting in release notes (:commit:`c6a9e20`)\n\nScrapy 0.24.1 (2014-06-27)\n--------------------------\n\n- Fix deprecated CrawlerSettings and increase backward compatibility with\n  .defaults attribute (:commit:`8e3f20a`)\n\n\nScrapy 0.24.0 (2014-06-26)\n--------------------------\n\nEnhancements\n~~~~~~~~~~~~\n\n- Improve Scrapy top-level namespace (:issue:`494`, :issue:`684`)\n- Add selector shortcuts to responses (:issue:`554`, :issue:`690`)\n- Add new lxml based LinkExtractor to replace unmaintained SgmlLinkExtractor\n  (:issue:`559`, :issue:`761`, :issue:`763`)\n- Cleanup settings API - part of per-spider settings **GSoC project** (:issue:`737`)\n- Add UTF8 encoding header to templates (:issue:`688`, :issue:`762`)\n- Telnet console now binds to 127.0.0.1 by default (:issue:`699`)\n- Update Debian/Ubuntu install instructions (:issue:`509`, :issue:`549`)\n- Disable smart strings in lxml XPath evaluations (:issue:`535`)\n- Restore filesystem based cache as default for http\n  cache middleware (:issue:`541`, :issue:`500`, :issue:`571`)\n- Expose current crawler in Scrapy shell (:issue:`557`)\n- Improve testsuite comparing CSV and XML exporters (:issue:`570`)\n- New ``offsite/filtered`` and ``offsite/domains`` stats (:issue:`566`)\n- Support process_links as generator in CrawlSpider (:issue:`555`)\n- Verbose logging and new stats counters for DupeFilter (:issue:`553`)\n- Add a mimetype parameter to ``MailSender.send()`` (:issue:`602`)\n- Generalize file pipeline log messages (:issue:`622`)\n- Replace unencodeable codepoints with html entities in SGMLLinkExtractor (:issue:`565`)\n- Converted SEP documents to rst format (:issue:`629`, :issue:`630`,\n  :issue:`638`, :issue:`632`, :issue:`636`, :issue:`640`, :issue:`635`,\n  :issue:`634`, :issue:`639`, :issue:`637`, :issue:`631`, :issue:`633`,\n  :issue:`641`, :issue:`642`)\n- Tests and docs for clickdata's nr index in FormRequest (:issue:`646`, :issue:`645`)\n- Allow to disable a downloader handler just like any other component (:issue:`650`)\n- Log when a request is discarded after too many redirections (:issue:`654`)\n- Log error responses if they are not handled by spider callbacks\n  (:issue:`612`, :issue:`656`)\n- Add content-type check to http compression mw (:issue:`193`, :issue:`660`)\n- Run pypy tests using latest pypi from ppa (:issue:`674`)\n- Run test suite using pytest instead of trial (:issue:`679`)\n- Build docs and check for dead links in tox environment (:issue:`687`)\n- Make scrapy.version_info a tuple of integers (:issue:`681`, :issue:`692`)\n- Infer exporter's output format from filename extensions\n  (:issue:`546`, :issue:`659`, :issue:`760`)\n- Support case-insensitive domains in ``url_is_from_any_domain()`` (:issue:`693`)\n- Remove pep8 warnings in project and spider templates (:issue:`698`)\n- Tests and docs for ``request_fingerprint`` function (:issue:`597`)\n- Update SEP-19 for GSoC project ``per-spider settings`` (:issue:`705`)\n- Set exit code to non-zero when contracts fails (:issue:`727`)\n- Add a setting to control what class is instantiated as Downloader component\n  (:issue:`738`)\n- Pass response in ``item_dropped`` signal (:issue:`724`)\n- Improve ``scrapy check`` contracts command (:issue:`733`, :issue:`752`)\n- Document ``spider.closed()`` shortcut (:issue:`719`)\n- Document ``request_scheduled`` signal (:issue:`746`)\n- Add a note about reporting security issues (:issue:`697`)\n- Add LevelDB http cache storage backend (:issue:`626`, :issue:`500`)\n- Sort spider list output of ``scrapy list`` command (:issue:`742`)\n- Multiple documentation enhancements and fixes\n  (:issue:`575`, :issue:`587`, :issue:`590`, :issue:`596`, :issue:`610`,\n  :issue:`617`, :issue:`618`, :issue:`627`, :issue:`613`, :issue:`643`,\n  :issue:`654`, :issue:`675`, :issue:`663`, :issue:`711`, :issue:`714`)\n\nBugfixes\n~~~~~~~~\n\n- Encode unicode URL value when creating Links in RegexLinkExtractor (:issue:`561`)\n- Ignore None values in ItemLoader processors (:issue:`556`)\n- Fix link text when there is an inner tag in SGMLLinkExtractor and\n  HtmlParserLinkExtractor (:issue:`485`, :issue:`574`)\n- Fix wrong checks on subclassing of deprecated classes\n  (:issue:`581`, :issue:`584`)\n- Handle errors caused by inspect.stack() failures (:issue:`582`)\n- Fix a reference to unexistent engine attribute (:issue:`593`, :issue:`594`)\n- Fix dynamic itemclass example usage of type() (:issue:`603`)\n- Use lucasdemarchi/codespell to fix typos (:issue:`628`)\n- Fix default value of attrs argument in SgmlLinkExtractor to be tuple (:issue:`661`)\n- Fix XXE flaw in sitemap reader (:issue:`676`)\n- Fix engine to support filtered start requests (:issue:`707`)\n- Fix offsite middleware case on urls with no hostnames (:issue:`745`)\n- Testsuite doesn't require PIL anymore (:issue:`585`)\n\n\nScrapy 0.22.2 (released 2014-02-14)\n-----------------------------------\n\n- fix a reference to unexistent engine.slots. closes #593 (:commit:`13c099a`)\n- downloaderMW doc typo (spiderMW doc copy remnant) (:commit:`8ae11bf`)\n- Correct typos (:commit:`1346037`)\n\nScrapy 0.22.1 (released 2014-02-08)\n-----------------------------------\n\n- localhost666 can resolve under certain circumstances (:commit:`2ec2279`)\n- test inspect.stack failure (:commit:`cc3eda3`)\n- Handle cases when inspect.stack() fails (:commit:`8cb44f9`)\n- Fix wrong checks on subclassing of deprecated classes. closes #581 (:commit:`46d98d6`)\n- Docs: 4-space indent for final spider example (:commit:`13846de`)\n- Fix HtmlParserLinkExtractor and tests after #485 merge (:commit:`368a946`)\n- BaseSgmlLinkExtractor: Fixed the missing space when the link has an inner tag (:commit:`b566388`)\n- BaseSgmlLinkExtractor: Added unit test of a link with an inner tag (:commit:`c1cb418`)\n- BaseSgmlLinkExtractor: Fixed unknown_endtag() so that it only set current_link=None when the end tag match the opening tag (:commit:`7e4d627`)\n- Fix tests for Travis-CI build (:commit:`76c7e20`)\n- replace unencodable codepoints with html entities. fixes #562 and #285 (:commit:`5f87b17`)\n- RegexLinkExtractor: encode URL unicode value when creating Links (:commit:`d0ee545`)\n- Updated the tutorial crawl output with latest output. (:commit:`8da65de`)\n- Updated shell docs with the crawler reference and fixed the actual shell output. (:commit:`875b9ab`)\n- PEP8 minor edits. (:commit:`f89efaf`)\n- Expose current crawler in the Scrapy shell. (:commit:`5349cec`)\n- Unused re import and PEP8 minor edits. (:commit:`387f414`)\n- Ignore None's values when using the ItemLoader. (:commit:`0632546`)\n- DOC Fixed HTTPCACHE_STORAGE typo in the default value which is now Filesystem instead Dbm. (:commit:`cde9a8c`)\n- show Ubuntu setup instructions as literal code (:commit:`fb5c9c5`)\n- Update Ubuntu installation instructions (:commit:`70fb105`)\n- Merge pull request #550 from stray-leone/patch-1 (:commit:`6f70b6a`)\n- modify the version of Scrapy Ubuntu package (:commit:`725900d`)\n- fix 0.22.0 release date (:commit:`af0219a`)\n- fix typos in news.rst and remove (not released yet) header (:commit:`b7f58f4`)\n\nScrapy 0.22.0 (released 2014-01-17)\n-----------------------------------\n\nEnhancements\n~~~~~~~~~~~~\n\n- [**Backward incompatible**] Switched HTTPCacheMiddleware backend to filesystem (:issue:`541`)\n  To restore old backend set ``HTTPCACHE_STORAGE`` to ``scrapy.contrib.httpcache.DbmCacheStorage``\n- Proxy \\https:// urls using CONNECT method (:issue:`392`, :issue:`397`)\n- Add a middleware to crawl ajax crawleable pages as defined by google (:issue:`343`)\n- Rename scrapy.spider.BaseSpider to scrapy.spider.Spider (:issue:`510`, :issue:`519`)\n- Selectors register EXSLT namespaces by default (:issue:`472`)\n- Unify item loaders similar to selectors renaming (:issue:`461`)\n- Make ``RFPDupeFilter`` class easily subclassable (:issue:`533`)\n- Improve test coverage and forthcoming Python 3 support (:issue:`525`)\n- Promote startup info on settings and middleware to INFO level (:issue:`520`)\n- Support partials in ``get_func_args`` util (:issue:`506`, issue:`504`)\n- Allow running individual tests via tox (:issue:`503`)\n- Update extensions ignored by link extractors (:issue:`498`)\n- Add middleware methods to get files/images/thumbs paths (:issue:`490`)\n- Improve offsite middleware tests (:issue:`478`)\n- Add a way to skip default Referer header set by RefererMiddleware (:issue:`475`)\n- Do not send ``x-gzip`` in default ``Accept-Encoding`` header (:issue:`469`)\n- Support defining http error handling using settings (:issue:`466`)\n- Use modern python idioms wherever you find legacies (:issue:`497`)\n- Improve and correct documentation\n  (:issue:`527`, :issue:`524`, :issue:`521`, :issue:`517`, :issue:`512`, :issue:`505`,\n  :issue:`502`, :issue:`489`, :issue:`465`, :issue:`460`, :issue:`425`, :issue:`536`)\n\nFixes\n~~~~~\n\n- Update Selector class imports in CrawlSpider template (:issue:`484`)\n- Fix unexistent reference to ``engine.slots`` (:issue:`464`)\n- Do not try to call ``body_as_unicode()`` on a non-TextResponse instance (:issue:`462`)\n- Warn when subclassing XPathItemLoader, previously it only warned on\n  instantiation. (:issue:`523`)\n- Warn when subclassing XPathSelector, previously it only warned on\n  instantiation. (:issue:`537`)\n- Multiple fixes to memory stats (:issue:`531`, :issue:`530`, :issue:`529`)\n- Fix overriding url in ``FormRequest.from_response()`` (:issue:`507`)\n- Fix tests runner under pip 1.5 (:issue:`513`)\n- Fix logging error when spider name is unicode (:issue:`479`)\n\nScrapy 0.20.2 (released 2013-12-09)\n-----------------------------------\n\n- Update CrawlSpider Template with Selector changes (:commit:`6d1457d`)\n- fix method name in tutorial. closes GH-480 (:commit:`b4fc359`\n\nScrapy 0.20.1 (released 2013-11-28)\n-----------------------------------\n\n- include_package_data is required to build wheels from published sources (:commit:`5ba1ad5`)\n- process_parallel was leaking the failures on its internal deferreds.  closes #458 (:commit:`419a780`)\n\nScrapy 0.20.0 (released 2013-11-08)\n-----------------------------------\n\nEnhancements\n~~~~~~~~~~~~\n\n- New Selector's API including CSS selectors (:issue:`395` and :issue:`426`),\n- Request/Response url/body attributes are now immutable\n  (modifying them had been deprecated for a long time)\n- :setting:`ITEM_PIPELINES` is now defined as a dict (instead of a list)\n- Sitemap spider can fetch alternate URLs (:issue:`360`)\n- ``Selector.remove_namespaces()`` now remove namespaces from element's attributes. (:issue:`416`)\n- Paved the road for Python 3.3+ (:issue:`435`, :issue:`436`, :issue:`431`, :issue:`452`)\n- New item exporter using native python types with nesting support (:issue:`366`)\n- Tune HTTP1.1 pool size so it matches concurrency defined by settings (:commit:`b43b5f575`)\n- scrapy.mail.MailSender now can connect over TLS or upgrade using STARTTLS (:issue:`327`)\n- New FilesPipeline with functionality factored out from ImagesPipeline (:issue:`370`, :issue:`409`)\n- Recommend Pillow instead of PIL for image handling (:issue:`317`)\n- Added Debian packages for Ubuntu Quantal and Raring (:commit:`86230c0`)\n- Mock server (used for tests) can listen for HTTPS requests (:issue:`410`)\n- Remove multi spider support from multiple core components\n  (:issue:`422`, :issue:`421`, :issue:`420`, :issue:`419`, :issue:`423`, :issue:`418`)\n- Travis-CI now tests Scrapy changes against development versions of ``w3lib`` and ``queuelib`` python packages.\n- Add pypy 2.1 to continuous integration tests (:commit:`ecfa7431`)\n- Pylinted, pep8 and removed old-style exceptions from source (:issue:`430`, :issue:`432`)\n- Use importlib for parametric imports (:issue:`445`)\n- Handle a regression introduced in Python 2.7.5 that affects XmlItemExporter (:issue:`372`)\n- Bugfix crawling shutdown on SIGINT (:issue:`450`)\n- Do not submit ``reset`` type inputs in FormRequest.from_response (:commit:`b326b87`)\n- Do not silence download errors when request errback raises an exception (:commit:`684cfc0`)\n\nBugfixes\n~~~~~~~~\n\n- Fix tests under Django 1.6 (:commit:`b6bed44c`)\n- Lot of bugfixes to retry middleware under disconnections using HTTP 1.1 download handler\n- Fix inconsistencies among Twisted releases (:issue:`406`)\n- Fix Scrapy shell bugs (:issue:`418`, :issue:`407`)\n- Fix invalid variable name in setup.py (:issue:`429`)\n- Fix tutorial references (:issue:`387`)\n- Improve request-response docs (:issue:`391`)\n- Improve best practices docs (:issue:`399`, :issue:`400`, :issue:`401`, :issue:`402`)\n- Improve django integration docs (:issue:`404`)\n- Document ``bindaddress`` request meta (:commit:`37c24e01d7`)\n- Improve ``Request`` class documentation (:issue:`226`)\n\nOther\n~~~~~\n\n- Dropped Python 2.6 support (:issue:`448`)\n- Add :doc:`cssselect <cssselect:index>` python package as install dependency\n- Drop libxml2 and multi selector's backend support, `lxml`_ is required from now on.\n- Minimum Twisted version increased to 10.0.0, dropped Twisted 8.0 support.\n- Running test suite now requires ``mock`` python library (:issue:`390`)\n\n\nThanks\n~~~~~~\n\nThanks to everyone who contribute to this release!\n\nList of contributors sorted by number of commits::\n\n     69 Daniel Gra\u251c\u2592a <dangra@...>\n     37 Pablo Hoffman <pablo@...>\n     13 Mikhail Korobov <kmike84@...>\n      9 Alex Cepoi <alex.cepoi@...>\n      9 alexanderlukanin13 <alexander.lukanin.13@...>\n      8 Rolando Espinoza La fuente <darkrho@...>\n      8 Lukasz Biedrycki <lukasz.biedrycki@...>\n      6 Nicolas Ramirez <nramirez.uy@...>\n      3 Paul Tremberth <paul.tremberth@...>\n      2 Martin Olveyra <molveyra@...>\n      2 Stefan <misc@...>\n      2 Rolando Espinoza <darkrho@...>\n      2 Loren Davie <loren@...>\n      2 irgmedeiros <irgmedeiros@...>\n      1 Stefan Koch <taikano@...>\n      1 Stefan <cct@...>\n      1 scraperdragon <dragon@...>\n      1 Kumara Tharmalingam <ktharmal@...>\n      1 Francesco Piccinno <stack.box@...>\n      1 Marcos Campal <duendex@...>\n      1 Dragon Dave <dragon@...>\n      1 Capi Etheriel <barraponto@...>\n      1 cacovsky <amarquesferraz@...>\n      1 Berend Iwema <berend@...>\n\nScrapy 0.18.4 (released 2013-10-10)\n-----------------------------------\n\n- IPython refuses to update the namespace. fix #396 (:commit:`3d32c4f`)\n- Fix AlreadyCalledError replacing a request in shell command. closes #407 (:commit:`b1d8919`)\n- Fix start_requests laziness and early hangs (:commit:`89faf52`)\n\nScrapy 0.18.3 (released 2013-10-03)\n-----------------------------------\n\n- fix regression on lazy evaluation of start requests (:commit:`12693a5`)\n- forms: do not submit reset inputs (:commit:`e429f63`)\n- increase unittest timeouts to decrease travis false positive failures (:commit:`912202e`)\n- backport master fixes to json exporter (:commit:`cfc2d46`)\n- Fix permission and set umask before generating sdist tarball (:commit:`06149e0`)\n\nScrapy 0.18.2 (released 2013-09-03)\n-----------------------------------\n\n- Backport ``scrapy check`` command fixes and backward compatible multi\n  crawler process(:issue:`339`)\n\nScrapy 0.18.1 (released 2013-08-27)\n-----------------------------------\n\n- remove extra import added by cherry picked changes (:commit:`d20304e`)\n- fix crawling tests under twisted pre 11.0.0 (:commit:`1994f38`)\n- py26 can not format zero length fields {} (:commit:`abf756f`)\n- test PotentiaDataLoss errors on unbound responses (:commit:`b15470d`)\n- Treat responses without content-length or Transfer-Encoding as good responses (:commit:`c4bf324`)\n- do no include ResponseFailed if http11 handler is not enabled (:commit:`6cbe684`)\n- New HTTP client wraps connection lost in ResponseFailed exception. fix #373 (:commit:`1a20bba`)\n- limit travis-ci build matrix (:commit:`3b01bb8`)\n- Merge pull request #375 from peterarenot/patch-1 (:commit:`fa766d7`)\n- Fixed so it refers to the correct folder (:commit:`3283809`)\n- added Quantal & Raring to support Ubuntu releases (:commit:`1411923`)\n- fix retry middleware which didn't retry certain connection errors after the upgrade to http1 client, closes GH-373 (:commit:`bb35ed0`)\n- fix XmlItemExporter in Python 2.7.4 and 2.7.5 (:commit:`de3e451`)\n- minor updates to 0.18 release notes (:commit:`c45e5f1`)\n- fix contributors list format (:commit:`0b60031`)\n\nScrapy 0.18.0 (released 2013-08-09)\n-----------------------------------\n\n- Lot of improvements to testsuite run using Tox, including a way to test on pypi\n- Handle GET parameters for AJAX crawleable urls (:commit:`3fe2a32`)\n- Use lxml recover option to parse sitemaps (:issue:`347`)\n- Bugfix cookie merging by hostname and not by netloc (:issue:`352`)\n- Support disabling ``HttpCompressionMiddleware`` using a flag setting (:issue:`359`)\n- Support xml namespaces using ``iternodes`` parser in ``XMLFeedSpider`` (:issue:`12`)\n- Support ``dont_cache`` request meta flag (:issue:`19`)\n- Bugfix ``scrapy.utils.gz.gunzip`` broken by changes in python 2.7.4 (:commit:`4dc76e`)\n- Bugfix url encoding on ``SgmlLinkExtractor`` (:issue:`24`)\n- Bugfix ``TakeFirst`` processor shouldn't discard zero (0) value (:issue:`59`)\n- Support nested items in xml exporter (:issue:`66`)\n- Improve cookies handling performance (:issue:`77`)\n- Log dupe filtered requests once (:issue:`105`)\n- Split redirection middleware into status and meta based middlewares (:issue:`78`)\n- Use HTTP1.1 as default downloader handler (:issue:`109` and :issue:`318`)\n- Support xpath form selection on ``FormRequest.from_response`` (:issue:`185`)\n- Bugfix unicode decoding error on ``SgmlLinkExtractor`` (:issue:`199`)\n- Bugfix signal dispatching on pypi interpreter (:issue:`205`)\n- Improve request delay and concurrency handling (:issue:`206`)\n- Add RFC2616 cache policy to ``HttpCacheMiddleware`` (:issue:`212`)\n- Allow customization of messages logged by engine (:issue:`214`)\n- Multiples improvements to ``DjangoItem`` (:issue:`217`, :issue:`218`, :issue:`221`)\n- Extend Scrapy commands using setuptools entry points (:issue:`260`)\n- Allow spider ``allowed_domains`` value to be set/tuple (:issue:`261`)\n- Support ``settings.getdict`` (:issue:`269`)\n- Simplify internal ``scrapy.core.scraper`` slot handling (:issue:`271`)\n- Added ``Item.copy`` (:issue:`290`)\n- Collect idle downloader slots (:issue:`297`)\n- Add ``ftp://`` scheme downloader handler (:issue:`329`)\n- Added downloader benchmark webserver and spider tools :ref:`benchmarking`\n- Moved persistent (on disk) queues to a separate project (queuelib_) which Scrapy now depends on\n- Add Scrapy commands using external libraries (:issue:`260`)\n- Added ``--pdb`` option to ``scrapy`` command line tool\n- Added :meth:`XPathSelector.remove_namespaces <scrapy.selector.Selector.remove_namespaces>` which allows to remove all namespaces from XML documents for convenience (to work with namespace-less XPaths). Documented in :ref:`topics-selectors`.\n- Several improvements to spider contracts\n- New default middleware named MetaRefreshMiddldeware that handles meta-refresh html tag redirections,\n- MetaRefreshMiddldeware and RedirectMiddleware have different priorities to address #62\n- added from_crawler method to spiders\n- added system tests with mock server\n- more improvements to macOS compatibility (thanks Alex Cepoi)\n- several more cleanups to singletons and multi-spider support (thanks Nicolas Ramirez)\n- support custom download slots\n- added --spider option to \"shell\" command.\n- log overridden settings when Scrapy starts\n\nThanks to everyone who contribute to this release. Here is a list of\ncontributors sorted by number of commits::\n\n    130 Pablo Hoffman <pablo@...>\n     97 Daniel Gra\u251c\u2592a <dangra@...>\n     20 Nicol\u251c\u012as Ram\u251c\u0141rez <nramirez.uy@...>\n     13 Mikhail Korobov <kmike84@...>\n     12 Pedro Faustino <pedrobandim@...>\n     11 Steven Almeroth <sroth77@...>\n      5 Rolando Espinoza La fuente <darkrho@...>\n      4 Michal Danilak <mimino.coder@...>\n      4 Alex Cepoi <alex.cepoi@...>\n      4 Alexandr N Zamaraev (aka tonal) <tonal@...>\n      3 paul <paul.tremberth@...>\n      3 Martin Olveyra <molveyra@...>\n      3 Jordi Llonch <llonchj@...>\n      3 arijitchakraborty <myself.arijit@...>\n      2 Shane Evans <shane.evans@...>\n      2 joehillen <joehillen@...>\n      2 Hart <HartSimha@...>\n      2 Dan <ellisd23@...>\n      1 Zuhao Wan <wanzuhao@...>\n      1 whodatninja <blake@...>\n      1 vkrest <v.krestiannykov@...>\n      1 tpeng <pengtaoo@...>\n      1 Tom Mortimer-Jones <tom@...>\n      1 Rocio Aramberri <roschegel@...>\n      1 Pedro <pedro@...>\n      1 notsobad <wangxiaohugg@...>\n      1 Natan L <kuyanatan.nlao@...>\n      1 Mark Grey <mark.grey@...>\n      1 Luan <luanpab@...>\n      1 Libor Nenad\u251c\u012al <libor.nenadal@...>\n      1 Juan M Uys <opyate@...>\n      1 Jonas Brunsgaard <jonas.brunsgaard@...>\n      1 Ilya Baryshev <baryshev@...>\n      1 Hasnain Lakhani <m.hasnain.lakhani@...>\n      1 Emanuel Schorsch <emschorsch@...>\n      1 Chris Tilden <chris.tilden@...>\n      1 Capi Etheriel <barraponto@...>\n      1 cacovsky <amarquesferraz@...>\n      1 Berend Iwema <berend@...>\n\n\nScrapy 0.16.5 (released 2013-05-30)\n-----------------------------------\n\n- obey request method when Scrapy deploy is redirected to a new endpoint (:commit:`8c4fcee`)\n- fix inaccurate downloader middleware documentation. refs #280 (:commit:`40667cb`)\n- doc: remove links to diveintopython.org, which is no longer available. closes #246 (:commit:`bd58bfa`)\n- Find form nodes in invalid html5 documents (:commit:`e3d6945`)\n- Fix typo labeling attrs type bool instead of list (:commit:`a274276`)\n\nScrapy 0.16.4 (released 2013-01-23)\n-----------------------------------\n\n- fixes spelling errors in documentation (:commit:`6d2b3aa`)\n- add doc about disabling an extension. refs #132 (:commit:`c90de33`)\n- Fixed error message formatting. log.err() doesn't support cool formatting and when error occurred, the message was:    \"ERROR: Error processing %(item)s\" (:commit:`c16150c`)\n- lint and improve images pipeline error logging (:commit:`56b45fc`)\n- fixed doc typos (:commit:`243be84`)\n- add documentation topics: Broad Crawls & Common Practices (:commit:`1fbb715`)\n- fix bug in Scrapy parse command when spider is not specified explicitly. closes #209 (:commit:`c72e682`)\n- Update docs/topics/commands.rst (:commit:`28eac7a`)\n\nScrapy 0.16.3 (released 2012-12-07)\n-----------------------------------\n\n- Remove concurrency limitation when using download delays and still ensure inter-request delays are enforced (:commit:`487b9b5`)\n- add error details when image pipeline fails (:commit:`8232569`)\n- improve macOS compatibility (:commit:`8dcf8aa`)\n- setup.py: use README.rst to populate long_description (:commit:`7b5310d`)\n- doc: removed obsolete references to ClientForm (:commit:`80f9bb6`)\n- correct docs for default storage backend (:commit:`2aa491b`)\n- doc: removed broken proxyhub link from FAQ (:commit:`bdf61c4`)\n- Fixed docs typo in SpiderOpenCloseLogging example (:commit:`7184094`)\n\n\nScrapy 0.16.2 (released 2012-11-09)\n-----------------------------------\n\n- Scrapy contracts: python2.6 compat (:commit:`a4a9199`)\n- Scrapy contracts verbose option (:commit:`ec41673`)\n- proper unittest-like output for Scrapy contracts (:commit:`86635e4`)\n- added open_in_browser to debugging doc (:commit:`c9b690d`)\n- removed reference to global Scrapy stats from settings doc (:commit:`dd55067`)\n- Fix SpiderState bug in Windows platforms (:commit:`58998f4`)\n\n\nScrapy 0.16.1 (released 2012-10-26)\n-----------------------------------\n\n- fixed LogStats extension, which got broken after a wrong merge before the 0.16 release (:commit:`8c780fd`)\n- better backward compatibility for scrapy.conf.settings (:commit:`3403089`)\n- extended documentation on how to access crawler stats from extensions (:commit:`c4da0b5`)\n- removed .hgtags (no longer needed now that Scrapy uses git) (:commit:`d52c188`)\n- fix dashes under rst headers (:commit:`fa4f7f9`)\n- set release date for 0.16.0 in news (:commit:`e292246`)\n\n\nScrapy 0.16.0 (released 2012-10-18)\n-----------------------------------\n\nScrapy changes:\n\n- added :ref:`topics-contracts`, a mechanism for testing spiders in a formal/reproducible way\n- added options ``-o`` and ``-t`` to the :command:`runspider` command\n- documented :doc:`topics/autothrottle` and added to extensions installed by default. You still need to enable it with :setting:`AUTOTHROTTLE_ENABLED`\n- major Stats Collection refactoring: removed separation of global/per-spider stats, removed stats-related signals (``stats_spider_opened``, etc). Stats are much simpler now, backward compatibility is kept on the Stats Collector API and signals.\n- added :meth:`~scrapy.spidermiddlewares.SpiderMiddleware.process_start_requests` method to spider middlewares\n- dropped Signals singleton. Signals should now be accessed through the Crawler.signals attribute. See the signals documentation for more info.\n- dropped Stats Collector singleton. Stats can now be accessed through the Crawler.stats attribute. See the stats collection documentation for more info.\n- documented :ref:`topics-api`\n- ``lxml`` is now the default selectors backend instead of ``libxml2``\n- ported FormRequest.from_response() to use `lxml`_ instead of `ClientForm`_\n- removed modules: ``scrapy.xlib.BeautifulSoup`` and ``scrapy.xlib.ClientForm``\n- SitemapSpider: added support for sitemap urls ending in .xml and .xml.gz, even if they advertise a wrong content type (:commit:`10ed28b`)\n- StackTraceDump extension: also dump trackref live references (:commit:`fe2ce93`)\n- nested items now fully supported in JSON and JSONLines exporters\n- added :reqmeta:`cookiejar` Request meta key to support multiple cookie sessions per spider\n- decoupled encoding detection code to `w3lib.encoding`_, and ported Scrapy code to use that module\n- dropped support for Python 2.5. See https://blog.scrapinghub.com/2012/02/27/scrapy-0-15-dropping-support-for-python-2-5/\n- dropped support for Twisted 2.5\n- added :setting:`REFERER_ENABLED` setting, to control referer middleware\n- changed default user agent to: ``Scrapy/VERSION (+http://scrapy.org)``\n- removed (undocumented) ``HTMLImageLinkExtractor`` class from ``scrapy.contrib.linkextractors.image``\n- removed per-spider settings (to be replaced by instantiating multiple crawler objects)\n- ``USER_AGENT`` spider attribute will no longer work, use ``user_agent`` attribute instead\n- ``DOWNLOAD_TIMEOUT`` spider attribute will no longer work, use ``download_timeout`` attribute instead\n- removed ``ENCODING_ALIASES`` setting, as encoding auto-detection has been moved to the `w3lib`_ library\n- promoted :ref:`topics-djangoitem` to main contrib\n- LogFormatter method now return dicts(instead of strings) to support lazy formatting (:issue:`164`, :commit:`dcef7b0`)\n- downloader handlers (:setting:`DOWNLOAD_HANDLERS` setting) now receive settings as the first argument of the ``__init__`` method\n- replaced memory usage acounting with (more portable) `resource`_ module, removed ``scrapy.utils.memory`` module\n- removed signal: ``scrapy.mail.mail_sent``\n- removed ``TRACK_REFS`` setting, now :ref:`trackrefs <topics-leaks-trackrefs>` is always enabled\n- DBM is now the default storage backend for HTTP cache middleware\n- number of log messages (per level) are now tracked through Scrapy stats (stat name: ``log_count/LEVEL``)\n- number received responses are now tracked through Scrapy stats (stat name: ``response_received_count``)\n- removed ``scrapy.log.started`` attribute\n\nScrapy 0.14.4\n-------------\n\n- added precise to supported Ubuntu distros (:commit:`b7e46df`)\n- fixed bug in json-rpc webservice reported in https://groups.google.com/forum/#!topic/scrapy-users/qgVBmFybNAQ/discussion. also removed no longer supported 'run' command from extras/scrapy-ws.py (:commit:`340fbdb`)\n- meta tag attributes for content-type http equiv can be in any order. #123 (:commit:`0cb68af`)\n- replace \"import Image\" by more standard \"from PIL import Image\". closes #88 (:commit:`4d17048`)\n- return trial status as bin/runtests.sh exit value. #118 (:commit:`b7b2e7f`)\n\nScrapy 0.14.3\n-------------\n\n- forgot to include pydispatch license. #118 (:commit:`fd85f9c`)\n- include egg files used by testsuite in source distribution. #118 (:commit:`c897793`)\n- update docstring in project template to avoid confusion with genspider command, which may be considered as an advanced feature. refs #107 (:commit:`2548dcc`)\n- added note to docs/topics/firebug.rst about google directory being shut down (:commit:`668e352`)\n- don't discard slot when empty, just save in another dict in order to recycle if needed again. (:commit:`8e9f607`)\n- do not fail handling unicode xpaths in libxml2 backed selectors (:commit:`b830e95`)\n- fixed minor mistake in Request objects documentation (:commit:`bf3c9ee`)\n- fixed minor defect in link extractors documentation (:commit:`ba14f38`)\n- removed some obsolete remaining code related to sqlite support in Scrapy (:commit:`0665175`)\n\nScrapy 0.14.2\n-------------\n\n- move buffer pointing to start of file before computing checksum. refs #92 (:commit:`6a5bef2`)\n- Compute image checksum before persisting images. closes #92 (:commit:`9817df1`)\n- remove leaking references in cached failures (:commit:`673a120`)\n- fixed bug in MemoryUsage extension: get_engine_status() takes exactly 1 argument (0 given) (:commit:`11133e9`)\n- fixed struct.error on http compression middleware. closes #87 (:commit:`1423140`)\n- ajax crawling wasn't expanding for unicode urls (:commit:`0de3fb4`)\n- Catch start_requests iterator errors. refs #83 (:commit:`454a21d`)\n- Speed-up libxml2 XPathSelector (:commit:`2fbd662`)\n- updated versioning doc according to recent changes (:commit:`0a070f5`)\n- scrapyd: fixed documentation link (:commit:`2b4e4c3`)\n- extras/makedeb.py: no longer obtaining version from git (:commit:`caffe0e`)\n\nScrapy 0.14.1\n-------------\n\n- extras/makedeb.py: no longer obtaining version from git (:commit:`caffe0e`)\n- bumped version to 0.14.1 (:commit:`6cb9e1c`)\n- fixed reference to tutorial directory (:commit:`4b86bd6`)\n- doc: removed duplicated callback argument from Request.replace() (:commit:`1aeccdd`)\n- fixed formatting of scrapyd doc (:commit:`8bf19e6`)\n- Dump stacks for all running threads and fix engine status dumped by StackTraceDump extension (:commit:`14a8e6e`)\n- added comment about why we disable ssl on boto images upload (:commit:`5223575`)\n- SSL handshaking hangs when doing too many parallel connections to S3 (:commit:`63d583d`)\n- change tutorial to follow changes on dmoz site (:commit:`bcb3198`)\n- Avoid _disconnectedDeferred AttributeError exception in Twisted>=11.1.0 (:commit:`98f3f87`)\n- allow spider to set autothrottle max concurrency (:commit:`175a4b5`)\n\nScrapy 0.14\n-----------\n\nNew features and settings\n~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Support for `AJAX crawleable urls`_\n- New persistent scheduler that stores requests on disk, allowing to suspend and resume crawls (:rev:`2737`)\n- added ``-o`` option to ``scrapy crawl``, a shortcut for dumping scraped items into a file (or standard output using ``-``)\n- Added support for passing custom settings to Scrapyd ``schedule.json`` api (:rev:`2779`, :rev:`2783`)\n- New ``ChunkedTransferMiddleware`` (enabled by default) to support `chunked transfer encoding`_ (:rev:`2769`)\n- Add boto 2.0 support for S3 downloader handler (:rev:`2763`)\n- Added `marshal`_ to formats supported by feed exports (:rev:`2744`)\n- In request errbacks, offending requests are now received in ``failure.request`` attribute (:rev:`2738`)\n- Big downloader refactoring to support per domain/ip concurrency limits (:rev:`2732`)\n   - ``CONCURRENT_REQUESTS_PER_SPIDER`` setting has been deprecated and replaced by:\n      - :setting:`CONCURRENT_REQUESTS`, :setting:`CONCURRENT_REQUESTS_PER_DOMAIN`, :setting:`CONCURRENT_REQUESTS_PER_IP`\n   - check the documentation for more details\n- Added builtin caching DNS resolver (:rev:`2728`)\n- Moved Amazon AWS-related components/extensions (SQS spider queue, SimpleDB stats collector) to a separate project: [scaws](https://github.com/scrapinghub/scaws) (:rev:`2706`, :rev:`2714`)\n- Moved spider queues to scrapyd: ``scrapy.spiderqueue`` -> ``scrapyd.spiderqueue`` (:rev:`2708`)\n- Moved sqlite utils to scrapyd: ``scrapy.utils.sqlite`` -> ``scrapyd.sqlite`` (:rev:`2781`)\n- Real support for returning iterators on ``start_requests()`` method. The iterator is now consumed during the crawl when the spider is getting idle (:rev:`2704`)\n- Added :setting:`REDIRECT_ENABLED` setting to quickly enable/disable the redirect middleware (:rev:`2697`)\n- Added :setting:`RETRY_ENABLED` setting to quickly enable/disable the retry middleware (:rev:`2694`)\n- Added ``CloseSpider`` exception to manually close spiders (:rev:`2691`)\n- Improved encoding detection by adding support for HTML5 meta charset declaration (:rev:`2690`)\n- Refactored close spider behavior to wait for all downloads to finish and be processed by spiders, before closing the spider (:rev:`2688`)\n- Added ``SitemapSpider`` (see documentation in Spiders page) (:rev:`2658`)\n- Added ``LogStats`` extension for periodically logging basic stats (like crawled pages and scraped items) (:rev:`2657`)\n- Make handling of gzipped responses more robust (#319, :rev:`2643`). Now Scrapy will try and decompress as much as possible from a gzipped response, instead of failing with an ``IOError``.\n- Simplified !MemoryDebugger extension to use stats for dumping memory debugging info (:rev:`2639`)\n- Added new command to edit spiders: ``scrapy edit`` (:rev:`2636`) and ``-e`` flag to ``genspider`` command that uses it (:rev:`2653`)\n- Changed default representation of items to pretty-printed dicts. (:rev:`2631`). This improves default logging by making log more readable in the default case, for both Scraped and Dropped lines.\n- Added :signal:`spider_error` signal (:rev:`2628`)\n- Added :setting:`COOKIES_ENABLED` setting (:rev:`2625`)\n- Stats are now dumped to Scrapy log (default value of :setting:`STATS_DUMP` setting has been changed to ``True``). This is to make Scrapy users more aware of Scrapy stats and the data that is collected there.\n- Added support for dynamically adjusting download delay and maximum concurrent requests (:rev:`2599`)\n- Added new DBM HTTP cache storage backend (:rev:`2576`)\n- Added ``listjobs.json`` API to Scrapyd (:rev:`2571`)\n- ``CsvItemExporter``: added ``join_multivalued`` parameter (:rev:`2578`)\n- Added namespace support to ``xmliter_lxml`` (:rev:`2552`)\n- Improved cookies middleware by making ``COOKIES_DEBUG`` nicer and documenting it (:rev:`2579`)\n- Several improvements to Scrapyd and Link extractors\n\nCode rearranged and removed\n~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Merged item passed and item scraped concepts, as they have often proved confusing in the past. This means: (:rev:`2630`)\n   - original item_scraped signal was removed\n   - original item_passed signal was renamed to item_scraped\n   - old log lines ``Scraped Item...`` were removed\n   - old log lines ``Passed Item...`` were renamed to ``Scraped Item...`` lines and downgraded to ``DEBUG`` level\n- Reduced Scrapy codebase by striping part of Scrapy code into two new libraries:\n   - `w3lib`_ (several functions from ``scrapy.utils.{http,markup,multipart,response,url}``, done in :rev:`2584`)\n   - `scrapely`_ (was ``scrapy.contrib.ibl``, done in :rev:`2586`)\n- Removed unused function: ``scrapy.utils.request.request_info()`` (:rev:`2577`)\n- Removed googledir project from ``examples/googledir``. There's now a new example project called ``dirbot`` available on GitHub: https://github.com/scrapy/dirbot\n- Removed support for default field values in Scrapy items (:rev:`2616`)\n- Removed experimental crawlspider v2 (:rev:`2632`)\n- Removed scheduler middleware to simplify architecture. Duplicates filter is now done in the scheduler itself, using the same dupe filtering class as before (``DUPEFILTER_CLASS`` setting) (:rev:`2640`)\n- Removed support for passing urls to ``scrapy crawl`` command (use ``scrapy parse`` instead) (:rev:`2704`)\n- Removed deprecated Execution Queue (:rev:`2704`)\n- Removed (undocumented) spider context extension (from scrapy.contrib.spidercontext) (:rev:`2780`)\n- removed ``CONCURRENT_SPIDERS`` setting (use scrapyd maxproc instead) (:rev:`2789`)\n- Renamed attributes of core components: downloader.sites -> downloader.slots, scraper.sites -> scraper.slots (:rev:`2717`, :rev:`2718`)\n- Renamed setting ``CLOSESPIDER_ITEMPASSED`` to :setting:`CLOSESPIDER_ITEMCOUNT` (:rev:`2655`). Backward compatibility kept.\n\nScrapy 0.12\n-----------\n\nThe numbers like #NNN reference tickets in the old issue tracker (Trac) which is no longer available.\n\nNew features and improvements\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Passed item is now sent in the ``item`` argument of the :signal:`item_passed\n  <item_scraped>` (#273)\n- Added verbose option to ``scrapy version`` command, useful for bug reports (#298)\n- HTTP cache now stored by default in the project data dir (#279)\n- Added project data storage directory (#276, #277)\n- Documented file structure of Scrapy projects (see command-line tool doc)\n- New lxml backend for XPath selectors (#147)\n- Per-spider settings (#245)\n- Support exit codes to signal errors in Scrapy commands (#248)\n- Added ``-c`` argument to ``scrapy shell`` command\n- Made ``libxml2`` optional (#260)\n- New ``deploy`` command (#261)\n- Added :setting:`CLOSESPIDER_PAGECOUNT` setting (#253)\n- Added :setting:`CLOSESPIDER_ERRORCOUNT` setting (#254)\n\nScrapyd changes\n~~~~~~~~~~~~~~~\n\n- Scrapyd now uses one process per spider\n- It stores one log file per spider run, and rotate them keeping the latest 5 logs per spider (by default)\n- A minimal web ui was added, available at http://localhost:6800 by default\n- There is now a ``scrapy server`` command to start a Scrapyd server of the current project\n\nChanges to settings\n~~~~~~~~~~~~~~~~~~~\n\n- added ``HTTPCACHE_ENABLED`` setting (False by default) to enable HTTP cache middleware\n- changed ``HTTPCACHE_EXPIRATION_SECS`` semantics: now zero means \"never expire\".\n\nDeprecated/obsoleted functionality\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Deprecated ``runserver`` command in favor of ``server`` command which starts a Scrapyd server. See also: Scrapyd changes\n- Deprecated ``queue`` command in favor of using Scrapyd ``schedule.json`` API. See also: Scrapyd changes\n- Removed the !LxmlItemLoader (experimental contrib which never graduated to main contrib)\n\nScrapy 0.10\n-----------\n\nThe numbers like #NNN reference tickets in the old issue tracker (Trac) which is no longer available.\n\nNew features and improvements\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- New Scrapy service called ``scrapyd`` for deploying Scrapy crawlers in production (#218) (documentation available)\n- Simplified Images pipeline usage which doesn't require subclassing your own images pipeline now (#217)\n- Scrapy shell now shows the Scrapy log by default (#206)\n- Refactored execution queue in a common base code and pluggable backends called \"spider queues\" (#220)\n- New persistent spider queue (based on SQLite) (#198), available by default, which allows to start Scrapy in server mode and then schedule spiders to run.\n- Added documentation for Scrapy command-line tool and all its available sub-commands. (documentation available)\n- Feed exporters with pluggable backends (#197) (documentation available)\n- Deferred signals (#193)\n- Added two new methods to item pipeline open_spider(), close_spider() with deferred support (#195)\n- Support for overriding default request headers per spider (#181)\n- Replaced default Spider Manager with one with similar functionality but not depending on Twisted Plugins (#186)\n- Split Debian package into two packages - the library and the service (#187)\n- Scrapy log refactoring (#188)\n- New extension for keeping persistent spider contexts among different runs (#203)\n- Added ``dont_redirect`` request.meta key for avoiding redirects (#233)\n- Added ``dont_retry`` request.meta key for avoiding retries (#234)\n\nCommand-line tool changes\n~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- New ``scrapy`` command which replaces the old ``scrapy-ctl.py`` (#199)\n  - there is only one global ``scrapy`` command now, instead of one ``scrapy-ctl.py`` per project\n  - Added ``scrapy.bat`` script for running more conveniently from Windows\n- Added bash completion to command-line tool (#210)\n- Renamed command ``start`` to ``runserver`` (#209)\n\nAPI changes\n~~~~~~~~~~~\n\n- ``url`` and ``body`` attributes of Request objects are now read-only (#230)\n- ``Request.copy()`` and ``Request.replace()`` now also copies their ``callback`` and ``errback`` attributes (#231)\n- Removed ``UrlFilterMiddleware`` from ``scrapy.contrib`` (already disabled by default)\n- Offsite middleware doesn't filter out any request coming from a spider that doesn't have a allowed_domains attribute (#225)\n- Removed Spider Manager ``load()`` method. Now spiders are loaded in the ``__init__`` method itself.\n- Changes to Scrapy Manager (now called \"Crawler\"):\n   - ``scrapy.core.manager.ScrapyManager`` class renamed to ``scrapy.crawler.Crawler``\n   - ``scrapy.core.manager.scrapymanager`` singleton moved to ``scrapy.project.crawler``\n- Moved module: ``scrapy.contrib.spidermanager`` to ``scrapy.spidermanager``\n- Spider Manager singleton moved from ``scrapy.spider.spiders`` to the ``spiders` attribute of ``scrapy.project.crawler`` singleton.\n- moved Stats Collector classes: (#204)\n   - ``scrapy.stats.collector.StatsCollector`` to ``scrapy.statscol.StatsCollector``\n   - ``scrapy.stats.collector.SimpledbStatsCollector`` to ``scrapy.contrib.statscol.SimpledbStatsCollector``\n- default per-command settings are now specified in the ``default_settings`` attribute of command object class (#201)\n- changed arguments of Item pipeline ``process_item()`` method from ``(spider, item)`` to ``(item, spider)``\n   - backward compatibility kept (with deprecation warning)\n- moved ``scrapy.core.signals`` module to ``scrapy.signals``\n   - backward compatibility kept (with deprecation warning)\n- moved ``scrapy.core.exceptions`` module to ``scrapy.exceptions``\n   - backward compatibility kept (with deprecation warning)\n- added ``handles_request()`` class method to ``BaseSpider``\n- dropped ``scrapy.log.exc()`` function (use ``scrapy.log.err()`` instead)\n- dropped ``component`` argument of ``scrapy.log.msg()`` function\n- dropped ``scrapy.log.log_level`` attribute\n- Added ``from_settings()`` class methods to Spider Manager, and Item Pipeline Manager\n\nChanges to settings\n~~~~~~~~~~~~~~~~~~~\n\n- Added ``HTTPCACHE_IGNORE_SCHEMES`` setting to ignore certain schemes on !HttpCacheMiddleware (#225)\n- Added ``SPIDER_QUEUE_CLASS`` setting which defines the spider queue to use (#220)\n- Added ``KEEP_ALIVE`` setting (#220)\n- Removed ``SERVICE_QUEUE`` setting (#220)\n- Removed ``COMMANDS_SETTINGS_MODULE`` setting (#201)\n- Renamed ``REQUEST_HANDLERS`` to ``DOWNLOAD_HANDLERS`` and make download handlers classes (instead of functions)\n\nScrapy 0.9\n----------\n\nThe numbers like #NNN reference tickets in the old issue tracker (Trac) which is no longer available.\n\nNew features and improvements\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Added SMTP-AUTH support to scrapy.mail\n- New settings added: ``MAIL_USER``, ``MAIL_PASS`` (:rev:`2065` | #149)\n- Added new scrapy-ctl view command - To view URL in the browser, as seen by Scrapy (:rev:`2039`)\n- Added web service for controlling Scrapy process (this also deprecates the web console. (:rev:`2053` | #167)\n- Support for running Scrapy as a service, for production systems (:rev:`1988`, :rev:`2054`, :rev:`2055`, :rev:`2056`, :rev:`2057` | #168)\n- Added wrapper induction library (documentation only available in source code for now). (:rev:`2011`)\n- Simplified and improved response encoding support (:rev:`1961`, :rev:`1969`)\n- Added ``LOG_ENCODING`` setting (:rev:`1956`, documentation available)\n- Added ``RANDOMIZE_DOWNLOAD_DELAY`` setting (enabled by default) (:rev:`1923`, doc available)\n- ``MailSender`` is no longer IO-blocking (:rev:`1955` | #146)\n- Linkextractors and new Crawlspider now handle relative base tag urls (:rev:`1960` | #148)\n- Several improvements to Item Loaders and processors (:rev:`2022`, :rev:`2023`, :rev:`2024`, :rev:`2025`, :rev:`2026`, :rev:`2027`, :rev:`2028`, :rev:`2029`, :rev:`2030`)\n- Added support for adding variables to telnet console (:rev:`2047` | #165)\n- Support for requests without callbacks (:rev:`2050` | #166)\n\nAPI changes\n~~~~~~~~~~~\n\n- Change ``Spider.domain_name`` to ``Spider.name`` (SEP-012, :rev:`1975`)\n- ``Response.encoding`` is now the detected encoding (:rev:`1961`)\n- ``HttpErrorMiddleware`` now returns None or raises an exception (:rev:`2006` | #157)\n- ``scrapy.command`` modules relocation (:rev:`2035`, :rev:`2036`, :rev:`2037`)\n- Added ``ExecutionQueue`` for feeding spiders to scrape (:rev:`2034`)\n- Removed ``ExecutionEngine`` singleton (:rev:`2039`)\n- Ported ``S3ImagesStore`` (images pipeline) to use boto and threads (:rev:`2033`)\n- Moved module: ``scrapy.management.telnet`` to ``scrapy.telnet`` (:rev:`2047`)\n\nChanges to default settings\n~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Changed default ``SCHEDULER_ORDER`` to ``DFO`` (:rev:`1939`)\n\nScrapy 0.8\n----------\n\nThe numbers like #NNN reference tickets in the old issue tracker (Trac) which is no longer available.\n\nNew features\n~~~~~~~~~~~~\n\n- Added DEFAULT_RESPONSE_ENCODING setting (:rev:`1809`)\n- Added ``dont_click`` argument to ``FormRequest.from_response()`` method (:rev:`1813`, :rev:`1816`)\n- Added ``clickdata`` argument to ``FormRequest.from_response()`` method (:rev:`1802`, :rev:`1803`)\n- Added support for HTTP proxies (``HttpProxyMiddleware``) (:rev:`1781`, :rev:`1785`)\n- Offsite spider middleware now logs messages when filtering out requests (:rev:`1841`)\n\nBackward-incompatible changes\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Changed ``scrapy.utils.response.get_meta_refresh()`` signature (:rev:`1804`)\n- Removed deprecated ``scrapy.item.ScrapedItem`` class - use ``scrapy.item.Item instead`` (:rev:`1838`)\n- Removed deprecated ``scrapy.xpath`` module - use ``scrapy.selector`` instead. (:rev:`1836`)\n- Removed deprecated ``core.signals.domain_open`` signal - use ``core.signals.domain_opened`` instead (:rev:`1822`)\n- ``log.msg()`` now receives a ``spider`` argument (:rev:`1822`)\n   - Old domain argument has been deprecated and will be removed in 0.9. For spiders, you should always use the ``spider`` argument and pass spider references. If you really want to pass a string, use the ``component`` argument instead.\n- Changed core signals ``domain_opened``, ``domain_closed``, ``domain_idle``\n- Changed Item pipeline to use spiders instead of domains\n   -  The ``domain`` argument of  ``process_item()`` item pipeline method was changed to  ``spider``, the new signature is: ``process_item(spider, item)`` (:rev:`1827` | #105)\n   - To quickly port your code (to work with Scrapy 0.8) just use ``spider.domain_name`` where you previously used ``domain``.\n- Changed Stats API to use spiders instead of domains (:rev:`1849` | #113)\n   - ``StatsCollector`` was changed to receive spider references (instead of domains) in its methods (``set_value``, ``inc_value``, etc).\n   - added ``StatsCollector.iter_spider_stats()`` method\n   - removed ``StatsCollector.list_domains()`` method\n   - Also, Stats signals were renamed and now pass around spider references (instead of domains). Here's a summary of the changes:\n   - To quickly port your code (to work with Scrapy 0.8) just use ``spider.domain_name`` where you previously used ``domain``. ``spider_stats`` contains exactly the same data as ``domain_stats``.\n- ``CloseDomain`` extension moved to ``scrapy.contrib.closespider.CloseSpider`` (:rev:`1833`)\n   - Its settings were also renamed:\n      - ``CLOSEDOMAIN_TIMEOUT`` to ``CLOSESPIDER_TIMEOUT``\n      - ``CLOSEDOMAIN_ITEMCOUNT`` to ``CLOSESPIDER_ITEMCOUNT``\n- Removed deprecated ``SCRAPYSETTINGS_MODULE`` environment variable - use ``SCRAPY_SETTINGS_MODULE`` instead (:rev:`1840`)\n- Renamed setting: ``REQUESTS_PER_DOMAIN`` to ``CONCURRENT_REQUESTS_PER_SPIDER`` (:rev:`1830`, :rev:`1844`)\n- Renamed setting: ``CONCURRENT_DOMAINS`` to ``CONCURRENT_SPIDERS`` (:rev:`1830`)\n- Refactored HTTP Cache middleware\n- HTTP Cache middleware has been heavilty refactored, retaining the same functionality except for the domain sectorization which was removed. (:rev:`1843` )\n- Renamed exception: ``DontCloseDomain`` to ``DontCloseSpider`` (:rev:`1859` | #120)\n- Renamed extension: ``DelayedCloseDomain`` to ``SpiderCloseDelay`` (:rev:`1861` | #121)\n- Removed obsolete ``scrapy.utils.markup.remove_escape_chars`` function - use ``scrapy.utils.markup.replace_escape_chars`` instead (:rev:`1865`)\n\nScrapy 0.7\n----------\n\nFirst release of Scrapy.\n\n\n.. _AJAX crawleable urls: https://developers.google.com/search/docs/ajax-crawling/docs/getting-started?csw=1\n.. _botocore: https://github.com/boto/botocore\n.. _chunked transfer encoding: https://en.wikipedia.org/wiki/Chunked_transfer_encoding\n.. _ClientForm: http://wwwsearch.sourceforge.net/old/ClientForm/\n.. _Creating a pull request: https://help.github.com/en/articles/creating-a-pull-request\n.. _cryptography: https://cryptography.io/en/latest/\n.. _docstrings: https://docs.python.org/3/glossary.html#term-docstring\n.. _KeyboardInterrupt: https://docs.python.org/3/library/exceptions.html#KeyboardInterrupt\n.. _LevelDB: https://github.com/google/leveldb\n.. _lxml: https://lxml.de/\n.. _marshal: https://docs.python.org/2/library/marshal.html\n.. _parsel.csstranslator.GenericTranslator: https://parsel.readthedocs.io/en/latest/parsel.html#parsel.csstranslator.GenericTranslator\n.. _parsel.csstranslator.HTMLTranslator: https://parsel.readthedocs.io/en/latest/parsel.html#parsel.csstranslator.HTMLTranslator\n.. _parsel.csstranslator.XPathExpr: https://parsel.readthedocs.io/en/latest/parsel.html#parsel.csstranslator.XPathExpr\n.. _PEP 257: https://www.python.org/dev/peps/pep-0257/\n.. _Pillow: https://python-pillow.org/\n.. _pyOpenSSL: https://www.pyopenssl.org/en/stable/\n.. _queuelib: https://github.com/scrapy/queuelib\n.. _registered with IANA: https://www.iana.org/assignments/media-types/media-types.xhtml\n.. _resource: https://docs.python.org/2/library/resource.html\n.. _robots.txt: https://www.robotstxt.org/\n.. _scrapely: https://github.com/scrapy/scrapely\n.. _scrapy-bench: https://github.com/scrapy/scrapy-bench\n.. _service_identity: https://service-identity.readthedocs.io/en/stable/\n.. _six: https://six.readthedocs.io/\n.. _tox: https://pypi.org/project/tox/\n.. _Twisted: https://twistedmatrix.com/trac/\n.. _w3lib: https://github.com/scrapy/w3lib\n.. _w3lib.encoding: https://github.com/scrapy/w3lib/blob/master/w3lib/encoding.py\n.. _What is cacheable: https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.9.1\n.. _zope.interface: https://zopeinterface.readthedocs.io/en/latest/\n.. _Zsh: https://www.zsh.org/\n.. _zstandard: https://pypi.org/project/zstandard/\n", "import logging\nfrom urllib.parse import urljoin, urlparse\n\nfrom w3lib.url import safe_url_string\n\nfrom scrapy.http import HtmlResponse\nfrom scrapy.utils.httpobj import urlparse_cached\nfrom scrapy.utils.response import get_meta_refresh\nfrom scrapy.exceptions import IgnoreRequest, NotConfigured\n\n\nlogger = logging.getLogger(__name__)\n\n\ndef _build_redirect_request(source_request, *, url, method=None, body=None):\n    redirect_request = source_request.replace(\n        url=url,\n        method=method,\n        body=body,\n        cookies=None,\n    )\n    if 'Cookie' in redirect_request.headers:\n        source_request_netloc = urlparse_cached(source_request).netloc\n        redirect_request_netloc = urlparse_cached(redirect_request).netloc\n        if source_request_netloc != redirect_request_netloc:\n            del redirect_request.headers['Cookie']\n    return redirect_request\n\n\nclass BaseRedirectMiddleware:\n\n    enabled_setting = 'REDIRECT_ENABLED'\n\n    def __init__(self, settings):\n        if not settings.getbool(self.enabled_setting):\n            raise NotConfigured\n\n        self.max_redirect_times = settings.getint('REDIRECT_MAX_TIMES')\n        self.priority_adjust = settings.getint('REDIRECT_PRIORITY_ADJUST')\n\n    @classmethod\n    def from_crawler(cls, crawler):\n        return cls(crawler.settings)\n\n    def _redirect(self, redirected, request, spider, reason):\n        ttl = request.meta.setdefault('redirect_ttl', self.max_redirect_times)\n        redirects = request.meta.get('redirect_times', 0) + 1\n\n        if ttl and redirects <= self.max_redirect_times:\n            redirected.meta['redirect_times'] = redirects\n            redirected.meta['redirect_ttl'] = ttl - 1\n            redirected.meta['redirect_urls'] = request.meta.get('redirect_urls', []) + [request.url]\n            redirected.meta['redirect_reasons'] = request.meta.get('redirect_reasons', []) + [reason]\n            redirected.dont_filter = request.dont_filter\n            redirected.priority = request.priority + self.priority_adjust\n            logger.debug(\"Redirecting (%(reason)s) to %(redirected)s from %(request)s\",\n                         {'reason': reason, 'redirected': redirected, 'request': request},\n                         extra={'spider': spider})\n            return redirected\n        else:\n            logger.debug(\"Discarding %(request)s: max redirections reached\",\n                         {'request': request}, extra={'spider': spider})\n            raise IgnoreRequest(\"max redirections reached\")\n\n    def _redirect_request_using_get(self, request, redirect_url):\n        redirect_request = _build_redirect_request(\n            request,\n            url=redirect_url,\n            method='GET',\n            body='',\n        )\n        redirect_request.headers.pop('Content-Type', None)\n        redirect_request.headers.pop('Content-Length', None)\n        return redirect_request\n\n\nclass RedirectMiddleware(BaseRedirectMiddleware):\n    \"\"\"\n    Handle redirection of requests based on response status\n    and meta-refresh html tag.\n    \"\"\"\n\n    def process_response(self, request, response, spider):\n        if (\n            request.meta.get('dont_redirect', False)\n            or response.status in getattr(spider, 'handle_httpstatus_list', [])\n            or response.status in request.meta.get('handle_httpstatus_list', [])\n            or request.meta.get('handle_httpstatus_all', False)\n        ):\n            return response\n\n        allowed_status = (301, 302, 303, 307, 308)\n        if 'Location' not in response.headers or response.status not in allowed_status:\n            return response\n\n        location = safe_url_string(response.headers['Location'])\n        if response.headers['Location'].startswith(b'//'):\n            request_scheme = urlparse(request.url).scheme\n            location = request_scheme + '://' + location.lstrip('/')\n\n        redirected_url = urljoin(request.url, location)\n\n        if response.status in (301, 307, 308) or request.method == 'HEAD':\n            redirected = _build_redirect_request(request, url=redirected_url)\n            return self._redirect(redirected, request, spider, response.status)\n\n        redirected = self._redirect_request_using_get(request, redirected_url)\n        return self._redirect(redirected, request, spider, response.status)\n\n\nclass MetaRefreshMiddleware(BaseRedirectMiddleware):\n\n    enabled_setting = 'METAREFRESH_ENABLED'\n\n    def __init__(self, settings):\n        super().__init__(settings)\n        self._ignore_tags = settings.getlist('METAREFRESH_IGNORE_TAGS')\n        self._maxdelay = settings.getint('METAREFRESH_MAXDELAY')\n\n    def process_response(self, request, response, spider):\n        if (\n            request.meta.get('dont_redirect', False)\n            or request.method == 'HEAD'\n            or not isinstance(response, HtmlResponse)\n        ):\n            return response\n\n        interval, url = get_meta_refresh(response,\n                                         ignore_tags=self._ignore_tags)\n        if url and interval < self._maxdelay:\n            redirected = self._redirect_request_using_get(request, url)\n            return self._redirect(redirected, request, spider, 'meta refresh')\n\n        return response\n", "import logging\nfrom testfixtures import LogCapture\nfrom unittest import TestCase\n\nimport pytest\n\nfrom scrapy.downloadermiddlewares.cookies import CookiesMiddleware\nfrom scrapy.downloadermiddlewares.defaultheaders import DefaultHeadersMiddleware\nfrom scrapy.downloadermiddlewares.redirect import RedirectMiddleware\nfrom scrapy.exceptions import NotConfigured\nfrom scrapy.http import Response, Request\nfrom scrapy.settings import Settings\nfrom scrapy.spiders import Spider\nfrom scrapy.utils.python import to_bytes\nfrom scrapy.utils.test import get_crawler\n\n\nclass CookiesMiddlewareTest(TestCase):\n\n    def assertCookieValEqual(self, first, second, msg=None):\n        def split_cookies(cookies):\n            return sorted([s.strip() for s in to_bytes(cookies).split(b\";\")])\n        return self.assertEqual(split_cookies(first), split_cookies(second), msg=msg)\n\n    def setUp(self):\n        self.spider = Spider('foo')\n        self.mw = CookiesMiddleware()\n        self.redirect_middleware = RedirectMiddleware(settings=Settings())\n\n    def tearDown(self):\n        del self.mw\n        del self.redirect_middleware\n\n    def test_basic(self):\n        req = Request('http://scrapytest.org/')\n        assert self.mw.process_request(req, self.spider) is None\n        assert 'Cookie' not in req.headers\n\n        headers = {'Set-Cookie': 'C1=value1; path=/'}\n        res = Response('http://scrapytest.org/', headers=headers)\n        assert self.mw.process_response(req, res, self.spider) is res\n\n        req2 = Request('http://scrapytest.org/sub1/')\n        assert self.mw.process_request(req2, self.spider) is None\n        self.assertEqual(req2.headers.get('Cookie'), b\"C1=value1\")\n\n    def test_setting_false_cookies_enabled(self):\n        self.assertRaises(\n            NotConfigured,\n            CookiesMiddleware.from_crawler,\n            get_crawler(settings_dict={'COOKIES_ENABLED': False})\n        )\n\n    def test_setting_default_cookies_enabled(self):\n        self.assertIsInstance(\n            CookiesMiddleware.from_crawler(get_crawler()),\n            CookiesMiddleware\n        )\n\n    def test_setting_true_cookies_enabled(self):\n        self.assertIsInstance(\n            CookiesMiddleware.from_crawler(\n                get_crawler(settings_dict={'COOKIES_ENABLED': True})\n            ),\n            CookiesMiddleware\n        )\n\n    def test_setting_enabled_cookies_debug(self):\n        crawler = get_crawler(settings_dict={'COOKIES_DEBUG': True})\n        mw = CookiesMiddleware.from_crawler(crawler)\n        with LogCapture(\n            'scrapy.downloadermiddlewares.cookies',\n            propagate=False,\n            level=logging.DEBUG,\n        ) as log:\n            req = Request('http://scrapytest.org/')\n            res = Response('http://scrapytest.org/', headers={'Set-Cookie': 'C1=value1; path=/'})\n            mw.process_response(req, res, crawler.spider)\n            req2 = Request('http://scrapytest.org/sub1/')\n            mw.process_request(req2, crawler.spider)\n\n            log.check(\n                ('scrapy.downloadermiddlewares.cookies',\n                 'DEBUG',\n                 'Received cookies from: <200 http://scrapytest.org/>\\n'\n                 'Set-Cookie: C1=value1; path=/\\n'),\n                ('scrapy.downloadermiddlewares.cookies',\n                 'DEBUG',\n                 'Sending cookies to: <GET http://scrapytest.org/sub1/>\\n'\n                 'Cookie: C1=value1\\n'),\n            )\n\n    def test_setting_disabled_cookies_debug(self):\n        crawler = get_crawler(settings_dict={'COOKIES_DEBUG': False})\n        mw = CookiesMiddleware.from_crawler(crawler)\n        with LogCapture(\n            'scrapy.downloadermiddlewares.cookies',\n            propagate=False,\n            level=logging.DEBUG,\n        ) as log:\n            req = Request('http://scrapytest.org/')\n            res = Response('http://scrapytest.org/', headers={'Set-Cookie': 'C1=value1; path=/'})\n            mw.process_response(req, res, crawler.spider)\n            req2 = Request('http://scrapytest.org/sub1/')\n            mw.process_request(req2, crawler.spider)\n\n            log.check()\n\n    def test_do_not_break_on_non_utf8_header(self):\n        req = Request('http://scrapytest.org/')\n        assert self.mw.process_request(req, self.spider) is None\n        assert 'Cookie' not in req.headers\n\n        headers = {'Set-Cookie': b'C1=in\\xa3valid; path=/', 'Other': b'ignore\\xa3me'}\n        res = Response('http://scrapytest.org/', headers=headers)\n        assert self.mw.process_response(req, res, self.spider) is res\n\n        req2 = Request('http://scrapytest.org/sub1/')\n        assert self.mw.process_request(req2, self.spider) is None\n        self.assertIn('Cookie', req2.headers)\n\n    def test_dont_merge_cookies(self):\n        # merge some cookies into jar\n        headers = {'Set-Cookie': 'C1=value1; path=/'}\n        req = Request('http://scrapytest.org/')\n        res = Response('http://scrapytest.org/', headers=headers)\n        assert self.mw.process_response(req, res, self.spider) is res\n\n        # test Cookie header is not seted to request\n        req = Request('http://scrapytest.org/dontmerge', meta={'dont_merge_cookies': 1})\n        assert self.mw.process_request(req, self.spider) is None\n        assert 'Cookie' not in req.headers\n\n        # check that returned cookies are not merged back to jar\n        res = Response(\n            'http://scrapytest.org/dontmerge',\n            headers={'Set-Cookie': 'dont=mergeme; path=/'},\n        )\n        assert self.mw.process_response(req, res, self.spider) is res\n\n        # check that cookies are merged back\n        req = Request('http://scrapytest.org/mergeme')\n        assert self.mw.process_request(req, self.spider) is None\n        self.assertEqual(req.headers.get('Cookie'), b'C1=value1')\n\n        # check that cookies are merged when dont_merge_cookies is passed as 0\n        req = Request('http://scrapytest.org/mergeme', meta={'dont_merge_cookies': 0})\n        assert self.mw.process_request(req, self.spider) is None\n        self.assertEqual(req.headers.get('Cookie'), b'C1=value1')\n\n    def test_complex_cookies(self):\n        # merge some cookies into jar\n        cookies = [\n            {'name': 'C1', 'value': 'value1', 'path': '/foo', 'domain': 'scrapytest.org'},\n            {'name': 'C2', 'value': 'value2', 'path': '/bar', 'domain': 'scrapytest.org'},\n            {'name': 'C3', 'value': 'value3', 'path': '/foo', 'domain': 'scrapytest.org'},\n            {'name': 'C4', 'value': 'value4', 'path': '/foo', 'domain': 'scrapy.org'},\n        ]\n\n        req = Request('http://scrapytest.org/', cookies=cookies)\n        self.mw.process_request(req, self.spider)\n\n        # embed C1 and C3 for scrapytest.org/foo\n        req = Request('http://scrapytest.org/foo')\n        self.mw.process_request(req, self.spider)\n        assert req.headers.get('Cookie') in (b'C1=value1; C3=value3', b'C3=value3; C1=value1')\n\n        # embed C2 for scrapytest.org/bar\n        req = Request('http://scrapytest.org/bar')\n        self.mw.process_request(req, self.spider)\n        self.assertEqual(req.headers.get('Cookie'), b'C2=value2')\n\n        # embed nothing for scrapytest.org/baz\n        req = Request('http://scrapytest.org/baz')\n        self.mw.process_request(req, self.spider)\n        assert 'Cookie' not in req.headers\n\n    def test_merge_request_cookies(self):\n        req = Request('http://scrapytest.org/', cookies={'galleta': 'salada'})\n        assert self.mw.process_request(req, self.spider) is None\n        self.assertEqual(req.headers.get('Cookie'), b'galleta=salada')\n\n        headers = {'Set-Cookie': 'C1=value1; path=/'}\n        res = Response('http://scrapytest.org/', headers=headers)\n        assert self.mw.process_response(req, res, self.spider) is res\n\n        req2 = Request('http://scrapytest.org/sub1/')\n        assert self.mw.process_request(req2, self.spider) is None\n\n        self.assertCookieValEqual(req2.headers.get('Cookie'), b\"C1=value1; galleta=salada\")\n\n    def test_cookiejar_key(self):\n        req = Request(\n            'http://scrapytest.org/',\n            cookies={'galleta': 'salada'},\n            meta={'cookiejar': \"store1\"},\n        )\n        assert self.mw.process_request(req, self.spider) is None\n        self.assertEqual(req.headers.get('Cookie'), b'galleta=salada')\n\n        headers = {'Set-Cookie': 'C1=value1; path=/'}\n        res = Response('http://scrapytest.org/', headers=headers, request=req)\n        assert self.mw.process_response(req, res, self.spider) is res\n\n        req2 = Request('http://scrapytest.org/', meta=res.meta)\n        assert self.mw.process_request(req2, self.spider) is None\n        self.assertCookieValEqual(req2.headers.get('Cookie'), b'C1=value1; galleta=salada')\n\n        req3 = Request(\n            'http://scrapytest.org/',\n            cookies={'galleta': 'dulce'},\n            meta={'cookiejar': \"store2\"},\n        )\n        assert self.mw.process_request(req3, self.spider) is None\n        self.assertEqual(req3.headers.get('Cookie'), b'galleta=dulce')\n\n        headers = {'Set-Cookie': 'C2=value2; path=/'}\n        res2 = Response('http://scrapytest.org/', headers=headers, request=req3)\n        assert self.mw.process_response(req3, res2, self.spider) is res2\n\n        req4 = Request('http://scrapytest.org/', meta=res2.meta)\n        assert self.mw.process_request(req4, self.spider) is None\n        self.assertCookieValEqual(req4.headers.get('Cookie'), b'C2=value2; galleta=dulce')\n\n        # cookies from hosts with port\n        req5_1 = Request('http://scrapytest.org:1104/')\n        assert self.mw.process_request(req5_1, self.spider) is None\n\n        headers = {'Set-Cookie': 'C1=value1; path=/'}\n        res5_1 = Response('http://scrapytest.org:1104/', headers=headers, request=req5_1)\n        assert self.mw.process_response(req5_1, res5_1, self.spider) is res5_1\n\n        req5_2 = Request('http://scrapytest.org:1104/some-redirected-path')\n        assert self.mw.process_request(req5_2, self.spider) is None\n        self.assertEqual(req5_2.headers.get('Cookie'), b'C1=value1')\n\n        req5_3 = Request('http://scrapytest.org/some-redirected-path')\n        assert self.mw.process_request(req5_3, self.spider) is None\n        self.assertEqual(req5_3.headers.get('Cookie'), b'C1=value1')\n\n        # skip cookie retrieval for not http request\n        req6 = Request('file:///scrapy/sometempfile')\n        assert self.mw.process_request(req6, self.spider) is None\n        self.assertEqual(req6.headers.get('Cookie'), None)\n\n    def test_local_domain(self):\n        request = Request(\"http://example-host/\", cookies={'currencyCookie': 'USD'})\n        assert self.mw.process_request(request, self.spider) is None\n        self.assertIn('Cookie', request.headers)\n        self.assertEqual(b'currencyCookie=USD', request.headers['Cookie'])\n\n    @pytest.mark.xfail(reason=\"Cookie header is not currently being processed\")\n    def test_keep_cookie_from_default_request_headers_middleware(self):\n        DEFAULT_REQUEST_HEADERS = dict(Cookie='default=value; asdf=qwerty')\n        mw_default_headers = DefaultHeadersMiddleware(DEFAULT_REQUEST_HEADERS.items())\n        # overwrite with values from 'cookies' request argument\n        req1 = Request('http://example.org', cookies={'default': 'something'})\n        assert mw_default_headers.process_request(req1, self.spider) is None\n        assert self.mw.process_request(req1, self.spider) is None\n        self.assertCookieValEqual(req1.headers['Cookie'], b'default=something; asdf=qwerty')\n        # keep both\n        req2 = Request('http://example.com', cookies={'a': 'b'})\n        assert mw_default_headers.process_request(req2, self.spider) is None\n        assert self.mw.process_request(req2, self.spider) is None\n        self.assertCookieValEqual(req2.headers['Cookie'], b'default=value; a=b; asdf=qwerty')\n\n    @pytest.mark.xfail(reason=\"Cookie header is not currently being processed\")\n    def test_keep_cookie_header(self):\n        # keep only cookies from 'Cookie' request header\n        req1 = Request('http://scrapytest.org', headers={'Cookie': 'a=b; c=d'})\n        assert self.mw.process_request(req1, self.spider) is None\n        self.assertCookieValEqual(req1.headers['Cookie'], 'a=b; c=d')\n        # keep cookies from both 'Cookie' request header and 'cookies' keyword\n        req2 = Request('http://scrapytest.org', headers={'Cookie': 'a=b; c=d'}, cookies={'e': 'f'})\n        assert self.mw.process_request(req2, self.spider) is None\n        self.assertCookieValEqual(req2.headers['Cookie'], 'a=b; c=d; e=f')\n        # overwrite values from 'Cookie' request header with 'cookies' keyword\n        req3 = Request(\n            'http://scrapytest.org',\n            headers={'Cookie': 'a=b; c=d'},\n            cookies={'a': 'new', 'e': 'f'},\n        )\n        assert self.mw.process_request(req3, self.spider) is None\n        self.assertCookieValEqual(req3.headers['Cookie'], 'a=new; c=d; e=f')\n\n    def test_request_cookies_encoding(self):\n        # 1) UTF8-encoded bytes\n        req1 = Request('http://example.org', cookies={'a': '\u00e1'.encode('utf8')})\n        assert self.mw.process_request(req1, self.spider) is None\n        self.assertCookieValEqual(req1.headers['Cookie'], b'a=\\xc3\\xa1')\n\n        # 2) Non UTF8-encoded bytes\n        req2 = Request('http://example.org', cookies={'a': '\u00e1'.encode('latin1')})\n        assert self.mw.process_request(req2, self.spider) is None\n        self.assertCookieValEqual(req2.headers['Cookie'], b'a=\\xc3\\xa1')\n\n        # 3) String\n        req3 = Request('http://example.org', cookies={'a': '\u00e1'})\n        assert self.mw.process_request(req3, self.spider) is None\n        self.assertCookieValEqual(req3.headers['Cookie'], b'a=\\xc3\\xa1')\n\n    @pytest.mark.xfail(reason=\"Cookie header is not currently being processed\")\n    def test_request_headers_cookie_encoding(self):\n        # 1) UTF8-encoded bytes\n        req1 = Request('http://example.org', headers={'Cookie': 'a=\u00e1'.encode('utf8')})\n        assert self.mw.process_request(req1, self.spider) is None\n        self.assertCookieValEqual(req1.headers['Cookie'], b'a=\\xc3\\xa1')\n\n        # 2) Non UTF8-encoded bytes\n        req2 = Request('http://example.org', headers={'Cookie': 'a=\u00e1'.encode('latin1')})\n        assert self.mw.process_request(req2, self.spider) is None\n        self.assertCookieValEqual(req2.headers['Cookie'], b'a=\\xc3\\xa1')\n\n        # 3) String\n        req3 = Request('http://example.org', headers={'Cookie': 'a=\u00e1'})\n        assert self.mw.process_request(req3, self.spider) is None\n        self.assertCookieValEqual(req3.headers['Cookie'], b'a=\\xc3\\xa1')\n\n    def test_invalid_cookies(self):\n        \"\"\"\n        Invalid cookies are logged as warnings and discarded\n        \"\"\"\n        with LogCapture(\n            'scrapy.downloadermiddlewares.cookies',\n            propagate=False,\n            level=logging.INFO,\n        ) as lc:\n            cookies1 = [{'value': 'bar'}, {'name': 'key', 'value': 'value1'}]\n            req1 = Request('http://example.org/1', cookies=cookies1)\n            assert self.mw.process_request(req1, self.spider) is None\n            cookies2 = [{'name': 'foo'}, {'name': 'key', 'value': 'value2'}]\n            req2 = Request('http://example.org/2', cookies=cookies2)\n            assert self.mw.process_request(req2, self.spider) is None\n            cookies3 = [{'name': 'foo', 'value': None}, {'name': 'key', 'value': ''}]\n            req3 = Request('http://example.org/3', cookies=cookies3)\n            assert self.mw.process_request(req3, self.spider) is None\n            lc.check(\n                (\"scrapy.downloadermiddlewares.cookies\",\n                 \"WARNING\",\n                 \"Invalid cookie found in request <GET http://example.org/1>:\"\n                 \" {'value': 'bar'} ('name' is missing)\"),\n                (\"scrapy.downloadermiddlewares.cookies\",\n                 \"WARNING\",\n                 \"Invalid cookie found in request <GET http://example.org/2>:\"\n                 \" {'name': 'foo'} ('value' is missing)\"),\n                (\"scrapy.downloadermiddlewares.cookies\",\n                 \"WARNING\",\n                 \"Invalid cookie found in request <GET http://example.org/3>:\"\n                 \" {'name': 'foo', 'value': None} ('value' is missing)\"),\n            )\n        self.assertCookieValEqual(req1.headers['Cookie'], 'key=value1')\n        self.assertCookieValEqual(req2.headers['Cookie'], 'key=value2')\n        self.assertCookieValEqual(req3.headers['Cookie'], 'key=')\n\n    def test_primitive_type_cookies(self):\n        # Boolean\n        req1 = Request('http://example.org', cookies={'a': True})\n        assert self.mw.process_request(req1, self.spider) is None\n        self.assertCookieValEqual(req1.headers['Cookie'], b'a=True')\n\n        # Float\n        req2 = Request('http://example.org', cookies={'a': 9.5})\n        assert self.mw.process_request(req2, self.spider) is None\n        self.assertCookieValEqual(req2.headers['Cookie'], b'a=9.5')\n\n        # Integer\n        req3 = Request('http://example.org', cookies={'a': 10})\n        assert self.mw.process_request(req3, self.spider) is None\n        self.assertCookieValEqual(req3.headers['Cookie'], b'a=10')\n\n        # String\n        req4 = Request('http://example.org', cookies={'a': 'b'})\n        assert self.mw.process_request(req4, self.spider) is None\n        self.assertCookieValEqual(req4.headers['Cookie'], b'a=b')\n\n    def _test_cookie_redirect(\n        self,\n        source,\n        target,\n        *,\n        cookies1,\n        cookies2,\n    ):\n        input_cookies = {'a': 'b'}\n\n        if not isinstance(source, dict):\n            source = {'url': source}\n        if not isinstance(target, dict):\n            target = {'url': target}\n        target.setdefault('status', 301)\n\n        request1 = Request(cookies=input_cookies, **source)\n        self.mw.process_request(request1, self.spider)\n        cookies = request1.headers.get('Cookie')\n        self.assertEqual(cookies, b\"a=b\" if cookies1 else None)\n\n        response = Response(\n            headers={\n                'Location': target['url'],\n            },\n            **target,\n        )\n        self.assertEqual(\n            self.mw.process_response(request1, response, self.spider),\n            response,\n        )\n\n        request2 = self.redirect_middleware.process_response(\n            request1,\n            response,\n            self.spider,\n        )\n        self.assertIsInstance(request2, Request)\n\n        self.mw.process_request(request2, self.spider)\n        cookies = request2.headers.get('Cookie')\n        self.assertEqual(cookies, b\"a=b\" if cookies2 else None)\n\n    def test_cookie_redirect_same_domain(self):\n        self._test_cookie_redirect(\n            'https://toscrape.com',\n            'https://toscrape.com',\n            cookies1=True,\n            cookies2=True,\n        )\n\n    def test_cookie_redirect_same_domain_forcing_get(self):\n        self._test_cookie_redirect(\n            'https://toscrape.com',\n            {'url': 'https://toscrape.com', 'status': 302},\n            cookies1=True,\n            cookies2=True,\n        )\n\n    def test_cookie_redirect_different_domain(self):\n        self._test_cookie_redirect(\n            'https://toscrape.com',\n            'https://example.com',\n            cookies1=True,\n            cookies2=False,\n        )\n\n    def test_cookie_redirect_different_domain_forcing_get(self):\n        self._test_cookie_redirect(\n            'https://toscrape.com',\n            {'url': 'https://example.com', 'status': 302},\n            cookies1=True,\n            cookies2=False,\n        )\n\n    def _test_cookie_header_redirect(\n        self,\n        source,\n        target,\n        *,\n        cookies2,\n    ):\n        \"\"\"Test the handling of a user-defined Cookie header when building a\n        redirect follow-up request.\n\n        We follow RFC 6265 for cookie handling. The Cookie header can only\n        contain a list of key-value pairs (i.e. no additional cookie\n        parameters like Domain or Path). Because of that, we follow the same\n        rules that we would follow for the handling of the Set-Cookie response\n        header when the Domain is not set: the cookies must be limited to the\n        target URL domain (not even subdomains can receive those cookies).\n\n        .. note:: This method tests the scenario where the cookie middleware is\n                  disabled. Because of known issue #1992, when the cookies\n                  middleware is enabled we do not need to be concerned about\n                  the Cookie header getting leaked to unintended domains,\n                  because the middleware empties the header from every request.\n        \"\"\"\n        if not isinstance(source, dict):\n            source = {'url': source}\n        if not isinstance(target, dict):\n            target = {'url': target}\n        target.setdefault('status', 301)\n\n        request1 = Request(headers={'Cookie': b'a=b'}, **source)\n\n        response = Response(\n            headers={\n                'Location': target['url'],\n            },\n            **target,\n        )\n\n        request2 = self.redirect_middleware.process_response(\n            request1,\n            response,\n            self.spider,\n        )\n        self.assertIsInstance(request2, Request)\n\n        cookies = request2.headers.get('Cookie')\n        self.assertEqual(cookies, b\"a=b\" if cookies2 else None)\n\n    def test_cookie_header_redirect_same_domain(self):\n        self._test_cookie_header_redirect(\n            'https://toscrape.com',\n            'https://toscrape.com',\n            cookies2=True,\n        )\n\n    def test_cookie_header_redirect_same_domain_forcing_get(self):\n        self._test_cookie_header_redirect(\n            'https://toscrape.com',\n            {'url': 'https://toscrape.com', 'status': 302},\n            cookies2=True,\n        )\n\n    def test_cookie_header_redirect_different_domain(self):\n        self._test_cookie_header_redirect(\n            'https://toscrape.com',\n            'https://example.com',\n            cookies2=False,\n        )\n\n    def test_cookie_header_redirect_different_domain_forcing_get(self):\n        self._test_cookie_header_redirect(\n            'https://toscrape.com',\n            {'url': 'https://example.com', 'status': 302},\n            cookies2=False,\n        )\n"], "filenames": ["docs/news.rst", "scrapy/downloadermiddlewares/redirect.py", "tests/test_downloadermiddleware_cookies.py"], "buggy_code_start_loc": [8, 6, 8], "buggy_code_end_loc": [4492, 84, 370], "fixing_code_start_loc": [8, 7, 9], "fixing_code_end_loc": [4557, 105, 526], "type": "CWE-863", "message": "Exposure of Sensitive Information to an Unauthorized Actor in GitHub repository scrapy/scrapy prior to 2.6.1.", "other": {"cve": {"id": "CVE-2022-0577", "sourceIdentifier": "security@huntr.dev", "published": "2022-03-02T04:15:06.960", "lastModified": "2022-03-24T15:32:44.797", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Exposure of Sensitive Information to an Unauthorized Actor in GitHub repository scrapy/scrapy prior to 2.6.1."}, {"lang": "es", "value": "Una Exposici\u00f3n de Informaci\u00f3n Confidencial a un Actor no Autorizado en el repositorio de GitHub scrapy/scrapy versiones anteriores a 2.6.1"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "NONE", "availabilityImpact": "NONE", "baseScore": 6.5, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 3.6}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 8.8, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.8, "impactScore": 5.9}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:S/C:P/I:N/A:N", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "PARTIAL", "integrityImpact": "NONE", "availabilityImpact": "NONE", "baseScore": 4.0}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.0, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-863"}]}, {"source": "security@huntr.dev", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-200"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:scrapy:scrapy:*:*:*:*:*:*:*:*", "versionEndExcluding": "2.6.1", "matchCriteriaId": "CDE4A502-62CA-49F4-88B8-521D66EEA30C"}]}]}, {"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:o:debian:debian_linux:9.0:*:*:*:*:*:*:*", "matchCriteriaId": "DEECE5FC-CACF-4496-A3E7-164736409252"}]}]}], "references": [{"url": "https://github.com/scrapy/scrapy/commit/8ce01b3b76d4634f55067d6cfdf632ec70ba304a", "source": "security@huntr.dev", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://huntr.dev/bounties/3da527b1-2348-4f69-9e88-2e11a96ac585", "source": "security@huntr.dev", "tags": ["Exploit", "Issue Tracking", "Patch", "Third Party Advisory"]}, {"url": "https://lists.debian.org/debian-lts-announce/2022/03/msg00021.html", "source": "security@huntr.dev", "tags": ["Mailing List", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/scrapy/scrapy/commit/8ce01b3b76d4634f55067d6cfdf632ec70ba304a"}}