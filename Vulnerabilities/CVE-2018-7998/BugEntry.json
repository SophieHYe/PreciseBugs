{"buggy_code": ["12/2/18 started 8.6.3\n- use pkg-config to find libjpeg, if we can\n- better clean of output image in vips_image_write() fixes a crash \n  writing twice to memory\n- better rounding behaviour in convolution means we hit the vector path more\n  often\n\n5/1/18 started 8.6.2\n- vips_sink_screen() keeps a ref to the input image ... stops a rare race\n- fix a minor accidental ABI break in 8.6.0 -> 8.6.1 [remicollet]\n- fix read of plane-separate TIFFs with large strips [remicollet]\n- fix a C++ warning in composite.cpp [lovell]\n- remove number of images limit in composite\n- composite allows 1 mode ... reused for all joins\n- fix race in vips_sink() for seq read \n\n10/12/17 started 8.6.1\n- fix mmap window new/free cycling \n- fix some compiler warnings\n- remove the 64-image limit on bandary operations\n- better version date [bmwiedemann]\n- bump wrapper script version [bgilbert]\n- fix a memleak on error during jpeg buffer write [lovell]\n- fix misspelling of IPTC as IPCT [lovell]\n- seq could be set on small images opened in random-access mode [aferrero2707]\n- fix small memleak in dzsave [lovell]\n- small speedup for rgb->g [lovell]\n\n15/4/17 started 8.6.0\n- supports fits images with leading non-image HDUs, thanks benepo\n- add vips_image_new_from_image() and vips_image_new_from_image1() ... make a\n  constant image\n- add new_from_image() to Python as well\n- slight change to cpp new_from_image() to match py/C behaviour\n- vips_conv(), vips_compass(), vips_convsep() default to FLOAT precision\n- add FORCE resize mode to break aspect ratio\n- add vips_thumbnail_image()\n- better prefix guessing on Windows, thanks tumagonx\n- savers support a \"page_height\" option for multipage save\n- rename 'disc' as 'memory' and default off\n- add vips_find_trim(), search for non-background areas \n- remove lcms1 support, it had bitrotted\n- `join` tagged as seq\n- support tiffsave_buffer for pyramids, thanks bubba\n- thumbnail and vipsthumbnail have an option for rendering intent, thanks \n  kleisauke \n- set file create time on Windows, thanks dlong500\n- remove python tests ... moved to pyvips test suite\n- vips7 and vips8 python bindings default to off ... use the new pyvips\n  binding instead\n- better svgload: larger output, handle missing width/height, thanks lovell\n- add vips_gravity() ... embed, but with direction rather than position\n- vips_text() can autofit text to a box, thanks gargsms\n- add vips_composite() / vips_composite2(): merge a set of images with \n  a set of blend modes\n- better gobject-introspection annotations, thanks astavale \n- vips_image_write() severs all links between images, when it can ... thanks\n  Warren and Nakilon\n- vector path for convolution is more accurate and can handle larger masks\n- linear and cubic kernels for reduce are higher quality\n- added vips_value_set_blob_free()\n- \"--size Nx\" to vipsthumbnail was broken, thanks jrochkind \n- fix build with gcc 7\n- add vips_fill_nearest() ... fill pixels with nearest colour\n- add VIPS_COMBINE_MIN, a new combining mode for vips_compass()\n- vips_hist_find_indexed() now has a @combine parameter\n- vips_affine() and vips_similarity() have a \"background\" parameter\n- fix nasty jaggies on the edges of affine output, thanks chregu\n- add gif-delay, gif-comment and gif-loop metadata\n- add dispose handling to gifload\n- dzsave outputs extra right and bottom overlap-only tiles, for closer spec\n  adherence\n- deprecate the \"centre\" option for vips_resize(): it's now always on\n- setting the EXIF data block automatically sets other image tags\n- add \"extend\" option to affine; resize uses it to stop black edges\n\n29/8/17 started 8.5.9\n- make --fail stop jpeg read on any libjpeg warning, thanks @mceachen\n- don't build enumtypes so often, removing perl as a compile dependency\n- fix a crash with heavy use of draw operations from language bindings, \n  thanks @Nakilon \n\n2/8/17 started 8.5.8\n- fix transparency detection in merge, thanks Haida\n- define env var VIPS_WARNING to hide warning messages\n- shut down dzsave output earlier to help mark-sweep bindings\n- fix webp thumbnail upscale, thanks Kleis\n\n9/6/17 started 8.5.7\n- better smartcrop\n- transform cmyk->rgb automatically on write if there's an embedded profile\n  and the saver does not support cmyk\n- fix DPI mixup in svgload ... we were writing images about 20% too large,\n  thanks Fosk\n\n19/5/17 started 8.5.6\n- tiff read with start page > 0 could break edge tiles or strips\n- raise b64 limit to allow for huge profiles (thanks jaume)\n- fix error return in blob save (thanks jaume)\n- tag vipsprofile as py2 (thanks ioquatix)\n- don't cache thumbnail (thanks tomasc)\n\n23/4/17 started 8.5.5\n- doc polishing\n- more improvements for truncated PNG files, thanks juyunsang \n- improve corrupted jpg handling, thanks juyunsang\n- fix small test suite issues on os x\n\n23/4/17 started 8.5.4\n- don't depend on image width when setting n_lines, thanks kleisauke\n\n7/4/17 started 8.5.3\n- more link fixing in docs \n- revise cache sizing again to help out of order errors under heavy load, thanks\n  kleisauke\n\n25/3/17 started 8.5.2\n- better behaviour for truncated PNG files, thanks Yury\n- missing proto for vips_tiffsave_buffer(), thanks greut\n- move some docs from the wiki and blog into core libvips docs\n- add support for markdown in docs\n\n25/3/17 started 8.5.1\n- init more classes earlier, thanks David\n\n13/10/16 started 8.5.0\n- rewritten buffer system is safer and frees memory earlier\n- added tiff save to buffer\n- added dzsave save to buffer (zip only)\n- revise header get/set functions\n- better vipsheader behaviour with complex field types\n- added vips_image_hasalpha()\n- added vips_thumbnail() / vips_thumbnail_buffer()\n- webpload/webpsave read and write icc, xmp, exif metadata\n- better >4gb detect for zip dzsave output [Felix B\u00fcnemann]\n- all loaders have a @fail option, meaning fail on first warning, though it\n  only does anything for jpg and csv\n- add vips_image_get_fields() to help bindings\n- add tiff multi-page read/write\n- add VIPS_META_PAGE_HEIGHT metadata\n- IM6/IM7 magickload supports page/n/page-height, all_frames deprecated\n- gifload supports n/page-height\n- added #defines for VIPS_SONAME, VIPS_LIBRARY_CURRENT, VIPS_LIBRARY_REVISION,\n  VIPS_LIBRARY_AGE\n- better support for bscale / bzero in fits images\n- deprecate vips_warn() / vips_info(); use g_warning() / g_info() instead\n- vipsthumbnail supports much fancier geometry strings, thanks tomasc\n- vips_thumbnail() has new @size option\n- fix --vips-cache-max etc. \n- add compute reordering, plus some new API to support it:\n  vips_reorder_margin_hint() and vips_reorder_prepare_many(), thanks\n  aferrero2707\n- kick load operations from cache on read error, thanks gaillard \n- fix return from C++ assignment operator overloads (+=, -= etc) \n- add @max_slope to vips_hist_local() to implement CLAHE, thanks hunter-87\n- vips_gaussnoise() pixels are reproducible on recalc, thanks MvGulik\n- max/min sort values by y and x coordinate\n- tiff read uses libtiff scanline API if rows-per-strip is large\n- vips_region_shrink() knows about alpha, helps dzsave and tiffsave\n- use expat, not libxml, for XML load ... removes a required dependency, since\n  we get expat as part of glib\n- new sequential mode infrastructure is faster and more flexible\n- add vips_smartcrop(), based on sharp's smartcropper\n- vipsthumbnail has a --smartcrop option\n- added vips_rot90() etc. convenience functions\n- fix vips_resize() bug when hscale and vscale were very different\n\n8/12/16 started 8.4.5\n- allow libgsf-1.14.26 to help centos, thanks tdiprima\n\n11/11/16 started 8.4.4\n- fix crash in vips.exe arg parsing on Windows, thanks Yury\n\n18/10/16 started 8.4.3\n- fix error detection in gif_close, thanks aaron42net\n- fix tiny threading memleak\n- improve compatibility with very old glib, see #548\n\n27/9/16 started 8.4.2\n- small doc improvements\n- fix error message for metadata fetch type mismatch\n- resolve a race condition in thread shutdown, thanks Lovell\n\n1/5/16 started 8.4\n- many more wepsave options [Felix B\u00fcnemann]\n- added quant_table option to wepsave [Felix B\u00fcnemann]\n- added @n option to pdfload, thanks andris\n- dzsave won't write empty tiles in google mode, thanks bverem, perog,\n  felixbuenemann\n- allow nested [] in CLI args\n- restore BandFmt on unpremultiply in vipsthumbnail\n- better python detection and build [Felix B\u00fcnemann]\n- max-alpha defaults to 65535 for RGB16/GREY16\n- added radsave_buffer [Henri Chain]\n- support tiff orientation tag\n- autorotate option for tiff load\n- tiffsave converts for jpg if jpg compression is turned on\n- tiffsave supports --strip\n- conversions to GREY16 could lock\n- free pixel buffers on image close as well as thread exit ... stops main \n  thread buffers clogging up the system\n- dzsave can write compressed zips [Felix B\u00fcnemann]\n- vips_image_write() only refs the input when it has to ... makes it easier to\n  combine many images in bounded memory\n- VImage::write() implementation was missing\n- VImage::write() return value changed from void to VImage to help chaining\n- added C++ arithmetic assignment overloads, += etc. \n- VImage::ifthenelse() with double args was missing =0 on options\n- better accuracy for reducev with smarter multiplication\n- better quality for vips_resize() with linear/cubic kernels \n- pyvips8 can create new metadata\n- better upsizing with vips_resize()\n- add imagemagick v7 support, thanks sachinwalia2k8 \n- added vips_worley(), vips_perlin() noise generators\n- added vips_convf(), vips_convi(), vips_convasep(), vips_conva() ... \n  im_conv*() functions rewritten as classes\n- vips_convsep() calls vips_convasep() for the approximate case\n- new fixed-point vector path for convi is up to about 2x faster\n- gif loader can make 1, 2, 3, or 4 bands depending on file contents\n- support --strip for pngsave\n- add svgz support [Felix B\u00fcnemann]\n- rename boostrap.sh -> autogen.sh to help snapcraft\n- support unicode filenames on Windows \n- added VIPS_ROUND as well as VIPS_RINT\n- resize/reduce*/shrink*/affine now round output size to nearest rather than \n  rounding down, thanks ioquatix\n- better support for tile overlaps in google maps mode in dzsave\n- dzsave puts vips-properties.xml in the main dir for gm and zoomify layouts\n- resize and reduce have @centre option for centre convention downsampling\n- vipsthumbnail uses centre convention to better match imagemagick\n\n19/8/16 started 8.3.4\n- better transparency handling in gifload, thanks diegocsandrim\n\n30/7/16 started 8.3.3\n- fix performance regression in 8.3.2, thanks Lovell\n- yet more robust vips file reading\n\n18/5/16 started 8.3.2\n- more robust vips image reading\n- more robust tiff read [Matt Richards]\n\n15/4/16 started 8.3.1\n- rename vips wrapper script, it was still vips-8.2, thanks Benjamin\n- export C++ operator overloads for MSVC linking [Lovell]\n- fix magickload @page with GraphicsMagick\n- add giflib5 support\n- allow resize >1 on one axis, <1 on the other\n- vips_resize has an optional @kernel argument\n- fix giflib4 detection [felixbuenemann]\n\n29/1/16 started 8.3\n- add vips_reduce*() ... a fast path for affine downsize\n- vips_resize() uses vips_reduce() with lanczos3 \n- bicubic is better on 32-bit int images\n- add pdfload, svgload, gifload for PDF, SVG and GIF rendering \n- vipsthumbnail knows about pdfload and svgload\n- added @page param to magickload \n- matload is more specific (thanks bithive)\n- lower mem use for progressive jpg decode\n- sharpen has a new @sigma param, @radius is deprecated\n- sharpen allows a much greater range of parameters\n- sharpen defaults now suitable for screen output\n- better handling of deprecated args in python\n- much better handling of arrayimage command-line args\n- faster hist_find (Lovell Fuller)\n- webpload has a @shrink parameter for shrink-on-load\n- vipsthumbnail knows about webp shrink-on-load\n- better behaviour for vips_cast() shift of non-int types (thanks apacheark)\n- python .bandrank() now works like .bandjoin()\n- vipsthumbnail --interpolator and --sharpen switches are deprecated\n- switches to disable PPM, Rad and Analyze support\n- added VIPS_COUNT_PIXELS(), overcomputation tracking\n- @out_format in vips_system() can contain [options]\n- webpsave_buffer no longer ignores @lossless, thanks aaron42net\n- float tiff tagged as scRGB to match photoshop convention, thanks Murat\n- better jpeg autorot, thanks otto\n\n24/3/16 started 8.2.4\n- fix nohalo and vsqbs interpolators, thanks Rafael\n\n27/1/16 started 8.2.3\n- fix a crash with SPARC byte-order labq vips images\n- fix parsing of filenames containing brackets, thanks shilpi230\n- fix hist_entropy (lovell)\n- small fixes to radiance load\n\n12/1/16 started 8.2.2\n- changes to ease compiling C++ binding with MSVC [Lovell Fuller]\n- reorder file tests to put slow loaders last\n- ifthenelse needs less C stack during eval\n- better rounding in bilinear interpolator\n- fix to \"make check\" in non-C locales [felixbuenemann]\n- use compiler builtins isnan, isinf, fabs, fmin, fmax, ceil, floor when \n  possible [Lovell Fuller]\n- tune vips_shrinkh(), 30% faster [Lovell Fuller]\n- remove SEQ hint from vips_subsample(), fixes cli performance [erdmann]\n- fix double free on attach ICC profile from file in tiff write [erdmann]\n- use g_assert_not_reached() \n- better vips-from-C docs\n- remove Duff from im_conv() / im_conv_f() for a 25% speedup [Lovell Fuller]\n\n1/1/16 started 8.2.1\n- add a compat stub [Benjamin Gilbert]\n- python bandjoin is now just an instance function\n- small doc improvements\n- small vips7 C++ improvement\n- remove exception specifications from vips8 C++ interface [Lovell Fuller]\n- VImage::get_typeof() now returns GType\n\n7/10/15 started 8.2.0\n- added im_bufmagick2vips(), a vips7 wrapper for magick load from buffer\n- fetch unset property now returns default value rather than warning\n- many more const declarations to help gobject-introspection\n- rewritten vips_shrink() is 2x faster, much lower memuse, now handles complex\n- only allow [] for filename options\n- add memory.h to Python API .. makes tracked highwater visible\n- added bandjoin_const to add constant bands to an image\n- better alpha handling for tiff write, thanks sadaqatullahn\n- better cache sizing for vips_resize()\n- sizealike / formatalike / bandsalike elide completely if they can for\n  a x2 saving in C stack use in many cases\n- added vips_mapim() ... resample with an index image, plus test\n- try to improve vips_resize() quality a little more\n- vips_resize() can do non-square resizes\n- dzsave removes tile metadata by default, thanks Benjamin\n- jpeg strip option removes a little more, thanks Benjamin\n- added vips_image_new_from_memory_copy()\n- improve vips_sink_screen() stability under heavy load\n- added vips_arrayjoin()\n- Python x.bandjoin(y) is now x.ibandjoin(y), sorry\n- faster and lower-mem TIFF read\n- faster bilinear interpolator\n- TIFF loads and saves IMAGEDESCRIPTION\n- add --properties flag to tiffsave\n- dzsave defaults changed: now writes 256x256 jpegs for non-edge tiles, thanks\n  Daniel\n\n7/5/15 started 8.1.1\n- oop, vips-8.0 wrapper script should be vips-8.1, thanks Danilo\n- fix vips7 pathname parsing on windows, thanks Lovell\n\n7/5/15 starteld 8.1.0\n- add vips_premultiply(), vips_unpremultiply()\n- change the alpha range rules for vips_flatten() to match vips_premultiply()\n- vipsthumbnail uses vips_resize() rather than its own code\n- vipsthumbnail uses vips_premultiply() for better alpha quality\n- added bandand() bandor() bandeor() convenience funcs to Python\n- oops, base64 encode could pad by up to two zero bytes\n- added VipsRefString as a thing that gi bindings can unpack\n- support \"with Vips.Image as i:\" in Python\n- try to support DOS CSV and PPM files on linux\n- add vips_byteswap(), remove byteswap option from vips_copy()\n- add vips_bandfold()/vips_bandunfold()\n- dzsave supports zip output > 4gb, thanks benjamin\n- add support for HSV colourspace [Jonas \u00d8gaard]\n- skip oversized markers in jpeg write\n- jpeg exif tags saved as name rather than title\n- can now set any jpeg exif tag, not just modify existing tags\n- add vips_hist_entropy()\n- vips_log(), vips_log10() are zero-avoiding\n- better overlap handling for dzsave, thanks robclouth\n- add @spacing option to vips_text()\n- tiff loads and saves IPCT and Photoshop data\n\n7/5/15 started 8.0.3\n- dzsave and tif pyr write could fail for some image dimensions, thanks Jonas\n\n4/5/15 started 8.0.2\n- fix a refcount error in C++ wrapper, thanks huskier\n- better C++ api test\n- test suite improvements\n- remove a couple of stray header decls, thanks benjamin\n\n25/4/15 started 8.0.1\n- fix some compiler warnings \n- work around a glib bug that can cause segv under load\n- add some notes on threading to the docs\n- better leak reporting\n\n11/2/15 started 8.0\n- remove old doc stuff, lots of doc improvements\n- add fliphor(), flipver(), rot90(), rot180(), rot270(), median(), dilate(), \n  erode() convenience methods to Python and C++\n- python: use [] to index and slice image bands, use () to get a point\n- c++: use [] to band index, () returns a vector<double>\n- add shift option to cast\n- sRGB2scRGB and scRGB2sRGB scale 16-bit alpha to and from 8-bit\n- add magickload_buffer() [mcuelenaere]\n- add vips_foreign_is_a_buffer() [mcuelenaere]\n- added test_foreign.py, plus more test images\n- added vips_region_shrink(), fast x2 shrinker\n- rewritten tiff writer is about 3 - 4x faster at making pyramids\n- jpg, magick, png, tiff readers now use only 1 fd per input image\n- added vips_info_set(), vips_progress_set(), vips_profile_set() ... bindings\n  can now support all the vips command-line options if they wish \n- better conversion to greyscale, thanks bkw\n- add vips_image_copy_memory(), improves stability with heavy threading\n- jpegsave supports new mozjpeg features [lovell]\n- add vips_vipsload(), vips_vipssave() ... why not\n\n26/3/15 started 7.42.4\n- im_maxpos_avg() avoids NaN\n- small tiffsave doc improvements\n- better thresholding for tiffsave \"squash\" mode\n- add @miniswhite mode to tiffsave\n\n6/2/15 started 7.42.3\n- bump version for back-compat ABI change\n- added vips_image_memory(), an alias for vips_image_new_memory()\n- improvements to configure for python\n- remove --disable-cxx configure flag\n- python imageize preserves interpretation\n- fix dzsave as a target format \n\n30/12/14 started 7.42.2\n- C++ required output params were broken, thanks Lovell\n- remove VImage::scale() to get scale from header, it clashed with the\n  VipsScale operator, thanks Lovell\n- allow c++ set enum from string\n- display param default and range in usage\n- better docs\n- more tests\n- renamed VIPS_FOREIGN_DZ_DEPTH_1 as VIPS_FOREIGN_DZ_DEPTH_ONE etc. to help\n  bindings\n- vipsthumbnail will return an error code if one or more conversions failed\n- disable chroma subsample in jpeg-tiff if Q >= 90\n- try to handle tiffs with old-style 8-bit colormaps\n- rename vipsthumbnail -o as -f, -o stays as a hidden flag\n- fix some small leaks\n- faster openslide load, thanks Benjamin\n- add VInterpolate class to cplusplus binding, thanks Lovell\n- add lower-level operation cache access\n- turn on leak testing in test suite\n- don't use isnormal() to test for crazy FP numbers, thanks Murat\n- much faster RGB16 -> sRGB path\n\n24/12/14 started 7.42.1\n- add gobject-2.0 to Requires: in vips and vips-cpp .pc files\n- bump soname\n- fix VipsBlob read\n- remove \"future\" dependency, thanks bgilbert\n\n4/11/14 started 7.42.0\n- better default resolution for png load\n- better pbm (one bit) load, better pfm (float) load/save\n- added pbm (one bit) save\n- changed vips_gaussblur() parameters, sorry\n- add .szi as a dzsave zip synonym\n- support tiff XMP metadata\n- support @density arg to magickload [Lovell]\n- support python3.4 and python2.7 in new python binding\n- vips_gaussmat() and vips_logmat() are now int by default, to match\n  vips_conv(), and use @precision, not @integer\n- added --disable-pyvips8 switch to turn off new py binding\n- \"vips thing\" exit status can now be used to test for optional components\n\n25/7/14 started 7.41.0\n- start working on --disable-deprecated\n- fix pngload with libpng >1.6.1\n- add vips_resize()\n- return of vips_init(), but just for bindings\n- revised type.c to make it more binding-friendly\n- add @background arg to save: the colour to flatten against\n- add VIPS_ARGUMENT_MODIFY flag ... used for draw_circle etc, meaning an op\n  which modifies its argument\n- rename VIPS_OPERATION_RELATIONAL_NOTEQUAL as VIPS_OPERATION_RELATIONAL_NOTEQ\n  for consistency\n- python vips8 binding\n- python vips8 test suite: test_arithmetic.py, test_colour.py,\n  test_conversion.py\n- move zoomify ImageProperties file, now a better match to the offical tool\n- rename VIPS_ANGLE_180 as VIPS_ANGLE_D180 etc. to help python\n- remove cimg support, we have a gmic plugin now instead\n- add support for vips8 plugins\n- added \"autorotate\" option to jpeg load\n- added autorot operator\n- added @filter option to pngsave (Lovell)\n- C++ vips8 binding\n\n27/10/14 started 7.40.12\n- better tiff detection (Lovell)\n- fix memleak in sharpen (Lovell)\n- fix profile handling in XYZ2scRGB, thanks Lovell\n\n8/10/14 started 7.40.11\n- rework extra band handling for colour functions\n- set interpretation of matlut output more carefully\n\n8/9/14 started 7.40.10\n- icc_import and icc_transform checks the input profile for compatibility \n  with the image, thanks James\n- try to make vips_thread_shutdown() optional\n\n8/9/14 started 7.40.9\n- support jfif resunit \"none\"\n- support GRAY as an input and output ICC space\n- fix a read loop with setjmp() in png read, if the png file is broken\n- fix vipsthumbnail with both input cmyk and output rgb profiles specified\n- vipsthumbnail retries with specified input profile if embedded profile is\n  broken\n- add @profile option to pngsave, matching tiff and jpeg\n- fix a race in the operation cache [Lovell]\n\n8/9/14 started 7.40.8\n- fix configure on rhel6 [Lovell]\n- mono <-> rgb converters were not handling extra bands, thanks James\n- support jpeg resunit \"none\"\n\n21/8/14 started 7.40.7\n- width and height were swapped in matlab load\n- set interpretation more carefully on matlab load\n- fix memleak in tilecache [Lovell]\n- fix memleak in VipsArray [Lovell]\n- fix memleak in webp load from buffer [Lovell]\n- fix memleak in png save to buffer [Lovell]\n- make out of order read in png and jpg a fatal error\n- add thread_shutdown() to C++ (and thereby to python)\n\n12/8/14 started 7.40.6\n- more doc fixes\n- fix similarity rotate+scale, thanks Topochicho\n- fix 16-bit PNG save, thanks John\n- fix dzsave date on Windows, thanks John\n- fix vipsthumbnail on many-core systems, thanks James\n\n25/7/14 started 7.40.5\n- fix a race in im_maxpos_avg()\n- limit n_thr on tiny images\n- don't exit() on memleak detected, just warn\n- add \"autocrop\" option to openslide load\n- argh fix affine, again, there were sometimes black bars with nohalo and the\n  vips8 interface\n- pngsave in interlaced mode makes a copy of the image, so it's always seq \n- vipsthumbnail shrinks to 1/2 window_size\n- vipsthumbnail has an anti-alias filter between shrink and affine\n- vipsthumbnail defaults to bicubic \n- better rounding behaviour for fixed-point bicubic reduces noise\n- fix pngload with libpng >=1.6.11\n- fix colour for openslide read associated\n\n4/7/14 started 7.40.4\n- fix vips_rawsave_fd(), thanks aferrero2707 \n- fix im_point()\n- vips_scale() now does round to nearest to avoid rounding errors\n- improve im_openout() compat macro\n- more vips7 compatibility fixes, thanks steve\n- more robust vips_system()\n- add webp support to vips7 \n\n30/6/14 started 7.40.3\n- fix interlaced thumbnails in vipsthumbnail, thanks lovell\n- fix use of \"header\" in benchmark/, thanks David\n- fits save now caches the image before write, so it's top-to-bottom\n- add --properties argument to dzsave, thanks bgilbert, jhenriksen\n\n25/6/14 started 7.40.2\n- dzsave write to zip stops at 4gb, thanks bgilbert\n- improve short option name handling, thanks bgilbert\n- added --enable-docs configure option to help freebsd\n- removed a bash-ism from configure to help freebsd\n- don't assume GType fits in an int to help freebsd\n\n24/6/14 started 7.40.1\n- revise man.1 pages\n- fix vips_guess_prefix()\n\n23/6/14 started 7.40.0\n- version bump\n- renamed \"header\" as \"vipsheader\" and \"edvips\" as \"vipsedit\"\n\n21/1/14 started 7.39.0\n- auto-decode for (almost) all operations, see vips_image_decode()\n- background render thread cleans up and quits neatly\n- colourspace has a source_space option\n- operations can be tagged as \"deprecated\"\n- redo im_draw_circle(), im_draw_flood(), im_draw_line(), im_draw_mask(),\n  im_draw_image(), im_draw_rect(), im_draw_point(), im_read_point(),\n  im_draw_smudge(), im_label_regions() as classes\n- better rounding in vips_flatten()\n- VipsStatistic operations are sequential\n- vipsthumbnail has --rotate auto-rotate option\n- removed embedded thumbnail reader from vipsthumbnail: embedded thumbnails\n  are too unlike the main image\n- fix to vipsthumbnail --crop, thanks Alessandro \n- add vips_sum()\n- add vips_hough base class and vips_hough_line()\n- add \"mode\" param to vips_draw_image()\n- add vips_hough_circle()\n- reduce default cache size to 1,000 operations\n- added \"postbuild\" signal\n- vips_system() now supports many input images and you can change image\n  argument order\n- support 16-bit palette TIFFs, plus palette TIFFs can have an alpha\n- libgsf-1 is now an optional dependency \n- dzsave can directly write a ZIP file \n- add \".vips\" as an alternative suffix for vips files\n- added vips_tiffload_buffer()\n- added vips_image_new_from_buffer(), vips_image_write_to_buffer()\n- added vips_object_set_from_string()\n- added @container option to dzsave \n- support 1/2/4 bit palette tiff images with alpha\n- vips_system() now uses g_spawn_command_line_sync()\n- added im_tile_cache_random() to help nip2\n- added hough_circle() to vips7 C++ API\n- added Travis CI config, thanks Lovell\n- im_*merge(), im_*mosaic(), im_match*(), im_global_balance*(), im_remosaic(),\n  im_*mosaic1(), im_*merge1() redone as classes\n- better filename tracking for globalbalance\n- revised vips8 image load/save API, now simpler and more logical\n- operations emit \"invalidate\" if any of their input images invalidate\n- operation cache drops ops on invalidate\n- skipahead is back, thanks to a new threadpool tweak\n\n6/3/14 started 7.38.6\n- grey ramp minimum was wrong\n- vipsthumbnail --crop could fail for very non-square images, thanks\n  Alessandro\n- fix a crash in vips_rawsave(), thanks Andrea\n- updated German translation, thanks Chris\n- fix coordinate error in affine, thanks ferryfax\n\n24/2/14 started 7.38.5\n- jpeg load from buffer could write to input, thanks Lovell\n- fix webpload from buffer, thanks Lovell\n- vips_sequential() could fail under heavy load\n- remove support for seq mode read for operations like extract\n\n13/2/14 started 7.38.4\n- --sharpen=none option to vipsthumbnail was broken, thanks ferryfax\n- more locking on property create and lookup to help very-threaded systems,\n  thanks Nick \n\n22/1/14 started 7.38.3\n- undeprecate VIPS_MASK_IDEAL_HIGHPASS and friends, ruby-vips was using them,\n  thanks ahacking\n\n22/1/14 started 7.38.2\n- auto RAD decode for affine\n- falsecolour was not working for some image types\n- foreign memory buffer images did not have the right dhint, broke\n  command-line falsecolour on sequential images\n- support many Radiance readers active at once\n- add secret \"rgbjpeg\" flag to vips_tiffsave() to help IIP\n\n19/1/14 started 7.38.1\n- bump soname, thanks benjamin\n- better conversion to and from scrgb/xyz for rad (hdr) \n- fix --interpolate flag to vipsthumbnail, thanks Lovell\n\n18/1/14 started 7.38.0\n- version bump\n\n19/10/13 started 7.37.0\n- redone im_rotate_*mask45(), im_gauss_*mask*(), im_log_*mask(), im_dilate(),\n  im_erode(), im_rank_image(), im_compass(), im_linedet(), im_gradient(),\n  im_convsep(), im_convsep_f(), im_fastcor(), im_spcor(), im_sharpen()\n  as classes\n- im_gradcor() deprecated\n- vips_init() now does some ABI compat checking, though this change requires\n  an ABI break\n- add \"interlace\" option to vips_jpegsave()\n- remove vips_image_copy_fields() and vips_demand_hint() and add \n  vips_image_pipeline() to do both jobs\n- vipsthumbnail allows non-square bounding boxes, thanks seth\n- add vips_matrixprint()\n- add @point subsample mode to vips_subsample()\n- im_contrast_surface() deprecated: it was slower than calling conv a few\n  times\n- radiance load supports sequential read\n- rewritten radiance decode is much faster\n- add vips_crop(), a synonym for vips_extract_area()\n- rename vips_gammacorrect() as vips_gamma(), now takes 1 / exp\n- vips_gamma() works for any format\n- add --linear mode to vipsthumbnail\n- support XYZ as a PCS for vips_icc_import() and vips_icc_export()\n- add --strip option to jpegsave\n- added vips_gaussblur() convenience function\n- added --vips-profile, records and dumps thread timing and memory use info \n- added vipsprofile, visualises --vips-profile output\n- auto-vectorization-friendly inner loops\n- added vips::init() and vips::shutdown() to C++ API\n- reuse pixel buffers on sharing to reduce mem cycling\n- conv is SMALLTILE, huge mem use saving on wide images\n- vipsthumbnail has a --crop option\n- remove video4linux1 code, it was useless on all modern linuxes\n- redone freq filter builders as classes\n- redone im_fwfft(), im_invfft(), im_freqflt(), im_disp_ps(), im_fractsurf(),\n  im_phasecor() as classes\n- vips_colourspace() allows B_W, GREY16, RGB16 as source / target\n- added vips_thread_shutdown(), thanks Lovell\n- vips_linear() has a uchar output mode\n- redone im_cntlines(), im_rank() as classes\n- move im_zerox() to deprecated, it wasm't very useful\n\n9/1/14 started 7.36.6\n- fix some clang compiler warnings\n\n20/11/13 started 7.36.5\n- better cache sizing in unbuffered sequential mode\n- allow larger tile_size in dzsave\n- remove use of PATH_MAX to help gnu hurd\n- fix vips_hist_match()\n\n15/11/13 started 7.36.4\n- improve compat with im_init_world()\n\n18/10/13 started 7.36.3\n- fix compiler warnings in ubuntu 13.10\n- reverse similarity rotation direction to match the convention used \n  elsewhere in vips\n- fix blocked caching of sequential load operations\n- fix cache flags\n- fix --delete option to vipsthumbnail\n\n10/10/13\tstarted 7.36.2\n- better jpeg startup\n- rename jpeg bool type to reduce confusion between libraries\n\n3/10/13\tstarted 7.36.1\n- fix to help OS X build\n\n3/10/13\tstarted 7.36.0\n- version bump\n\n1/7/13 started 7.35.0\n- added vips_matrixload() and vips_matrixsave(), load and save vips mat format\n- rename image arrays as image matrices ... INTERPRETATION_ARRAY ->\n  INTERPRETATION_MATRIX etc. \n- rewrite im_buildlut(), im_identity*(), im_maplut(), im_falsecolour(),\n  im_gammacorrect(), im_histgr(), im_histcum(), im_histnorm(), im_heq(),\n  im_histnD(), im_histindexed(), im_histspec(), im_invertlut(), im_lhisteq(),\n  im_stdif(), im_project(), im_profile(), im_tone_build*(), im_mpercent*(),\n  im_ismonotonic() as classes\n- vips_hist_local(), vips_stdif() do any number of bands\n- thin vips8 wrapper for im_histplot()\n- added vips_error_freeze() / vips_error_thaw()\n- used freeze() / thaw() to stop file format sniffers logging spurious errors\n- vipsthumbnail uses embedded jpg thumbnails if it can \n- rename vips_diag() as vips_info(), add --vips-info flag\n- deprecate im_hsp()\n- added vips_webpload(), vips_webpload_buffer(), vips_webpsave(),\n  vips_webpsave_buffer(), vips_webpsave_mime()\n- tiff reader allows separate planes for strip read\n- tiff reader and writer allow many more formats, eg. 32-bit int, complex, etc. \n- tiff reader and writer allow any number of bands\n- added vips_image_new_matrixv()\n- dzsave basename param now called filename, so you can use .dz as a\n  destination (basename is still there but deprecated)\n- new _UNBUFFERED sequential mode saves memory in some important cases\n- vips_conv() is a simple wrapper over the old convolution functions\n- new optimize_coding param for jpeg write produces optimal Huffman tables,\n  thanks Lovell \n- im_tone_map() and im_tone_analyse() deprecated\n- new --band arg to vips_maplut() replaces im_tone_map() functionality\n- added vips_similarity(), simple wrapper for vips_affine() that lets you\n  give a scale and rotate\n\n3/7/13 started 7.34.2\n- lower priority for Matlab load to reduce segvs from Mat_Open(), thanks\n  Michael\n- null-terminate libexif strings, thanks Mike\n- openslide always outputs solid pixels\n\n28/6/13 started 7.34.1\n- fix morphological operators on non-uchar images\n- remove any ICC profile when we use vips to go to srgb\n\n7/6/13 started 7.34.0\n- version bump\n- oops, VImage.PIL_mode_from_vips() failed for CMYK, thanks Alessandro\n- fix no-pango build\n- add im_vips2dz(): run the deepzoom writer from vips7\n- vips_magickload() has an option to read all images in a sequence\n- redo im_make_xy(), im_*eye(), im_zone*(), im_sines() as classes\n- added vips_pngload_buffer()\n- faster --centre option to dzsave, thanks Kacey\n\n12/3/13 started 7.33.0\n- vipsthumbnail lets you specify the sharpening mask\n- turn off caching for im_copy()/vips_copy(), we use copy to stop sharing, and\n  it's cheap so caching doesn't help anyway\n- auto rshift down to 8 bits on save, if necessary\n- im_gaussnoise(), im_copy_file(), im_grid(), im_scale(), im_scaleps(),\n  im_wrap(), im_rotquad(), im_zoom(), im_subsample(), im_msb(), im_text(),\n  im_system(), im_system_image()\n  redone as classes\n- add --angle option to dzsave\n- another vips_shrink() fix argh\n\n14/5/13 started 7.32.4\n- icc import and export could segv on very wide images\n- fix centos 5 build, thanks re-boot\n\n16/4/13 started 7.32.3\n- rename GETTEXT_PACKAGE as vips7.32 to help Debian (thanks Jay)\n- added \"persistent\" option to tilecache\n\n12/3/13 started 7.32.2\n- removed some left-over debugging code from configure.ac\n- better handling of args without values, thanks Ruven\n- better error messages from vips.c\n- fix demand hints so \"vips shrink\" works again, thanks Jan\n- im_jpeg2vips.c builds without jpeglib.h, thanks Alessandro\n\n6/2/13 started 7.32.1\n- fix --without-lcms, thanks speckins\n- updates to licence, thanks Benjamin\n- remove \"fred\" from dist\n- better bootstrap on OS X\n\n22/1/13 started 7.32.0\n- tilecache in threaded mode could deadlock if the downstream pixel source\n  raised an error (thanks Todd)\n- fix another dzsave corner-case (thanks Martin)\n- neater output for \"header\"\n- added VIPS_META_LOADER: record the loader name\n= header displays this loader hint\n- vipsthumbnail is better at cache sizing\n\n31/8/12 started 7.31.0\n- redone im_Lab2XYZ(), im_XYZ2Lab(), im_Lab2LCh(), im_LCh2Lab(), im_UCS2LCh, \n  im_LCh2UCS(), im_XYZ2Yxy(), im_Yxy2XYZ(), im_float2rad(), im_rad2float(),\n  im_Lab2LabQ(), im_LabQ2Lab(), im_Lab2LabS(), im_LabS2Lab(), im_LabQ2LabS(),\n  im_LabS2LabQ(), im_LabQ2disp(), im_XYZ2disp(), im_disp2XYZ(),\n  im_icc_import*(), im_icc_export*(), im_icc_transform*(), im_dE_fromLab(),\n  im_dECMC_fromLab(), im_dE00_from_Lab(), im_icc_ac2rc() as classes\n- added vips_colourspace(), vips_colourspace_issupported(), replaces all \n  derived conversions\n- faster and more accurate sRGB <-> XYZ conversion\n- support 16-bit sRGB import and export\n- rename UCS colourspace as CMC\n- dzsave can write zoomify and google maps layout as well\n- tilecache supports threaded access, so openslide read now threads\n- openslide2vips gets underlying tile size from openslide\n- embed has 'background' option\n- dzsave --layout google has a @background option\n- dzsave has a --depth option\n- update for new glib threading API\n- remove no threads option, glib no longer support it\n- better --help output for vips driver prog\n- vipsthumbnail -o allows absolute file names\n- much better exif handling for jpg images (thanks Gary)\n- preserve jpeg app13 (photoshop ipct)\n- vips_max() / _min() track the top n maxima / minima\n- deprecate im_maxpos_avg(): too specialised to be worth maintaining\n- deprecate im_linreg(): easily done by combining other operators\n- deprecate im_point(): easily done by combining other operators\n- add binary complex operations, with cross_phase as the only one so far\n- added vips_bandbool(), with vips_bandand(), _bandor(), _bandeor() as\n  convenience functions\n- added scRGB colourspace, linear light float space with sRGB primaries\n- all interpolators use corner convention ... we had round-to-nearest in\n  several of them before, causing a range of annoying problems\n- redone im_affine*() as a class\n- added input space displacement to affine\n- VipsArea is threadsafe\n- dzsave has a --centre option\n\n31/12/12 started 7.30.8\n- png icc profile write was broken\n\n31/12/12 started 7.30.7\n- better option parsing for \"vips\", thanks Haida\n- small fixes to help OS X\n- backported threaded tile cache from next version, im_tile_cache() now \n  uses it to prevent a deadlock, see comment there\n\n14/11/12 started 7.30.6\n- capture tiff warnings earlier\n\n14/11/12 started 7.30.5\n- fix libtool version mess up (thanks Benjamin)\n\n2/10/12 started 7.30.4\n- remove options from format string in .dzi (thanks Martin)\n- vipsCC.pc required the wrong version of vips (thanks Alessandro)\n- larger max tile size for dzsave\n- linecache is 50% larger to leave some slop room\n\n13/9/12 started 7.30.3\n- linecache sized itself too large\n- fix a compile failure if libtiff was not found (thanks Martin)\n- dzsave did not work for images with an odd number of scanlines \n  (thanks Martin)\n\n4/9/12 started 7.30.2\n- sequential stops all threads on error\n- sequential delays ahead threads rather than blocking them completely\n\n6/8/12 started 7.30.1\n- fixes to dzsave: shrink down to a 1x1 pixel tile, round image size up on \n  shrink, write a .dzi file with the pyramid params, default tile size and \n  overlap now matches the openslide writer\n- wrap VipsInterpolate for C++\n- so affinei and affinei_all appear in Python\n- be more cautious enabling YCbCr mode in tiff write\n- add \"DEPRECATED\" flag to arguments\n- jpeg load/save note and use the preferred resolution unit\n- better error msgs for enum args\n- fix compiler warnings in production build (thanks Dmitry)\n- fix spurious warnings about exif updates\n- VipsSequential has an integrated cache and stalls out of order threads\n- add a line cache ... sizes up dynamically with request size\n- tilecache / linecache use a hash table not a linear list\n\n20/7/12 started 7.30.0\n- support \"rs\" mode in vips7\n- add --vips-version cmdline arg\n- fix --without-tiff / exr / jpeg / png / magick\n- add --vips-fatal flag\n\n19/3/12 started 7.29.0\n- sanity-check PNG read geometry\n- nearest-neighbor interpolation rounds coordinates to nearest instead of \n  rounding down (thanks Nicolas)\n- add dzsave, save in deep zoom format\n- rework im_shrink() as a class\n- remove im_rightshift_size(), just a convenience function now\n- vipsthumbnail no longer removes profiles by default\n- much more gentle sharpening in thumbnails\n- added \"minimise\" signal, used by tilecache to drop\n- add :seq support to im_tiff2vips(), im_jpeg2vips() ... helps ruby-vips\n- better thread safety for vips8 operation dispatch\n- better thread safety for upstream / downstream image linking\n- added \"rs\" open mode, removed \"rd\"\n- added vips_operation_get_flags() ... system for attaching sets of flags to\n  operations\n- added VIPS_OPERATION_SEQUENTIAL flag\n- vips8 command-line interface uses this to turn sequential mode on\n  automatically when possible\n- better handling of input files in vips7 command-line interface\n- sequential can skip ahead, so extract / insert are now seq\n\n16/7/12 started 7.28.10\n- wopconst was broken\n- vips_sign() was broken\n- png save compression range was wrong\n- more/moreeq was wrong\n- vips7 ppm save with options was broken \n- don't cache write operations\n\n18/6/12 started 7.28.9\n- slightly more memory debugging output\n- remove references to the static bicubic interpolator from the docs\n- fix temp file handling on Windows --- was breaking for non-vips files \n  over 100mb\n- better support for using images from multiple threads\n\n18/6/12 started 7.28.8\n- fixes for centos5 portability\n\n18/6/12 started 7.28.7\n- add vips_flatten() -- flatten RGBA to RGB\n- better alpha handling in PNG load\n- don't save RGBA PNG as CMYK JPG (thanks Tobsn)\n- fix a crash with malformed jpg files (thanks Grigoriy)\n- vipsthumbnail enables sequential mode more and caches lines better\n\n19/4/12 started 7.28.6\n- better resolution unit handling in deprecated im_vips2tiff()\n- use TIFF_CFLAGS output from pkg-config (thanks Jay)\n- much faster vips_argument_map()\n- make jpeg pyramids work with tiff4\n- tiff loader always offers THINSTRIP (thanks Diuming)\n- add \"nocache\" operation flag, set for sequential load (thanks Diuming)\n- fix a crash in the tiff reader for huge values of RowsPerStrip (thanks\n  Nicolas)\n- remove use of G_DEFINE_BOXED_TYPE() to help compat (thanks Jake)\n\n19/4/12 started 7.28.5\n- ifthenelse blend mode was broken\n- small blend speedup\n- default to libtiff-4\n\n17/4/12 started 7.28.4\n- up max buffer size for vipsbuf\n\n6/4/12 started 7.28.3\n- vips_divide() failed for int arguments\n- fix warning for unused vips7 gvalue argument\n- fix openslide read: always return png-style rgba, im_argb2rgba() becomes a\n  NOP\n- cast to unsigned int now removes <0 values\n- vips7 interface to openslide now supports :,level,associated options (thanks\n  Benjamin)\n- make vips8 cache smaller\n- more accurate progress reporting\n\n13/3/12 started 7.28.2\n- xres/yres tiffsave args were broken\n\n13/3/12 started 7.28.1\n- add ICC profile read/write for png files\n\n30/1/12 started 7.28.0\n- version bump\n- added vips_foreign_find_save_options()/vips_foreign_find_load_options()\n- delayed write to foreign via a \"w\" image was not working\n- support operations with many returns in Python\n- sequential read mode \n- better im_shrink()\n- added vips_sequential()\n- new vips_sink_memory() keeps read ordering\n- tiff, jpeg, png readers support sequential read\n- max/min avoid NaN\n- oop, histnorm was broken by the new vipsstats\n- never use IM ping to get a header, fixes BMP load\n- set @filename for non-vips formats in vips7 compat layer\n- make Xres/Yres double\n- completely disable debug by default in production builds\n\n20/8/11 started 7.27.0\n- version bump for new dev cycle\n- im_subtract(), im_avg(), im_min(), im_minpos(), im_copy(), im_embed(),\n  im_flophor(), im_flipver(), im_insert(), im_insert_noexpand(), im_lrjoin(),\n  im_tbjoin(), im_extract_area(), im_extract_bands(), im_extract_areabands(),\n  im_replicate(), im_clip2fmt(), im_gbandjoin(), im_bandjoin(), im_invert(),\n  im_lintra(), im_lintra_vec(), im_black(), im_rot90, im_rot180(), im_rot270()\n  im_sintra(), im_costra(), im_tantra(), im_asintra(), im_acostra(), \n  im_atantra(), im_exptra(), im_exp10tra(), im_logtra(), im_log10tra(),\n  im_abs(), im_sign(), im_max(), im_maxpos(), im_deviate(), im_divide(),\n  im_multiply(), im_stats(), im_measure(), im_recomb(), im_floor(), im_ceil(),\n  im_rint(), im_equal*(), im_notequal*(), im_less*(), im_lesseq*(), im_more*(),\n  im_moreeq*(), im_remainder*(), im_and*(), im_or*(), im_eor*(), im_shift*(),\n  im_pow*(), im_exp*(), im_ifthenelse(), im_blend(), im_c2amph(), im_c2rect(),\n  im_bandmean(), im_c2real(), im_c2imag(), im_ri2c(), im_jpeg*2vips(), \n  im_vips2jpeg*(), im_tiff2vips(), im_vips2tiff(), im_exr2vips(),\n  im_fits2vips(), im_vips2fits(), im_analyze2vips(), im_raw2vips(),\n  im_vips2raw(), im_magick2vips(), im_png2vips(), im_png2*(), im_ppm2vips(),\n  im_vips2ppm(), im_mat2vips(), im_rad2vips(), im_vips2rad()\n  redone as classes\n- added argument priorites to help control arg ordering\n- generate has a 'stop' param to signal successful early termination\n- added optional output args, eg. x/y for min\n- CLI supports optional output args\n- in im_vips2tiff, enable YCbCr compression for jpeg write\n- VipsMin stops search early if it can\n- C API supports optional output args\n- switch back to int-valued operations\n- add the operation cache, various --vips-cache-* flags\n- fallback vips_init()\n- vips_tracked_malloc() tracks allocation size and can report total mem usage\n- cache limits, drop, init, flush plus command-line controls\n- remove dmalloc support, was never used and valgrind is better\n- im_csv2vips() allows quoted strings, including escaped quotes\n- added vips_shutdown()\n- added --vips-leak flag\n- more VipsImage props\n- added vips_image_write(), old one becomes vips_image_write_to_file()\n- added vips_region_paint_pel()\n- added VipsArea as a public struct\n- added array members and arguments\n- added nary\n- remove VipsPool, vips_object_local_array() is much better\n- cache.c now drops if you have too many open files\n- CLI args to change max files\n- new format for handling exif tags \n- switch SMALLTILE to 128, 512 was just too big\n- oop mode \"rd\" was not always being used for images\n- added ARRAY interpretation for images\n- VipsStats tracks minpos/maxpos as well\n- moved mask/ to deprecated\n- use atexit() to call vips_shutdown()\n- set _O_TEMPORARY on delete-on-close temp images if possible\n- unlink temps on rewind on *nix, less likely to leave temps on a crash\n- added complex conj as a basic operation\n- rect/polar/conj work on any format, not just complex\n- new VipsFile system for load/save in image formats\n- options now introspectable, try \"vips jpegsave\"\n- copy swap uses glib byteswap macros, about 2x faster\n- edvips can change vips header byte ordering\n- \"header\" is terse by default\n- \"header\" outputs filenames if working on many files\n- added openslide support (Benjamin Gilbert)\n- allow new-style load/save options in filenames to \n  vips_image_new_from_file() etc.\n- VipsFormat is deprecated\n- remove outchecks from documented API\n- support gobject-introspection \n- new Python binding based on gobject-introspection\n- only spot options at the end of arg strings\n- add vips_cache() as a vips8 operator\n- remove the old fft fallback\n- remove fftw2 support\n- much faster im_draw_smudge()\n\n14/1/12 started 7.26.8\n- interpolate CLI args were broken (thanks speckins)\n\n5/12/11 started 7.26.7\n- lazy read from tiled tiff from layers other than 0 was broken\n- optional args to vips_call*() do not work, disabled (fixed correctly in\n  master)\n- address calculations in files over 4gb were broken on 32-bit platforms\n  (broken since March 2011, oops)\n\n12/10/11 started 7.26.6\n- NOCACHE was not being set correctly on OS X causing performance \n  problems with large files\n- update Orientation exif tag on jpeg write\n\n12/10/11 started 7.26.5\n- jpeg read/write copies over XMP data\n- handle offset correctly in separable convolutions (thanks Nicolas)\n- macros for class arg boilerplate\n- class arg order set by new 'priority' param\n- VipsExtend, VipsDirection enums added\n\n12/9/11 started 7.26.4\n- fallback vips_init() \n- im_openout() compat stub was wrong, breaking ruby-vips\n- vips_class_map_concrete_all() needed a compat macro too\n- vips_class_map_all() was broken\n\n10/8/11 started 7.26.3\n- don't use G_VALUE_COLLECT_INIT(), many platforms do not have a glib this\n  recent\n- don't leave image->kill set when we detect termination\n- test for a working C++ compiler, disable C++ parts of none found\n\n10/8/11 started 7.26.2\n- oops, im_benchmark.c had some stuff turned off\n- configure option --without-cfitsio was broken (thanks Mike)\n\n26/7/11 started 7.26.1\n- doc fixups\n- oops, ==0 missing from a strcmp() in vips7compat\n- fixed a race in im_XYZ2Lab() table build\n- added im_concurrency_get() to operation db\n- better benchmarkn.sh runs for the correct number of CPUs automatically, runs\n  three times for each one, and just reports the fastest\n\n26/7/11 started 7.26.0\n- version bunp for 7.26\n- various fixes to get win32 and OS X building\n\n6/12/10 started 7.25.0\n- attach the jpeg thumbnail and multiscan fields (thanks Mike)\n- faster tiff read for some common cases\n- faster im_tile_cache()\n- if we use C++ in libvips, add -lstdc++ to vips-7.xx.pc \n- im_vips2png() / im_png2vips() set / get png resolution (thanks Zhiyu Wu)\n- updated README\n- don't use tables for bilinear on float data for a small speedup (thanks\n  Nicolas Robidoux)\n- no tables for uchar either, about a 15% speedup (thanks Nicolas)\n- dmask write was broken\n- lr/tbmerge() cast images to match, like im_insert()\n- lr/tbmosaic() work for any mix of image formats / bands\n- removed ancient balance stuff from im_lr/tbmosaic()\n- gtk-doc for mosaicing\n- add im_fits2vips() to the operation database\n- im_fits2vips() is lazy and much faster\n- im__file_open_write() / _read() has a flag for text_mode, get rid of all the \n  remaining fopen()s\n- move cooc_* and glds_* to deprecated\n- move im_dif_std() to almostdeprecated\n- move im_simcontr() to almostdeprecated\n- add im_sines() to operation db\n- move im_spatres() to almostdeprecated\n- done gtk-doc for other\n- --vips-progress tells you about nthreads, tile size, nlines\n- gtk-doc for interpolate\n- move im_stretch3() to deprecated\n- move im_clamp() to deprecated\n- gtk-doc for video ... all operators done! amazing argh\n- set MAP_NOCACHE on OS X, otherwise performance dives off a cliff with \n  files larger than memory\n- removed man pages, we are all gtk-doc now\n- im_jpeg2vips() ignores weird APP1 chunks\n- im_add() for int/uint was broken\n- im_ri2c() was broken\n- added VIPS_FORMAT_BIGENDIAN format flag\n- moved IMAGE and REGION to VipsImage and VipsRegion, classes over VipsObject\n- Rect -> VipsRect\n- libpng-1.5 supported\n- better png read for 1-bit and palette images\n- fits write\n- better fits metadata support\n- renamed all header fields, old names still supported, hopefully\n- all of iofuncs moved to vips_ namespace\n- lots of old iofuncs API moved to deprecated\n- added VipsOperation, an abstract base class for all vips operations\n- added VipsAdd, the first operation object\n- im_tiff2vips() int/uint mixup for rows_per_strip, thanks Bubba\n- removed the links feature, won't work with vips8\n- got rid of the tools/ subdirs\n- added im_bufjpeg2vips()\n- tiff reader can do 1, 2, 4, 8 bit palette images\n- tiff palette read can do mono images\n- im_bufjpeg2vips() has a \"header_only\" parameter\n- added vips_image_get_data()\n- updated German translation (thanks Chris)\n- fixed typo in im_conv() overflow estimation which could cause errors\n- vips.c has new action syntax, knows about vips8 operations\n- add now has sizealike\n- vips7 binops all do sizealike too, also gbandjoin and ifthenelse\n- new API is now functional\n- vips.c generates GOption flags for vips8 operations\n- added im_gauss_dmask_sep()\n- laplacian generator lost -ve lobes for large sigma\n- added im_aconv(), approximate convolution\n- bumped smalltile to 512x512 for testing\n- added VipsPool, got rid of floating refs again, argh\n- VIPS_EXEEXT is now part of the exported API\n- im_blend() also does sizealike, oops\n- jpeg write was not inverting CMYK, thanks Ole\n- im_falsecolour() converts to mono 8-bit for you\n- im_icc_import*/export*() cast inputs for you\n- im_vips2tiff() uses im__temp_name() for intermediates\n- added vips_wrap7 ... wrap up vips7 operations as vips8 classes\n- man pages are back for commands\n\n30/11/10 started 7.24.0\n- bump for new stable\n- added im_dmask2imask(), im_imask2dmask()\n- im_rotate_*mask90() can do masks of any size (thanks Adam Turcotte)\n\n18/7/10 started 7.23.0\n- im_vips2bufjpeg() writes to a linked list, so it will work for any size\n  image and header\n- added im_vips2bufpng()\n- use GetTempPath() to pick a temp dir on Windows\n- added \"rd\" mode to im_open()\n- vipsthumbnail and vips use \"rd\"\n- im_divide spots /0\n- remove liboil dependency, we will use Orc instead\n- various small cleanups (thanks Tim)\n- add lcms2 support\n- VImage(filename) defaults to \"rd\" mode\n- revise window_offset / window_size, again\n- fix a mixup with ANY hints that caused performance problems on the main\n  benchmark\n- rewritten im_circle as im_draw_circle, im_circle moved to almostdeprecated\n- added IM_TYPE_RW args for inplace ops --- nip2 uses this to wrap inplace ops\n  automatically\n- special-case 3x3 masks in im_conv() for a 20% speedup\n- add IM_TYPE_RW flag for im__rw_image, helps nip2 auto-wrap inplace ops\n- im_insertplace() casts and bandalikes\n- copy iconv.m4 and friends in bootstrap, thanks Mike\n- moved the stupid _copy() versions of the inplace ops to deprecated, since\n  nip2 can call inplace ops directly now\n- added im_draw_rect(), moved im_paintrect() to deprecated\n- added im_draw_image(), moved im_insertplace() to deprecated\n- added im_draw_line(), now clips, moved im_fastline() to deprecated\n- added im_draw_line_user(), now clips, moved im_fastlineuser() to deprecated\n- added im_draw_mask(), now wrappable, moved im_plotmask() to deprecated\n- added im_draw_point(), moved im_plotpoint() to deprecated\n- added im_read_point(), now partial, moved im_readpoint() to deprecated\n- added im_draw_smudge(), moved im_smudge() / im_smear() to deprecated\n- convolution functions support complex images\n- im_blend() can have any format condition image and it's converted to uchar\n- security fix for vips-7.23 wrapper script (thanks Jay)\n- im_affine() has a larger safety margin\n- fix gtk-doc warnings\n- small mask load/save improvements\n- mask gtk-doc done\n- add cfitsio dependency\n- add FITS reader\n- land the vector branch and the orc dependency ... we have SSE\n  erode/dilate/add/conv\n- add IM_SWAP\n- dilate/erode do (!=0) on non-uchar images\n- add multipass Orc to im_conv(), 3.5x faster for 5x5 mask\n- im_profile() works for any image format, any number of bands\n- im_rank_image() works for mix of formats, bands\n- morph gtk-doc done\n- oops, missing braces in debug.h and util.h, thanks Laurence\n- update C++/Python binding\n- oop, bool constants are always (int) now, so (^-1) works for unsigned types,\n  thanks Nicolas Robidoux\n- much lower memuse for im_cache() in complex pipelines\n- im_scale_dmask() normalises to 20, not 100 ... we hit the fast\n  conv path more often\n\n12/5/10 started 7.22.2\n- the conditional image of ifthenelse can be any format, a (!=0) is added if\n  necessary\n- oops vipsthumbnail sharpening was turning off for integer shrinks,\n  thanks Nicolas Robidoux\n- im_vips2jpeg() could fail for very small images (thanks Tim)\n- threadpool wasn't stopping on allocate errors (thanks Tim)\n- vips_sink_disc() could block if allocate failed (thanks Tim)\n\n12/5/10 started 7.22.1\n- fix a problem with tiff pyramid write and >1cpu, thanks Ruven\n- constant ops clip to target range\n- oops, moreconst and moreeqconst were the same\n- better buffer handling in sinkdisc for single-line images\n- less chatty errors from \"vips\"\n- oops, don't rename \"copy_set\" as \"copy_\", thanks Ole\n\n12/5/10 started 7.22.0\n- bump and rename\n- vipsthumbnail has a manualpage and sharpens correctly\n- more interpolator work\n- fixes to --disable-cxx mode (thanks Mike)\n- added German translation, thanks Chris Leick\n- fixed typos in some messages, thanks Chris Leick\n- fix gettext startup\n- all \"colour\" in messages changed to \"color\", have a proper en_GB\n  translation file\n- vipsthumbnail delete profile failed if there was a profile\n- interpolate cli unref was broken\n- more accurate, slightly faster bilinear and bicubic (thanks Nicolas Robidoux)\n\n21/3/10 started 7.21.3\n- added progress feedback to threadpool\n- --vips-wbuffer2 switch does all wbuffer use now\n- im_wbuffer2() renamed as vips_discsink(), some cleanups\n- im_gammacorrect() can do 16-bit images too\n- im_histplot() could fail for signed int histograms\n- im_fwfft() and im_invfft() could free their output image too early\n- added im_local_imask(), im_local_dmask()\n- added im_mpercent_hist()\n- im_maplut() casts the index image to one of the uint types\n- fixed a couple of /0 problems with scale == 0 masks\n- set G_LOG_DOMAIN to VIPS so we can use g_warning etc.\n- added VIPS_DEBUG_MSG() macro\n- --vips-wbuffer2 turns on threadpool for im_iterate as well\n- im_vips2tiff() uses vips_sink() instead of threadgroup\n- strip out threadgroup\n- add --enable-debug=xxx flag\n- im_iterate() -> vips_sink()\n- better number-of-bands detection for im_magick2vips()\n- added im_get_argv0()\n- added PFM read / write\n\n16/1/10 started 7.21.2\n- \"invalidate\" is careful to keep images alive, so invalidate callbacks can do\n  im_close()\n- flood_blob could loop if start point == ink\n- added im_meta_remove()\n- added remove profile option to vipsthumbnail\n- added vips_bandfmt_iscomplex() and friends, im_iscomplex() and friends\n  deprecated\n- im_bandjoin()/im_gbandjoin() work with images of varying formats\n- added im_copy_native(), deprecated im_copy_from() and friends\n- im_check*() name rationalisation\n- finally removed old flood stuff\n- im_insert*() bandalike and formatalike\n- im_*join() bandalike and formatalike\n- im_ri2c() bandalike\n- im_vips2png() saves 16-bit PNGs, if necessary\n- vipsthumbnail has selectable interpolators, optional sharpen\n- moved a lot of stuff (eg. im_iscomplex()) from deprecated to\n  almostdeprecated to avoid breakage\n- im_csv2vips(): allow lines that end with EOF rather than \\n\n- im_vips2tiff has a bigtiff option\n- oops, im_lineset() needs to ask for WIO of mask and ink\n- move cache invalidation to REGION, fixes a race\n- don't im_invalidate() after paint, it can cause horrible performance\n  problems ... for example, im_plotmask() used as the action operator for\n  im_fastlineuser() is terrible\n- instead, users of the inplace operations need to call im_invalidate() at the\n  end of a set of paint actions to trigger an update\n- parent/child renamed as upstream/downstream in DAG\n- set VIPS_ICC_DIR in configure\n- ICC profiles are looked for in VIPS_ICC_DIR as a fallback\n- im_render() mask image generation no longer triggers image calc\n- threadgroups scale output buffers with number of threads for smalltile ...\n  improves SMP scaling for narrow images on many-way machines\n- default to max number of processors (--vips-concurrency and IM_CONCURRENCY\n  set >0 can override) on linux and win32\n- better nprocs guesser\n- im_render() fixes to help the paintbox, some speedups too\n- added im_wbuffer2(), a new distributed threading system, and --vips-wbuffer2\n  to enable it, thank you Christian\n\n15/1/10 started 7.21.1\n- added \"written\" callbacks, used to implement write to non-vips formats\n\n26/11/09 started 7.21.0\n- branch for new dev cycle\n- argh, missing init from colour.c (thanks Peter)\n- argh, im_measure() was not looping over bands correctly (thanks Peter)\n- removed mmap_limit, we now always use windows ... reduces VM use hugely,\n  because mmap windows are freed when their regions are freed, while images\n  are only unmapped when they are closed\n- have a min bytes for mmap windows as well, so we don't make too many tiny\n  windows\n- im_disp2Lab() was broken\n- deprecated.h is now defined in terms of current functionality, rather than\n  repeating stuff\n- im_flood() and friends rewritten, typically 4x faster\n- removed --with-cimg option, added --disable-cxx\n- added im_system_image() (thanks Roland)\n- added postclose callbacks\n- added vipsthumbnail\n- oops, generate C++/Python wrappers for deprecated operations by default\n- read TIFF images strip-wise, not scanline-wise\n- better TIFF YCbCr reading (thanks Ole)\n- isanalyze generates fewer silly error messages\n\n26/11/09 started 7.20.3\n- updated en_GB.po translation\n- file_length is gint64 to avoid win32 breakage\n\n23/11/09 started 7.20.2\n- GETTEXT_PACKAGE now includes lib version number (thanks Jay)\n\n11/11/09 started 7.20.1\n- oop, im_clip2fmt() was missing PTOP flag, should get a small speedup\n- im_conv() / im_convf() didn't like all-zero masks\n- small updates to im_convf() from im_conv()\n- im_read_imask() produced an incorrect error message if passed a doublemask\n- rename im_convf(), im_convsepf() as _f()\n- vips.c drops _f suffix when overloading\n- regenerate C++ binding, don't make deprecated package\n\n9/11/09 started 7.20.0\n- removed vips-7.x.spec.in, shouldn't really have this in SVN\n- bumped version to 7.20\n- fixes to get \"make dist\" working again\n\n3/4/09 started 7.19.0\n- version bump\n- tiny conv speedup\n- catch lcms error messages\n- fix includes for gtk+-3.0\n- report virtual memory too in im__print_all()\n- cosmetic changes to nohalo\n- im_magick2vips() needs to invert alpha\n- now (more or less) passes -Wextra\n- added \"fail\" option to im_jpeg2vips: fail with an error on any warning\n  (thank you Ole)\n- started gtk-doc changes\n- renamed im_meta_get_type() and im_header_get_type() as\n  im_meta_get_typeof() and im_header_get_typeof() to prevent confusion with\n  GObject type definers (was breaking gtkdoc object scan)\n- revised more names, limited documented API\n- im_buildlut() could segv for non-zero based tables (thanks Jack)\n- VIPS_BUF_STATIC() does not take length arg\n- check for SetImageOption() so we work with GraphicsMagick too\n- \"header\" sets a non-zero exit code if anything failed\n- add and use im_check_uncoded() and friends\n- matlab load handles column-major and plane-separated images (thanks Mikhail)\n- JPEG save allows \"none\" for profile, meaning don't attach a profile\n- saner, simpler, faster typecasting for im_add(), im_subtract(),\n  im_multiply(), im_divide(), im_remainder()\n- im_remainder() has a float result for float types\n- im_measure() allows sel == NULL, meaning all patches\n- added \"deprecated\" package\n- faster, simpler, better im_max(), im_min, im_avg(), im_deviate()\n- im_max() returns true modulus, not square of modulus, for complex images\n- im_avg() works for complex, returning average modulus\n- im_system() fix (thanks Roland)\n- im_system() rewrite\n- im_maxpos()/im_minpos() are partial and work for complex\n- im_max()/im_min() are now convenience functions\n- im_maxpos_avg() handles complex and multi-band images\n- added im_point(), rewrite im_point_bilinear() in terms of this\n- close callbacks now happen *after* images have closed resources (such as\n  open files) ... this lets them delete temps and stuff. Expect breakage :(\n- added vips_interpolate_get_window_offset()\n- boolean revised: smaller, more general, faster\n- im_remainderconst_vec() renamed to im_remainder_vec() for consistency\n- added im_shift*_vec()\n- renamed im_eor_vec() as im_eorimage_vec() for consistency, also and, or\n- renamed im_eorconst() as im_eorimage_const() for consistency, also and, or\n- relational revised: smaller, more general, faster\n- im_blend()/im_ifthenelse() allows many-band conditional, 1-band then/else\n- im_blend()/im_ifthenelse() allows band and format to differ between then\n  and else parts\n- better im_check() functions\n- added im_flood_other() as start of simple segmentation operator\n- added im_label_regions()\n- im_printlines(), im_debugim() deprecated (use im_vips2csv() instead)\n- meta, header, callback, error, region, check, generate, memory gtkdocs\n- removed printlines tool, vips2csv is much better\n- removed other useless tools as well: debugim, binfile\n- fix up addr calcs on 64-bit machines with >2gb images and inplace ops\n  (thanks Christoph)\n- im_generate() checks that im_demand_hint() has been called for this image\n- im_jpeg2vips.c, set scale_num on shrink (thanks Guido)\n- heh argh reading history always stopped after the first line (thanks Haida)\n- added im_histindexed\n- new im_iterate() calls start and stop functions from workers so resources\n  they make are owned by the worker thread ... this makes it possible to have\n  start functions which create mutiple regions and therefore allows\n  im_iterate() to scan more than one image at once\n- threadgroup no longer has any default action, you must attach a work\n  function\n- added im_copy_file()\n- added im_insertset()\n- im_insertplace() allows small to be outside big\n- added im__colour_difference(), colour ops now work on any image format\n- added im_col_display_get_table(), so display tables are now shared by name\n- added im__colour_unary()\n- drop \"set\" postfix from names, so \"insert\" can now take a vector of positions\n- deprecate all the \"_raw\" variants, not really necessary now\n- removed \"contrib\", not very useful anymore\n- added im_header_as_string()\n- im_malloc()/im_free() now call g_try_malloc()/g_free() ... removes confusion\n  over whether to use im_free() or g_free() for things like im_header_string()\n- added im_history_get(), im_getexp(), im_printdesc() as wrapped functions ...\n  so you no longer need the \"header\" program\n- image vectors from Python work, woo\n\n25/3/09 started 7.18.0\n- revised version numbers\n- updated vipsmanual\n- revised manpages\n- removed name and \"changed\" from vipsobject since we don't use them yet\n- explicitly link with stdc++ for nohalo etc. stuff\n- wrap im_gauss_imask_sep in C++/Python\n\n6/3/09 started 7.17.3\n- revised nohalo\n- remove fading stuff from im_render() -- cleaner and simpler\n- configure spots support for \"restrict\"\n- reset dcm:display-range on magick read to help DICOM\n- saner im_buildlut() behaviour\n- added im_gauss_imask_sep()\n- allow open and view of truncated images (thanks Joe & Rachel)\n- revising rounding on im_affine*() coordinate transforms to make them more\n  stable\n- added Radiance write\n- added im_float2rad()\n- added IM_CODING_RAD, support where it makes sense (extract, flip, rotate,\n  etc.)\n- IM_PROGRESS env var\n- docs for rad2float and IM_CODING_RAD\n\n3/3/09 started 7.17.2\n- im_magick2vips.c: allow funky bit depths, like 14 (thanks Mikkel)\n- isradiance was returning TRUE too often\n- radiance loader now loads packed RGBE/XYZE instead of unpacking to float\n- added im_rad2float()\n\n11/10/08 started 7.17.0\n- merge vips-7.16 brach back into trunk\n- bumped version number to 7.17.0\n- re-added type.[hc]\n- added vipsinterpolate and im_affinei\n- added yafrsmooth interpolation\n- added yafrtest\n- added yafrnohalo\n- ubuntu 8.10 changes\n- interpolators get an output pointer, not region\n- tuning for bicubic\n- revised transform / clip code, we now do corner not centre\n- yafr-smooth reworked along the lines of bicubic\n- cleanups after yafr hacking\n- added affinei_all\n- don't set im_error() on failed callback\n- moved im_format_t to VipsFormat, now sits over VipsObject\n- IM_FORMAT_FLAG_PARTIAL -> VIPS_FORMAT_PARTIAL\n- updated docs\n- interpolators use type introspection\n- added vips --list classes, does formats too\n- include sys/param.h to get PATH_MAX in more places\n- added vips_format_get_flags()\n- oop, forgot to check for cancel during tiled tiff write\n- don't use mmap for tiff read: no performance advantage, chews up VM\n- VIPS_INTERPOLATE_SHIFT bumped to 12, we need the extra precision for u16 gel\n  data\n- added string->double transform for cmdline args\n- merged class-params branch back into trunk\n- IM_FREE() can do \"const char*\" variables\n- im_buf_t renamed as VipsBuf\n- added vips_object_to_string()\n- added \"nickname\" and \"description\" properties to VipsObject\n- shift/and/or/eor ops were broken for non-int types\n- added nohalo interpolator\n- updated format docs\n- IM_INPUT_INTERPOLATE() now used by affinei and affinei_all\n- added vips_object_new\n- resamplers/interpolators now in a resample package\n- removed yafrnohalo.c\n- added matio as a dependency\n- added Matlab save file read\n- added Radiance file read\n- better file-not-found messages\n\n11/9/08 started 7.16.3\n- oop typo in manpage for im_project()\n- doc fixes\n- returning non-zero from eval callbacks was not always stopping computation\n\n11/9/08 started 7.16.2\n- added --without-v4l option\n- added -no-undefined to libsrcCC build, so we get a libvipsCC.dll\n- removed the swig dependency: we include the generated bindings in the\n  distribution tarball\n\n6/9/08 started 7.16.1\n- trigger eval callbacks on tiled tiff write\n- added vips as an im_format_t\n- added im_format_write()/_read() convenience functions\n- more cleanups for the format API, argh\n- removed win32/ directory now mingw finally makes DLLs correctly\n- removed the windowed spcor for now, it has some edge effects\n\n24/8/08 branch for 7.16\n- renames and version numbers\n- load plgs from libdir as well as libdir/vips-x.x for compat\n- complex -> complex conversion was broken\n- refstring <-> gstring transforms\n- better behaviour with Magick non-presence\n- added --enable-links switch to configure ... we no longer make the bin/im_*\n  links by default\n- started a 'format' section in the docs\n- configure fails if no gettext found\n- revised po/\n- released as 7.16.0!\n\n25/5/08 fork for loadable image format branch\n- image load/save in non-vips format code moved to own dir\n- simple format searching added\n- some cleanups for vips load\n- im_open() simplified\n- add im_format_flags\n- only consider formats with a save method in im_format_for_name()\n- oops, format sort order was reversed\n- im_filename_suffix() includes \".\" in suffix\n- merge back into trunk for 7.15.1\n- remove im_ispng(), im_png2vips_header() etc. & friends\n- add \"vips --list formats\"\n- rename VBuf as im_buf_t for consistency\n- add type.[hc], start of new type system\n- removed man pages for IM_MIN, MAX and RINT to avoid case confusion on\n  OS X / win\n\n7/3/08 started 7.15.0\n- MAGIC constants should be tagged as unsigned\n- write MAGIC correctly on sparc/powerpc machines (thanks Joe)\n- oop, we were still making fade threads even when not fading\n- tiny cond jump fixes for valgrind in colour.c\n- remove -lstdc++ from libs, except on windows\n- push Magick cflags earlier in the include order to make it easier to pick\n  GraphicsMagick over ImageMagick (thanks Mikhail)\n- fix the en_GB translation\n- use meta to preserve resunit between tiff load and save\n- small doc improvements\n- read and write CMYKA tiff (thanks Doron)\n- performance improvements for morphology ops, esp. when zooming out\n- oop, im_render() was broken for mask == NULL\n- better support for multiple Python installs (thanks Jay)\n- better IM_SETSTR() stops some warnings\n- im_histcum() works for signed histograms\n- better rounding for im_conv(), im_convsep()\n- tiny speedup for im_conv()\n- better /0 test for remainderconst\n- revise i18n configure, get rid of intltool\n- command-line IMAGVEC input could segv with non-vips image output\n- added .tobuffer()/.frombuffer(), .tostring()/.fromstring() to Python binding\n- add PIL_mode_from_vips () and vips_from_PIL_mode () utility functions\n- update docs for new Python stuff\n- FIND_ macros no longer search for stuff, you have to specify prefixes if the\n  packages are not on the default path (or in $prefix). This avoids some\n  accidents on some platforms\n- configure prints a summary of optional packages found at the end\n- im_lhisteq() checks for window too small\n- added invalidate callbacks\n- now tests for MagickWand before ImageMagick (thanks Adam Turcotte)\n- added \"-rotate\" option to vips2dj\n- added man page for im_resize_linear\n- better jpeg-in-tiff YCbCr read (thanks Ole)\n- oops, invalidatefns were not being freed on im__close()\n- VMask() can init from std::vector, so Python can init from []\n- added IM_LIBDIR, im_guess_libdir()\n- load plugins from libdir/vips-x.x on startup\n- added meta get/set int/double/string/area/blob/GValue to C++ API\n- include time_t in vips.h, thanks Nicolas Robidoux\n- lock global image list (thanks lee)\n\n25/1/08 started 7.14.0\n- bump all version numbers for new stable\n- better CMYK JPEG read (thanks Ole)\n- add __str__ to VError in Python (thanks Ole)\n- revert the dynamic wrapping for Python :-( next version!\n- added VImage::convert2disc (thanks Ole)\n- you can now set the jpeg quality factor for tiff pyramids (thanks Joe)\n- you can now shrink jpegs during read, see \"man im_jpeg2vips\"\n- added CMYK JPEG write\n- optionally use GraphicsMagick (thanks Bob Friesenhahn)\n- look for MAGICKCORE_HDRI_SUPPORT (thanks Marcel)\n- set icc profiles in tiff pyramids explicitly (thanks Joe)\n- add --without-cimg configure option\n- add im_maxpos_subpel\n- make im_abs compile without liboil\n- add im_align_bands\n- fix type overflow in complex division\n- fix im_cross_phase and im_addgnoise (Tom)\n- updated docs, C++ and python\n- header no longer stops on error\n- C++ dummy2.cpp helps OS X linking\n\n12/12/07 started 7.13.3\n- added \"include <cstring>\" to VImage.cc to help gcc 4.3\n- started moving the python binding to dynamic wrapping\n- added im_wrap(), im_wraptwo(), im_phasecor_fft(), im_cross_phase() (Tom)\n- memleak plugged in im_save_string_setf()\n- bugfix in and docs for im_gradcor() (Tom)\n- use Glib macros to make im_msb work on big-endian platforms (Tom)\n- use Glib macros to get rid of needless compile warnings (Tom)\n- fix type overflow in im_c2ps/im_abs (Tom)\n\n31/10/07 started 7.13.2\n- build cimg on windows fixes\n- various include cleanups, updated man pages\n- break im_wbuffer() out to a separate API\n- use im_wbuffer() to make im_vips2jpeg() compress in the background\n- also im_vips2png(), im_vips2tiff(), im_vips2ppm()\n- revised evaluation progress system\n- new evalstart/evalend/preclose callbacks fix over/underflow reporting\n- but the meaning of evalend has changed in a non-backwards-compatible way :(\n  use preclose instead ito get the old behaviour\n- added \"--vips-progress\" flag to turn on a simple eval progress tracker\n- make im_spcor[12] static, im_spcor is wrapper (Tom)\n\n28/9/07 started 7.13.1\n- vips2dj can print RGB images\n- oop, include <stdexcept> missing\n- add protos for generate/iterate function args, fix warnings\n- add cimg package, we now have C++ source inside VIPS, sigh\n- added OUTPUT_DOUBLEVEC and OUTPUT_INTVEC, use for im_maxpos_vec() and friends\n\n29/8/07 started 7.13.0\n- we now have a trunk and the version is 7.13.x, woo!\n- move manpages into a separate man/ dir ... speeds up builds a lot on windows\n- don't install malkovich\n- don't fail on unknown args for python (thanks Simon)\n\n1/8/07 started 7.12.5\n- im_embed() is more general ... x and y can be negative\n- predicate.c is smaller and cleaner\n- libsrcCC link improvement from Pablo\n- support 32/64-bit ImageMagick as well (thanks Marcel)\n- better im_magick2vips() for Q8 ImageMagick\n- split repository to trunk/branches ready for a stable 7.12.x branch\n\n27/7/07 started 7.12.4\n- proto.h had vars called small, breaking on win32\n- more python fixing, we now have working matricies too\n\n17/7/07 started 7.12.3\n- fix to VImage.i for gcc 4.2 (thanks Damir)\n- eek, off by 1 for more than 1 band hists\n- needed a slightly larger worst-case buffer in im__b64_encode()\n- tiny cleanup for make_hI() prevents cond jump on ui in valgrind\n- --disable-threads was broken again\n- remove .svn dirs from dist\n- now passes distcheck again\n\n17/7/07 started 7.12.2\n- added im_bandmean()\n- added support for TIFFTAG_PREDICTOR (Andrey Kiselev)\n- fix TIFFOpen() mode snafu (Andrey Kiselev)\n\n11/5/07 started 7.12.1\n- memory.c abort()s with DEBUG\n- oops, im_bits_of_fmt() manpage was not being installed\n- im_histcum() can do all image types\n- updated NEWS\n- added im_csv2vips_header()\n- command-line csv read was broken (thanks Tom)\n- removed length limit on argument vectors (Tom)\n- added IM_PREFIX, configure-time install prefix\n- oop, turned off memory.c DEBUG\n- fix some bogus gcc 4.1 warnings with im_open_local_array()\n- better vips usage message\n- oops, IM_ANY missing from im_demand_hint() manpage (thanks Shahid)\n- just warn if plugins fail to load in im_init_world()\n- expose Vargv and make refblock public rather than private so that\n  subclasses of VImage can add vips-style member operations (thanks Pablo)\n- oops, im_initdesc() needed to have bbits set correctly (thanks Shahid)\n- make VError derive from std::exception more officially\n- woo, got exceptions working in SWIG\n- soname version bumped to 12.x.x\n- oops, added vector ops to Python\n- check for overflow of int in return of strtol in dispatch system (Tom)\n- add im_[di]mask_[xy]size to dispatch system (Tom)\n- add im_gradcor(), im_grad_[xy] (Tom)\n\n26/3/07 started 7.11.21\n- ooo, added %include \"std_except.i\" & friends to VError.i, VImage.i\n- im_init_world() is more lenient about recursive invocation\n- im_gbandjoin() falls back to im_copy() for 1 input image\n- race condition fixed in im_render.c (thanks Simon)\n- bump for 7.12!!!\n\n26/1/07 started 7.11.20\n- another fix to im_region_image() (thanks Mikkel)\n- tiny speed up to im_rect_includesrect()\n- avoid recursive invocation in im_init_world() (thanks Christian)\n- fix to extract_prefix (thanks Christian)\n- buffer cache is now per thread\n- combine buffer unref and ref in a single operation to reduce malloc/free\n  cycles\n- new internal API for passing regions between threads means we can remove\n  buffer locks\n- more buffer/region sanity checks, plus a memory barrier\n- lock around error buffer changes\n- im_vips2mask() was wrong for nx1 m-band images\n- liboil back to \"test\"\n- add buffer_cache_list to avoid GHashTable _insert()s\n- oop, --vips-concurrency was broken\n- renamed (in dispatch layer) im_and/or/eor_const -> im_and/or/eorimageconst\n  for consistency\n- C++ API wraps IMAGEVEC, DOUBLEVEC, INTVEC arguments\n- oop, IMAGE % vector<double> was broken\n\n21/12/06 started 7.11.19\n- added im_linreg() (Tom)\n- various C++ API polishes, plus a bugfix (Dennis Lubert)\n- vips.spec split to devel and python too (Dennis Lubert)\n- be more explicit about sizeof(magic)\n- init magic to native order by default (thanks Dennis)\n- Hist becomes im_history_get()\n- new history mechanism is faster, uses much less memory, and removes\n  duplicate lines\n- added im_get_option_group()\n- added official im_concurrency_set()/_get()()\n- don't read bbits from vips files ... set ourselves from bandfmt\n- oops add RGB16 and GREY16 to C++ header\n- --list packages option to vips.c\n- updated docs to 7.12\n- oops, im_region_image() snafu was causing a lot of recomputation\n- make im_mpercent() suck a little less\n- EXIF save was a bit bOrked ... cause of mac crashes?\n- im_histgr(), im_heq(), im_hist() all number bands from zero now\n- fix stride in liboil calls\n- set RGB16 on 16-bit RGB ICC export\n\n29/11/06 started 7.11.18\n- added im_buffer_t so regions can share calculated pixels: 2-3x speedup on\n  the benchmark\n- im_region_local() -> im_region_buffer()\n- im_sharpen() order change to help sharing\n- im_invalidate() clears buffer caches\n- add sentinel attributes\n- add some missing im_demand_hint()s\n- paint ops invalidate the output image\n- fix nothread eval\n- raise threads limit to 1024 (thanks Christian)\n- manual redone\n- vipsCC python init() hooks\n- add liboil dependency\n- use liboil for im_abs(), im_add(), im_divide(), im_floor(), im_multiply(),\n  im_subtract(), im_lintra(), im_avg(),im_deviate()\n- quiet libtoolize test (thanks Tom)\n- im_benchmarkn now regrows image each time\n- strip meta from sample2.v ... saves a lot of mem (esp. Hist)\n- added im_isscalar() (Tom)\n- added IM_REGION_ADDR_TOPLEFT() (Tom)\n- reduce size of im_rightshift_size.c to help compile (Tom)\n- make im_stop_many(NULL) safe (Tom)\n\n24/11/06 started 7.11.17\n1;5Q\n- better benchmark script makes graphing easier\n- double-buffer image file writes\n- reuse write threads\n- clean up threadgroup / iterate / generate\n- added im_benchmarkn to make it easier to make a CPU-bound op on large\n  machines\n- im_cache() failed for cpus > 1\n\n1/11/06 started 7.11.16\n- moved im__convert_saveable() into im_copy() (thanks Christian)\n- missing gobject dependency (thanks Christian)\n- --enable-threads was broken (thanks Christian)\n- eval without theads was broken (thanks Christian)\n- LIBADD libvips.la to libvipsCC.la (thanks Simon)\n- benchmark.sh is now plain sh, not bash\n- set ORIENTATION_TOPLEFT in im_vips2tiff (thanks Josef)\n- oops, im_vips2csv() output separator was broken\n- added im_benchmark2\n- move XYZ2Lab LUT build outside the eval thread\n\n30/10/06 started 7.11.15\n- print leaked windows\n- oops, race condition in im_window_unref()\n- integrated im_region_window() into im_region_image(), tiny speed up\n\n6/10/06 started 7.11.14\n- ifthenelse and affine dhints revised\n- buildlut no longer outputs x cods\n- configure asks for glib >= 2.6 (we need GOption)\n- configure uses AC_TOOL_CHECK to find tool names to help cross-compiling.\n- better configure test for libexif\n- add </libexif/ prefix if required\n- test for glibtoolize during bootstrap to help OS X\n- add --version to vips main prog\n- don't set Type in im_scale, want to be able to scale hists, for example\n- im_vips2mask() allows multiband hists as well\n- im_vips2csv() lets you specify an output separator\n- vips.c cleanups in arg handling\n- removed python binding to C layer, too hard to get it working right\n- leak test python test program\n- added throw() decls to C++ to help SWIG\n- no longer derive VError from std::exception, can't get it to work with SWIG\n- added mmap window manager to share windows between regions ... big reduction\n  in VM use for large workspaces and for SMP\n- add im_spcor2 (with sliding window) (Tom)\n\n15/9/06 started 7.11.12\n- python vips wrapper hooks into init to start vips\n- oop, python detect was broken again\n- im_file_length() error return was wrong (thanks Christian)\n- im_csv2vips() isnored last column if there was no trailing\n  whitespace/quoting\n- test for NULL filename/mode, common if you forget to check argc\n  (thanks Bruno)\n- im_break_token() returns NULL on trailing whitespace ... helps read_dmask\n  work with trailing whitespace on matrix headers\n- added im_buildlut(3)\n- removed extra im_free() in im_copy() fallback in im_msb()\n- added GValue input/output args\n- various C++ binding improvements (thanks Dennis): namespace support,\n  VError inherits from std::exception, small fixups\n- remove im_msb() warning on fallback to copy for uchar ... not very serious,\n  happens a lot in nip2\n- added <vips/vips> C++ include ... include in a namespace\n- added im_benchmark / SMP benchmark script\n- add im_maxpos_avg() and im_point_bilinear() (Tom)\n- make im_region_free(NULL) safe (Tom)\n- link in manpages for im_contrast_surface (Tom)\n\n8/9/06 started 7.11.11\n- add im_norm_dmask()\n- removed old code for gradient and lindetect\n- internal decls split from proto.h to help SWIG\n- test for python and SWIG during configure\n- added python dir for the binding\n- python binding done!\n- oops, --without-python was broken (thanks Tom)\n- added python/test\n- add im_lu_decomp() im_lu_solve(), rewrite NR type functions in terms of these (Tom)\n\n23/6/06 started 7.11.10\n- still more im_affine() rounding/clipping tweaks\n- ignore \"--\" arguments to vips.c\n- im_init_world() also sets g_*_prgname() and loads plugins\n- add manpage for im_init_world() (oops)\n- error_exit() prints prgname\n- various cygwin fixes\n- fix cache thread assert failure (thanks Joe)\n- \"header\" now uses GOption, slightly different args, will loop over args\n- fixed assert() overenthusiasm in im_prepare()\n- im_csv2vips() now has separate whitespace / separator tables\n- add im_rightshift_size() (Tom)\n- add im_maxpos_vec(), im_minpos_vec() (Tom)\n- add im_norm_dmask() (Tom)\n- make im_free_[di]mask(NULL) safe (Tom)\n\n23/6/06 started 7.11.9\n- back on sourceforge CVS again\n- require openexr 1.2.2 or greater\n- range check xy on im_insert*() for sanity\n- VMask::invertlut decl removed (thanks Jean)\n- added \\\"all\\\" option to vips.c\n\n17/5/06 started 7.11.8\n- debrokened openexr read\n- added im_tile_cache()\n- added tiled read to im_exr2vips()\n- im_tiff2vips() now uses im_tile_cache() rather than its own cache ...\n  faster in some cases, less RAM use in some cases, saves 200+ lines\n- removed 'broken' read option from im_tiff2vips()\n- read/write doubles with g_ascii_strtod() and friends where appropriate\n- add a \"thread\" member to region to help sanity check region ownership\n- saner threadgroup fixes a race problem on gcc 4.0.3 / amd64\n- added im_vips2csv()\n- im_open() now does CSV read/write too\n- oops, broke vips main prog for function name in argv1 case\n\n22/4/06 started 7.11.7\n- split vips_png.c to im_vips2png.c and im_png2vips.c\n- added OpenEXR dependency\n- added im_exr2vips(), im_exr2vips_header()\n- added im_isexr(), im_open() knows about OpenEXR\n- added im_contrast_surface(), im_contrast_surface_raw() (Tom)\n- added im_msb(), im_msb_band() (Tom)\n- im_scale() sets Type on output\n- added RGB16, GREY16 types\n- im_*2vips() set these types if appropriate\n- configure fixes for mac\n- vips main prog uses GOption\n- im_icc_* locks around calls to cmsDoTransform() to avoid corruption on SMP\n  machines\n- add im_prepare_many() (Tom)\n\n10/3/06 started 7.11.6\n- typo in manpage and header for im_rect_dup() (Tom)\n- don't abort image load if XML read fails\n- added im_video_test() ... test video source\n- oops, lcms .pc finder was not working\n- clipping problem in im_affine() fixed (thanks Clare)\n- test for attr support in libmagick\n- im_text() returns an error for empty string\n- im_falsecolour() scale reversed\n- im_remosaic() could crash on bad mosaics\n- configure changes to fix --without-magick, lcms and fftw (but sadly we now\n  require .pc files for these libs)\n- im_vips2jpeg() automatically converts to 1 or 3 band sRGB uchar for write\n- also im_vips2png()\n- added im_project()\n\n20/2/06 started 7.11.5\n- added im_csv2vips()\n- commas in filename options can be escaped with a '\\'\n- raise tile buffer limit (thanks Ruven)\n- im_spcor() and im_fastcor() have prettier borders\n- im_fastcor() returns sum of squares of differences, not sum of abs of\n  differences\n\n18/11/05 started 7.11.4\n- small win32 fixes, thanks Juan\n- added im_flood_blob_copy() ... a temporary hack\n- much faster im_histplot()\n- read RGBA palette-ized PNG images more robustly (thanks Tom)\n- turn on -ms-bitfields automatically for mingw\n\n26/9/05 started 7.11.3\n- better error recovery for im_binfile() file too large\n- all raw files now use mmap windows, so (eg.) ppm and analyze reads can go\n  >2GB\n- remove DISABLE_COMPAT ... you now have to define IM_ENABLE_DEPRECATED to get\n  broken #defines\n- fix to build without exif, thanks Chas\n- use native win32 API for seek()/truncate() to work with large files\n- use attribute to check printf-style args with gcc\n- fix gcc4 warnings\n- removed ebuild, since it's in gentoo now\n- im_magick2vips() sets meta from attributes (good for dicom)\n- im_magick2vips() writes many-frame images as tall thin VIPS images\n- im_histcum() was broken for vertical histograms\n- im_histnorm() is neater\n- simpler and faster inner loop for im_conv() and im_convf() avoids gcc4 bug\n- appendc() was reading past the end of the buffer on MSB machines\n\n13/6/05 started 7.11.2\n- im_copy_set() was messed up in 7.11.1\n- put into CVS, phew\n- fixed a rounding bug in im_affine() ... should no longer get black edges on\n  image resize\n- if TIFF open fails in im_open(), try going through libmagick\n- merge requires all bands == 0 for transparency (used to just check 1st\n  band)\n- 16 bit LAB TIFF read/write was wrong\n- new GType for refstring makes it visible from im_header_map()\n- jpeg loader attaches exif data (and human-readable meta fields)\n- jpeg saver writes any exif data\n- meta not wiped by im_*incheck() in a \"w\" image\n- meta keeps traverse order\n- now require glib >= 2.4\n- require libxml-2.0 for meta save and new history mechanism\n- no more .desc files, history saved in XML after pixel data\n- i/s/d meta fields saved there too\n- added base64 encode/decode\n- added blob header write\n- added a save string type: types which define transforms to and from the\n  save format get serialized\n- GValue meta API now exposed, since we can serialise anything\n- jpeg loader loads ICC profiles\n- jpeg saver saves ICC profiles from the VIPS header\n- src/header.c knows about meta system\n- added im_analyze2vips(), im_grid(), im_raw2vips()\n- extract/grid/replicate/zoom were not setting TRANSFORM flag\n- better falsecolour LUT\n- less stupid + more portable read/write of VIPS header\n- better im_updatehist()\n- jpeg load sets vips xres/yres from exif, if possible\n- jpeg save sets exif xres/yres from vips, if possible\n- icc_export and icc_transform  attach profiles and intents to output images\n- added im_icc_import_embedded() to import with an embedded profile\n- split vips_jpeg.c into two, it was getting too big\n- added im_cp_descv(), im_cp_desc_array(), funcs use them\n- removed im_append_Hist() from API\n- fixed meta copy bug\n- better history copy, removed nonsense about 1st line of Hist being special\n- tiff read/write now reads/writes ICC profile from meta\n- edvips rewritten to remove stupidness, and can now set xml\n- header can now print xml extension block\n- IM_ prefix for colour temp names\n\n1/6/05 started 7.11\n- added im_copy_morph()\n- im_region_region() allows Bands and BandFmt to differ, provided\n  sizeof( pel ) is the same ... makes im_copy_morph() work\n- added im_meta*() functions (MW)\n- im_header_*() rewritten for meta\n- added im_header_exists(), im_header_map()\n- use pkg-config to find libpng and ImageMagick\n- added im_lineset()\n- added im_extract_areabands() (JF)\n- added im_copy_from() (JF)\n\n15/4/05 started 7.10.12\n- im_ifthenelse just evals left/right for region all zero/all one\n- also im_blend\n- swap g_setenv() back to plain setenv() so we work with glib 2.2\n\n9/4/05 JC started 7.10.11\n- docs no longer have broken links\n- fixed memleak in im_text()\n\n8/4/05\n- one bit tiff read was sometimes reading a byte too far in each scanline\n\n14/1/05 started 7.10.9\n- im_filename_split() will now usually work for filenames containing ':'\n  characters\n- added im_render_fade() for fancier nip2 image repaint\n- added \"ccittfax4\" as a TIFF compression option\n- fix all 64-bit compiler warnings\n- \",\" allowed as column separator in mask read\n- better at spotting singular matricies\n- small im_render() tidies\n- glib dependency reduced to just 2.0, but untested ... helps people building\n  on older systems who aren't interested in nip2\n- removing leading spaces from IMAGEVEC arguments\n- load non-interlaced PNGs more efficiently\n- 1 point mosaic functions work on more image types\n- better memory allocation debugging info\n- local memory on regions can shrink as well as grow\n- shut down threadgroups on render if no dirty tiles\n- limit number of simultaneous renders\n- higher mmap window threshold\n- allow max == -1 for unlimited render cache\n- 'priority' marks non-suspendable renders\n- im_embed() mode == 4 paints white pels\n- im_tiff2vips() was broken with --disable-threads\n- oops, im_errormsg() compat macros were GCC only\n- larger default tile size and strip height\n- tiff write sets PHOTOMETRIC_CIELAB for vips TYPE_LAB images ... so we can\n  write float LAB as well as float RGB (thanks Ruven)\n- also 16 bit LAB TIFF write\n- im_render() rewritten\n\n20/11/04 started 7.10.8\n- im_sharpen() is ~15% faster\n- more quoting for MAGICK finder\n- im_XYZ2Lab() uses a LUT rather than cbrt(), 5x faster\n- --disable-threads removes gthread dependency completely (thanks Simon)\n- intercept TIFF warnings as well as errors ... stops occasional libMagick\n  exceptions\n- add im_init_world() to im_init() as well to help backwards compat (thanks\n  Simon)\n- im_icc_present() function description was broken, thanks Jay\n- oops, libtool library versioning was wrong, thanks Jay\n- can now make TIFF pyramids of any non-complex image type (was uchar and LAB\n  only), thanks Ruven\n- 1st order mosaic code now works for LABQ too\n- build system changes to make \"make distcheck\" work\n- RPM .spec files fixed up and updated by configure (thanks Simon)\n- tiny cleanups for vdump\n- use g_setenv()/g_getenv()\n- tiny improvements to IM_FREE*()\n- tiny VImage debug print fixes (thanks Jay)\n- swap off_t for gint64 to fix LARGEFILE support on win32\n- computation feedback now uses gint64 for number of pels, so we give feedback\n  correctly on images with >2**31 pels\n- other small fixes for >2**31 pels in an image\n\n10/11/04 started 7.10.7\n- im_histnD() was not checking BandFmt (thanks Kirk)\n- improvements to threading system speed up non-vips output in some cases\n- use cbrt(x) where we can ... 10x faster than pow(x,1.0/3) on win32\n- typeo in im_text() when built without PANGOFT2 (thanks Stefan)\n\n1/11/04 styarted 7.10.6\n- tiny doc fixes\n- scripts now only depend on 'vips' program\n- im_open( \"r\" ) is now lazier ... for non-VIPS formats, we delay read until\n  the first ->generate()\n- so im_open_header() now deprecated since im_open(\"r\") is identical\n- now looks for fftw3 as well as fftw2 ... slightly faster ffts\n\n19/10/04 started 7.10.5\n- fix to light_correct (thanks Jay)\n- edvips knows about xoffset/yoffset\n- better vips enum<->char conversions\n\n4/10/04 started 7.10.4\n- man page fixes (thanks Jay)\n- removed last csh scripts (thanks Jay)\n- scripts default VIPSHOME to $prefix (thanks Jay)\n- doc build system tidies\n- im_rank() edge padding was wrong\n- im_vips2tiff() can now embed ICC profiles\n\n22/9/04 started 7.10.3\n- mildly better im_vips2tiff()\n- *, -, +, /, % between two images now work for mixed number of bands\n- im_free() was missing a man page\n- revised documentation\n\n1/9/04 started 7.10.2\n- C++ .pc files were still set for 7.9, grr\n- im_insertplace() didn't check compatibility of images (thanks Matt)\n\n27/7/04 started 7.10.1\n- set default stack size explicitly to help platforms with a very low default\n- 16 bit RGB tiff read was broken (bug introduced in 7.9.5, thanks Haida)\n- !pangoft2 was broken, thanks Kenneth\n- win32 build fixes\n\n12/7/04 renamed as 7.10.0\n- added NOCACHE function flag ... stops nip memoising video & paint ops\n- added im_extract_bands() ... takes out many bands from an image\n- im_vips2tiff() scanline write speed up for area pipelines\n\n10/6/04 started 7.9.6\n- tiny polishing of im_ppm2vips()\n- im_blend() can now work on labq\n- boolean ops all work on float/complex images (by casting to int)\n- im_maplut() was broken for 1 band image + many band lut + >8 bit output\n- im_lintra_vec() now handles 1 band image and many band vector to make many\n  band image\n- oops, im_lintra_vec() was missing a man page\n- im_measure() can work on labq\n- im_lhisteq() uses new embed mode, _raw() version is one pixel smaller, sets\n  Xoffset/Yoffset for new origin scheme\n- generalised im_tone_build() to any image type to make im_tone_build_range()\n\n20/5/04 started 7.9.5\n- tiff output res can be a single number too\n- added im_text() to make a bitmap from a string with pango\n- im_tiff2vips() does 16 bit RGBA\n- im_binfile() was broken since 7.9.2 due to im_mapfile() change\n- im_ppm2vips() now works for 16 bit images\n- added im_copy_swap() ... copies, reversing byte order\n- im_resize_linear() was broken for some images, thanks Javi\n\n8/3/04 started 7.9.4\n- oops, config.h include missing in a few places\n- im_vips2tiff() can now write 1 bit images\n- im__find_lr/tboverlap() now exported to nip\n- better edge tile handling for tiff read/write (thanks Ruven)\n- added extend-pixels-from-edge mode to im_embed()\n- im_conv*(), im_rank(), im_stdif(), im_dilate(), im_erode() all use it to\n  expand their input, so their output now has guess borders, not black borders\n- im_fastcor() now does an im_embed( 1 ) on the output ... the zero borders\n  were very annoying before, since you would usually be searching for the\n  minimum point\n- no change to im_spcor(), since you will usually be searching for the maximum\n- better im_render() cache behaviour under heavy loads\n- im_affine() revised\n\t* clip, resample and transform is now pixel-perfect for all\n\t  inputs (I hope)\n\t* uses the new embed to make sure there are no black borders\n\t  from edge interpolation\n\t* about 20 - 30% faster\n- policy change: Xoffset and Yoffset are now set by all operations to record\n  the position of the input origin in the output\n- im_replicate() is much faster for some cases\n- added tile and mirror flags to im_embed()\n- added im_cache() convenience function\n- better ETA for image calculation\n- im_tiff2vips() now has a \"broken\" option so it can read tiled tiffs made\n  with earlier versions of vips\n- on convert float to int format, now does floor() not rint() ... more\n  'mathematical'\n- added im_rint()\n- im_sharpen() now uses a gaussian mask\n- im_convsep() more resistant to int overflow problems\n- added im_make_xy(), avoids rounding problems with the old float-based thing\n- im_profile() now makes vertical images for a vertical profile\n- added im_vips2tiff() option to set the resolution in inches not cm (thanks\n  Andrey)\n- im_binfile() is now exported\n\n6/2/04 started 7.9.3\n- added an im_init_world() to im_open(), to help old progs\n- renamed VSemaphore as im_semaphore_t\n- started using libtool library versioning\n- now uses g_module_*() in place of dlopen()\n- now uses pkg-config instead of vips-config (thanks Simon)\n- fixes to vips.h for _ADDR() with DEBUG on (thanks Konrad)\n\n10/12/03 started 7.9.2\n- patches for freebsd, thanks Lev Serebryakov\n- vips2dj knows about my colour laser printer\n- added i18n support, glib/gmodule/gthread dependency\n- im_error*() API revised to be more i18n friendly\n- List type removed, now uses g_slist\n- VBuf added, some more utility funcs pushed down from nip\n- im_thread stuff removed, now uses g_thread\n- im_lock stuff removed, now uses g_mutex\n- im_semaphore_t renamed to VSemaphore, not sure this is a good idea\n- build with --disable-threads to turn off threaded render\n- #include <vips/vips.h> now pulls in most of the public API, you shouldn't\n  need other vips includes very often\n- im_close() is better at cleaning up if there's an error\n- inverse FFTs could fail for wider-than-high images with fftw\n- better im_icc_transform error messages\n- bug fix in im_render with large caches\n- im_binfile() now has an offset parameter\n- im_mapfile()/im_unmapfile() now work on IMAGE and record the length of the\n  file they mapped ... this lets VIPS successfully unmap a file if it changes\n  size while it's open\n\n20/10/03 started 7.9.1\n- threadgroups now have their own kill flag\n- im_plotmask() now does anti-aliasing\n- im_iterate() fix for operations on mmap window images (thanks Clare)\n- im_writeline() stops on kill\n- fix for im_fwfft() segv for wider-than-high real images (thanks Andrey)\n- fix for im_fwfft() to work for non-square real images (thanks Andrey)\n- can now read and write 32-bit IEEE float TIFF (Andrey Kiselev)\n- clean-ups for colour.c (Andrey Kiselev)\n- no longer lets you make an image with width|height|bands == 0 (thanks Joe)\n- im_vips2tiff(), im_vips2*jpeg*(), im_vips2png(), im_vips2ppm() could\n  sometimes fail for mmap window input images (thanks David)\n- added IM_RECT_HCENTRE(), IM_RECT_VCENTRE() macros\n\n20/8/03 JC\n- started 7.9.0\n- added im_rank_image() ... im_maxvalue() a special case of this\n- im_subtract() goes up to int earlier for better value preserving, thanks\n  Haida\n- im_rank() much faster for large windows, correct result on all platforms\n  (dratted memcpy() was causing problems before)\n- fixed problem with libMagick config if installed somewhere strange\n- fixed problem with include order in library compile\n- added --without-magick configure option\n- added im_render(), threaded background image paint\n- added im_replicate(), replicate an image horizontally and vertically\n\n31/5/03 JC\n- started 7.8.11\n- fixed a problem with relational operators and some combinations of input\n  types (bug introduced in 7.8.9), thanks Haida\n- vips-7.8 script overrides VIPSHOME environment variable\n- better im_guess_prefix\n- stupid light_correct script no longer uses /pics/tmp\n- added batch_crop script\n\n22/5/03\n- started 7.8.10\n- the JPEG writer can embed ICC profiles in output images ... although I've\n  yet to see it make any difference :-( test this carefully at some point\n- fixed a possible coredumper in jpeg write\n- jpeg read now spots truncated files\n- im_invertlut() now makes an image, not a mask ... sorry :-(\n- im_histnD() makes an n-dimensional histogram from an n-band image\n- im_col_pythagoras() patch\n- IM_NUMBER() now returns int not size_t\n- new win32 build system from Juan and friends, based on tmake\n- sample project files for MSVC added, thanks Juan\n- win32/ subdir now has the win32 build systems\n- spec/ subdir now has the spec files for building RPMs\n- dist now includes formatted documentation\n- license change: VIPS is now LGPL, nip stays GPL ... this means proprietary\n  programs can link against the vips library\n- had a report of a working VIPS build on a 64 bit system (!)\n- im_log_dmask() now includes all of the negative lobe, thanks matt\n- vips-7.8 start script now auto-relocates\n- im_spcor_raw(), im_fastcor_raw() now exported\n\n29/4/03\n- started 7.8.9\n- changes to build to help MSVC\n- oops, makedef.pl missed out function names with an initial cap, and\n  error_exit()\n- im_min() and im_max() gave random wrong results for >1 thread on >1 CPU\n  machines (bug introduced in 7.7.20), thanks Joe\n- vips.c no longer generates C++ wrappers for functions with no image argument\n  (thanks Haida)\n- im_invertlut() now wrapped by hand in VMask.cc\n- C++ docs updated\n- added im_open_header(), returns an IMAGE with just width/height/etc and no\n  data\n- ... so now \"header\" will print useful stuff even on truncated files\n- tiff writer knows about alpha (thanks Jenny)\n\n7/2/03\n- started 7.8.8\n- build failed with lcms turned off\n- im_spcor() could segv for 16bit images (thanks Joe)\n- im_tiff2vips() read resolution expressed as pixels/cm incorrectly\n- im_vips2tiff() tries not to write mad resolutions\n- header and im_open file type tests reordered for slight speedup\n- im_copy_set() had a broken dispatch function for xres/yres\n- im_fwfft() exploits libfftw real -> complex transform if possible for a 2x\n  speed-up (thanks Matt)\n- im_invfftr() added for complex -> real inverse transform for 2x speed-up\n  (thanks Matt)\n- im_freqflt() now uses im_invfftr() for real result and speedup\n- im_flipver() could segv on some inputs, thanks Clare\n- relational operators now work on complex\n- relational rewritten ... now fractionally slower, but 1/3 the size\n- vips2dj -1:1 produced incorrect height\n- better overlap-too-small detection in mosaicing code\n- im_system() can have NULL output\n- global balance ignores overlaps with only transparent pixels\n\n3/1/03\n- started 7.8.7\n- worked in patch from Hans Breuer (thanks!)\n\t- png read/write with im_png2vips(), im_png2vips_header(),\n\t  im_vips2png(), im_ispng()\n\t- im_errorstring() and im_col_displays() are now functions not externs\n\t  (helps DLLs)\n\t- many include fixes to help native win32 build\n- added libMagick support, 78 file formats now loadable with\n  im_magick2vips(), im_magick2vips_header() and im_ismagick(), w00t\n- now installs vips.m4 to $prefix/share/aclocal\n- added im_icc_export_depth() ... export to device space with a specified bit\n  depth (8 or 16)\n- vips.def now rebuilt with custom rule in libsrc/Makefile.am\n- removed externs im_Type, im_BandFmt, im_Coding, im_Compression to simplify\n  DLL build\n- im_mmap() -> im__mmap(), since it's supposed to be an internal function\n- new vips-7.8.x/proj directory holds unsupported sample makefiles and\n  config.h for building with the MSC toolchain\n- new scripts batch_image_convert and batch_rubber_sheet (thanks Joe)\n- added the RPM .spec files to the main distribution\n- InitializeMagic() now passed \"\" rather than NULL to avoid assert() problems\n  on some libMagic versions\n\n2/12/02\n- started 7.8.6\n- now reads 8-bit RGBA tiff\n- C++ build guide fixes (thanks fsicre)\n- im_Type2char array text slightly messed up\n- global_balance is safer for complex mixed mosaics\n- removed im_lintra() fallback to im_copy() for scale == 1, offset == 0 ...\n  too confusing\n- im_tiff2vips() now reads 16-bit LAB\n- added im_Lab2LabS() and im_LabS2Lab()\n\n5/11/02\n- started 7.8.5\n- fix for mmap window of local region ... caused im_iterate() to break\n  sometimes for large images, in turn occasionally breaking\n  im_max()/im_min()/etc. (thanks Joe)\n- tiny speed up for im_rot90()/270()\n- on install on win32, add .exe suffix for links\n- vips.c knows to remove .exe suffix for linked commands\n- added im_errormsg_system() ... decode win32 error codes too\n- pagesize calcs for roving mmap windows were messed up on win32 (thanks Kirk)\n- some TODO cleanups\n- global balance broke horribly if you had filenames with spaces in (thanks\n  Clare)\n\n31/10/02\n- started 7.8.4\n- im_unmapfile() includes mixed up on mac os x\n- libtool patched for mac os x\n- vips.c sets numeric locale to \"C\"\n\n27/10/02\n- started 7.8.3\n- configure fixes help mac os x\n- im_guess_prefix() adds \".exe\" suffix on w32 if not there\n- changed im_measure() error messages to number bands from 1\n- added func descriptor for im_read_dmask() to help nip, updated C++ API, docs\n\n21/10/02 JC\n- started 7.8.2\n- tries rand() if random() is not available\n- tries mktemp() if mkstemp() is not available\n- turns off realpath() if not available\n- added IM_DIR_SEP/IM_DIR_SEP_STR directory separator character/string\n- added IM_PATH_SEP/IM_PATH_SEP_STR path separator character/string\n- added im_path_is_absolute()\n- vips.c knows to link to vips.exe on win32\n- spot mingw* and set BINARY_OPEN\n- open images in binary too (since we now read() the header)\n\n10/10/02 JC\n- im_lintra() and im_lintra_vec() were broken for complex images :-( thanks\n  matt\n- renamed im_and() as im_andimage(), im_eor() as im_eorimage() and im_or() as\n  im_orimage() ... avoids breakage in the C++ layer\n- added im_dE00_fromLab()\n- limited release as vips-7.8.0\n\n2/10/02\n- renamed as vips-7.8, woohoo\n- revised documentation\n\n19/9/02 JC\n- started sorting out VIPS #defines ... there are now a sensible set of new\n  names (eg. NOCODING becomes IM_CODING_NONE, LAB becomes IM_TYPE_LAB)\n- define IM_NO_VIPS7_COMPAT to turn off the old names\n- added im_mmap()/im_munmap() layer for windows portability\n- removed the contents of history.h .. obsolete\n- added IM_IMAGE_ADDR() macro\n\n10/9/02 JC\n- handle errors from TIFF lib correctly\n- configure fixes for cygwin\n- CMYK TIFF write fixed\n- configure fixes for mingw\n\n5/9/02 JC\n- im_cp_desc() now copies Xoffset/Yoffset\n\n21/8/02 JC\n- started 7.7.24\n- reads CMYK TIFF\n- reads dpi from TIFFs\n- better float Xres/Yres\n\n14/8/02 JC\n- new header fields Xoffset and Yoffset ... used by functions to hint\n  the position of the origin in output images\n- support added to c++ api and to header\n- im__lrmerge(), im__tbmerge(), im__affine(), im_insert(),\n  set Xoffset/Yoffset\n- now uses <lcms.h>, not <lcms/lcms.h> for better suse w0rkage\n- better configure for fftw (uses libdfftw name if libfftw not found)\n\n8/8/02 JC\n- large file support with mmap() windows ... had to change\n  im_prepare_inplace() to im_prepare_to()\n\n  benchmark:\n\n  - system\n\n\thardware: 2 x 2.5GHz P4, 1GB RAM, 15k SCSI, ReiserFS\n\tos: suse 8 (kernel 2.4.18)\n\tcompiler: gcc 2.95.3, -O2, threads turned on\n\timages: fred.v, fred2.v; both 4k by 4k LABPACK (64MB)\n\timages: jim.v, jim2.v; both 15k by 15k LABPACK (900MB)\n\ttime: smallest real of 5 runs, system idle\n\tvips: 7.7.23, debug on in im_openin.c, window limit set with an\n\t  environment variable\n\n  - benchmarks\n\n\tcpu-bound: im_sharpen fred.v fred3.v 11 1.5 20 50 1 2\n\tio-bound: im_insert fred.v fred2.v fred3.v 4000 0\n\tworst-case: im_rot90 fred.v fred3.v\n\n  - results\n\n\tdesktop:\n\n\t\t\tno mmap windows\t\tmmap windows\n\n\tcpu-bound\treal    0m3.712s\treal    0m3.970s\n\t\t\tuser    0m6.010s\tuser    0m6.390s\n\t\t\tsys     0m0.900s \tsys     0m1.110s\n\n\tio-bound\treal    0m1.813s\treal    0m1.865s\n\t\t\tuser    0m0.900s\tuser    0m0.990s\n\t\t\tsys     0m1.720s \tsys     0m1.520s\n\n\tworst-case\treal    0m1.344s\treal    0m3.039s\n\t\t\tuser    0m1.270s\tuser    0m2.230s\n\t\t\tsys     0m0.850s\tsys     0m3.050s\n\n  not quite sure why sharpen is a little slower (4%?) ... IO speed is about\n  the same though ... worst-case is having to constantly move windows about\n  (500,000 page faults, vs 10,000 for no windows)\n\n  again, with an image larger than RAM\n\n  \t\t\tno mmap windows\t\tmmap windows\n\n\tio-bound \treal    2m52.759s\treal    2m11.172s\n\t\t\tuser    0m14.940s\tuser    0m14.890s\n\t\t\tsys     0m29.940s\tsys     0m26.560s\n\n\tworst-case\treal    3m35.391s\treal    3m50.760s\n\t\t\tuser    0m19.850s\tuser    0m26.600s\n\t\t\tsys     0m12.650s \tsys     0m43.130s\n\n  mmap windows actually slightly faster in this case ... plus they stress the\n  OS less\n\n31/7/02 JC\n- added -lm for better lcms detect\n- README notes for fftw on suse8\n- im_profile() sets HISTOGRAM for output image\n- im_copy()/im_copy_set() function descriptor no longer sets PTOP ... helps\n  avoid LUT problems\n- im_subsample()/im_zoom() fall back to im_copy() for shrink/grow == 1\n- im_lintra() falls back to im_copy() for scale == 1, offset == 0\n- no longer use Type == LUT ... all just Type == HISTOGRAM now\n- im_blend() was messed up for > 1 band images :(\n\n16/7/02 JC\n- started 7.7.23\n- im_XYZ2sRGB() wasn't setting Type = sRGB\n- im_icc_import() was broken for rgb\n- im_header_string() had wrong return type in function database\n\n13/7/02 JC\n- added im_flood_blob()\n- added im_open_local_array() ... C API convenience function\n- oop, im_flood() was missing a man page\n- Type == FOURIER added to help visualisation\n- released as 7.7.22\n\n30/6/02 JC\n- JPEG, TIFF and PPM import all now set sRGB Type for RGB import\n- im_header_int(), im_header_double() and im_header_string() added to aid\n  UIs\n- now uses gettimeofday(), not time()\n- for consistency with other trig functions, im_c2amph() now returns degrees\n  not radians (ouch)\n- added im_c2rect() ... turn (amp, phase) to rectangular\n- added im_sign() ... unit vector in direction of value\n- better im_scaleps() ... old code was terrible\n- rewritten im_rotquad() ... now partial\n- im_icc_export()/_import() now do ABSOLUTE correctly\n- added im_icc_ac2rc() ... converts absolute to relative colorimetry\n\n25/6/02 JC\n- added im_copy_set(3) ... like im_copy(), but set informational header fields\n\n20/6/02 JC\n- added im_ceil(), im_floor()\n- im_Lab2LabQ was not clipping a/b range correctly\n- im_icc_export(), own ABSOLUTE mode\n- released as 7.7.21\n\n28/5/02 JC\n- im_remainderconst_vec broken for float/double\n- added Yxy colourspace\n\n16/05/02 JC\n- auug, libtool was all messed up ... redone all the autotools stuff\n- uses libtool convenience libraries to build vips in sections\n- uses config subdir for temp files and .m4 things\n- patched stupid suse config.guess\n- vips2dj patched for better raw cmyk\n- released as 7.7.20\n\n12/5/02 JC\n- im_vips2jpeg*() and im_vips2ppm() now both partial\n- started updating the C++ guide\n- had to change the location of the C++ headers :-( all C++ progs should now\n  have:\n\n\t#include <vips/vipscpp.h>\n\n  this is so things can work on systems which do not have case sensitive\n  file systems\n\n- changes for Mac OS X\n  * im_system() TRUE/FALSE removed\n  * searches /*/[lib|include] to get fink libs for tiff and jpeg\n\n30/4/02 JC\n- several functions were missing IM_FN_PIO in their descriptor ... this was\n  harmless for nip/ip/C, but broke the ref counting in the C++ layer\n- im_system() now defaults \"/tmp\" for temp files\n- STRING input and output args were broken for C++ :-(\n- threads exit more quickly on error\n- im_min()/im_max() now partial (at last)\n- im_remainderconst()/im_remainderconst_vec() added\n- --with-dmalloc configure switch\n- vips2dj does CMYK and mono too\n- im_vips2tiff() allows any number of bands (but not the right way to\n  write CMYK, see TODO)\n\n26/4/02 JC\n- old ICC profile reader removed\n- little cms wrapped ... configure spots it, im_icc_transform() uses it to map\n  between two images\n- also im_icc_import() and im_icc_export() so you can see PCS images\n- im_icc_present() to test for existence of lib\n- README fixes\n\n4/4/02 JC\n- TODO changes\n- oops, DEBUG left on in im_invertlut()\n\n2/4/02 JC\n- im_fwfft.c/im_invfft.c now use libfftw if available ... about 5x speed up\n  and double precision\n- added FIND_FFTW autoconf macro\n- include/vips/proto.h changes\n\n26/3/02 JC\n- started 7.7.19\n\n25/3/02 JC\n- im_log_dmask() was broken (thanks matt)\n- casts between VDMask and VIMask were broken (thanks matt)\n- various error msgs improvements and tiny man page fixes\n\n13/3/02 JC\n- tb/lr merge first/last cache moved to per-call state for better sharing\n- im_remosaic() bails out faster on error and makes better error messages\n\n13/3/02 ruven\n- im_vips2tiff() pyramids stop at tilesize, not 64x64\n\n25/02/02 JC\n- im_remosaic() is smarter, and works better with im_global_balance()\n- im_affine() 2x faster\n\n14/2/02 JC\n- started 7.7.18\n- vips.m4 and libsrc/Makefile.am fixes for IRIX\n\n11/02/02 JC\n- vips/thread.h and vips/threadgroup.h were missing extern \"C\" for C++\n- VImage::write() now tracks dependencies, so you can write() to a partial\n  safely ... although it's not a very useful thing to do (thanks Mike)\n- new VImage::print() function for debugging\n- added im_print()\n\n22/01/02 JC\n- started 7.7.17\n\n15/01/02 JC\n- im_rect_unionrect() and im_rect_intersectrect() safer for repeated args\n- im_video_v4l() no longer perrror()s on ioctl fail for less spam\n\n03/01/02 JC\n- started 7.7.16\n- im_version_string() really does return the date as well now\n\n12/12/01 JC\n- im_guess_prefix() extra smartness for relative path names\n- VImage() no longer uses tmpnam() (thanks Paul)\n\n11/12/01 JC\n- renamed im_fexists() as im_existsf()\n\n7/12/01 JC\n- ppm man pages added (doh)\n\n28/11/01 JC\n- warnings on g++ 2.96 fixed\n\n22/11/01 JC\n- started 7.7.15\n- im_video_v4l() failed to compile on non-linux platforms\n\n7/11/01 JC\n- im_remosaic() added\n- im_*merge() are more intelligent about transparency in bizarre overlaps\n- grr! putenv() semantics change on more recent clibs ... should be safer\n  now\n\n19/10/01 JC\n- VDisplay( \"display name\" ) segved on unknown display :-( thanks mike\n\n26/9/01 JC\n- contrib tools get data files from share/vips/xxx area now\n- im_vipshome() renamed as im_guess_prefix(), reworked for new package layout\n- doc/ build sorted out\n- ... but of course, docs still need updating for 7.8\n\n20/9/01 JC\n- fix to im_vipshome()\n- ip2 renamed as nip\n- split to library only ... separate ip and nip packages\n- new VIPS_VERSION_* macros set from configure.in in vips/version.h.in\n- vips.m4 VIPS finder\n- reworked README, doc/README and TODO\n- now installs to /usr/local/ by default\n- fmask4th.c was including varargs.h ... d'oh\n- include area reorganised: everything inside <vips/..> now ... hopefully the\n  only user-visible change is that all plain C progs need to change:\n\n\t#include <vips.h>\n\n  to:\n\n\t#include <vips/vips.h>\n\n  the C++ API should be unaltered\n\n21/8/01 ruven\n- im_setupout() was missing some #includes\n\n20/8/01 JC\n- started 7.7.14\n\n15/8/01 JC\n- added libxml dependency for ip2\n\n27/7/01 JC\n- im_conv(), im_convf(), im_convsep(), im_convsepf() now reject masks with\n  scale == 0\n\n26/7/01 JC\n- started 7.7.12\n\n25/7/01 JC\n- started 7.7.11\n- oop, im_histeq() and im_tonemap() also missed\n- better error messages from im_run_command()\n\n23/7/01 JC\n- started 7.7.10\n- im_sharpen() failed due to change in im_band_extract() offset\n\n20/7/01 JC\n- started 7.7.9\n\n4/7/01 JC\n- im_open(,\"w\") open() delayed until im_setupout(), very slightly safer\n- updated im_open() man page\n- im_tiff2vips() now embeds index in filename ... and it's page number (from\n  0), not subsample factor\n- finally bit the bullet ... im_extract()/im_extract_band() now number from\n  zero (sorry!)\n- and im_lrmosaic()/im_tbmosaic() bandno param too\n\n29/6/01 JC\n- im_region_free() now frees immediately\n\n27/6/01 JC\n- im_vips2tiff() man page updated for deflate, 2 years late\n\n22/6/01 JC\n- oops, limit wrong on im_rank()\n\n21/6/01 JC\n- better post_install for --prefix outside VIPS's tree\n- -ltiff needs -lm in acinclude.m4 ... fixes configure on redhat 7.x\n\n13/6/01 JC\n- started 7.7.8\n\n6/6/01 JC\n- im_invertlut() added\n\n31/5/01 JC\n- im_colour_temperature, im_XYZ2Lab_temp, im_Lab2XYZ_temp added\n- ... colour temp stuff needs sorting out properly\n\n25/5/01 JC\n- added vips-config script, cf. gtk-config\n- --without-threads option added\n- did a bit of work on the C++ API docs\n\n24/5/01 JC\n- added im_tiff2vips_header(), im_jpeg2vips_header() and im_ppm2vips_header()\n- header uses these to print fields quickly\n- switched to config.h\n- configure.in rewritten ... much nicer, fewer options, more automatic\n\n17/5/01 JC\n- im_matinv() didn't free stuff correctly on singular matrix\n\n16/5/01 JC\n- vips2dj now knows about 5000ps printers\n- allow RW mode for non-native VIPS image files, for 8 bit images\n\n2/5/01 JC\n- started 7.7.7\n\n1/5/01 JC\n- im_addgnoise() did not work for >1 band images\n\n23/4/01 JC\n- configure options to remove support for JPEG and TIFF ... helpful for a no-\n  dependencies build\n\n20/4/01 JC\n- im_(v)snprintf() added\n- all sprintf()s removed\n\n15/4/01 JC\n- im_affine() had a rounding problem\n\n11/4/01 JC\n- tiny mosaicing bug fixed in im__lrcalcon\n- started 7.7.6\n\n21/3/01 JC\n- new iblend code in im_tbmerge() was typo-d\n- mosaic1 was broken by affine too\n\n20/3/01 JC\n- im_image() failed for FMTUCHAR\n\n12/3/01 JC\n- started 7.7.5\n- im_sharpen() uses seperable convolution for big speed up\n- new \"Print\" menu\n\n11/3/01 JC\n- REALVEC renamed as DOUBLEVEC\n- added IMAGEVEC\n- added IM_INPUT_IMAGEVEC\n- gbandjoin now has function description\n- new function im_maxvalue()\n- im_compass()/im_lindetect() reimplemented with im_conv()/im_maxvalue(),\n  about 15% faster, works for any type, partial\n- im_gradient() reimplemented with im_conv()/im_abs()/im_add(), about 30%\n  slower, works for any type, partial\n\n10/3/01 JC\n- new function, im_clip2fmt() converts between any image formats ...\n  slightly faster than the old im_clip()\n- legacy im_clip2us() etc. functions now just call this\n\n9/3/01 JC\n- im_conv() rewritten, simpler, about 10% faster\n- im_convsep() rewritten, now does any non-complex type, partial, 20% faster\n- new functions: im_convf(), im_convsepf() for DOUBLEMASK\n- raw versions of each\n- legacy convolvers (eg. im_convbi()) removed\n\n8/3/01 JC\n- new function im_blend()\n- new function im_lab_morph()\n- speed up to im_ifthenelse()\n- speed up to im_*merge() (uses integer arithmetic for integer blends)\n\n4/3/01 JC\n- tiny speed ups to im_histgr()\n- speed ups to im_maplut()\n\n3/3/01 JC\n- new functions: im_histnorm(), im_histcum()\n- im_histeq() more general\n- im_vipshome() --- better behaviour for relative paths\n\n2/3/01 JC\n- new video package\n- im_video_v4l1() (video for linux) added\n- configure.in switches to turn v4l1 on and off\n\n1/3/01 JC\n- new im_histspec() implementation ... more general, bugs removed\n\n14/2/01 JC\n- better vips2dj usage message\n\n13/2/01 JC\n- im_image_sanity() added, called in various places in iofuncs\n\n9/2/01 JC\n- added 'check' and 'name' class member stuff to ip from ip_gtk2\n- new \"Plot\" menu\n- new \"Overlay\" menu\n- more stuff in _stdenv/_list ... curried forms of head/tail etc.\n\n7/2/01 JC\n- started 7.7.4\n- vips2dj and vdump now use im_vipshome()\n\n5/2/01 JC\n- new im_vipshome() function\n- min()/max() macros renamed as MIN()/MAX()\n- new im_load_plugins() function\n- vips.exe and ip now load $VIPSHOME/lib plugins at startup\n\n2/2/01 JC\n- mosaicing functions now have an extra max blend width parameter\n\n30/1/01 JC\n- fixed tbmerge no overlap detect\n\n13/12/00 JC\n- started 7.7.3\n\n30/12/00 JC\n- vips.h fixes for cygwin/wingdi conflict\n\n27/11/00 JC\n- added im_vips2ppm(), im_open() imports and exports it\n- fixed nasty implicit output conversion problem for PIO dispatch() calls\n\n21/11/00 JC\n- added im_ppm2vips()\n\n16/11/00 JC\n- configure.in fixes ... jpeg found correctly now\n- searches for libz as well\n\n16/11/00 JC\n- started 7.7.2\n\n5/11/00 JC\n- speed up to lab2labq\n\n19/10/00 JC\n- started 7.7.1\n\n13/1/00 JC\n- oops, im_open() was missing an 'else' in jpeg/tiff load\n\n5/8/00 JC\n- im_vips2tiff() now has mode string embedded in output filename\n- im_vips2jpeg() now has qfac in output filename\n- im_open() understands this\n\n11/7/00 JC\n- new im_image() function ... wraps a VIPS image around a memory buffer\n- C++ layer changes:\n\t* now use #include <vips/Vips.h>\n\t* error renamed as VError\n\t* new VMask() constructors\n\t* new VImage() constructor\n\t* new VImage::data() access member\n\t* more operator equivalences: <, >, <=, >=, ==, !=, &, |, ^, %\n\n17/6/00 JC\n- more consts added to vips protos\n\n10/5/00 JC\n- minor configure.in changes to help solaris\n- removed _TIFFmalloc() and _TIFFfree() calls\n\n9/3/00 JC\n- fixed rounding problem in generate grid\n\n8/3/00 JC\n- fixup to im_system() temp dir\n\n7/3/00 JC\n- added im_system()\n- small tidies\n\n1/3/00 JC\n- better plugin test in configure.in\n\n26/2/00 JC\n- fixes to Makefile.am in ip/src* and configure.in, to help ip find the right\n  gtk includes on systems with more than one gtk-xxx installed\n\n21/2/00 JC\n- now builds ip and ip_gtk2\n\n16/2/00 JC\n- configure.in fixes for xil and some TIFF/JPEG strangeness\n\n15/2/00 JC\n- im_global_balancef() was broken! d'oh\n- note in README about enabling video cards\n\n10/2/00 JC\n- configure now searches for xil ... FIND_XIL macro\n- im_zoom() spots integer overflow\n- better shape set on region drag end in ip\n- better zoom-too-far handling in ip\n\n13/1/00 JC\n- fixes to configure etc. to help cygwin\n- jpeg is now searched for too ... FIND_JPEG macro\n\n10/1/00 JC\n- global_balance() now uses new affine() atuff\n\n27/12/99 JC\n- mosaic1 stuff now uses new affine() funcs\n\n21/12/99 JC\n- added Joe's docs\n- im_LabS2LabQ() rounding on a/b slightly broken for a/b == 0\n\n20/12/99 JC\n- new function: im_affine()\n- similarity*() now in terms of affine()\n- tests for error return in reduce.c from maplut\n- small clean-ups\n\n15/12/99\n- im_version() added, new iofuncs package for it\n- ip did not call zero-input-arg vips functions\n- vips.c did not like zero-input-arg functions\n\n6/12/99 JC\n- Sobel filter was a bit broken\n\n3/12/99 JC\n- menu reorganisation\n- generate gauss mask dialog\n\n2/12/99 JC\n- reworked text file IO, better error messages\n\n1/12/99 JC\n- reworked .iprc filename stuff, cleaner\n\n30/11/99 JC\n- better menu set switcher in calc preferences\n- ip now thinks it's 7.7\n- did a spellcheck on the ip guide\n\n29/11/99 JC\n- 7.7 started!\n- srgb D65->D50 converter\n- Negate added to arith\n- find similar pixel value dialog\n- find similar colour dialog\n- paste into background dialog\n\n19/11/99 JC\n- adjust labq was mising\n- shrink image defaulted to /2 not /1\n- sharpdropshadow broken\n- Rotate.* broken\n- vips-7.6.3 release\n\n18/11/99 JC\n- ip didn't report space free on >2GB filesystems correctly\n- ip did not link statically against libXpm on solaris7\n\n17/11/99 JC\n- im_histplot() failed for all 0's histogram\n- new profile_image dialog\n- man pages for im_sRGB2XYZ/im_XYZ2sRGB were broken\n- new colourize image dialog\n- new shrink image image dialog\n- new expand image image dialog\n- better doc Makefiles\n\n16/11/99 JC\n- more menu reorganising\n- new image_to_mask/mask_to_image buttons\n- new match_two_images dialog\n- new measure_colour_chart dialog\n\n15/11/99 JC\n- new custom LABQ sharpen in Image menu\n- configure support for SGI video (thanks Ruven)\n- menu fiddling in ip\n- new \"resize canvas\" menu item\n- im_insert_noexpand() added, no docs tho'\n\n11/11/99 JC\n- new ip menu item: Image=>Adjust white/black/saturation of LabQ\n- fixed bug in decompose complex number\n- browse-icons now ignores errors\n- better error msg for \"12 12\" etc cases\n\n10/11/99 JC\n- open hi-res gives proper error msg if no file found\n- made file-select boxes a bit more compact and clearer\n- updated configure.in for vips-examples-7.6\n\n9/11/99 JC\n- new column start point moved\n- vdump now defaults to subsample 1, portrait\n- navigation boxes were broken\n- no longer shrink-to-fit if loading as high res\n- better positioning of zoom windows\n- removed some old cruft\n\n8/11/99 JC\n- ooops, im_remainder() got lost somehow\n- refguide converted to latex and updated\n- cppguide updated\n\n5/11/99 JC\n- libguide converted to latex and updated\n\n4/11/99 JC\n- ip guide now latex2htmls cleanly ... still needs updating tho'\n- cpp/app guide latex2html redone\n\n2/11/99 JC\n- configure no longer adds -32 to IRIX builds for you\n- some more stuff in README\n- simple DEBUGM malloc tracking, made libsrc/iofuncs/memory.c\n- changed im_malloc() to return void *\n- removed duplicate im_malloc() proto from util.h\n- changed all malloc/free to go through im_malloc()/im_free()\n\n23/10/99 JC\n- double-click on error image now pops a load browser and an error dialog\n- add-new-column no longer scrolls to right edge of workspace\n- better scroll-to-bottom on item add\n- load ws twice does not cause 'already open' errors\n- memorise directory button in fsb\n\n18/10/99 JC\n- new FIND_TIFF/FIND_MOTIF macros for acinclude.m4\n- new ./configure switches, see ./configure --help\n- enabled static libs\n\n8/10/99\n- broke action_proc_bop() into smaller functions, stops bad code gen on\n  gcc2.95.1 (and others, prolly)\n- restored old Makefiles in doc/src/ipguide\n- vips7.6 script renamed as vips-7.6\n\n5/10/99\n- replace image was broken\n- some menu reorganisation\n- 'reload all menus' button\n\n4/10/99\n- computed regions in ip were broken\n- updated system.iprc defaults\n- new menu item: adjust white/black points\n\n2/10/99\n- browse icons was broken\n- greyscale 16-bit tiled tiff was broken\n- extra mutex locks for TIFF*() in im_tiff2vips()\n\n1/10/99\n- some automake probs fixed\n- squished two ip bugs\n\n30/9/99\n- fixed problem with pthreads, now works on suse6.2 as well\n- new API stuff for threaded evaluation with im_threadgroup_t\n- new public interface provide platform independent threads/locks/semaphores\n- no error box if you zoom out too far now\n\n26/9/99\n- lr/tb merge blend was not quite right ... should be smoother now\n- histplot broken for float images\n\n24/9/99\n- better mono->labq converter\n- more portable ispoweroftwo detect for freq filter stuff\n\n23/9/99\n- better graphics expose handling\n\n17/9/99\n- >/< stuff in ip was a bit mixed up\n- ink preview fixed for mono images\n- help popup fixed\n\n15/9/99\n- linedetect and sobel filters for ip, thnx Kirk\n\n14/9/99\n- Find_histogram was broken\n- im_profile() man pages was broken\n- ooops, ip had old set of macros\n\n10/9/99\n- im_and/im_or/im_eor now work for any integer type\n\nSummer hols: (2nd half August '99)\n- initial heap block larger to avoid start gcs\n- def slicer fixed\n- larger max heap\n- toolkits with initial '_' hidden by default\n- custom recomb\n- dialog.def removed\n- ... other menu fixes\n- generate grid menu\n- im_remainder() added\n- new cursor change code, hglass rotates during comp!\n- dialog.c handles cursor changes better\n- rubber band in paintbox displays\n- mag widget stays on right!\n- undo/redo single pixel paint ops\n- heap size control from prefs\n- cancel for reductions as well as for image calc\n- browse stuff reworked, no more .icon.v files\n- save stops you overwriting open .v files\n- better animate_countdown() handling\n- better resize behaviour for bars added to images\n- better code generation, bug fixed in state tracking\n- auto recover from crash\n", "/* foreign file formats base class\n *\n * 7/2/12\n * \t- add support for sequential reads\n * 18/6/12\n * \t- flatten alpha with vips_flatten()\n * 28/5/13\n * \t- auto rshift down to 8 bits during save\n * 19/1/14\n * \t- pack and unpack rad to scrgb\n * 18/8/14\n * \t- fix conversion to 16-bit RGB, thanks John\n * 18/6/15\n * \t- forward progress signals from load\n * 23/5/16\n * \t- remove max-alpha stuff, this is now automatic\n * 12/6/17\n * \t- transform cmyk->rgb if there's an embedded profile\n * 16/6/17\n * \t- add page_height\n */\n\n/*\n\n    This file is part of VIPS.\n\n    VIPS is free software; you can redistribute it and/or modify\n    it under the terms of the GNU Lesser General Public License as published by\n    the Free Software Foundation; either version 2 of the License, or\n    (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Lesser General Public License for more details.\n\n    You should have received a copy of the GNU Lesser General Public License\n    along with this program; if not, write to the Free Software\n    Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA\n    02110-1301  USA\n\n */\n\n/*\n\n    These files are distributed with VIPS - http://www.vips.ecs.soton.ac.uk\n\n */\n\n/*\n#define DEBUG\n */\n\n#ifdef HAVE_CONFIG_H\n#include <config.h>\n#endif /*HAVE_CONFIG_H*/\n#include <vips/intl.h>\n\n#include <stdio.h>\n#include <stdlib.h>\n\n#include <vips/vips.h>\n#include <vips/internal.h>\n#include <vips/debug.h>\n\n#include \"pforeign.h\"\n\n/**\n * SECTION: foreign\n * @short_description: load and save images in a variety of formats\n * @stability: Stable\n * @see_also: <link linkend=\"libvips-image\">image</link>\n * @include: vips/vips.h\n *\n * This set of operations load and save images in a variety of formats. \n *\n * The operations share a base class that offers a simple way to search for a\n * subclass of #VipsForeign which can load a certain file (see\n * vips_foreign_find_load()) or buffer (see vips_foreign_find_load_buffer()), \n * or which could be used to save an image to a\n * certain file type (see vips_foreign_find_save() and\n * vips_foreign_find_save_buffer()). You can then run these\n * operations using vips_call() and friends to perform the load or save.\n *\n * vips_image_write_to_file() and vips_image_new_from_file() and friends use\n * these functions to automate file load and save. \n *\n * You can also invoke the operations directly, for example:\n *\n * |[\n * vips_tiffsave (my_image, \"frank.anything\", \n *     \"compression\", VIPS_FOREIGN_TIFF_COMPRESSION_JPEG,\n *     NULL);\n * ]|\n *\n * To add support for a new file format to vips, simply define a new subclass\n * of #VipsForeignLoad or #VipsForeignSave. \n *\n * If you define a new operation which is a subclass of #VipsForeign, support \n * for it automatically appears in all VIPS user-interfaces. It will also be\n * transparently supported by vips_image_new_from_file() and friends.\n *\n * VIPS comes with VipsForeign for TIFF, JPEG, PNG, Analyze, PPM, OpenEXR, CSV,\n * Matlab, Radiance, RAW, FITS, WebP, SVG, PDF, GIF and VIPS. It also includes \n * import filters which can load with libMagick and with OpenSlide. \n *\n * ## Writing a new loader\n *\n * Add a new loader to VIPS by subclassing #VipsForeignLoad. Subclasses need to \n * implement at least @header().\n *\n * @header() must set at least the header fields of @out. @load(), if defined,\n * must load the pixels to @real.\n *\n * The suffix list is used to select a format to save a file in, and to pick a\n * loader if you don't define is_a().\n *\n * You should also define @nickname and @description in #VipsObject. \n *\n * As a complete example, here's code for a PNG loader, minus the actual\n * calls to libpng.\n *\n * |[\n * typedef struct _VipsForeignLoadPng {\n *   VipsForeignLoad parent_object;\n * \n *   char *filename; \n * } VipsForeignLoadPng;\n * \n * typedef VipsForeignLoadClass VipsForeignLoadPngClass;\n * \n * G_DEFINE_TYPE( VipsForeignLoadPng, vips_foreign_load_png, \n *   VIPS_TYPE_FOREIGN_LOAD );\n * \n * static VipsForeignFlags\n * vips_foreign_load_png_get_flags_filename( const char *filename )\n * {\n *   VipsForeignFlags flags;\n * \n *   flags = 0;\n *   if( vips__png_isinterlaced( filename ) )\n *   \tflags = VIPS_FOREIGN_PARTIAL;\n *   else\n *   \tflags = VIPS_FOREIGN_SEQUENTIAL;\n * \n *   return( flags );\n * }\n * \n * static VipsForeignFlags\n * vips_foreign_load_png_get_flags( VipsForeignLoad *load )\n * {\n *   VipsForeignLoadPng *png = (VipsForeignLoadPng *) load;\n * \n *   return( vips_foreign_load_png_get_flags_filename( png->filename ) );\n * }\n * \n * static int\n * vips_foreign_load_png_header( VipsForeignLoad *load )\n * {\n *   VipsForeignLoadPng *png = (VipsForeignLoadPng *) load;\n * \n *   if( vips__png_header( png->filename, load->out ) )\n *   \treturn( -1 );\n * \n *   return( 0 );\n * }\n * \n * static int\n * vips_foreign_load_png_load( VipsForeignLoad *load )\n * {\n *   VipsForeignLoadPng *png = (VipsForeignLoadPng *) load;\n * \n *   if( vips__png_read( png->filename, load->real ) )\n *   \treturn( -1 );\n * \n *   return( 0 );\n * }\n * \n * static void\n * vips_foreign_load_png_class_init( VipsForeignLoadPngClass *class )\n * {\n *   GObjectClass *gobject_class = G_OBJECT_CLASS( class );\n *   VipsObjectClass *object_class = (VipsObjectClass *) class;\n *   VipsForeignClass *foreign_class = (VipsForeignClass *) class;\n *   VipsForeignLoadClass *load_class = (VipsForeignLoadClass *) class;\n * \n *   gobject_class->set_property = vips_object_set_property;\n *   gobject_class->get_property = vips_object_get_property;\n * \n *   object_class->nickname = \"pngload\";\n *   object_class->description = _( \"load png from file\" );\n * \n *   foreign_class->suffs = vips__png_suffs;\n * \n *   load_class->is_a = vips__png_ispng;\n *   load_class->get_flags_filename = \n *   \tvips_foreign_load_png_get_flags_filename;\n *   load_class->get_flags = vips_foreign_load_png_get_flags;\n *   load_class->header = vips_foreign_load_png_header;\n *   load_class->load = vips_foreign_load_png_load;\n * \n *   VIPS_ARG_STRING( class, \"filename\", 1, \n *   \t_( \"Filename\" ),\n *   \t_( \"Filename to load from\" ),\n *   \tVIPS_ARGUMENT_REQUIRED_INPUT, \n *   \tG_STRUCT_OFFSET( VipsForeignLoadPng, filename ),\n *   \tNULL );\n * }\n * \n * static void\n * vips_foreign_load_png_init( VipsForeignLoadPng *png )\n * {\n * }\n * ]|\n * \n * ## Writing a new saver\n *\n * Call your saver in the class' @build() method after chaining up. The\n * prepared image should be ready for you to save in @ready.  \n *\n * As a complete example, here's the code for the CSV saver, minus the calls\n * to the actual save routines.\n *\n * |[\n * typedef struct _VipsForeignSaveCsv {\n *   VipsForeignSave parent_object;\n * \n *   char *filename; \n *   const char *separator;\n * } VipsForeignSaveCsv;\n * \n * typedef VipsForeignSaveClass VipsForeignSaveCsvClass;\n * \n * G_DEFINE_TYPE( VipsForeignSaveCsv, vips_foreign_save_csv, \n *   VIPS_TYPE_FOREIGN_SAVE );\n * \n * static int\n * vips_foreign_save_csv_build( VipsObject *object )\n * {\n *   VipsForeignSave *save = (VipsForeignSave *) object;\n *   VipsForeignSaveCsv *csv = (VipsForeignSaveCsv *) object;\n * \n *   if( VIPS_OBJECT_CLASS( vips_foreign_save_csv_parent_class )->\n *   \tbuild( object ) )\n *   \treturn( -1 );\n * \n *   if( vips__csv_write( save->ready, csv->filename, csv->separator ) )\n *   \treturn( -1 );\n * \n *   return( 0 );\n * }\n * \n * static void\n * vips_foreign_save_csv_class_init( VipsForeignSaveCsvClass *class )\n * {\n *   GObjectClass *gobject_class = G_OBJECT_CLASS( class );\n *   VipsObjectClass *object_class = (VipsObjectClass *) class;\n *   VipsForeignClass *foreign_class = (VipsForeignClass *) class;\n *   VipsForeignSaveClass *save_class = (VipsForeignSaveClass *) class;\n * \n *   gobject_class->set_property = vips_object_set_property;\n *   gobject_class->get_property = vips_object_get_property;\n * \n *   object_class->nickname = \"csvsave\";\n *   object_class->description = _( \"save image to csv file\" );\n *   object_class->build = vips_foreign_save_csv_build;\n * \n *   foreign_class->suffs = vips__foreign_csv_suffs;\n * \n *   save_class->saveable = VIPS_SAVEABLE_MONO;\n *   // no need to define ->format_table, we don't want the input \n *   // cast for us\n * \n *   VIPS_ARG_STRING( class, \"filename\", 1, \n *   \t_( \"Filename\" ),\n *   \t_( \"Filename to save to\" ),\n *   \tVIPS_ARGUMENT_REQUIRED_INPUT, \n *   \tG_STRUCT_OFFSET( VipsForeignSaveCsv, filename ),\n *   \tNULL );\n * \n *   VIPS_ARG_STRING( class, \"separator\", 13, \n *   \t_( \"Separator\" ), \n *   \t_( \"Separator characters\" ),\n *   \tVIPS_ARGUMENT_OPTIONAL_INPUT,\n *   \tG_STRUCT_OFFSET( VipsForeignSaveCsv, separator ),\n *   \t\"\\t\" ); \n * }\n * \n * static void\n * vips_foreign_save_csv_init( VipsForeignSaveCsv *csv )\n * {\n *   csv->separator = g_strdup( \"\\t\" );\n * }\n * ]|\n */\n\n/* Use this to link images to the load operation that made them. \n */\nstatic GQuark vips__foreign_load_operation = 0; \n\n/**\n * VipsForeignFlags: \n * @VIPS_FOREIGN_NONE: no flags set\n * @VIPS_FOREIGN_PARTIAL: the image may be read lazilly\n * @VIPS_FOREIGN_BIGENDIAN: image pixels are most-significant byte first\n * @VIPS_FOREIGN_SEQUENTIAL: top-to-bottom lazy reading\n *\n * Some hints about the image loader.\n *\n * #VIPS_FOREIGN_PARTIAL means that the image can be read directly from the\n * file without needing to be unpacked to a temporary image first. \n *\n * #VIPS_FOREIGN_SEQUENTIAL means that the loader supports lazy reading, but\n * only top-to-bottom (sequential) access. Formats like PNG can read sets of\n * scanlines, for example, but only in order. \n *\n * If neither PARTIAL or SEQUENTIAL is set, the loader only supports whole\n * image read. Setting both PARTIAL and SEQUENTIAL is an error.\n *\n * #VIPS_FOREIGN_BIGENDIAN means that image pixels are most-significant byte\n * first. Depending on the native byte order of the host machine, you may\n * need to swap bytes. See vips_copy().\n */\n\nG_DEFINE_ABSTRACT_TYPE( VipsForeign, vips_foreign, VIPS_TYPE_OPERATION );\n\nstatic void\nvips_foreign_summary_class( VipsObjectClass *object_class, VipsBuf *buf )\n{\n\tVipsForeignClass *class = VIPS_FOREIGN_CLASS( object_class );\n\n\tVIPS_OBJECT_CLASS( vips_foreign_parent_class )->\n\t\tsummary_class( object_class, buf );\n\n\tif( class->suffs ) {\n\t\tconst char **p;\n\n\t\tvips_buf_appends( buf, \" (\" );\n\t\tfor( p = class->suffs; *p; p++ ) {\n\t\t\tvips_buf_appendf( buf, \"%s\", *p );\n\t\t\tif( p[1] )\n\t\t\t\tvips_buf_appends( buf, \", \" );\n\t\t}\n\t\tvips_buf_appends( buf, \")\" );\n\t}\n\n\tvips_buf_appendf( buf, \", priority=%d\", class->priority );\n\n}\n\nstatic void\nvips_foreign_class_init( VipsForeignClass *class )\n{\n\tGObjectClass *gobject_class = G_OBJECT_CLASS( class );\n\tVipsObjectClass *object_class = (VipsObjectClass *) class;\n\n\tgobject_class->set_property = vips_object_set_property;\n\tgobject_class->get_property = vips_object_get_property;\n\n\tobject_class->nickname = \"foreign\";\n\tobject_class->description = _( \"load and save image files\" );\n\tobject_class->summary_class = vips_foreign_summary_class;\n}\n\nstatic void\nvips_foreign_init( VipsForeign *object )\n{\n}\n\n/* To iterate over supported files we build a temp list of subclasses of \n * VipsForeign, sort by priority, iterate, and free.\n */\n\nstatic void *\nfile_add_class( VipsForeignClass *class, GSList **files )\n{\n\t/* Append so we don't reverse the list of files. Sort will not reorder\n\t * items of equal priority. \n\t */\n\t*files = g_slist_append( *files, class );\n\n\treturn( NULL );\n}\n\nstatic gint\nfile_compare( VipsForeignClass *a, VipsForeignClass *b )\n{\n        return( b->priority - a->priority );\n}\n\n/**\n * vips_foreign_map:\n * @base: base class to search below (eg. \"VipsForeignLoad\")\n * @fn: (scope call): function to apply to each #VipsForeignClass\n * @a: user data\n * @b: user data\n *\n * Apply a function to every #VipsForeignClass that VIPS knows about. Foreigns\n * are presented to the function in priority order. \n *\n * Like all VIPS map functions, if @fn returns %NULL, iteration continues. If\n * it returns non-%NULL, iteration terminates and that value is returned. The\n * map function returns %NULL if all calls return %NULL.\n *\n * See also: vips_slist_map().\n *\n * Returns: (transfer none): the result of iteration\n */\nvoid *\nvips_foreign_map( const char *base, VipsSListMap2Fn fn, void *a, void *b )\n{\n\tGSList *files;\n\tvoid *result;\n\n\tfiles = NULL;\n\t(void) vips_class_map_all( g_type_from_name( base ), \n\t\t(VipsClassMapFn) file_add_class, (void *) &files );\n\n\tfiles = g_slist_sort( files, (GCompareFunc) file_compare );\n\tresult = vips_slist_map2( files, fn, a, b );\n\tg_slist_free( files );\n\n\treturn( result );\n}\n\n/* Abstract base class for image load.\n */\n\nG_DEFINE_ABSTRACT_TYPE( VipsForeignLoad, vips_foreign_load, VIPS_TYPE_FOREIGN );\n\nstatic void\nvips_foreign_load_dispose( GObject *gobject )\n{\n\tVipsForeignLoad *load = VIPS_FOREIGN_LOAD( gobject );\n\n\tVIPS_UNREF( load->real );\n\n\tG_OBJECT_CLASS( vips_foreign_load_parent_class )->dispose( gobject );\n}\n\nstatic void\nvips_foreign_load_summary_class( VipsObjectClass *object_class, VipsBuf *buf )\n{\n\tVipsForeignLoadClass *class = VIPS_FOREIGN_LOAD_CLASS( object_class );\n\n\tVIPS_OBJECT_CLASS( vips_foreign_load_parent_class )->\n\t\tsummary_class( object_class, buf );\n\n\tif( !G_TYPE_IS_ABSTRACT( G_TYPE_FROM_CLASS( class ) ) ) {\n\t\tif( class->is_a )\n\t\t\tvips_buf_appends( buf, \", is_a\" );\n\t\tif( class->is_a_buffer )\n\t\t\tvips_buf_appends( buf, \", is_a_buffer\" );\n\t\tif( class->get_flags )\n\t\t\tvips_buf_appends( buf, \", get_flags\" );\n\t\tif( class->get_flags_filename )\n\t\t\tvips_buf_appends( buf, \", get_flags_filename\" );\n\t\tif( class->header )\n\t\t\tvips_buf_appends( buf, \", header\" );\n\t\tif( class->load )\n\t\t\tvips_buf_appends( buf, \", load\" );\n\n\t\t/* You can omit ->load(), you must not omit ->header().\n\t\t */\n\t\tg_assert( class->header );\n\t}\n}\n\n/* Can this VipsForeign open this file?\n */\nstatic void *\nvips_foreign_find_load_sub( VipsForeignLoadClass *load_class, \n\tconst char *filename )\n{\n\tVipsForeignClass *class = VIPS_FOREIGN_CLASS( load_class );\n\n#ifdef DEBUG\n\tprintf( \"vips_foreign_find_load_sub: %s\\n\", \n\t\tVIPS_OBJECT_CLASS( class )->nickname );\n#endif /*DEBUG*/\n\n\tif( load_class->is_a ) {\n\t\tif( load_class->is_a( filename ) ) \n\t\t\treturn( load_class );\n\n#ifdef DEBUG\n\t\tprintf( \"vips_foreign_find_load_sub: is_a failed\\n\" ); \n#endif /*DEBUG*/\n\t}\n\telse if( class->suffs && \n\t\tvips_filename_suffix_match( filename, class->suffs ) )\n\t\treturn( load_class );\n\telse {\n#ifdef DEBUG\n\t\tprintf( \"vips_foreign_find_load_sub: suffix match failed\\n\" ); \n#endif /*DEBUG*/\n\t}\n\n\treturn( NULL );\n}\n\n/**\n * vips_foreign_find_load:\n * @filename: file to find a loader for\n *\n * Searches for an operation you could use to load @filename. Any trailing\n * options on @filename are stripped and ignored. \n *\n * See also: vips_foreign_find_load_buffer(), vips_image_new_from_file().\n *\n * Returns: the name of an operation on success, %NULL on error\n */\nconst char *\nvips_foreign_find_load( const char *name )\n{\n\tchar filename[VIPS_PATH_MAX];\n\tchar option_string[VIPS_PATH_MAX];\n\tVipsForeignLoadClass *load_class;\n\n\tvips__filename_split8( name, filename, option_string );\n\n\tif( !vips_existsf( \"%s\", filename ) ) {\n\t\tvips_error( \"VipsForeignLoad\", \n\t\t\t_( \"file \\\"%s\\\" not found\" ), name );\n\t\treturn( NULL );\n\t}\n\n\tif( !(load_class = (VipsForeignLoadClass *) vips_foreign_map( \n\t\t\"VipsForeignLoad\",\n\t\t(VipsSListMap2Fn) vips_foreign_find_load_sub, \n\t\t(void *) filename, NULL )) ) {\n\t\tvips_error( \"VipsForeignLoad\", \n\t\t\t_( \"\\\"%s\\\" is not a known file format\" ), name );\n\t\treturn( NULL );\n\t}\n\n#ifdef DEBUG\n\tprintf( \"vips_foreign_find_load: selected %s\\n\", \n\t\tVIPS_OBJECT_CLASS( load_class )->nickname );\n#endif /*DEBUG*/\n\n\treturn( G_OBJECT_CLASS_NAME( load_class ) );\n}\n\n/* Kept for compat with earlier version of the vip8 API. Use\n * vips_image_new_from_file() now. \n */\n\nint\nvips_foreign_load( const char *name, VipsImage **out, ... )\n{\n\tchar filename[VIPS_PATH_MAX];\n\tchar option_string[VIPS_PATH_MAX];\n\tconst char *operation_name;\n\tva_list ap;\n\tint result;\n\n\tvips__filename_split8( name, filename, option_string );\n\tif( !(operation_name = vips_foreign_find_load( filename )) )\n\t\treturn( -1 );\n\n\tva_start( ap, out );\n\tresult = vips_call_split_option_string( operation_name, option_string, \n\t\tap, filename, out );\n\tva_end( ap );\n\n\treturn( result );\n}\n\n/* Can this VipsForeign open this buffer?\n */\nstatic void *\nvips_foreign_find_load_buffer_sub( VipsForeignLoadClass *load_class, \n\tconst void **buf, size_t *len )\n{\n\tif( load_class->is_a_buffer &&\n\t\tload_class->is_a_buffer( *buf, *len ) ) \n\t\treturn( load_class );\n\n\treturn( NULL );\n}\n\n/**\n * vips_foreign_find_load_buffer:\n * @data: (array length=size) (element-type guint8) (transfer none): start of \n * memory buffer\n * @size: (type gsize): number of bytes in @data\n *\n * Searches for an operation you could use to load a memory buffer. To see the\n * range of buffer loaders supported by your vips, try something like:\n * \n * \tvips -l | grep load_buffer\n *\n * See also: vips_image_new_from_buffer().\n *\n * Returns: (transfer none): the name of an operation on success, %NULL on \n * error.\n */\nconst char *\nvips_foreign_find_load_buffer( const void *data, size_t size )\n{\n\tVipsForeignLoadClass *load_class;\n\n\tif( !(load_class = (VipsForeignLoadClass *) vips_foreign_map( \n\t\t\"VipsForeignLoad\",\n\t\t(VipsSListMap2Fn) vips_foreign_find_load_buffer_sub, \n\t\t&data, &size )) ) {\n\t\tvips_error( \"VipsForeignLoad\", \n\t\t\t\"%s\", _( \"buffer is not in a known format\" ) ); \n\t\treturn( NULL );\n\t}\n\n\treturn( G_OBJECT_CLASS_NAME( load_class ) );\n}\n\n/**\n * vips_foreign_is_a:\n * @loader: name of loader to use for test\n * @filename: file to test\n *\n * Return %TRUE if @filename can be loaded by @loader. @loader is something\n * like \"tiffload\" or \"VipsForeignLoadTiff\".\n *\n * Returns: %TRUE if @filename can be loaded by @loader.\n */\ngboolean \nvips_foreign_is_a( const char *loader, const char *filename )\n{\n\tconst VipsObjectClass *class;\n\tVipsForeignLoadClass *load_class;\n\n\tif( !(class = vips_class_find( \"VipsForeignLoad\", loader )) ) \n\t\treturn( FALSE );\n\tload_class = VIPS_FOREIGN_LOAD_CLASS( class );\n\tif( load_class->is_a &&\n\t\tload_class->is_a( filename ) ) \n\t\treturn( TRUE );\n\n\treturn( FALSE );\n}\n\n/**\n * vips_foreign_is_a_buffer:\n * @loader: name of loader to use for test\n * @data: (array length=size) (element-type guint8): pointer to the buffer to test\n * @size: (type gsize): size of the buffer to test\n *\n * Return %TRUE if @data can be loaded by @loader. @loader is something\n * like \"tiffload_buffer\" or \"VipsForeignLoadTiffBuffer\".\n *\n * Returns: %TRUE if @data can be loaded by @loader.\n */\ngboolean\nvips_foreign_is_a_buffer( const char *loader, const void *data, size_t size )\n{\n\tconst VipsObjectClass *class;\n\tVipsForeignLoadClass *load_class;\n\n\tif( !(class = vips_class_find( \"VipsForeignLoad\", loader )) )\n\t\treturn( FALSE );\n\tload_class = VIPS_FOREIGN_LOAD_CLASS( class );\n\tif( load_class->is_a_buffer &&\n\t\tload_class->is_a_buffer( data, size ) )\n\t\treturn( TRUE );\n\n\treturn( FALSE );\n}\n\n/**\n * vips_foreign_flags:\n * @loader: name of loader to use for test\n * @filename: file to test\n *\n * Return the flags for @filename using @loader. \n * @loader is something like \"tiffload\" or \"VipsForeignLoadTiff\".\n *\n * Returns: the flags for @filename.\n */\nVipsForeignFlags \nvips_foreign_flags( const char *loader, const char *filename )\n{\n\tconst VipsObjectClass *class;\n\n\tif( (class = vips_class_find( \"VipsForeignLoad\", loader )) ) {\n\t\tVipsForeignLoadClass *load_class = \n\t\t\tVIPS_FOREIGN_LOAD_CLASS( class );\n\n\t\tif( load_class->get_flags_filename ) \n\t\t\treturn( load_class->get_flags_filename( filename ) );\n\t}\n\n\treturn( 0 );\n}\n\nstatic VipsObject *\nvips_foreign_load_new_from_string( const char *string )\n{\n\tconst char *file_op;\n\tGType type;\n\tVipsForeignLoad *load;\n\n\tif( !(file_op = vips_foreign_find_load( string )) )\n\t\treturn( NULL );\n\ttype = g_type_from_name( file_op );\n\tg_assert( type ); \n\n\tload = VIPS_FOREIGN_LOAD( g_object_new( type, NULL ) );\n\tg_object_set( load,\n\t\t\"filename\", string,\n\t\tNULL );\n\n\treturn( VIPS_OBJECT( load ) );\n}\n\nstatic VipsImage *\nvips_foreign_load_temp( VipsForeignLoad *load )\n{\n\tconst guint64 disc_threshold = vips_get_disc_threshold();\n\tconst guint64 image_size = VIPS_IMAGE_SIZEOF_IMAGE( load->out );\n\n\t/* If this is a partial operation, we can open directly.\n\t */\n\tif( load->flags & VIPS_FOREIGN_PARTIAL ) {\n#ifdef DEBUG\n\t\tprintf( \"vips_foreign_load_temp: partial temp\\n\" );\n#endif /*DEBUG*/\n\n\t\treturn( vips_image_new() );\n\t}\n\n\t/* If it can do sequential access and it's been requested, we can open\n\t * directly.\n\t */\n\tif( (load->flags & VIPS_FOREIGN_SEQUENTIAL) && \n\t\tload->access != VIPS_ACCESS_RANDOM ) {\n#ifdef DEBUG\n\t\tprintf( \"vips_foreign_load_temp: partial sequential temp\\n\" );\n#endif /*DEBUG*/\n\n\t\treturn( vips_image_new() );\n\t}\n\n\t/* ->memory used to be called ->disc and default TRUE. If it's been\n\t * forced FALSE, set memory TRUE.\n\t */\n\tif( !load->disc )\n\t\tload->memory = TRUE;\n\n\t/* We open via disc if:\n\t * - 'memory' is off\n\t * - the uncompressed image will be larger than \n\t *   vips_get_disc_threshold()\n\t */\n\tif( !load->memory && \n\t\timage_size > disc_threshold ) {\n#ifdef DEBUG\n\t\tprintf( \"vips_foreign_load_temp: disc temp\\n\" );\n#endif /*DEBUG*/\n\n\t\treturn( vips_image_new_temp_file( \"%s.v\" ) );\n\t}\n\n#ifdef DEBUG\n\tprintf( \"vips_foreign_load_temp: memory temp\\n\" );\n#endif /*DEBUG*/\n\n\t/* Otherwise, fall back to a memory buffer.\n\t */\n\treturn( vips_image_new_memory() );\n}\n\n/* Check two images for compatibility: their geometries need to match.\n */\nstatic gboolean\nvips_foreign_load_iscompat( VipsImage *a, VipsImage *b )\n{\n\tif( a->Xsize != b->Xsize ||\n\t\ta->Ysize != b->Ysize ||\n\t\ta->Bands != b->Bands ||\n\t\ta->Coding != b->Coding ||\n\t\ta->BandFmt != b->BandFmt ) {\n\t\tvips_error( \"VipsForeignLoad\",\n\t\t\t\"%s\", _( \"images do not match\" ) ); \n\t\treturn( FALSE );\n\t}\n\n\treturn( TRUE );\n}\n\n/* Our start function ... do the lazy open, if necessary, and return a region\n * on the new image.\n */\nstatic void *\nvips_foreign_load_start( VipsImage *out, void *a, void *b )\n{\n\tVipsForeignLoad *load = VIPS_FOREIGN_LOAD( b );\n\tVipsForeignLoadClass *class = VIPS_FOREIGN_LOAD_GET_CLASS( load );\n\n\tif( !load->real ) {\n\t\tif( !(load->real = vips_foreign_load_temp( load )) )\n\t\t\treturn( NULL );\n\n#ifdef DEBUG\n\t\tprintf( \"vips_foreign_load_start: triggering ->load()\\n\" );\n#endif /*DEBUG*/\n\n\t\t/* Read the image in. This may involve a long computation and\n\t\t * will finish with load->real holding the decompressed image. \n\t\t *\n\t\t * We want our caller to be able to see this computation on\n\t\t * @out, so eval signals on ->real need to appear on ->out.\n\t\t */\n\t\tload->real->progress_signal = load->out;\n\n\t\t/* Note the load object on the image. Loaders can use \n\t\t * this to signal invalidate if they hit a load error. See\n\t\t * vips_foreign_load_invalidate() below.\n\t\t */\n\t\tg_object_set_qdata( G_OBJECT( load->real ), \n\t\t\tvips__foreign_load_operation, load ); \n\n\t\tif( class->load( load ) ||\n\t\t\tvips_image_pio_input( load->real ) ) \n\t\t\treturn( NULL );\n\n\t\t/* ->header() read the header into @out, load has read the\n\t\t * image into @real. They must match exactly in size, bands,\n\t\t * format and coding for the copy to work.  \n\t\t *\n\t\t * Some versions of ImageMagick give different results between\n\t\t * Ping and Load for some formats, for example.\n\t\t */\n\t\tif( !vips_foreign_load_iscompat( load->real, out ) )\n\t\t\treturn( NULL );\n\n\t\t/* We have to tell vips that out depends on real. We've set\n\t\t * the demand hint below, but not given an input there.\n\t\t */\n\t\tvips_image_pipelinev( load->out, load->out->dhint, \n\t\t\tload->real, NULL );\n\t}\n\n\treturn( vips_region_new( load->real ) );\n}\n\n/* Just pointer-copy.\n */\nstatic int\nvips_foreign_load_generate( VipsRegion *or, \n\tvoid *seq, void *a, void *b, gboolean *stop )\n{\n\tVipsRegion *ir = (VipsRegion *) seq;\n\n        VipsRect *r = &or->valid;\n\n        /* Ask for input we need.\n         */\n        if( vips_region_prepare( ir, r ) )\n                return( -1 );\n\n        /* Attach output region to that.\n         */\n        if( vips_region_region( or, ir, r, r->left, r->top ) )\n                return( -1 );\n\n        return( 0 );\n}\n\nstatic int\nvips_foreign_load_build( VipsObject *object )\n{\n\tVipsObjectClass *class = VIPS_OBJECT_GET_CLASS( object );\n\tVipsForeignLoad *load = VIPS_FOREIGN_LOAD( object );\n\tVipsForeignLoadClass *fclass = VIPS_FOREIGN_LOAD_GET_CLASS( object );\n\n\tVipsForeignFlags flags;\n\n#ifdef DEBUG\n\tprintf( \"vips_foreign_load_build:\\n\" );\n#endif /*DEBUG*/\n\n\tflags = 0;\n\tif( fclass->get_flags )\n\t\tflags |= fclass->get_flags( load );\n\n\tif( (flags & VIPS_FOREIGN_PARTIAL) &&\n\t\t(flags & VIPS_FOREIGN_SEQUENTIAL) ) {\n\t\tg_warning( \"%s\", \n\t\t\t_( \"VIPS_FOREIGN_PARTIAL and VIPS_FOREIGN_SEQUENTIAL \"\n\t\t\t\t\"both set -- using SEQUENTIAL\" ) );\n\t\tflags ^= VIPS_FOREIGN_PARTIAL;\n\t}\n\n\tg_object_set( load, \"flags\", flags, NULL );\n\n\t/* If the loader can do sequential mode and sequential has been\n\t * requested, we need to block caching.\n\t */\n\tif( (load->flags & VIPS_FOREIGN_SEQUENTIAL) && \n\t\tload->access != VIPS_ACCESS_RANDOM ) \n\t\tload->nocache = TRUE;\n\n\tif( VIPS_OBJECT_CLASS( vips_foreign_load_parent_class )->\n\t\tbuild( object ) )\n\t\treturn( -1 );\n\n\tif( load->sequential ) \n\t\tg_warning( \"%s\", \n\t\t\t_( \"ignoring deprecated \\\"sequential\\\" mode -- \"\n\t\t\t\t\"please use \\\"access\\\" instead\" ) ); \n\n\tg_object_set( object, \"out\", vips_image_new(), NULL ); \n\n\tvips_image_set_string( load->out, \n\t\tVIPS_META_LOADER, class->nickname );\n\n#ifdef DEBUG\n\tprintf( \"vips_foreign_load_build: triggering ->header()\\n\" );\n#endif /*DEBUG*/\n\n\t/* Read the header into @out.\n\t */\n\tif( fclass->header &&\n\t\tfclass->header( load ) ) \n\t\treturn( -1 );\n\n\t/* If there's no ->load() method then the header read has done\n\t * everything. Otherwise, it's just set fields and we must also\n\t * load pixels.\n\t *\n\t * Delay the load until the first pixel is requested by doing the work\n\t * in the start function of the copy.\n\t */\n\tif( fclass->load ) {\n#ifdef DEBUG\n\t\tprintf( \"vips_foreign_load_build: delaying read ...\\n\" );\n#endif /*DEBUG*/\n\n\t\t/* ->header() should set the dhint. It'll default to the safe\n\t\t * SMALLTILE if header() did not set it.\n\t\t */\n\t\tvips_image_pipelinev( load->out, load->out->dhint, NULL );\n\n\t\t/* Then 'start' creates the real image and 'gen' fetches \n\t\t * pixels for @out from @real on demand.\n\t\t */\n\t\tif( vips_image_generate( load->out, \n\t\t\tvips_foreign_load_start, \n\t\t\tvips_foreign_load_generate, \n\t\t\tvips_stop_one, \n\t\t\tNULL, load ) ) \n\t\t\treturn( -1 );\n\t}\n\n\t/* If random access has been requested, make sure that we don't have a\n\t * SEQ tag left from a sequential loader.\n\t */\n\tif( load->access == VIPS_ACCESS_RANDOM ) \n\t\t(void) vips_image_remove( load->out, VIPS_META_SEQUENTIAL );\n\n\treturn( 0 );\n}\n\nstatic VipsOperationFlags \nvips_foreign_load_operation_get_flags( VipsOperation *operation )\n{\n\tVipsForeignLoad *load = VIPS_FOREIGN_LOAD( operation );\n\n\tVipsOperationFlags flags;\n\n\tflags = VIPS_OPERATION_CLASS( vips_foreign_load_parent_class )->\n\t\tget_flags( operation );\n\tif( load->nocache )\n\t\tflags |= VIPS_OPERATION_NOCACHE;\n\n\treturn( flags );\n}\n\nstatic void\nvips_foreign_load_class_init( VipsForeignLoadClass *class )\n{\n\tGObjectClass *gobject_class = G_OBJECT_CLASS( class );\n\tVipsObjectClass *object_class = (VipsObjectClass *) class;\n\tVipsOperationClass *operation_class = (VipsOperationClass *) class;\n\n\tgobject_class->dispose = vips_foreign_load_dispose;\n\tgobject_class->set_property = vips_object_set_property;\n\tgobject_class->get_property = vips_object_get_property;\n\n\tobject_class->build = vips_foreign_load_build;\n\tobject_class->summary_class = vips_foreign_load_summary_class;\n\tobject_class->new_from_string = vips_foreign_load_new_from_string;\n\tobject_class->nickname = \"fileload\";\n\tobject_class->description = _( \"file loaders\" );\n\n\toperation_class->get_flags = vips_foreign_load_operation_get_flags;\n\n\tVIPS_ARG_IMAGE( class, \"out\", 2, \n\t\t_( \"Output\" ), \n\t\t_( \"Output image\" ),\n\t\tVIPS_ARGUMENT_REQUIRED_OUTPUT, \n\t\tG_STRUCT_OFFSET( VipsForeignLoad, out ) );\n\n\tVIPS_ARG_FLAGS( class, \"flags\", 6, \n\t\t_( \"Flags\" ), \n\t\t_( \"Flags for this file\" ),\n\t\tVIPS_ARGUMENT_OPTIONAL_OUTPUT,\n\t\tG_STRUCT_OFFSET( VipsForeignLoad, flags ),\n\t\tVIPS_TYPE_FOREIGN_FLAGS, VIPS_FOREIGN_NONE ); \n\n\tVIPS_ARG_BOOL( class, \"memory\", 7, \n\t\t_( \"Memory\" ), \n\t\t_( \"Force open via memory\" ),\n\t\tVIPS_ARGUMENT_OPTIONAL_INPUT,\n\t\tG_STRUCT_OFFSET( VipsForeignLoad, memory ),\n\t\tFALSE );\n\n\tVIPS_ARG_ENUM( class, \"access\", 8, \n\t\t_( \"Access\" ), \n\t\t_( \"Required access pattern for this file\" ),\n\t\tVIPS_ARGUMENT_OPTIONAL_INPUT,\n\t\tG_STRUCT_OFFSET( VipsForeignLoad, access ),\n\t\tVIPS_TYPE_ACCESS, VIPS_ACCESS_RANDOM ); \n\n\tVIPS_ARG_BOOL( class, \"sequential\", 10, \n\t\t_( \"Sequential\" ), \n\t\t_( \"Sequential read only\" ),\n\t\tVIPS_ARGUMENT_OPTIONAL_INPUT | VIPS_ARGUMENT_DEPRECATED,\n\t\tG_STRUCT_OFFSET( VipsForeignLoad, sequential ),\n\t\tFALSE );\n\n\tVIPS_ARG_BOOL( class, \"fail\", 11, \n\t\t_( \"Fail\" ), \n\t\t_( \"Fail on first error\" ),\n\t\tVIPS_ARGUMENT_OPTIONAL_INPUT,\n\t\tG_STRUCT_OFFSET( VipsForeignLoad, fail ),\n\t\tFALSE );\n\n\tVIPS_ARG_BOOL( class, \"disc\", 12, \n\t\t_( \"Disc\" ), \n\t\t_( \"Open to disc\" ),\n\t\tVIPS_ARGUMENT_OPTIONAL_INPUT | VIPS_ARGUMENT_DEPRECATED,\n\t\tG_STRUCT_OFFSET( VipsForeignLoad, disc ),\n\t\tTRUE );\n\n}\n\nstatic void\nvips_foreign_load_init( VipsForeignLoad *load )\n{\n\tload->disc = TRUE;\n\tload->access = VIPS_ACCESS_RANDOM;\n}\n\n/*\n * Loaders can call this\n */\n\n/**\n * vips_foreign_load_invalidate: (method)\n * @image: image to invalidate\n *\n * Loaders can call this on the image they are making if they see a read error\n * from the load library. It signals \"invalidate\" on the load operation and\n * will cause it to be dropped from cache. \n *\n * If we know a file will cause a read error, we don't want to cache the\n * failing operation, we want to make sure the image will really be opened \n * again if our caller tries again. For example, a broken file might be \n * replaced by a working one. \n */\nvoid\nvips_foreign_load_invalidate( VipsImage *image )\n{\n\tVipsOperation *operation; \n\n#ifdef DEBUG\n\tprintf( \"vips_foreign_load_invalidate: %p\\n\", image ); \n#endif /*DEBUG*/\n\n\tif( (operation = g_object_get_qdata( G_OBJECT( image ), \n\t\tvips__foreign_load_operation )) ) {\n\t\tvips_operation_invalidate( operation ); \n\t}\n}\n\n/* Abstract base class for image savers.\n */\n\nG_DEFINE_ABSTRACT_TYPE( VipsForeignSave, vips_foreign_save, VIPS_TYPE_FOREIGN );\n\nstatic void\nvips_foreign_save_dispose( GObject *gobject )\n{\n\tVipsForeignSave *save = VIPS_FOREIGN_SAVE( gobject );\n\n\tVIPS_UNREF( save->ready );\n\n\tG_OBJECT_CLASS( vips_foreign_save_parent_class )->dispose( gobject );\n}\n\nstatic void\nvips_foreign_save_summary_class( VipsObjectClass *object_class, VipsBuf *buf )\n{\n\tVipsForeignSaveClass *class = VIPS_FOREIGN_SAVE_CLASS( object_class );\n\n\tVIPS_OBJECT_CLASS( vips_foreign_save_parent_class )->\n\t\tsummary_class( object_class, buf );\n\n\tvips_buf_appendf( buf, \", %s\", \n\t\tvips_enum_nick( VIPS_TYPE_SAVEABLE, class->saveable ) );\n}\n\nstatic VipsObject *\nvips_foreign_save_new_from_string( const char *string )\n{\n\tconst char *file_op;\n\tGType type;\n\tVipsForeignSave *save;\n\n\tif( !(file_op = vips_foreign_find_save( string )) )\n\t\treturn( NULL );\n\ttype = g_type_from_name( file_op );\n\tg_assert( type ); \n\n\tsave = VIPS_FOREIGN_SAVE( g_object_new( type, NULL ) );\n\tg_object_set( save,\n\t\t\"filename\", string,\n\t\tNULL );\n\n\treturn( VIPS_OBJECT( save ) );\n}\n\n/* Convert an image for saving. \n */\nint\nvips__foreign_convert_saveable( VipsImage *in, VipsImage **ready,\n\tVipsSaveable saveable, VipsBandFormat *format, VipsCoding *coding,\n\tVipsArrayDouble *background )\n{\n\t/* in holds a reference to the output of our chain as we build it.\n\t */\n\tg_object_ref( in );\n\n\t/* For coded images, can this class save the coding we are in now? \n\t * Nothing to do.\n\t */\n\tif( in->Coding != VIPS_CODING_NONE &&\n\t\tcoding[in->Coding] ) {\n\t\t*ready = in;\n\t\treturn( 0 );\n\t}\n\n\t/* For uncoded images, if this saver supports ANY bands and this \n\t * format we have nothing to do.\n\t */\n\tif( in->Coding == VIPS_CODING_NONE &&\n\t        saveable == VIPS_SAVEABLE_ANY &&\n\t\tformat[in->BandFmt] == in->BandFmt ) {\n\t\t*ready = in;\n\t\treturn( 0 );\n\t}\n\n\t/* Otherwise ... we need to decode and then (possibly) recode at the\n\t * end.\n\t */\n\n\t/* If this is an VIPS_CODING_LABQ, we can go straight to RGB.\n\t */\n\tif( in->Coding == VIPS_CODING_LABQ ) {\n\t\tVipsImage *out;\n\n\t\tif( vips_LabQ2sRGB( in, &out, NULL ) ) {\n\t\t\tg_object_unref( in );\n\t\t\treturn( -1 );\n\t\t}\n\t\tg_object_unref( in );\n\n\t\tin = out;\n\t}\n\n\t/* If this is an VIPS_CODING_RAD, we unpack to float. This could be\n\t * scRGB or XYZ. \n\t */\n\tif( in->Coding == VIPS_CODING_RAD ) {\n\t\tVipsImage *out;\n\n\t\tif( vips_rad2float( in, &out, NULL ) ) {\n\t\t\tg_object_unref( in );\n\t\t\treturn( -1 );\n\t\t}\n\t\tg_object_unref( in );\n\n\t\tin = out;\n\t}\n\n\t/* If the saver supports RAD, we need to go to scRGB or XYZ. \n\t */\n\tif( coding[VIPS_CODING_RAD] ) {\n\t\tif( in->Type != VIPS_INTERPRETATION_scRGB &&\n\t\t\tin->Type != VIPS_INTERPRETATION_XYZ ) {\n\t\t\tVipsImage *out;\n\n\t\t\tif( vips_colourspace( in, &out, \n\t\t\t\tVIPS_INTERPRETATION_scRGB, NULL ) ) {\n\t\t\t\tg_object_unref( in );\n\t\t\t\treturn( -1 );\n\t\t\t}\n\t\t\tg_object_unref( in );\n\n\t\t\tin = out;\n\t\t}\n\t}\n\n\t/* If this image is CMYK and the saver is RGB-only, use lcms to try to\n\t * import to XYZ. This will only work if the image has an embedded\n\t * profile. \n\t */\n\tif( in->Type == VIPS_INTERPRETATION_CMYK &&\n\t\tin->Bands >= 4 &&\n\t\t(saveable == VIPS_SAVEABLE_RGB ||\n\t\t saveable == VIPS_SAVEABLE_RGBA ||\n\t\t saveable == VIPS_SAVEABLE_RGBA_ONLY) ) { \n\t\tVipsImage *out;\n\n\t\tif( vips_icc_import( in, &out, \n\t\t\t\"pcs\", VIPS_PCS_XYZ,\n\t\t\tNULL ) ) {\n\t\t\tg_object_unref( in );\n\t\t\treturn( -1 );\n\t\t}\n\t\tg_object_unref( in );\n\n\t\tin = out;\n\n\t\t/* We've imported to PCS, we must remove the embedded profile,\n\t\t * since it no longer matches the image.\n\t\t *\n\t\t * For example, when converting CMYK JPG to RGB PNG, we need \n\t\t * to remove the CMYK profile on import, or the png writer will \n\t\t * try to attach it when we write the image as RGB.\n\t\t */\n\t\tvips_image_remove( in, VIPS_META_ICC_NAME );\n\t}\n\n\t/* If this is something other than CMYK or RAD, eg. maybe a LAB image,\n\t * we need to transform to RGB.\n\t */\n\tif( !coding[VIPS_CODING_RAD] &&\n\t\tin->Bands >= 3 &&\n\t\tin->Type != VIPS_INTERPRETATION_CMYK &&\n\t\tvips_colourspace_issupported( in ) &&\n\t\t(saveable == VIPS_SAVEABLE_RGB ||\n\t\t saveable == VIPS_SAVEABLE_RGBA ||\n\t\t saveable == VIPS_SAVEABLE_RGBA_ONLY ||\n\t\t saveable == VIPS_SAVEABLE_RGB_CMYK) ) { \n\t\tVipsImage *out;\n\t\tVipsInterpretation interpretation;\n\n\t\t/* Do we make RGB or RGB16? We don't want to squash a 16-bit\n\t\t * RGB down to 8 bits if the saver supports 16. \n\t\t */\n\t\tif( vips_band_format_is8bit( format[in->BandFmt] ) )\n\t\t\tinterpretation = VIPS_INTERPRETATION_sRGB;\n\t\telse\n\t\t\tinterpretation = VIPS_INTERPRETATION_RGB16;\n\n\t\tif( vips_colourspace( in, &out, interpretation, NULL ) ) {\n\t\t\tg_object_unref( in );\n\t\t\treturn( -1 );\n\t\t}\n\t\tg_object_unref( in );\n\n\t\tin = out;\n\t}\n\n\t/* VIPS_SAVEABLE_RGBA_ONLY does not support 1 or 2 bands ... convert \n\t * to sRGB. \n\t */\n\tif( !coding[VIPS_CODING_RAD] &&\n\t\tin->Bands < 3 &&\n\t\tvips_colourspace_issupported( in ) &&\n\t\tsaveable == VIPS_SAVEABLE_RGBA_ONLY ) { \n\t\tVipsImage *out;\n\t\tVipsInterpretation interpretation;\n\n\t\t/* Do we make RGB or RGB16? We don't want to squash a 16-bit\n\t\t * RGB down to 8 bits if the saver supports 16. \n\t\t */\n\t\tif( vips_band_format_is8bit( format[in->BandFmt] ) )\n\t\t\tinterpretation = VIPS_INTERPRETATION_sRGB;\n\t\telse\n\t\t\tinterpretation = VIPS_INTERPRETATION_RGB16;\n\n\t\tif( vips_colourspace( in, &out, interpretation, NULL ) ) {\n\t\t\tg_object_unref( in );\n\t\t\treturn( -1 );\n\t\t}\n\t\tg_object_unref( in );\n\n\t\tin = out;\n\t}\n\n\t/* Get the bands right. We must do this after all colourspace\n\t * transforms, since they can change the number of bands. \n\t */\n\tif( in->Coding == VIPS_CODING_NONE ) {\n\t\t/* Do we need to flatten out an alpha channel? There needs to\n\t\t * be an alpha there now, and this writer needs to not support\n\t\t * alpha.\n\t\t */\n\t\tif( (in->Bands == 2 ||\n\t\t\t(in->Bands == 4 && \n\t\t\t in->Type != VIPS_INTERPRETATION_CMYK)) &&\n\t\t\t(saveable == VIPS_SAVEABLE_MONO ||\n\t\t\t saveable == VIPS_SAVEABLE_RGB ||\n\t\t\t saveable == VIPS_SAVEABLE_RGB_CMYK) ) {\n\t\t\tVipsImage *out;\n\n\t\t\tif( vips_flatten( in, &out, \n\t\t\t\t\"background\", background,\n\t\t\t\tNULL ) ) {\n\t\t\t\tg_object_unref( in );\n\t\t\t\treturn( -1 );\n\t\t\t}\n\t\t\tg_object_unref( in );\n\n\t\t\tin = out;\n\t\t}\n\n\t\t/* Other alpha removal strategies ... just drop the extra\n\t\t * bands.\n\t\t */\n\n\t\telse if( in->Bands > 3 && \n\t\t\t(saveable == VIPS_SAVEABLE_RGB ||\n\t\t\t (saveable == VIPS_SAVEABLE_RGB_CMYK &&\n\t\t\t  in->Type != VIPS_INTERPRETATION_CMYK)) ) { \n\t\t\tVipsImage *out;\n\n\t\t\t/* Don't let 4 bands though unless the image really is\n\t\t\t * a CMYK.\n\t\t\t *\n\t\t\t * Consider a RGBA png being saved as JPG. We can\n\t\t\t * write CMYK jpg, but we mustn't do that for RGBA\n\t\t\t * images.\n\t\t\t */\n\t\t\tif( vips_extract_band( in, &out, 0, \n\t\t\t\t\"n\", 3,\n\t\t\t\tNULL ) ) {\n\t\t\t\tg_object_unref( in );\n\t\t\t\treturn( -1 );\n\t\t\t}\n\t\t\tg_object_unref( in );\n\n\t\t\tin = out;\n\t\t}\n\t\telse if( in->Bands > 4 && \n\t\t\t((saveable == VIPS_SAVEABLE_RGB_CMYK &&\n\t\t\t  in->Type == VIPS_INTERPRETATION_CMYK) ||\n\t\t\t saveable == VIPS_SAVEABLE_RGBA ||\n\t\t\t saveable == VIPS_SAVEABLE_RGBA_ONLY) ) {\n\t\t\tVipsImage *out;\n\n\t\t\tif( vips_extract_band( in, &out, 0, \n\t\t\t\t\"n\", 4,\n\t\t\t\tNULL ) ) {\n\t\t\t\tg_object_unref( in );\n\t\t\t\treturn( -1 );\n\t\t\t}\n\t\t\tg_object_unref( in );\n\n\t\t\tin = out;\n\t\t}\n\t\telse if( in->Bands > 1 && \n\t\t\tsaveable == VIPS_SAVEABLE_MONO ) {\n\t\t\tVipsImage *out;\n\n\t\t\tif( vips_extract_band( in, &out, 0, NULL ) ) {\n\t\t\t\tg_object_unref( in );\n\t\t\t\treturn( -1 );\n\t\t\t}\n\t\t\tg_object_unref( in );\n\n\t\t\tin = out;\n\t\t}\n\n\t\t/* Else we have VIPS_SAVEABLE_ANY and we don't chop bands down.\n\t\t */\n\t}\n\n\t/* Handle the ushort interpretations.\n\t *\n\t * RGB16 and GREY16 use 0-65535 for black-white. If we have an image\n\t * tagged like this, and it has more than 8 bits (we leave crazy uchar\n\t * images tagged as RGB16 alone), we'll need to get it ready for the\n\t * saver.\n\t */\n\tif( (in->Type == VIPS_INTERPRETATION_RGB16 ||\n\t\t in->Type == VIPS_INTERPRETATION_GREY16) &&\n\t\t!vips_band_format_is8bit( in->BandFmt ) ) {\n\t\t/* If the saver supports ushort, cast to ushort. It may be\n\t\t * float at the moment, for example.\n\t\t *\n\t\t * If the saver does not support ushort, automatically shift\n\t\t * it down. This is the behaviour we want for saving an RGB16\n\t\t * image as JPG, for example.\n\t\t */\n\t\tif( format[VIPS_FORMAT_USHORT] == VIPS_FORMAT_USHORT ) {\n\t\t\tVipsImage *out;\n\n\t\t\tif( vips_cast( in, &out, VIPS_FORMAT_USHORT, NULL ) ) {\n\t\t\t\tg_object_unref( in );\n\t\t\t\treturn( -1 );\n\t\t\t}\n\t\t\tg_object_unref( in );\n\n\t\t\tin = out;\n\t\t}\n\t\telse {\n\t\t\tVipsImage *out;\n\n\t\t\tif( vips_rshift_const1( in, &out, 8, NULL ) ) { \n\t\t\t\tg_object_unref( in );\n\t\t\t\treturn( -1 );\n\t\t\t}\n\t\t\tg_object_unref( in );\n\n\t\t\tin = out;\n\n\t\t\t/* That could have produced an int image ... make sure \n\t\t\t * we are now uchar.\n\t\t\t */\n\t\t\tif( vips_cast( in, &out, VIPS_FORMAT_UCHAR, NULL ) ) {\n\t\t\t\tg_object_unref( in );\n\t\t\t\treturn( -1 );\n\t\t\t}\n\t\t\tg_object_unref( in );\n\n\t\t\tin = out;\n\t\t}\n\t}\n\n\t/* Cast to the output format.\n\t */\n\t{\n\t\tVipsImage *out;\n\n\t\tif( vips_cast( in, &out, format[in->BandFmt], NULL ) ) {\n\t\t\tg_object_unref( in );\n\t\t\treturn( -1 );\n\t\t}\n\t\tg_object_unref( in );\n\n\t\tin = out;\n\t}\n\n\t/* Does this class want a coded image? Search the coding table for the\n\t * first one.\n\t */\n\tif( coding[VIPS_CODING_NONE] ) {\n\t\t/* Already NONE, nothing to do.\n\t\t */\n\t}\n\telse if( coding[VIPS_CODING_LABQ] ) {\n\t\tVipsImage *out;\n\n\t\tif( vips_Lab2LabQ( in, &out, NULL ) ) {\n\t\t\tg_object_unref( in );\n\t\t\treturn( -1 );\n\t\t}\n\t\tg_object_unref( in );\n\n\t\tin = out;\n\t}\n\telse if( coding[VIPS_CODING_RAD] ) {\n\t\tVipsImage *out;\n\n\t\tif( vips_float2rad( in, &out, NULL ) ) {\n\t\t\tg_object_unref( in );\n\t\t\treturn( -1 );\n\t\t}\n\t\tg_object_unref( in );\n\n\t\tin = out;\n\t}\n\n\t*ready = in;\n\n\treturn( 0 );\n}\n\nstatic int\nvips_foreign_save_build( VipsObject *object )\n{\n\tVipsForeignSave *save = VIPS_FOREIGN_SAVE( object );\n\n\tif( save->in ) {\n\t\tVipsForeignSaveClass *class = \n\t\t\tVIPS_FOREIGN_SAVE_GET_CLASS( save );\n\t\tVipsImage *ready;\n\n\t\tif( vips__foreign_convert_saveable( save->in, &ready,\n\t\t\tclass->saveable, class->format_table, class->coding,\n\t\t\tsave->background ) )\n\t\t\treturn( -1 );\n\n\t\tif( save->page_height )\n\t\t\tvips_image_set_int( ready, \n\t\t\t\tVIPS_META_PAGE_HEIGHT, save->page_height );\n\n\t\tVIPS_UNREF( save->ready );\n\t\tsave->ready = ready;\n\t}\n\n\tif( VIPS_OBJECT_CLASS( vips_foreign_save_parent_class )->\n\t\tbuild( object ) )\n\t\treturn( -1 );\n\n\treturn( 0 );\n}\n\n#define UC VIPS_FORMAT_UCHAR\n#define C VIPS_FORMAT_CHAR\n#define US VIPS_FORMAT_USHORT\n#define S VIPS_FORMAT_SHORT\n#define UI VIPS_FORMAT_UINT\n#define I VIPS_FORMAT_INT\n#define F VIPS_FORMAT_FLOAT\n#define X VIPS_FORMAT_COMPLEX\n#define D VIPS_FORMAT_DOUBLE\n#define DX VIPS_FORMAT_DPCOMPLEX\n\nstatic int vips_foreign_save_format_table[10] = {\n// UC  C   US  S   UI  I  F  X  D  DX \n   UC, C,  US, S,  UI, I, F, X, D, DX\n};\n\nstatic void\nvips_foreign_save_class_init( VipsForeignSaveClass *class )\n{\n\tGObjectClass *gobject_class = G_OBJECT_CLASS( class );\n\tVipsObjectClass *object_class = (VipsObjectClass *) class;\n\tVipsOperationClass *operation_class = (VipsOperationClass *) class;\n\n\tint i;\n\n\tgobject_class->dispose = vips_foreign_save_dispose;\n\tgobject_class->set_property = vips_object_set_property;\n\tgobject_class->get_property = vips_object_get_property;\n\n\tobject_class->build = vips_foreign_save_build;\n\tobject_class->summary_class = vips_foreign_save_summary_class;\n\tobject_class->new_from_string = vips_foreign_save_new_from_string;\n\tobject_class->nickname = \"filesave\";\n\tobject_class->description = _( \"file savers\" );\n\n\t/* All savers are sequential by definition. Things like tiled tiff \n\t * write and interlaced png write, which are not, add extra caches \n\t * on their input. \n\t */\n\toperation_class->flags |= VIPS_OPERATION_SEQUENTIAL;\n\n\t/* Must not cache savers.\n\t */\n\toperation_class->flags |= VIPS_OPERATION_NOCACHE;\n\n\t/* Default to no coding allowed.\n\t */\n\tfor( i = 0; i < VIPS_CODING_LAST; i++ )\n\t\tclass->coding[i] = FALSE;\n\tclass->coding[VIPS_CODING_NONE] = TRUE;\n\n\t/* Default to no cast on save.\n\t */\n\tclass->format_table = vips_foreign_save_format_table; \n\n\tVIPS_ARG_IMAGE( class, \"in\", 0, \n\t\t_( \"Input\" ), \n\t\t_( \"Image to save\" ),\n\t\tVIPS_ARGUMENT_REQUIRED_INPUT,\n\t\tG_STRUCT_OFFSET( VipsForeignSave, in ) );\n\n\tVIPS_ARG_BOOL( class, \"strip\", 100,\n\t\t_( \"Strip\" ),\n\t\t_( \"Strip all metadata from image\" ),\n\t\tVIPS_ARGUMENT_OPTIONAL_INPUT,\n\t\tG_STRUCT_OFFSET( VipsForeignSave, strip ),\n\t\tFALSE );\n\n\tVIPS_ARG_BOXED( class, \"background\", 101, \n\t\t_( \"Background\" ), \n\t\t_( \"Background value\" ),\n\t\tVIPS_ARGUMENT_OPTIONAL_INPUT,\n\t\tG_STRUCT_OFFSET( VipsForeignSave, background ),\n\t\tVIPS_TYPE_ARRAY_DOUBLE );\n\n\tVIPS_ARG_INT( class, \"page_height\", 8, \n\t\t_( \"Page height\" ), \n\t\t_( \"Set page height for multipage save\" ),\n\t\tVIPS_ARGUMENT_OPTIONAL_INPUT,\n\t\tG_STRUCT_OFFSET( VipsForeignSave, page_height ),\n\t\t0, VIPS_MAX_COORD, 0 ); \n}\n\nstatic void\nvips_foreign_save_init( VipsForeignSave *save )\n{\n\tsave->background = vips_array_double_newv( 1, 0.0 );\n}\n\n/* Can we write this filename with this file? \n */\nstatic void *\nvips_foreign_find_save_sub( VipsForeignSaveClass *save_class, \n\tconst char *filename )\n{\n\tVipsForeignClass *class = VIPS_FOREIGN_CLASS( save_class );\n\n\t/* The suffs might be defined on an abstract base class, make sure we\n\t * don't pick that.\n\t */\n\tif( !G_TYPE_IS_ABSTRACT( G_TYPE_FROM_CLASS( class ) ) &&\n\t\tclass->suffs &&\n\t\tvips_filename_suffix_match( filename, class->suffs ) )\n\t\treturn( save_class );\n\n\treturn( NULL );\n}\n\n/**\n * vips_foreign_find_save:\n * @filename: name to find a saver for\n *\n * Searches for an operation you could use to write to @filename.\n * Any trailing options on @filename are stripped and ignored. \n *\n * See also: vips_foreign_find_save_buffer(), vips_image_write_to_file().\n *\n * Returns: the name of an operation on success, %NULL on error\n */\nconst char *\nvips_foreign_find_save( const char *name )\n{\n\tchar filename[VIPS_PATH_MAX];\n\tchar option_string[VIPS_PATH_MAX];\n\tVipsForeignSaveClass *save_class;\n\n\tvips__filename_split8( name, filename, option_string );\n\n\tif( !(save_class = (VipsForeignSaveClass *) vips_foreign_map( \n\t\t\"VipsForeignSave\",\n\t\t(VipsSListMap2Fn) vips_foreign_find_save_sub, \n\t\t(void *) filename, NULL )) ) {\n\t\tvips_error( \"VipsForeignSave\",\n\t\t\t_( \"\\\"%s\\\" is not a known file format\" ), name );\n\n\t\treturn( NULL );\n\t}\n\n\treturn( G_OBJECT_CLASS_NAME( save_class ) );\n}\n\n/* Kept for early vips8 API compat.\n */\n\nint\nvips_foreign_save( VipsImage *in, const char *name, ... )\n{\n\tchar filename[VIPS_PATH_MAX];\n\tchar option_string[VIPS_PATH_MAX];\n\tconst char *operation_name;\n\tva_list ap;\n\tint result;\n\n\tvips__filename_split8( name, filename, option_string );\n\n\tif( !(operation_name = vips_foreign_find_save( filename )) )\n\t\treturn( -1 );\n\n\tva_start( ap, name );\n\tresult = vips_call_split_option_string( operation_name, option_string, \n\t\tap, in, filename );\n\tva_end( ap );\n\n\treturn( result );\n}\n\n/* Can we write this buffer with this file type?\n */\nstatic void *\nvips_foreign_find_save_buffer_sub( VipsForeignSaveClass *save_class, \n\tconst char *suffix )\n{\n\tVipsObjectClass *object_class = VIPS_OBJECT_CLASS( save_class );\n\tVipsForeignClass *class = VIPS_FOREIGN_CLASS( save_class );\n\n\tif( class->suffs &&\n\t\tvips_ispostfix( object_class->nickname, \"_buffer\" ) &&\n\t\tvips_filename_suffix_match( suffix, class->suffs ) )\n\t\treturn( save_class );\n\n\treturn( NULL );\n}\n\n/**\n * vips_foreign_find_save_buffer:\n * @suffix: name to find a saver for\n *\n * Searches for an operation you could use to write to a buffer in @suffix\n * format. \n *\n * See also: vips_image_write_to_buffer().\n *\n * Returns: the name of an operation on success, %NULL on error\n */\nconst char *\nvips_foreign_find_save_buffer( const char *name )\n{\n\tchar suffix[VIPS_PATH_MAX];\n\tchar option_string[VIPS_PATH_MAX];\n\tVipsForeignSaveClass *save_class;\n\n\tvips__filename_split8( name, suffix, option_string );\n\n\tif( !(save_class = (VipsForeignSaveClass *) vips_foreign_map( \n\t\t\"VipsForeignSave\",\n\t\t(VipsSListMap2Fn) vips_foreign_find_save_buffer_sub, \n\t\t(void *) suffix, NULL )) ) {\n\t\tvips_error( \"VipsForeignSave\",\n\t\t\t_( \"\\\"%s\\\" is not a known buffer format\" ), name );\n\n\t\treturn( NULL );\n\t}\n\n\treturn( G_OBJECT_CLASS_NAME( save_class ) );\n}\n\n/* Called from iofuncs to init all operations in this dir. Use a plugin system\n * instead?\n */\nvoid\nvips_foreign_operation_init( void )\n{\n\textern GType vips_foreign_load_rad_get_type( void ); \n\textern GType vips_foreign_save_rad_file_get_type( void ); \n\textern GType vips_foreign_save_rad_buffer_get_type( void ); \n\textern GType vips_foreign_load_mat_get_type( void ); \n\textern GType vips_foreign_load_ppm_get_type( void ); \n\textern GType vips_foreign_save_ppm_get_type( void ); \n\textern GType vips_foreign_load_png_get_type( void ); \n\textern GType vips_foreign_load_png_buffer_get_type( void ); \n\textern GType vips_foreign_save_png_file_get_type( void ); \n\textern GType vips_foreign_save_png_buffer_get_type( void ); \n\textern GType vips_foreign_load_csv_get_type( void ); \n\textern GType vips_foreign_save_csv_get_type( void ); \n\textern GType vips_foreign_load_matrix_get_type( void ); \n\textern GType vips_foreign_save_matrix_get_type( void ); \n\textern GType vips_foreign_print_matrix_get_type( void ); \n\textern GType vips_foreign_load_fits_get_type( void ); \n\textern GType vips_foreign_save_fits_get_type( void ); \n\textern GType vips_foreign_load_analyze_get_type( void ); \n\textern GType vips_foreign_load_openexr_get_type( void ); \n\textern GType vips_foreign_load_openslide_get_type( void ); \n\textern GType vips_foreign_load_jpeg_file_get_type( void ); \n\textern GType vips_foreign_load_jpeg_buffer_get_type( void ); \n\textern GType vips_foreign_save_jpeg_file_get_type( void ); \n\textern GType vips_foreign_save_jpeg_buffer_get_type( void ); \n\textern GType vips_foreign_save_jpeg_mime_get_type( void ); \n\textern GType vips_foreign_load_tiff_file_get_type( void ); \n\textern GType vips_foreign_load_tiff_buffer_get_type( void ); \n\textern GType vips_foreign_save_tiff_file_get_type( void ); \n\textern GType vips_foreign_save_tiff_buffer_get_type( void ); \n\textern GType vips_foreign_load_vips_get_type( void ); \n\textern GType vips_foreign_save_vips_get_type( void ); \n\textern GType vips_foreign_load_raw_get_type( void ); \n\textern GType vips_foreign_save_raw_get_type( void ); \n\textern GType vips_foreign_save_raw_fd_get_type( void ); \n\textern GType vips_foreign_load_magick_file_get_type( void ); \n\textern GType vips_foreign_load_magick_buffer_get_type( void ); \n\textern GType vips_foreign_load_magick7_file_get_type( void ); \n\textern GType vips_foreign_load_magick7_buffer_get_type( void ); \n\textern GType vips_foreign_save_dz_file_get_type( void ); \n\textern GType vips_foreign_save_dz_buffer_get_type( void ); \n\textern GType vips_foreign_load_webp_file_get_type( void ); \n\textern GType vips_foreign_load_webp_buffer_get_type( void ); \n\textern GType vips_foreign_save_webp_file_get_type( void ); \n\textern GType vips_foreign_save_webp_buffer_get_type( void ); \n\textern GType vips_foreign_load_pdf_get_type( void ); \n\textern GType vips_foreign_load_pdf_file_get_type( void ); \n\textern GType vips_foreign_load_pdf_buffer_get_type( void ); \n\textern GType vips_foreign_load_svg_get_type( void ); \n\textern GType vips_foreign_load_svg_file_get_type( void ); \n\textern GType vips_foreign_load_svg_buffer_get_type( void ); \n\textern GType vips_foreign_load_gif_get_type( void ); \n\textern GType vips_foreign_load_gif_file_get_type( void ); \n\textern GType vips_foreign_load_gif_buffer_get_type( void ); \n\n\tvips_foreign_load_csv_get_type(); \n\tvips_foreign_save_csv_get_type(); \n\tvips_foreign_load_matrix_get_type(); \n\tvips_foreign_save_matrix_get_type(); \n\tvips_foreign_print_matrix_get_type(); \n\tvips_foreign_load_raw_get_type(); \n\tvips_foreign_save_raw_get_type(); \n\tvips_foreign_save_raw_fd_get_type(); \n\tvips_foreign_load_vips_get_type(); \n\tvips_foreign_save_vips_get_type(); \n\n#ifdef HAVE_ANALYZE\n\tvips_foreign_load_analyze_get_type(); \n#endif /*HAVE_ANALYZE*/\n\n#ifdef HAVE_PPM\n\tvips_foreign_load_ppm_get_type(); \n\tvips_foreign_save_ppm_get_type(); \n#endif /*HAVE_PPM*/\n\n#ifdef HAVE_RADIANCE\n\tvips_foreign_load_rad_get_type(); \n\tvips_foreign_save_rad_file_get_type(); \n\tvips_foreign_save_rad_buffer_get_type(); \n#endif /*HAVE_RADIANCE*/\n\n#ifdef HAVE_POPPLER\n\tvips_foreign_load_pdf_get_type(); \n\tvips_foreign_load_pdf_file_get_type(); \n\tvips_foreign_load_pdf_buffer_get_type(); \n#endif /*HAVE_POPPLER*/\n\n#ifdef HAVE_RSVG\n\tvips_foreign_load_svg_get_type(); \n\tvips_foreign_load_svg_file_get_type(); \n\tvips_foreign_load_svg_buffer_get_type(); \n#endif /*HAVE_RSVG*/\n\n#ifdef HAVE_GIFLIB\n\tvips_foreign_load_gif_get_type(); \n\tvips_foreign_load_gif_file_get_type(); \n\tvips_foreign_load_gif_buffer_get_type(); \n#endif /*HAVE_GIFLIB*/\n\n#ifdef HAVE_GSF\n\tvips_foreign_save_dz_file_get_type(); \n\tvips_foreign_save_dz_buffer_get_type(); \n#endif /*HAVE_GSF*/\n\n#ifdef HAVE_PNG\n\tvips_foreign_load_png_get_type(); \n\tvips_foreign_load_png_buffer_get_type(); \n\tvips_foreign_save_png_file_get_type(); \n\tvips_foreign_save_png_buffer_get_type(); \n#endif /*HAVE_PNG*/\n\n#ifdef HAVE_MATIO\n\tvips_foreign_load_mat_get_type(); \n#endif /*HAVE_MATIO*/\n\n#ifdef HAVE_JPEG\n\tvips_foreign_load_jpeg_file_get_type(); \n\tvips_foreign_load_jpeg_buffer_get_type(); \n\tvips_foreign_save_jpeg_file_get_type(); \n\tvips_foreign_save_jpeg_buffer_get_type(); \n\tvips_foreign_save_jpeg_mime_get_type(); \n#endif /*HAVE_JPEG*/\n\n#ifdef HAVE_LIBWEBP\n\tvips_foreign_load_webp_file_get_type(); \n\tvips_foreign_load_webp_buffer_get_type(); \n\tvips_foreign_save_webp_file_get_type(); \n\tvips_foreign_save_webp_buffer_get_type(); \n#endif /*HAVE_LIBWEBP*/\n\n#ifdef HAVE_TIFF\n\tvips_foreign_load_tiff_file_get_type(); \n\tvips_foreign_load_tiff_buffer_get_type(); \n\tvips_foreign_save_tiff_file_get_type(); \n\tvips_foreign_save_tiff_buffer_get_type(); \n#endif /*HAVE_TIFF*/\n\n#ifdef HAVE_OPENSLIDE\n\tvips_foreign_load_openslide_get_type(); \n#endif /*HAVE_OPENSLIDE*/\n\n#ifdef HAVE_MAGICK\n\tvips_foreign_load_magick_file_get_type(); \n\tvips_foreign_load_magick_buffer_get_type(); \n#endif /*HAVE_MAGICK*/\n\n#ifdef HAVE_MAGICK7\n\tvips_foreign_load_magick7_file_get_type(); \n\tvips_foreign_load_magick7_buffer_get_type(); \n#endif /*HAVE_MAGICK7*/\n\n#ifdef HAVE_CFITSIO\n\tvips_foreign_load_fits_get_type(); \n\tvips_foreign_save_fits_get_type(); \n#endif /*HAVE_CFITSIO*/\n\n#ifdef HAVE_OPENEXR\n\tvips_foreign_load_openexr_get_type(); \n#endif /*HAVE_OPENEXR*/\n\n\tvips__foreign_load_operation = \n\t\tg_quark_from_static_string( \"vips-foreign-load-operation\" ); \n}\n", "/* Base type for supported image formats. Subclass this to add a new\n * format.\n */\n\n/*\n\n    This file is part of VIPS.\n    \n    VIPS is free software; you can redistribute it and/or modify\n    it under the terms of the GNU Lesser General Public License as published by\n    the Free Software Foundation; either version 2 of the License, or\n    (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Lesser General Public License for more details.\n\n    You should have received a copy of the GNU Lesser General Public License\n    along with this program; if not, write to the Free Software\n    Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA\n    02110-1301  USA\n\n */\n\n/*\n\n    These files are distributed with VIPS - http://www.vips.ecs.soton.ac.uk\n\n */\n\n#ifndef VIPS_FOREIGN_H\n#define VIPS_FOREIGN_H\n\n#ifdef __cplusplus\nextern \"C\" {\n#endif /*__cplusplus*/\n\n#define VIPS_TYPE_FOREIGN (vips_foreign_get_type())\n#define VIPS_FOREIGN( obj ) \\\n\t(G_TYPE_CHECK_INSTANCE_CAST( (obj), \\\n\tVIPS_TYPE_FOREIGN, VipsForeign ))\n#define VIPS_FOREIGN_CLASS( klass ) \\\n\t(G_TYPE_CHECK_CLASS_CAST( (klass), \\\n\tVIPS_TYPE_FOREIGN, VipsForeignClass))\n#define VIPS_IS_FOREIGN( obj ) \\\n\t(G_TYPE_CHECK_INSTANCE_TYPE( (obj), VIPS_TYPE_FOREIGN ))\n#define VIPS_IS_FOREIGN_CLASS( klass ) \\\n\t(G_TYPE_CHECK_CLASS_TYPE( (klass), VIPS_TYPE_FOREIGN ))\n#define VIPS_FOREIGN_GET_CLASS( obj ) \\\n\t(G_TYPE_INSTANCE_GET_CLASS( (obj), \\\n\tVIPS_TYPE_FOREIGN, VipsForeignClass ))\n\ntypedef struct _VipsForeign {\n\tVipsOperation parent_object;\n\n\t/*< public >*/\n\n} VipsForeign;\n\ntypedef struct _VipsForeignClass {\n\tVipsOperationClass parent_class;\n\n\t/*< public >*/\n\n\t/* Loop over formats in this order, default 0. We need this because\n\t * some formats can be read by several loaders (eg. tiff can be read\n\t * by the libMagick loader as well as by the tiff loader), and we want\n\t * to make sure the better loader comes first.\n\t */\n\tint priority;\n\n\t/* Null-terminated list of recommended suffixes, eg. \".tif\", \".tiff\".\n\t * This can be used by both load and save, so it's in the base class.\n\t */\n\tconst char **suffs;\n\n} VipsForeignClass;\n\n/* Don't put spaces around void here, it breaks gtk-doc.\n */\nGType vips_foreign_get_type(void);\n\n/* Map over and find formats. This uses type introspection to loop over\n * subclasses of VipsForeign.\n */\nvoid *vips_foreign_map( const char *base, \n\tVipsSListMap2Fn fn, void *a, void *b );\n\n/* Image file load properties. \n *\n * Keep in sync with the deprecated VipsFormatFlags, we need to be able to\n * cast between them.\n */\ntypedef enum /*< flags >*/ {\n\tVIPS_FOREIGN_NONE = 0,\t\t/* No flags set */\n\tVIPS_FOREIGN_PARTIAL = 1,\t/* Lazy read OK (eg. tiled tiff) */\n\tVIPS_FOREIGN_BIGENDIAN = 2,\t/* Most-significant byte first */\n\tVIPS_FOREIGN_SEQUENTIAL = 4,\t/* Top-to-bottom lazy read OK */\n\tVIPS_FOREIGN_ALL = 7\t\t/* All flags set */\n} VipsForeignFlags;\n\n#define VIPS_TYPE_FOREIGN_LOAD (vips_foreign_load_get_type())\n#define VIPS_FOREIGN_LOAD( obj ) \\\n\t(G_TYPE_CHECK_INSTANCE_CAST( (obj), \\\n\tVIPS_TYPE_FOREIGN_LOAD, VipsForeignLoad ))\n#define VIPS_FOREIGN_LOAD_CLASS( klass ) \\\n\t(G_TYPE_CHECK_CLASS_CAST( (klass), \\\n\tVIPS_TYPE_FOREIGN_LOAD, VipsForeignLoadClass))\n#define VIPS_IS_FOREIGN_LOAD( obj ) \\\n\t(G_TYPE_CHECK_INSTANCE_TYPE( (obj), VIPS_TYPE_FOREIGN_LOAD ))\n#define VIPS_IS_FOREIGN_LOAD_CLASS( klass ) \\\n\t(G_TYPE_CHECK_CLASS_TYPE( (klass), VIPS_TYPE_FOREIGN_LOAD ))\n#define VIPS_FOREIGN_LOAD_GET_CLASS( obj ) \\\n\t(G_TYPE_INSTANCE_GET_CLASS( (obj), \\\n\tVIPS_TYPE_FOREIGN_LOAD, VipsForeignLoadClass ))\n\ntypedef struct _VipsForeignLoad {\n\tVipsForeign parent_object;\n\t/*< private >*/\n\n\t/* Set TRUE to force open via memory. \n\t */\n\tgboolean memory;\n\n\t/* Type of access upstream wants and the loader must supply. \n\t */\n\tVipsAccess access;\n\n\t/* Flags for this load operation.\n\t */\n\tVipsForeignFlags flags;\n\n\t/* Stop load on first warning.\n\t */\n\tgboolean fail;\n\n\t/* Deprecated and unused, just here for compat.\n\t */\n\tgboolean sequential;\n\n\t/*< public >*/\n\n\t/* The image we generate. This must be set by ->header().\n\t */\n\tVipsImage *out;\n\n\t/* The behind-the-scenes real image we decompress to. This can be a\n\t * disc file or a memory buffer. This must be set by ->load().\n\t */\n\tVipsImage *real;\n\n\t/* Set this to tag the operation as nocache.\n\t */\n\tgboolean nocache;\n\n\t/* Deprecated: the memory option used to be called disc and default\n\t * TRUE.\n\t */\n\tgboolean disc;\n} VipsForeignLoad;\n\ntypedef struct _VipsForeignLoadClass {\n\tVipsForeignClass parent_class;\n\t/*< public >*/\n\n\t/* Is a file in this format. \n\t *\n\t * This function should return %TRUE if the file contains an image of \n\t * this type. If you don't define this function, #VipsForeignLoad\n\t * will use @suffs instead.\n\t */\n\tgboolean (*is_a)( const char *filename );\n\n\t/* Is a buffer in this format. \n\t *\n\t * This function should return %TRUE if the buffer contains an image of \n\t * this type. \n\t */\n\tgboolean (*is_a_buffer)( const void *data, size_t size );\n\n\t/* Get the flags from a filename. \n\t *\n\t * This function should examine the file and return a set\n\t * of flags. If you don't define it, vips will default to 0 (no flags \n\t * set).  \n\t *\n\t * This operation is necessary for vips7 compatibility. \n\t */\n\tVipsForeignFlags (*get_flags_filename)( const char *filename );\n\n\t/* Get the flags for this load operation. Images can be loaded from \n\t * (for example) memory areas rather than files, so you can't just use\n\t * @get_flags_filename().\n\t */\n\tVipsForeignFlags (*get_flags)( VipsForeignLoad *load );\n\n\t/* Do the minimum read we can. \n\t *\n\t * Set the header fields in @out from @filename. If you can read the \n\t * whole image as well with no performance cost (as with vipsload),\n\t * or if your loader does not support reading only the header, read\n\t * the entire image in this method and leave @load() NULL.\n\t *\n\t * @header() needs to set the dhint on the image .. otherwise you get \n\t * the default SMALLTILE.\n\t *\n\t * Return 0 for success, -1 for error, setting\n\t * vips_error().\n\t */\n\tint (*header)( VipsForeignLoad *load );\n\n\t/* Read the whole image into @real. The pixels will get copied to @out \n\t * later.\n\t *\n\t * You can omit this method if you define a @header() method which \n\t * loads the whole file. \n\t *\n\t * Return 0 for success, -1 for error, setting\n\t * vips_error().\n\t */\n\tint (*load)( VipsForeignLoad *load );\n} VipsForeignLoadClass;\n\n/* Don't put spaces around void here, it breaks gtk-doc.\n */\nGType vips_foreign_load_get_type(void);\n\nconst char *vips_foreign_find_load( const char *filename );\nconst char *vips_foreign_find_load_buffer( const void *data, size_t size );\n\nVipsForeignFlags vips_foreign_flags( const char *loader, const char *filename );\ngboolean vips_foreign_is_a( const char *loader, const char *filename );\ngboolean vips_foreign_is_a_buffer( const char *loader, \n\tconst void *data, size_t size );\n\nvoid vips_foreign_load_invalidate( VipsImage *image );\n\n#define VIPS_TYPE_FOREIGN_SAVE (vips_foreign_save_get_type())\n#define VIPS_FOREIGN_SAVE( obj ) \\\n\t(G_TYPE_CHECK_INSTANCE_CAST( (obj), \\\n\tVIPS_TYPE_FOREIGN_SAVE, VipsForeignSave ))\n#define VIPS_FOREIGN_SAVE_CLASS( klass ) \\\n\t(G_TYPE_CHECK_CLASS_CAST( (klass), \\\n\tVIPS_TYPE_FOREIGN_SAVE, VipsForeignSaveClass))\n#define VIPS_IS_FOREIGN_SAVE( obj ) \\\n\t(G_TYPE_CHECK_INSTANCE_TYPE( (obj), VIPS_TYPE_FOREIGN_SAVE ))\n#define VIPS_IS_FOREIGN_SAVE_CLASS( klass ) \\\n\t(G_TYPE_CHECK_CLASS_TYPE( (klass), VIPS_TYPE_FOREIGN_SAVE ))\n#define VIPS_FOREIGN_SAVE_GET_CLASS( obj ) \\\n\t(G_TYPE_INSTANCE_GET_CLASS( (obj), \\\n\tVIPS_TYPE_FOREIGN_SAVE, VipsForeignSaveClass ))\n\n/** \n * VipsSaveable:\n * @VIPS_SAVEABLE_MONO: 1 band (eg. CSV)\n * @VIPS_SAVEABLE_RGB: 1 or 3 bands (eg. PPM) \n * @VIPS_SAVEABLE_RGBA: 1, 2, 3 or 4 bands (eg. PNG)\n * @VIPS_SAVEABLE_RGBA_ONLY: 3 or 4 bands (eg. WEBP)\n * @VIPS_SAVEABLE_RGB_CMYK: 1, 3 or 4 bands (eg. JPEG)\n * @VIPS_SAVEABLE_ANY: any number of bands (eg. TIFF)\n *\n * See also: #VipsForeignSave.\n */\ntypedef enum {\n\tVIPS_SAVEABLE_MONO,\n\tVIPS_SAVEABLE_RGB,\n\tVIPS_SAVEABLE_RGBA,\n\tVIPS_SAVEABLE_RGBA_ONLY,\n\tVIPS_SAVEABLE_RGB_CMYK,\n\tVIPS_SAVEABLE_ANY,\n\tVIPS_SAVEABLE_LAST\n} VipsSaveable;\n\ntypedef struct _VipsForeignSave {\n\tVipsForeign parent_object;\n\n\t/* Don't attach metadata.\n\t */\n\tgboolean strip;\n\n\t/* If flattening out alpha, the background colour to use. Default to\n\t * 0 (black).\n\t */\n\tVipsArrayDouble *background;\n\n\t/* Set to non-zero to set the page size for multi-page save.\n\t */\n\tint page_height;\n\n\t/*< public >*/\n\n\t/* The image we are to save, as supplied by our caller. \n\t */\n\tVipsImage *in;\n\n\t/* @in converted to a saveable format (eg. 8-bit RGB) according to the\n\t * instructions you give in the class fields below.\n\t *\n\t * This is the image you should actually write to the output.\n\t */\n\tVipsImage *ready;\n\n} VipsForeignSave;\n\ntypedef struct _VipsForeignSaveClass {\n\tVipsForeignClass parent_class;\n\n\t/*< public >*/\n\n\t/* How this format treats bands.\n\t *\n\t * @saveable describes the bands that your saver can handle. For \n\t * example, PPM images can have 1 or 3 bands (mono or RGB), so it \n\t * uses #VIPS_SAVEABLE_RGB.\n\t */\n\tVipsSaveable saveable;\n\n\t/* How this format treats band formats.\n\t *\n\t * @format_table describes the band formats that your saver can \n\t * handle. For each of the 10 #VipsBandFormat values, the array \n\t * should give the format your saver will accept. \n\t */\n\tVipsBandFormat *format_table;\n\n\t/* The set of coding types this format can save. For example, jpeg can\n\t * only save NONE, so has NONE TRUE and RAD and LABQ FALSE.\n\t *\n\t * Default NONE TRUE, RAD and LABQ FALSE.\n\t */\n\tgboolean coding[VIPS_CODING_LAST];\n} VipsForeignSaveClass;\n\n/* Don't put spaces around void here, it breaks gtk-doc.\n */\nGType vips_foreign_save_get_type(void);\n\nconst char *vips_foreign_find_save( const char *filename );\nconst char *vips_foreign_find_save_buffer( const char *suffix );\n\nint vips_vipsload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\nint vips_vipssave( VipsImage *in, const char *filename, ... )\n\t__attribute__((sentinel));\n\nint vips_openslideload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\n\nint vips_jpegload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\nint vips_jpegload_buffer( void *buf, size_t len, VipsImage **out, ... )\n\t__attribute__((sentinel));\n\nint vips_jpegsave( VipsImage *in, const char *filename, ... )\n\t__attribute__((sentinel));\nint vips_jpegsave_buffer( VipsImage *in, void **buf, size_t *len, ... )\n\t__attribute__((sentinel));\nint vips_jpegsave_mime( VipsImage *in, ... )\n\t__attribute__((sentinel));\n\n/**\n * VipsForeignWebpPreset:\n * @VIPS_FOREIGN_WEBP_PRESET_DEFAULT: default preset\n * @VIPS_FOREIGN_WEBP_PRESET_PICTURE: digital picture, like portrait, inner shot\n * @VIPS_FOREIGN_WEBP_PRESET_PHOTO: outdoor photograph, with natural lighting\n * @VIPS_FOREIGN_WEBP_PRESET_DRAWING: hand or line drawing, with high-contrast details\n * @VIPS_FOREIGN_WEBP_PRESET_ICON: small-sized colorful images\n * @VIPS_FOREIGN_WEBP_PRESET_TEXT: text-like\n *\n * Tune lossy encoder settings for different image types.\n */\ntypedef enum {\n\tVIPS_FOREIGN_WEBP_PRESET_DEFAULT,\n\tVIPS_FOREIGN_WEBP_PRESET_PICTURE,\n\tVIPS_FOREIGN_WEBP_PRESET_PHOTO,\n\tVIPS_FOREIGN_WEBP_PRESET_DRAWING,\n\tVIPS_FOREIGN_WEBP_PRESET_ICON,\n\tVIPS_FOREIGN_WEBP_PRESET_TEXT,\n\tVIPS_FOREIGN_WEBP_PRESET_LAST\n} VipsForeignWebpPreset;\n\nint vips_webpload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\nint vips_webpload_buffer( void *buf, size_t len, VipsImage **out, ... )\n\t__attribute__((sentinel));\n\nint vips_webpsave( VipsImage *in, const char *filename, ... )\n\t__attribute__((sentinel));\nint vips_webpsave_buffer( VipsImage *in, void **buf, size_t *len, ... )\n\t__attribute__((sentinel));\nint vips_webpsave_mime( VipsImage *in, ... )\n\t__attribute__((sentinel));\n\n/**\n * VipsForeignTiffCompression:\n * @VIPS_FOREIGN_TIFF_COMPRESSION_NONE: no compression\n * @VIPS_FOREIGN_TIFF_COMPRESSION_JPEG: jpeg compression\n * @VIPS_FOREIGN_TIFF_COMPRESSION_DEFLATE: deflate (zip) compression\n * @VIPS_FOREIGN_TIFF_COMPRESSION_PACKBITS: packbits compression\n * @VIPS_FOREIGN_TIFF_COMPRESSION_CCITTFAX4: fax4 compression\n * @VIPS_FOREIGN_TIFF_COMPRESSION_LZW: LZW compression\n *\n * The compression types supported by the tiff writer.\n *\n * Use @Q to set the jpeg compression level, default 75.\n *\n * Use @prediction to set the lzw or deflate prediction, default none.\n */\ntypedef enum {\n\tVIPS_FOREIGN_TIFF_COMPRESSION_NONE,\n\tVIPS_FOREIGN_TIFF_COMPRESSION_JPEG,\n\tVIPS_FOREIGN_TIFF_COMPRESSION_DEFLATE,\n\tVIPS_FOREIGN_TIFF_COMPRESSION_PACKBITS,\n\tVIPS_FOREIGN_TIFF_COMPRESSION_CCITTFAX4,\n\tVIPS_FOREIGN_TIFF_COMPRESSION_LZW,\n\tVIPS_FOREIGN_TIFF_COMPRESSION_LAST\n} VipsForeignTiffCompression;\n\n/**\n * VipsForeignTiffPredictor:\n * @VIPS_FOREIGN_TIFF_PREDICTOR_NONE: no prediction\n * @VIPS_FOREIGN_TIFF_PREDICTOR_HORIZONTAL: horizontal differencing\n * @VIPS_FOREIGN_TIFF_PREDICTOR_FLOAT: float predictor\n *\n * The predictor can help deflate and lzw compression. The values are fixed by\n * the tiff library.\n */\ntypedef enum {\n\tVIPS_FOREIGN_TIFF_PREDICTOR_NONE = 1,\n\tVIPS_FOREIGN_TIFF_PREDICTOR_HORIZONTAL = 2,\n\tVIPS_FOREIGN_TIFF_PREDICTOR_FLOAT = 3,\n\tVIPS_FOREIGN_TIFF_PREDICTOR_LAST\n} VipsForeignTiffPredictor;\n\n/**\n * VipsForeignTiffResunit:\n * @VIPS_FOREIGN_TIFF_RESUNIT_CM: use centimeters\n * @VIPS_FOREIGN_TIFF_RESUNIT_INCH: use inches\n *\n * Use inches or centimeters as the resolution unit for a tiff file.\n */\ntypedef enum {\n\tVIPS_FOREIGN_TIFF_RESUNIT_CM,\n\tVIPS_FOREIGN_TIFF_RESUNIT_INCH,\n\tVIPS_FOREIGN_TIFF_RESUNIT_LAST\n} VipsForeignTiffResunit;\n\nint vips_tiffload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\nint vips_tiffload_buffer( void *buf, size_t len, VipsImage **out, ... )\n\t__attribute__((sentinel));\nint vips_tiffsave( VipsImage *in, const char *filename, ... )\n\t__attribute__((sentinel));\nint vips_tiffsave_buffer( VipsImage *in, void **buf, size_t *len, ... )\n\t__attribute__((sentinel));\n\nint vips_openexrload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\n\nint vips_fitsload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\nint vips_fitssave( VipsImage *in, const char *filename, ... )\n\t__attribute__((sentinel));\n\nint vips_analyzeload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\n\nint vips_rawload( const char *filename, VipsImage **out, \n\tint width, int height, int bands, ... )\n\t__attribute__((sentinel));\nint vips_rawsave( VipsImage *in, const char *filename, ... )\n\t__attribute__((sentinel));\nint vips_rawsave_fd( VipsImage *in, int fd, ... )\n\t__attribute__((sentinel));\n\nint vips_csvload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\nint vips_csvsave( VipsImage *in, const char *filename, ... )\n\t__attribute__((sentinel));\n\nint vips_matrixload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\nint vips_matrixsave( VipsImage *in, const char *filename, ... )\n\t__attribute__((sentinel));\nint vips_matrixprint( VipsImage *in, ... )\n\t__attribute__((sentinel));\n\nint vips_magickload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\nint vips_magickload_buffer( void *buf, size_t len, VipsImage **out, ... )\n\t__attribute__((sentinel));\n\n/**\n * VipsForeignPngFilter:\n * @VIPS_FOREIGN_PNG_FILTER_NONE: no filtering\n * @VIPS_FOREIGN_PNG_FILTER_SUB: difference to the left\n * @VIPS_FOREIGN_PNG_FILTER_UP: difference up\n * @VIPS_FOREIGN_PNG_FILTER_AVG: average of left and up\n * @VIPS_FOREIGN_PNG_FILTER_PAETH: pick best neighbor predictor automatically\n * @VIPS_FOREIGN_PNG_FILTER_ALL: adaptive\n *\n * http://www.w3.org/TR/PNG-Filters.html\n * The values mirror those of png.h in libpng.\n */\ntypedef enum /*< flags >*/ {\n\tVIPS_FOREIGN_PNG_FILTER_NONE = 0x08,\n\tVIPS_FOREIGN_PNG_FILTER_SUB = 0x10,\n\tVIPS_FOREIGN_PNG_FILTER_UP = 0x20,\n\tVIPS_FOREIGN_PNG_FILTER_AVG = 0x40,\n\tVIPS_FOREIGN_PNG_FILTER_PAETH = 0x80,\n\tVIPS_FOREIGN_PNG_FILTER_ALL = 0xEA\n} VipsForeignPngFilter;\n\nint vips_pngload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\nint vips_pngload_buffer( void *buf, size_t len, VipsImage **out, ... )\n\t__attribute__((sentinel));\nint vips_pngsave( VipsImage *in, const char *filename, ... )\n\t__attribute__((sentinel));\nint vips_pngsave_buffer( VipsImage *in, void **buf, size_t *len, ... )\n\t__attribute__((sentinel));\n\nint vips_ppmload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\nint vips_ppmsave( VipsImage *in, const char *filename, ... )\n\t__attribute__((sentinel));\n\nint vips_matload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\n\nint vips_radload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\nint vips_radsave( VipsImage *in, const char *filename, ... )\n\t__attribute__((sentinel));\nint vips_radsave_buffer( VipsImage *in, void **buf, size_t *len, ... )\n\t__attribute__((sentinel));\n\nint vips_pdfload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\nint vips_pdfload_buffer( void *buf, size_t len, VipsImage **out, ... )\n\t__attribute__((sentinel));\n\nint vips_svgload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\nint vips_svgload_buffer( void *buf, size_t len, VipsImage **out, ... )\n\t__attribute__((sentinel));\n\nint vips_gifload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\nint vips_gifload_buffer( void *buf, size_t len, VipsImage **out, ... )\n\t__attribute__((sentinel));\n\n/**\n * VipsForeignDzLayout:\n * @VIPS_FOREIGN_DZ_LAYOUT_DZ: use DeepZoom directory layout\n * @VIPS_FOREIGN_DZ_LAYOUT_ZOOMIFY: use Zoomify directory layout\n * @VIPS_FOREIGN_DZ_LAYOUT_GOOGLE: use Google maps directory layout\n *\n * What directory layout and metadata standard to use. \n */\ntypedef enum {\n\tVIPS_FOREIGN_DZ_LAYOUT_DZ,\n\tVIPS_FOREIGN_DZ_LAYOUT_ZOOMIFY,\n\tVIPS_FOREIGN_DZ_LAYOUT_GOOGLE,\n\tVIPS_FOREIGN_DZ_LAYOUT_LAST\n} VipsForeignDzLayout;\n\n/**\n * VipsForeignDzDepth:\n * @VIPS_FOREIGN_DZ_DEPTH_ONEPIXEL: create layers down to 1x1 pixel\n * @VIPS_FOREIGN_DZ_DEPTH_ONETILE: create layers down to 1x1 tile\n * @VIPS_FOREIGN_DZ_DEPTH_ONE: only create a single layer\n *\n * How many pyramid layers to create.\n */\ntypedef enum {\n\tVIPS_FOREIGN_DZ_DEPTH_ONEPIXEL,\n\tVIPS_FOREIGN_DZ_DEPTH_ONETILE,\n\tVIPS_FOREIGN_DZ_DEPTH_ONE,\n\tVIPS_FOREIGN_DZ_DEPTH_LAST\n} VipsForeignDzDepth;\n\n/**\n * VipsForeignDzContainer:\n * @VIPS_FOREIGN_DZ_CONTAINER_FS: write tiles to the filesystem\n * @VIPS_FOREIGN_DZ_CONTAINER_ZIP: write tiles to a zip file\n *\n * How many pyramid layers to create.\n */\ntypedef enum {\n\tVIPS_FOREIGN_DZ_CONTAINER_FS,\n\tVIPS_FOREIGN_DZ_CONTAINER_ZIP,\n\tVIPS_FOREIGN_DZ_CONTAINER_LAST\n} VipsForeignDzContainer;\n\nint vips_dzsave( VipsImage *in, const char *name, ... )\n\t__attribute__((sentinel));\n\n#ifdef __cplusplus\n}\n#endif /*__cplusplus*/\n\n#endif /*VIPS_FOREIGN_H*/\n"], "fixing_code": ["12/2/18 started 8.6.3\n- use pkg-config to find libjpeg, if we can\n- better clean of output image in vips_image_write() fixes a crash \n  writing twice to memory\n- better rounding behaviour in convolution means we hit the vector path more\n  often\n- fix a crash if a delayed load failed [gsharpsh00ter]\n\n5/1/18 started 8.6.2\n- vips_sink_screen() keeps a ref to the input image ... stops a rare race\n- fix a minor accidental ABI break in 8.6.0 -> 8.6.1 [remicollet]\n- fix read of plane-separate TIFFs with large strips [remicollet]\n- fix a C++ warning in composite.cpp [lovell]\n- remove number of images limit in composite\n- composite allows 1 mode ... reused for all joins\n- fix race in vips_sink() for seq read \n\n10/12/17 started 8.6.1\n- fix mmap window new/free cycling \n- fix some compiler warnings\n- remove the 64-image limit on bandary operations\n- better version date [bmwiedemann]\n- bump wrapper script version [bgilbert]\n- fix a memleak on error during jpeg buffer write [lovell]\n- fix misspelling of IPTC as IPCT [lovell]\n- seq could be set on small images opened in random-access mode [aferrero2707]\n- fix small memleak in dzsave [lovell]\n- small speedup for rgb->g [lovell]\n\n15/4/17 started 8.6.0\n- supports fits images with leading non-image HDUs, thanks benepo\n- add vips_image_new_from_image() and vips_image_new_from_image1() ... make a\n  constant image\n- add new_from_image() to Python as well\n- slight change to cpp new_from_image() to match py/C behaviour\n- vips_conv(), vips_compass(), vips_convsep() default to FLOAT precision\n- add FORCE resize mode to break aspect ratio\n- add vips_thumbnail_image()\n- better prefix guessing on Windows, thanks tumagonx\n- savers support a \"page_height\" option for multipage save\n- rename 'disc' as 'memory' and default off\n- add vips_find_trim(), search for non-background areas \n- remove lcms1 support, it had bitrotted\n- `join` tagged as seq\n- support tiffsave_buffer for pyramids, thanks bubba\n- thumbnail and vipsthumbnail have an option for rendering intent, thanks \n  kleisauke \n- set file create time on Windows, thanks dlong500\n- remove python tests ... moved to pyvips test suite\n- vips7 and vips8 python bindings default to off ... use the new pyvips\n  binding instead\n- better svgload: larger output, handle missing width/height, thanks lovell\n- add vips_gravity() ... embed, but with direction rather than position\n- vips_text() can autofit text to a box, thanks gargsms\n- add vips_composite() / vips_composite2(): merge a set of images with \n  a set of blend modes\n- better gobject-introspection annotations, thanks astavale \n- vips_image_write() severs all links between images, when it can ... thanks\n  Warren and Nakilon\n- vector path for convolution is more accurate and can handle larger masks\n- linear and cubic kernels for reduce are higher quality\n- added vips_value_set_blob_free()\n- \"--size Nx\" to vipsthumbnail was broken, thanks jrochkind \n- fix build with gcc 7\n- add vips_fill_nearest() ... fill pixels with nearest colour\n- add VIPS_COMBINE_MIN, a new combining mode for vips_compass()\n- vips_hist_find_indexed() now has a @combine parameter\n- vips_affine() and vips_similarity() have a \"background\" parameter\n- fix nasty jaggies on the edges of affine output, thanks chregu\n- add gif-delay, gif-comment and gif-loop metadata\n- add dispose handling to gifload\n- dzsave outputs extra right and bottom overlap-only tiles, for closer spec\n  adherence\n- deprecate the \"centre\" option for vips_resize(): it's now always on\n- setting the EXIF data block automatically sets other image tags\n- add \"extend\" option to affine; resize uses it to stop black edges\n\n29/8/17 started 8.5.9\n- make --fail stop jpeg read on any libjpeg warning, thanks @mceachen\n- don't build enumtypes so often, removing perl as a compile dependency\n- fix a crash with heavy use of draw operations from language bindings, \n  thanks @Nakilon \n\n2/8/17 started 8.5.8\n- fix transparency detection in merge, thanks Haida\n- define env var VIPS_WARNING to hide warning messages\n- shut down dzsave output earlier to help mark-sweep bindings\n- fix webp thumbnail upscale, thanks Kleis\n\n9/6/17 started 8.5.7\n- better smartcrop\n- transform cmyk->rgb automatically on write if there's an embedded profile\n  and the saver does not support cmyk\n- fix DPI mixup in svgload ... we were writing images about 20% too large,\n  thanks Fosk\n\n19/5/17 started 8.5.6\n- tiff read with start page > 0 could break edge tiles or strips\n- raise b64 limit to allow for huge profiles (thanks jaume)\n- fix error return in blob save (thanks jaume)\n- tag vipsprofile as py2 (thanks ioquatix)\n- don't cache thumbnail (thanks tomasc)\n\n23/4/17 started 8.5.5\n- doc polishing\n- more improvements for truncated PNG files, thanks juyunsang \n- improve corrupted jpg handling, thanks juyunsang\n- fix small test suite issues on os x\n\n23/4/17 started 8.5.4\n- don't depend on image width when setting n_lines, thanks kleisauke\n\n7/4/17 started 8.5.3\n- more link fixing in docs \n- revise cache sizing again to help out of order errors under heavy load, thanks\n  kleisauke\n\n25/3/17 started 8.5.2\n- better behaviour for truncated PNG files, thanks Yury\n- missing proto for vips_tiffsave_buffer(), thanks greut\n- move some docs from the wiki and blog into core libvips docs\n- add support for markdown in docs\n\n25/3/17 started 8.5.1\n- init more classes earlier, thanks David\n\n13/10/16 started 8.5.0\n- rewritten buffer system is safer and frees memory earlier\n- added tiff save to buffer\n- added dzsave save to buffer (zip only)\n- revise header get/set functions\n- better vipsheader behaviour with complex field types\n- added vips_image_hasalpha()\n- added vips_thumbnail() / vips_thumbnail_buffer()\n- webpload/webpsave read and write icc, xmp, exif metadata\n- better >4gb detect for zip dzsave output [Felix B\u00fcnemann]\n- all loaders have a @fail option, meaning fail on first warning, though it\n  only does anything for jpg and csv\n- add vips_image_get_fields() to help bindings\n- add tiff multi-page read/write\n- add VIPS_META_PAGE_HEIGHT metadata\n- IM6/IM7 magickload supports page/n/page-height, all_frames deprecated\n- gifload supports n/page-height\n- added #defines for VIPS_SONAME, VIPS_LIBRARY_CURRENT, VIPS_LIBRARY_REVISION,\n  VIPS_LIBRARY_AGE\n- better support for bscale / bzero in fits images\n- deprecate vips_warn() / vips_info(); use g_warning() / g_info() instead\n- vipsthumbnail supports much fancier geometry strings, thanks tomasc\n- vips_thumbnail() has new @size option\n- fix --vips-cache-max etc. \n- add compute reordering, plus some new API to support it:\n  vips_reorder_margin_hint() and vips_reorder_prepare_many(), thanks\n  aferrero2707\n- kick load operations from cache on read error, thanks gaillard \n- fix return from C++ assignment operator overloads (+=, -= etc) \n- add @max_slope to vips_hist_local() to implement CLAHE, thanks hunter-87\n- vips_gaussnoise() pixels are reproducible on recalc, thanks MvGulik\n- max/min sort values by y and x coordinate\n- tiff read uses libtiff scanline API if rows-per-strip is large\n- vips_region_shrink() knows about alpha, helps dzsave and tiffsave\n- use expat, not libxml, for XML load ... removes a required dependency, since\n  we get expat as part of glib\n- new sequential mode infrastructure is faster and more flexible\n- add vips_smartcrop(), based on sharp's smartcropper\n- vipsthumbnail has a --smartcrop option\n- added vips_rot90() etc. convenience functions\n- fix vips_resize() bug when hscale and vscale were very different\n\n8/12/16 started 8.4.5\n- allow libgsf-1.14.26 to help centos, thanks tdiprima\n\n11/11/16 started 8.4.4\n- fix crash in vips.exe arg parsing on Windows, thanks Yury\n\n18/10/16 started 8.4.3\n- fix error detection in gif_close, thanks aaron42net\n- fix tiny threading memleak\n- improve compatibility with very old glib, see #548\n\n27/9/16 started 8.4.2\n- small doc improvements\n- fix error message for metadata fetch type mismatch\n- resolve a race condition in thread shutdown, thanks Lovell\n\n1/5/16 started 8.4\n- many more wepsave options [Felix B\u00fcnemann]\n- added quant_table option to wepsave [Felix B\u00fcnemann]\n- added @n option to pdfload, thanks andris\n- dzsave won't write empty tiles in google mode, thanks bverem, perog,\n  felixbuenemann\n- allow nested [] in CLI args\n- restore BandFmt on unpremultiply in vipsthumbnail\n- better python detection and build [Felix B\u00fcnemann]\n- max-alpha defaults to 65535 for RGB16/GREY16\n- added radsave_buffer [Henri Chain]\n- support tiff orientation tag\n- autorotate option for tiff load\n- tiffsave converts for jpg if jpg compression is turned on\n- tiffsave supports --strip\n- conversions to GREY16 could lock\n- free pixel buffers on image close as well as thread exit ... stops main \n  thread buffers clogging up the system\n- dzsave can write compressed zips [Felix B\u00fcnemann]\n- vips_image_write() only refs the input when it has to ... makes it easier to\n  combine many images in bounded memory\n- VImage::write() implementation was missing\n- VImage::write() return value changed from void to VImage to help chaining\n- added C++ arithmetic assignment overloads, += etc. \n- VImage::ifthenelse() with double args was missing =0 on options\n- better accuracy for reducev with smarter multiplication\n- better quality for vips_resize() with linear/cubic kernels \n- pyvips8 can create new metadata\n- better upsizing with vips_resize()\n- add imagemagick v7 support, thanks sachinwalia2k8 \n- added vips_worley(), vips_perlin() noise generators\n- added vips_convf(), vips_convi(), vips_convasep(), vips_conva() ... \n  im_conv*() functions rewritten as classes\n- vips_convsep() calls vips_convasep() for the approximate case\n- new fixed-point vector path for convi is up to about 2x faster\n- gif loader can make 1, 2, 3, or 4 bands depending on file contents\n- support --strip for pngsave\n- add svgz support [Felix B\u00fcnemann]\n- rename boostrap.sh -> autogen.sh to help snapcraft\n- support unicode filenames on Windows \n- added VIPS_ROUND as well as VIPS_RINT\n- resize/reduce*/shrink*/affine now round output size to nearest rather than \n  rounding down, thanks ioquatix\n- better support for tile overlaps in google maps mode in dzsave\n- dzsave puts vips-properties.xml in the main dir for gm and zoomify layouts\n- resize and reduce have @centre option for centre convention downsampling\n- vipsthumbnail uses centre convention to better match imagemagick\n\n19/8/16 started 8.3.4\n- better transparency handling in gifload, thanks diegocsandrim\n\n30/7/16 started 8.3.3\n- fix performance regression in 8.3.2, thanks Lovell\n- yet more robust vips file reading\n\n18/5/16 started 8.3.2\n- more robust vips image reading\n- more robust tiff read [Matt Richards]\n\n15/4/16 started 8.3.1\n- rename vips wrapper script, it was still vips-8.2, thanks Benjamin\n- export C++ operator overloads for MSVC linking [Lovell]\n- fix magickload @page with GraphicsMagick\n- add giflib5 support\n- allow resize >1 on one axis, <1 on the other\n- vips_resize has an optional @kernel argument\n- fix giflib4 detection [felixbuenemann]\n\n29/1/16 started 8.3\n- add vips_reduce*() ... a fast path for affine downsize\n- vips_resize() uses vips_reduce() with lanczos3 \n- bicubic is better on 32-bit int images\n- add pdfload, svgload, gifload for PDF, SVG and GIF rendering \n- vipsthumbnail knows about pdfload and svgload\n- added @page param to magickload \n- matload is more specific (thanks bithive)\n- lower mem use for progressive jpg decode\n- sharpen has a new @sigma param, @radius is deprecated\n- sharpen allows a much greater range of parameters\n- sharpen defaults now suitable for screen output\n- better handling of deprecated args in python\n- much better handling of arrayimage command-line args\n- faster hist_find (Lovell Fuller)\n- webpload has a @shrink parameter for shrink-on-load\n- vipsthumbnail knows about webp shrink-on-load\n- better behaviour for vips_cast() shift of non-int types (thanks apacheark)\n- python .bandrank() now works like .bandjoin()\n- vipsthumbnail --interpolator and --sharpen switches are deprecated\n- switches to disable PPM, Rad and Analyze support\n- added VIPS_COUNT_PIXELS(), overcomputation tracking\n- @out_format in vips_system() can contain [options]\n- webpsave_buffer no longer ignores @lossless, thanks aaron42net\n- float tiff tagged as scRGB to match photoshop convention, thanks Murat\n- better jpeg autorot, thanks otto\n\n24/3/16 started 8.2.4\n- fix nohalo and vsqbs interpolators, thanks Rafael\n\n27/1/16 started 8.2.3\n- fix a crash with SPARC byte-order labq vips images\n- fix parsing of filenames containing brackets, thanks shilpi230\n- fix hist_entropy (lovell)\n- small fixes to radiance load\n\n12/1/16 started 8.2.2\n- changes to ease compiling C++ binding with MSVC [Lovell Fuller]\n- reorder file tests to put slow loaders last\n- ifthenelse needs less C stack during eval\n- better rounding in bilinear interpolator\n- fix to \"make check\" in non-C locales [felixbuenemann]\n- use compiler builtins isnan, isinf, fabs, fmin, fmax, ceil, floor when \n  possible [Lovell Fuller]\n- tune vips_shrinkh(), 30% faster [Lovell Fuller]\n- remove SEQ hint from vips_subsample(), fixes cli performance [erdmann]\n- fix double free on attach ICC profile from file in tiff write [erdmann]\n- use g_assert_not_reached() \n- better vips-from-C docs\n- remove Duff from im_conv() / im_conv_f() for a 25% speedup [Lovell Fuller]\n\n1/1/16 started 8.2.1\n- add a compat stub [Benjamin Gilbert]\n- python bandjoin is now just an instance function\n- small doc improvements\n- small vips7 C++ improvement\n- remove exception specifications from vips8 C++ interface [Lovell Fuller]\n- VImage::get_typeof() now returns GType\n\n7/10/15 started 8.2.0\n- added im_bufmagick2vips(), a vips7 wrapper for magick load from buffer\n- fetch unset property now returns default value rather than warning\n- many more const declarations to help gobject-introspection\n- rewritten vips_shrink() is 2x faster, much lower memuse, now handles complex\n- only allow [] for filename options\n- add memory.h to Python API .. makes tracked highwater visible\n- added bandjoin_const to add constant bands to an image\n- better alpha handling for tiff write, thanks sadaqatullahn\n- better cache sizing for vips_resize()\n- sizealike / formatalike / bandsalike elide completely if they can for\n  a x2 saving in C stack use in many cases\n- added vips_mapim() ... resample with an index image, plus test\n- try to improve vips_resize() quality a little more\n- vips_resize() can do non-square resizes\n- dzsave removes tile metadata by default, thanks Benjamin\n- jpeg strip option removes a little more, thanks Benjamin\n- added vips_image_new_from_memory_copy()\n- improve vips_sink_screen() stability under heavy load\n- added vips_arrayjoin()\n- Python x.bandjoin(y) is now x.ibandjoin(y), sorry\n- faster and lower-mem TIFF read\n- faster bilinear interpolator\n- TIFF loads and saves IMAGEDESCRIPTION\n- add --properties flag to tiffsave\n- dzsave defaults changed: now writes 256x256 jpegs for non-edge tiles, thanks\n  Daniel\n\n7/5/15 started 8.1.1\n- oop, vips-8.0 wrapper script should be vips-8.1, thanks Danilo\n- fix vips7 pathname parsing on windows, thanks Lovell\n\n7/5/15 starteld 8.1.0\n- add vips_premultiply(), vips_unpremultiply()\n- change the alpha range rules for vips_flatten() to match vips_premultiply()\n- vipsthumbnail uses vips_resize() rather than its own code\n- vipsthumbnail uses vips_premultiply() for better alpha quality\n- added bandand() bandor() bandeor() convenience funcs to Python\n- oops, base64 encode could pad by up to two zero bytes\n- added VipsRefString as a thing that gi bindings can unpack\n- support \"with Vips.Image as i:\" in Python\n- try to support DOS CSV and PPM files on linux\n- add vips_byteswap(), remove byteswap option from vips_copy()\n- add vips_bandfold()/vips_bandunfold()\n- dzsave supports zip output > 4gb, thanks benjamin\n- add support for HSV colourspace [Jonas \u00d8gaard]\n- skip oversized markers in jpeg write\n- jpeg exif tags saved as name rather than title\n- can now set any jpeg exif tag, not just modify existing tags\n- add vips_hist_entropy()\n- vips_log(), vips_log10() are zero-avoiding\n- better overlap handling for dzsave, thanks robclouth\n- add @spacing option to vips_text()\n- tiff loads and saves IPCT and Photoshop data\n\n7/5/15 started 8.0.3\n- dzsave and tif pyr write could fail for some image dimensions, thanks Jonas\n\n4/5/15 started 8.0.2\n- fix a refcount error in C++ wrapper, thanks huskier\n- better C++ api test\n- test suite improvements\n- remove a couple of stray header decls, thanks benjamin\n\n25/4/15 started 8.0.1\n- fix some compiler warnings \n- work around a glib bug that can cause segv under load\n- add some notes on threading to the docs\n- better leak reporting\n\n11/2/15 started 8.0\n- remove old doc stuff, lots of doc improvements\n- add fliphor(), flipver(), rot90(), rot180(), rot270(), median(), dilate(), \n  erode() convenience methods to Python and C++\n- python: use [] to index and slice image bands, use () to get a point\n- c++: use [] to band index, () returns a vector<double>\n- add shift option to cast\n- sRGB2scRGB and scRGB2sRGB scale 16-bit alpha to and from 8-bit\n- add magickload_buffer() [mcuelenaere]\n- add vips_foreign_is_a_buffer() [mcuelenaere]\n- added test_foreign.py, plus more test images\n- added vips_region_shrink(), fast x2 shrinker\n- rewritten tiff writer is about 3 - 4x faster at making pyramids\n- jpg, magick, png, tiff readers now use only 1 fd per input image\n- added vips_info_set(), vips_progress_set(), vips_profile_set() ... bindings\n  can now support all the vips command-line options if they wish \n- better conversion to greyscale, thanks bkw\n- add vips_image_copy_memory(), improves stability with heavy threading\n- jpegsave supports new mozjpeg features [lovell]\n- add vips_vipsload(), vips_vipssave() ... why not\n\n26/3/15 started 7.42.4\n- im_maxpos_avg() avoids NaN\n- small tiffsave doc improvements\n- better thresholding for tiffsave \"squash\" mode\n- add @miniswhite mode to tiffsave\n\n6/2/15 started 7.42.3\n- bump version for back-compat ABI change\n- added vips_image_memory(), an alias for vips_image_new_memory()\n- improvements to configure for python\n- remove --disable-cxx configure flag\n- python imageize preserves interpretation\n- fix dzsave as a target format \n\n30/12/14 started 7.42.2\n- C++ required output params were broken, thanks Lovell\n- remove VImage::scale() to get scale from header, it clashed with the\n  VipsScale operator, thanks Lovell\n- allow c++ set enum from string\n- display param default and range in usage\n- better docs\n- more tests\n- renamed VIPS_FOREIGN_DZ_DEPTH_1 as VIPS_FOREIGN_DZ_DEPTH_ONE etc. to help\n  bindings\n- vipsthumbnail will return an error code if one or more conversions failed\n- disable chroma subsample in jpeg-tiff if Q >= 90\n- try to handle tiffs with old-style 8-bit colormaps\n- rename vipsthumbnail -o as -f, -o stays as a hidden flag\n- fix some small leaks\n- faster openslide load, thanks Benjamin\n- add VInterpolate class to cplusplus binding, thanks Lovell\n- add lower-level operation cache access\n- turn on leak testing in test suite\n- don't use isnormal() to test for crazy FP numbers, thanks Murat\n- much faster RGB16 -> sRGB path\n\n24/12/14 started 7.42.1\n- add gobject-2.0 to Requires: in vips and vips-cpp .pc files\n- bump soname\n- fix VipsBlob read\n- remove \"future\" dependency, thanks bgilbert\n\n4/11/14 started 7.42.0\n- better default resolution for png load\n- better pbm (one bit) load, better pfm (float) load/save\n- added pbm (one bit) save\n- changed vips_gaussblur() parameters, sorry\n- add .szi as a dzsave zip synonym\n- support tiff XMP metadata\n- support @density arg to magickload [Lovell]\n- support python3.4 and python2.7 in new python binding\n- vips_gaussmat() and vips_logmat() are now int by default, to match\n  vips_conv(), and use @precision, not @integer\n- added --disable-pyvips8 switch to turn off new py binding\n- \"vips thing\" exit status can now be used to test for optional components\n\n25/7/14 started 7.41.0\n- start working on --disable-deprecated\n- fix pngload with libpng >1.6.1\n- add vips_resize()\n- return of vips_init(), but just for bindings\n- revised type.c to make it more binding-friendly\n- add @background arg to save: the colour to flatten against\n- add VIPS_ARGUMENT_MODIFY flag ... used for draw_circle etc, meaning an op\n  which modifies its argument\n- rename VIPS_OPERATION_RELATIONAL_NOTEQUAL as VIPS_OPERATION_RELATIONAL_NOTEQ\n  for consistency\n- python vips8 binding\n- python vips8 test suite: test_arithmetic.py, test_colour.py,\n  test_conversion.py\n- move zoomify ImageProperties file, now a better match to the offical tool\n- rename VIPS_ANGLE_180 as VIPS_ANGLE_D180 etc. to help python\n- remove cimg support, we have a gmic plugin now instead\n- add support for vips8 plugins\n- added \"autorotate\" option to jpeg load\n- added autorot operator\n- added @filter option to pngsave (Lovell)\n- C++ vips8 binding\n\n27/10/14 started 7.40.12\n- better tiff detection (Lovell)\n- fix memleak in sharpen (Lovell)\n- fix profile handling in XYZ2scRGB, thanks Lovell\n\n8/10/14 started 7.40.11\n- rework extra band handling for colour functions\n- set interpretation of matlut output more carefully\n\n8/9/14 started 7.40.10\n- icc_import and icc_transform checks the input profile for compatibility \n  with the image, thanks James\n- try to make vips_thread_shutdown() optional\n\n8/9/14 started 7.40.9\n- support jfif resunit \"none\"\n- support GRAY as an input and output ICC space\n- fix a read loop with setjmp() in png read, if the png file is broken\n- fix vipsthumbnail with both input cmyk and output rgb profiles specified\n- vipsthumbnail retries with specified input profile if embedded profile is\n  broken\n- add @profile option to pngsave, matching tiff and jpeg\n- fix a race in the operation cache [Lovell]\n\n8/9/14 started 7.40.8\n- fix configure on rhel6 [Lovell]\n- mono <-> rgb converters were not handling extra bands, thanks James\n- support jpeg resunit \"none\"\n\n21/8/14 started 7.40.7\n- width and height were swapped in matlab load\n- set interpretation more carefully on matlab load\n- fix memleak in tilecache [Lovell]\n- fix memleak in VipsArray [Lovell]\n- fix memleak in webp load from buffer [Lovell]\n- fix memleak in png save to buffer [Lovell]\n- make out of order read in png and jpg a fatal error\n- add thread_shutdown() to C++ (and thereby to python)\n\n12/8/14 started 7.40.6\n- more doc fixes\n- fix similarity rotate+scale, thanks Topochicho\n- fix 16-bit PNG save, thanks John\n- fix dzsave date on Windows, thanks John\n- fix vipsthumbnail on many-core systems, thanks James\n\n25/7/14 started 7.40.5\n- fix a race in im_maxpos_avg()\n- limit n_thr on tiny images\n- don't exit() on memleak detected, just warn\n- add \"autocrop\" option to openslide load\n- argh fix affine, again, there were sometimes black bars with nohalo and the\n  vips8 interface\n- pngsave in interlaced mode makes a copy of the image, so it's always seq \n- vipsthumbnail shrinks to 1/2 window_size\n- vipsthumbnail has an anti-alias filter between shrink and affine\n- vipsthumbnail defaults to bicubic \n- better rounding behaviour for fixed-point bicubic reduces noise\n- fix pngload with libpng >=1.6.11\n- fix colour for openslide read associated\n\n4/7/14 started 7.40.4\n- fix vips_rawsave_fd(), thanks aferrero2707 \n- fix im_point()\n- vips_scale() now does round to nearest to avoid rounding errors\n- improve im_openout() compat macro\n- more vips7 compatibility fixes, thanks steve\n- more robust vips_system()\n- add webp support to vips7 \n\n30/6/14 started 7.40.3\n- fix interlaced thumbnails in vipsthumbnail, thanks lovell\n- fix use of \"header\" in benchmark/, thanks David\n- fits save now caches the image before write, so it's top-to-bottom\n- add --properties argument to dzsave, thanks bgilbert, jhenriksen\n\n25/6/14 started 7.40.2\n- dzsave write to zip stops at 4gb, thanks bgilbert\n- improve short option name handling, thanks bgilbert\n- added --enable-docs configure option to help freebsd\n- removed a bash-ism from configure to help freebsd\n- don't assume GType fits in an int to help freebsd\n\n24/6/14 started 7.40.1\n- revise man.1 pages\n- fix vips_guess_prefix()\n\n23/6/14 started 7.40.0\n- version bump\n- renamed \"header\" as \"vipsheader\" and \"edvips\" as \"vipsedit\"\n\n21/1/14 started 7.39.0\n- auto-decode for (almost) all operations, see vips_image_decode()\n- background render thread cleans up and quits neatly\n- colourspace has a source_space option\n- operations can be tagged as \"deprecated\"\n- redo im_draw_circle(), im_draw_flood(), im_draw_line(), im_draw_mask(),\n  im_draw_image(), im_draw_rect(), im_draw_point(), im_read_point(),\n  im_draw_smudge(), im_label_regions() as classes\n- better rounding in vips_flatten()\n- VipsStatistic operations are sequential\n- vipsthumbnail has --rotate auto-rotate option\n- removed embedded thumbnail reader from vipsthumbnail: embedded thumbnails\n  are too unlike the main image\n- fix to vipsthumbnail --crop, thanks Alessandro \n- add vips_sum()\n- add vips_hough base class and vips_hough_line()\n- add \"mode\" param to vips_draw_image()\n- add vips_hough_circle()\n- reduce default cache size to 1,000 operations\n- added \"postbuild\" signal\n- vips_system() now supports many input images and you can change image\n  argument order\n- support 16-bit palette TIFFs, plus palette TIFFs can have an alpha\n- libgsf-1 is now an optional dependency \n- dzsave can directly write a ZIP file \n- add \".vips\" as an alternative suffix for vips files\n- added vips_tiffload_buffer()\n- added vips_image_new_from_buffer(), vips_image_write_to_buffer()\n- added vips_object_set_from_string()\n- added @container option to dzsave \n- support 1/2/4 bit palette tiff images with alpha\n- vips_system() now uses g_spawn_command_line_sync()\n- added im_tile_cache_random() to help nip2\n- added hough_circle() to vips7 C++ API\n- added Travis CI config, thanks Lovell\n- im_*merge(), im_*mosaic(), im_match*(), im_global_balance*(), im_remosaic(),\n  im_*mosaic1(), im_*merge1() redone as classes\n- better filename tracking for globalbalance\n- revised vips8 image load/save API, now simpler and more logical\n- operations emit \"invalidate\" if any of their input images invalidate\n- operation cache drops ops on invalidate\n- skipahead is back, thanks to a new threadpool tweak\n\n6/3/14 started 7.38.6\n- grey ramp minimum was wrong\n- vipsthumbnail --crop could fail for very non-square images, thanks\n  Alessandro\n- fix a crash in vips_rawsave(), thanks Andrea\n- updated German translation, thanks Chris\n- fix coordinate error in affine, thanks ferryfax\n\n24/2/14 started 7.38.5\n- jpeg load from buffer could write to input, thanks Lovell\n- fix webpload from buffer, thanks Lovell\n- vips_sequential() could fail under heavy load\n- remove support for seq mode read for operations like extract\n\n13/2/14 started 7.38.4\n- --sharpen=none option to vipsthumbnail was broken, thanks ferryfax\n- more locking on property create and lookup to help very-threaded systems,\n  thanks Nick \n\n22/1/14 started 7.38.3\n- undeprecate VIPS_MASK_IDEAL_HIGHPASS and friends, ruby-vips was using them,\n  thanks ahacking\n\n22/1/14 started 7.38.2\n- auto RAD decode for affine\n- falsecolour was not working for some image types\n- foreign memory buffer images did not have the right dhint, broke\n  command-line falsecolour on sequential images\n- support many Radiance readers active at once\n- add secret \"rgbjpeg\" flag to vips_tiffsave() to help IIP\n\n19/1/14 started 7.38.1\n- bump soname, thanks benjamin\n- better conversion to and from scrgb/xyz for rad (hdr) \n- fix --interpolate flag to vipsthumbnail, thanks Lovell\n\n18/1/14 started 7.38.0\n- version bump\n\n19/10/13 started 7.37.0\n- redone im_rotate_*mask45(), im_gauss_*mask*(), im_log_*mask(), im_dilate(),\n  im_erode(), im_rank_image(), im_compass(), im_linedet(), im_gradient(),\n  im_convsep(), im_convsep_f(), im_fastcor(), im_spcor(), im_sharpen()\n  as classes\n- im_gradcor() deprecated\n- vips_init() now does some ABI compat checking, though this change requires\n  an ABI break\n- add \"interlace\" option to vips_jpegsave()\n- remove vips_image_copy_fields() and vips_demand_hint() and add \n  vips_image_pipeline() to do both jobs\n- vipsthumbnail allows non-square bounding boxes, thanks seth\n- add vips_matrixprint()\n- add @point subsample mode to vips_subsample()\n- im_contrast_surface() deprecated: it was slower than calling conv a few\n  times\n- radiance load supports sequential read\n- rewritten radiance decode is much faster\n- add vips_crop(), a synonym for vips_extract_area()\n- rename vips_gammacorrect() as vips_gamma(), now takes 1 / exp\n- vips_gamma() works for any format\n- add --linear mode to vipsthumbnail\n- support XYZ as a PCS for vips_icc_import() and vips_icc_export()\n- add --strip option to jpegsave\n- added vips_gaussblur() convenience function\n- added --vips-profile, records and dumps thread timing and memory use info \n- added vipsprofile, visualises --vips-profile output\n- auto-vectorization-friendly inner loops\n- added vips::init() and vips::shutdown() to C++ API\n- reuse pixel buffers on sharing to reduce mem cycling\n- conv is SMALLTILE, huge mem use saving on wide images\n- vipsthumbnail has a --crop option\n- remove video4linux1 code, it was useless on all modern linuxes\n- redone freq filter builders as classes\n- redone im_fwfft(), im_invfft(), im_freqflt(), im_disp_ps(), im_fractsurf(),\n  im_phasecor() as classes\n- vips_colourspace() allows B_W, GREY16, RGB16 as source / target\n- added vips_thread_shutdown(), thanks Lovell\n- vips_linear() has a uchar output mode\n- redone im_cntlines(), im_rank() as classes\n- move im_zerox() to deprecated, it wasm't very useful\n\n9/1/14 started 7.36.6\n- fix some clang compiler warnings\n\n20/11/13 started 7.36.5\n- better cache sizing in unbuffered sequential mode\n- allow larger tile_size in dzsave\n- remove use of PATH_MAX to help gnu hurd\n- fix vips_hist_match()\n\n15/11/13 started 7.36.4\n- improve compat with im_init_world()\n\n18/10/13 started 7.36.3\n- fix compiler warnings in ubuntu 13.10\n- reverse similarity rotation direction to match the convention used \n  elsewhere in vips\n- fix blocked caching of sequential load operations\n- fix cache flags\n- fix --delete option to vipsthumbnail\n\n10/10/13\tstarted 7.36.2\n- better jpeg startup\n- rename jpeg bool type to reduce confusion between libraries\n\n3/10/13\tstarted 7.36.1\n- fix to help OS X build\n\n3/10/13\tstarted 7.36.0\n- version bump\n\n1/7/13 started 7.35.0\n- added vips_matrixload() and vips_matrixsave(), load and save vips mat format\n- rename image arrays as image matrices ... INTERPRETATION_ARRAY ->\n  INTERPRETATION_MATRIX etc. \n- rewrite im_buildlut(), im_identity*(), im_maplut(), im_falsecolour(),\n  im_gammacorrect(), im_histgr(), im_histcum(), im_histnorm(), im_heq(),\n  im_histnD(), im_histindexed(), im_histspec(), im_invertlut(), im_lhisteq(),\n  im_stdif(), im_project(), im_profile(), im_tone_build*(), im_mpercent*(),\n  im_ismonotonic() as classes\n- vips_hist_local(), vips_stdif() do any number of bands\n- thin vips8 wrapper for im_histplot()\n- added vips_error_freeze() / vips_error_thaw()\n- used freeze() / thaw() to stop file format sniffers logging spurious errors\n- vipsthumbnail uses embedded jpg thumbnails if it can \n- rename vips_diag() as vips_info(), add --vips-info flag\n- deprecate im_hsp()\n- added vips_webpload(), vips_webpload_buffer(), vips_webpsave(),\n  vips_webpsave_buffer(), vips_webpsave_mime()\n- tiff reader allows separate planes for strip read\n- tiff reader and writer allow many more formats, eg. 32-bit int, complex, etc. \n- tiff reader and writer allow any number of bands\n- added vips_image_new_matrixv()\n- dzsave basename param now called filename, so you can use .dz as a\n  destination (basename is still there but deprecated)\n- new _UNBUFFERED sequential mode saves memory in some important cases\n- vips_conv() is a simple wrapper over the old convolution functions\n- new optimize_coding param for jpeg write produces optimal Huffman tables,\n  thanks Lovell \n- im_tone_map() and im_tone_analyse() deprecated\n- new --band arg to vips_maplut() replaces im_tone_map() functionality\n- added vips_similarity(), simple wrapper for vips_affine() that lets you\n  give a scale and rotate\n\n3/7/13 started 7.34.2\n- lower priority for Matlab load to reduce segvs from Mat_Open(), thanks\n  Michael\n- null-terminate libexif strings, thanks Mike\n- openslide always outputs solid pixels\n\n28/6/13 started 7.34.1\n- fix morphological operators on non-uchar images\n- remove any ICC profile when we use vips to go to srgb\n\n7/6/13 started 7.34.0\n- version bump\n- oops, VImage.PIL_mode_from_vips() failed for CMYK, thanks Alessandro\n- fix no-pango build\n- add im_vips2dz(): run the deepzoom writer from vips7\n- vips_magickload() has an option to read all images in a sequence\n- redo im_make_xy(), im_*eye(), im_zone*(), im_sines() as classes\n- added vips_pngload_buffer()\n- faster --centre option to dzsave, thanks Kacey\n\n12/3/13 started 7.33.0\n- vipsthumbnail lets you specify the sharpening mask\n- turn off caching for im_copy()/vips_copy(), we use copy to stop sharing, and\n  it's cheap so caching doesn't help anyway\n- auto rshift down to 8 bits on save, if necessary\n- im_gaussnoise(), im_copy_file(), im_grid(), im_scale(), im_scaleps(),\n  im_wrap(), im_rotquad(), im_zoom(), im_subsample(), im_msb(), im_text(),\n  im_system(), im_system_image()\n  redone as classes\n- add --angle option to dzsave\n- another vips_shrink() fix argh\n\n14/5/13 started 7.32.4\n- icc import and export could segv on very wide images\n- fix centos 5 build, thanks re-boot\n\n16/4/13 started 7.32.3\n- rename GETTEXT_PACKAGE as vips7.32 to help Debian (thanks Jay)\n- added \"persistent\" option to tilecache\n\n12/3/13 started 7.32.2\n- removed some left-over debugging code from configure.ac\n- better handling of args without values, thanks Ruven\n- better error messages from vips.c\n- fix demand hints so \"vips shrink\" works again, thanks Jan\n- im_jpeg2vips.c builds without jpeglib.h, thanks Alessandro\n\n6/2/13 started 7.32.1\n- fix --without-lcms, thanks speckins\n- updates to licence, thanks Benjamin\n- remove \"fred\" from dist\n- better bootstrap on OS X\n\n22/1/13 started 7.32.0\n- tilecache in threaded mode could deadlock if the downstream pixel source\n  raised an error (thanks Todd)\n- fix another dzsave corner-case (thanks Martin)\n- neater output for \"header\"\n- added VIPS_META_LOADER: record the loader name\n= header displays this loader hint\n- vipsthumbnail is better at cache sizing\n\n31/8/12 started 7.31.0\n- redone im_Lab2XYZ(), im_XYZ2Lab(), im_Lab2LCh(), im_LCh2Lab(), im_UCS2LCh, \n  im_LCh2UCS(), im_XYZ2Yxy(), im_Yxy2XYZ(), im_float2rad(), im_rad2float(),\n  im_Lab2LabQ(), im_LabQ2Lab(), im_Lab2LabS(), im_LabS2Lab(), im_LabQ2LabS(),\n  im_LabS2LabQ(), im_LabQ2disp(), im_XYZ2disp(), im_disp2XYZ(),\n  im_icc_import*(), im_icc_export*(), im_icc_transform*(), im_dE_fromLab(),\n  im_dECMC_fromLab(), im_dE00_from_Lab(), im_icc_ac2rc() as classes\n- added vips_colourspace(), vips_colourspace_issupported(), replaces all \n  derived conversions\n- faster and more accurate sRGB <-> XYZ conversion\n- support 16-bit sRGB import and export\n- rename UCS colourspace as CMC\n- dzsave can write zoomify and google maps layout as well\n- tilecache supports threaded access, so openslide read now threads\n- openslide2vips gets underlying tile size from openslide\n- embed has 'background' option\n- dzsave --layout google has a @background option\n- dzsave has a --depth option\n- update for new glib threading API\n- remove no threads option, glib no longer support it\n- better --help output for vips driver prog\n- vipsthumbnail -o allows absolute file names\n- much better exif handling for jpg images (thanks Gary)\n- preserve jpeg app13 (photoshop ipct)\n- vips_max() / _min() track the top n maxima / minima\n- deprecate im_maxpos_avg(): too specialised to be worth maintaining\n- deprecate im_linreg(): easily done by combining other operators\n- deprecate im_point(): easily done by combining other operators\n- add binary complex operations, with cross_phase as the only one so far\n- added vips_bandbool(), with vips_bandand(), _bandor(), _bandeor() as\n  convenience functions\n- added scRGB colourspace, linear light float space with sRGB primaries\n- all interpolators use corner convention ... we had round-to-nearest in\n  several of them before, causing a range of annoying problems\n- redone im_affine*() as a class\n- added input space displacement to affine\n- VipsArea is threadsafe\n- dzsave has a --centre option\n\n31/12/12 started 7.30.8\n- png icc profile write was broken\n\n31/12/12 started 7.30.7\n- better option parsing for \"vips\", thanks Haida\n- small fixes to help OS X\n- backported threaded tile cache from next version, im_tile_cache() now \n  uses it to prevent a deadlock, see comment there\n\n14/11/12 started 7.30.6\n- capture tiff warnings earlier\n\n14/11/12 started 7.30.5\n- fix libtool version mess up (thanks Benjamin)\n\n2/10/12 started 7.30.4\n- remove options from format string in .dzi (thanks Martin)\n- vipsCC.pc required the wrong version of vips (thanks Alessandro)\n- larger max tile size for dzsave\n- linecache is 50% larger to leave some slop room\n\n13/9/12 started 7.30.3\n- linecache sized itself too large\n- fix a compile failure if libtiff was not found (thanks Martin)\n- dzsave did not work for images with an odd number of scanlines \n  (thanks Martin)\n\n4/9/12 started 7.30.2\n- sequential stops all threads on error\n- sequential delays ahead threads rather than blocking them completely\n\n6/8/12 started 7.30.1\n- fixes to dzsave: shrink down to a 1x1 pixel tile, round image size up on \n  shrink, write a .dzi file with the pyramid params, default tile size and \n  overlap now matches the openslide writer\n- wrap VipsInterpolate for C++\n- so affinei and affinei_all appear in Python\n- be more cautious enabling YCbCr mode in tiff write\n- add \"DEPRECATED\" flag to arguments\n- jpeg load/save note and use the preferred resolution unit\n- better error msgs for enum args\n- fix compiler warnings in production build (thanks Dmitry)\n- fix spurious warnings about exif updates\n- VipsSequential has an integrated cache and stalls out of order threads\n- add a line cache ... sizes up dynamically with request size\n- tilecache / linecache use a hash table not a linear list\n\n20/7/12 started 7.30.0\n- support \"rs\" mode in vips7\n- add --vips-version cmdline arg\n- fix --without-tiff / exr / jpeg / png / magick\n- add --vips-fatal flag\n\n19/3/12 started 7.29.0\n- sanity-check PNG read geometry\n- nearest-neighbor interpolation rounds coordinates to nearest instead of \n  rounding down (thanks Nicolas)\n- add dzsave, save in deep zoom format\n- rework im_shrink() as a class\n- remove im_rightshift_size(), just a convenience function now\n- vipsthumbnail no longer removes profiles by default\n- much more gentle sharpening in thumbnails\n- added \"minimise\" signal, used by tilecache to drop\n- add :seq support to im_tiff2vips(), im_jpeg2vips() ... helps ruby-vips\n- better thread safety for vips8 operation dispatch\n- better thread safety for upstream / downstream image linking\n- added \"rs\" open mode, removed \"rd\"\n- added vips_operation_get_flags() ... system for attaching sets of flags to\n  operations\n- added VIPS_OPERATION_SEQUENTIAL flag\n- vips8 command-line interface uses this to turn sequential mode on\n  automatically when possible\n- better handling of input files in vips7 command-line interface\n- sequential can skip ahead, so extract / insert are now seq\n\n16/7/12 started 7.28.10\n- wopconst was broken\n- vips_sign() was broken\n- png save compression range was wrong\n- more/moreeq was wrong\n- vips7 ppm save with options was broken \n- don't cache write operations\n\n18/6/12 started 7.28.9\n- slightly more memory debugging output\n- remove references to the static bicubic interpolator from the docs\n- fix temp file handling on Windows --- was breaking for non-vips files \n  over 100mb\n- better support for using images from multiple threads\n\n18/6/12 started 7.28.8\n- fixes for centos5 portability\n\n18/6/12 started 7.28.7\n- add vips_flatten() -- flatten RGBA to RGB\n- better alpha handling in PNG load\n- don't save RGBA PNG as CMYK JPG (thanks Tobsn)\n- fix a crash with malformed jpg files (thanks Grigoriy)\n- vipsthumbnail enables sequential mode more and caches lines better\n\n19/4/12 started 7.28.6\n- better resolution unit handling in deprecated im_vips2tiff()\n- use TIFF_CFLAGS output from pkg-config (thanks Jay)\n- much faster vips_argument_map()\n- make jpeg pyramids work with tiff4\n- tiff loader always offers THINSTRIP (thanks Diuming)\n- add \"nocache\" operation flag, set for sequential load (thanks Diuming)\n- fix a crash in the tiff reader for huge values of RowsPerStrip (thanks\n  Nicolas)\n- remove use of G_DEFINE_BOXED_TYPE() to help compat (thanks Jake)\n\n19/4/12 started 7.28.5\n- ifthenelse blend mode was broken\n- small blend speedup\n- default to libtiff-4\n\n17/4/12 started 7.28.4\n- up max buffer size for vipsbuf\n\n6/4/12 started 7.28.3\n- vips_divide() failed for int arguments\n- fix warning for unused vips7 gvalue argument\n- fix openslide read: always return png-style rgba, im_argb2rgba() becomes a\n  NOP\n- cast to unsigned int now removes <0 values\n- vips7 interface to openslide now supports :,level,associated options (thanks\n  Benjamin)\n- make vips8 cache smaller\n- more accurate progress reporting\n\n13/3/12 started 7.28.2\n- xres/yres tiffsave args were broken\n\n13/3/12 started 7.28.1\n- add ICC profile read/write for png files\n\n30/1/12 started 7.28.0\n- version bump\n- added vips_foreign_find_save_options()/vips_foreign_find_load_options()\n- delayed write to foreign via a \"w\" image was not working\n- support operations with many returns in Python\n- sequential read mode \n- better im_shrink()\n- added vips_sequential()\n- new vips_sink_memory() keeps read ordering\n- tiff, jpeg, png readers support sequential read\n- max/min avoid NaN\n- oop, histnorm was broken by the new vipsstats\n- never use IM ping to get a header, fixes BMP load\n- set @filename for non-vips formats in vips7 compat layer\n- make Xres/Yres double\n- completely disable debug by default in production builds\n\n20/8/11 started 7.27.0\n- version bump for new dev cycle\n- im_subtract(), im_avg(), im_min(), im_minpos(), im_copy(), im_embed(),\n  im_flophor(), im_flipver(), im_insert(), im_insert_noexpand(), im_lrjoin(),\n  im_tbjoin(), im_extract_area(), im_extract_bands(), im_extract_areabands(),\n  im_replicate(), im_clip2fmt(), im_gbandjoin(), im_bandjoin(), im_invert(),\n  im_lintra(), im_lintra_vec(), im_black(), im_rot90, im_rot180(), im_rot270()\n  im_sintra(), im_costra(), im_tantra(), im_asintra(), im_acostra(), \n  im_atantra(), im_exptra(), im_exp10tra(), im_logtra(), im_log10tra(),\n  im_abs(), im_sign(), im_max(), im_maxpos(), im_deviate(), im_divide(),\n  im_multiply(), im_stats(), im_measure(), im_recomb(), im_floor(), im_ceil(),\n  im_rint(), im_equal*(), im_notequal*(), im_less*(), im_lesseq*(), im_more*(),\n  im_moreeq*(), im_remainder*(), im_and*(), im_or*(), im_eor*(), im_shift*(),\n  im_pow*(), im_exp*(), im_ifthenelse(), im_blend(), im_c2amph(), im_c2rect(),\n  im_bandmean(), im_c2real(), im_c2imag(), im_ri2c(), im_jpeg*2vips(), \n  im_vips2jpeg*(), im_tiff2vips(), im_vips2tiff(), im_exr2vips(),\n  im_fits2vips(), im_vips2fits(), im_analyze2vips(), im_raw2vips(),\n  im_vips2raw(), im_magick2vips(), im_png2vips(), im_png2*(), im_ppm2vips(),\n  im_vips2ppm(), im_mat2vips(), im_rad2vips(), im_vips2rad()\n  redone as classes\n- added argument priorites to help control arg ordering\n- generate has a 'stop' param to signal successful early termination\n- added optional output args, eg. x/y for min\n- CLI supports optional output args\n- in im_vips2tiff, enable YCbCr compression for jpeg write\n- VipsMin stops search early if it can\n- C API supports optional output args\n- switch back to int-valued operations\n- add the operation cache, various --vips-cache-* flags\n- fallback vips_init()\n- vips_tracked_malloc() tracks allocation size and can report total mem usage\n- cache limits, drop, init, flush plus command-line controls\n- remove dmalloc support, was never used and valgrind is better\n- im_csv2vips() allows quoted strings, including escaped quotes\n- added vips_shutdown()\n- added --vips-leak flag\n- more VipsImage props\n- added vips_image_write(), old one becomes vips_image_write_to_file()\n- added vips_region_paint_pel()\n- added VipsArea as a public struct\n- added array members and arguments\n- added nary\n- remove VipsPool, vips_object_local_array() is much better\n- cache.c now drops if you have too many open files\n- CLI args to change max files\n- new format for handling exif tags \n- switch SMALLTILE to 128, 512 was just too big\n- oop mode \"rd\" was not always being used for images\n- added ARRAY interpretation for images\n- VipsStats tracks minpos/maxpos as well\n- moved mask/ to deprecated\n- use atexit() to call vips_shutdown()\n- set _O_TEMPORARY on delete-on-close temp images if possible\n- unlink temps on rewind on *nix, less likely to leave temps on a crash\n- added complex conj as a basic operation\n- rect/polar/conj work on any format, not just complex\n- new VipsFile system for load/save in image formats\n- options now introspectable, try \"vips jpegsave\"\n- copy swap uses glib byteswap macros, about 2x faster\n- edvips can change vips header byte ordering\n- \"header\" is terse by default\n- \"header\" outputs filenames if working on many files\n- added openslide support (Benjamin Gilbert)\n- allow new-style load/save options in filenames to \n  vips_image_new_from_file() etc.\n- VipsFormat is deprecated\n- remove outchecks from documented API\n- support gobject-introspection \n- new Python binding based on gobject-introspection\n- only spot options at the end of arg strings\n- add vips_cache() as a vips8 operator\n- remove the old fft fallback\n- remove fftw2 support\n- much faster im_draw_smudge()\n\n14/1/12 started 7.26.8\n- interpolate CLI args were broken (thanks speckins)\n\n5/12/11 started 7.26.7\n- lazy read from tiled tiff from layers other than 0 was broken\n- optional args to vips_call*() do not work, disabled (fixed correctly in\n  master)\n- address calculations in files over 4gb were broken on 32-bit platforms\n  (broken since March 2011, oops)\n\n12/10/11 started 7.26.6\n- NOCACHE was not being set correctly on OS X causing performance \n  problems with large files\n- update Orientation exif tag on jpeg write\n\n12/10/11 started 7.26.5\n- jpeg read/write copies over XMP data\n- handle offset correctly in separable convolutions (thanks Nicolas)\n- macros for class arg boilerplate\n- class arg order set by new 'priority' param\n- VipsExtend, VipsDirection enums added\n\n12/9/11 started 7.26.4\n- fallback vips_init() \n- im_openout() compat stub was wrong, breaking ruby-vips\n- vips_class_map_concrete_all() needed a compat macro too\n- vips_class_map_all() was broken\n\n10/8/11 started 7.26.3\n- don't use G_VALUE_COLLECT_INIT(), many platforms do not have a glib this\n  recent\n- don't leave image->kill set when we detect termination\n- test for a working C++ compiler, disable C++ parts of none found\n\n10/8/11 started 7.26.2\n- oops, im_benchmark.c had some stuff turned off\n- configure option --without-cfitsio was broken (thanks Mike)\n\n26/7/11 started 7.26.1\n- doc fixups\n- oops, ==0 missing from a strcmp() in vips7compat\n- fixed a race in im_XYZ2Lab() table build\n- added im_concurrency_get() to operation db\n- better benchmarkn.sh runs for the correct number of CPUs automatically, runs\n  three times for each one, and just reports the fastest\n\n26/7/11 started 7.26.0\n- version bunp for 7.26\n- various fixes to get win32 and OS X building\n\n6/12/10 started 7.25.0\n- attach the jpeg thumbnail and multiscan fields (thanks Mike)\n- faster tiff read for some common cases\n- faster im_tile_cache()\n- if we use C++ in libvips, add -lstdc++ to vips-7.xx.pc \n- im_vips2png() / im_png2vips() set / get png resolution (thanks Zhiyu Wu)\n- updated README\n- don't use tables for bilinear on float data for a small speedup (thanks\n  Nicolas Robidoux)\n- no tables for uchar either, about a 15% speedup (thanks Nicolas)\n- dmask write was broken\n- lr/tbmerge() cast images to match, like im_insert()\n- lr/tbmosaic() work for any mix of image formats / bands\n- removed ancient balance stuff from im_lr/tbmosaic()\n- gtk-doc for mosaicing\n- add im_fits2vips() to the operation database\n- im_fits2vips() is lazy and much faster\n- im__file_open_write() / _read() has a flag for text_mode, get rid of all the \n  remaining fopen()s\n- move cooc_* and glds_* to deprecated\n- move im_dif_std() to almostdeprecated\n- move im_simcontr() to almostdeprecated\n- add im_sines() to operation db\n- move im_spatres() to almostdeprecated\n- done gtk-doc for other\n- --vips-progress tells you about nthreads, tile size, nlines\n- gtk-doc for interpolate\n- move im_stretch3() to deprecated\n- move im_clamp() to deprecated\n- gtk-doc for video ... all operators done! amazing argh\n- set MAP_NOCACHE on OS X, otherwise performance dives off a cliff with \n  files larger than memory\n- removed man pages, we are all gtk-doc now\n- im_jpeg2vips() ignores weird APP1 chunks\n- im_add() for int/uint was broken\n- im_ri2c() was broken\n- added VIPS_FORMAT_BIGENDIAN format flag\n- moved IMAGE and REGION to VipsImage and VipsRegion, classes over VipsObject\n- Rect -> VipsRect\n- libpng-1.5 supported\n- better png read for 1-bit and palette images\n- fits write\n- better fits metadata support\n- renamed all header fields, old names still supported, hopefully\n- all of iofuncs moved to vips_ namespace\n- lots of old iofuncs API moved to deprecated\n- added VipsOperation, an abstract base class for all vips operations\n- added VipsAdd, the first operation object\n- im_tiff2vips() int/uint mixup for rows_per_strip, thanks Bubba\n- removed the links feature, won't work with vips8\n- got rid of the tools/ subdirs\n- added im_bufjpeg2vips()\n- tiff reader can do 1, 2, 4, 8 bit palette images\n- tiff palette read can do mono images\n- im_bufjpeg2vips() has a \"header_only\" parameter\n- added vips_image_get_data()\n- updated German translation (thanks Chris)\n- fixed typo in im_conv() overflow estimation which could cause errors\n- vips.c has new action syntax, knows about vips8 operations\n- add now has sizealike\n- vips7 binops all do sizealike too, also gbandjoin and ifthenelse\n- new API is now functional\n- vips.c generates GOption flags for vips8 operations\n- added im_gauss_dmask_sep()\n- laplacian generator lost -ve lobes for large sigma\n- added im_aconv(), approximate convolution\n- bumped smalltile to 512x512 for testing\n- added VipsPool, got rid of floating refs again, argh\n- VIPS_EXEEXT is now part of the exported API\n- im_blend() also does sizealike, oops\n- jpeg write was not inverting CMYK, thanks Ole\n- im_falsecolour() converts to mono 8-bit for you\n- im_icc_import*/export*() cast inputs for you\n- im_vips2tiff() uses im__temp_name() for intermediates\n- added vips_wrap7 ... wrap up vips7 operations as vips8 classes\n- man pages are back for commands\n\n30/11/10 started 7.24.0\n- bump for new stable\n- added im_dmask2imask(), im_imask2dmask()\n- im_rotate_*mask90() can do masks of any size (thanks Adam Turcotte)\n\n18/7/10 started 7.23.0\n- im_vips2bufjpeg() writes to a linked list, so it will work for any size\n  image and header\n- added im_vips2bufpng()\n- use GetTempPath() to pick a temp dir on Windows\n- added \"rd\" mode to im_open()\n- vipsthumbnail and vips use \"rd\"\n- im_divide spots /0\n- remove liboil dependency, we will use Orc instead\n- various small cleanups (thanks Tim)\n- add lcms2 support\n- VImage(filename) defaults to \"rd\" mode\n- revise window_offset / window_size, again\n- fix a mixup with ANY hints that caused performance problems on the main\n  benchmark\n- rewritten im_circle as im_draw_circle, im_circle moved to almostdeprecated\n- added IM_TYPE_RW args for inplace ops --- nip2 uses this to wrap inplace ops\n  automatically\n- special-case 3x3 masks in im_conv() for a 20% speedup\n- add IM_TYPE_RW flag for im__rw_image, helps nip2 auto-wrap inplace ops\n- im_insertplace() casts and bandalikes\n- copy iconv.m4 and friends in bootstrap, thanks Mike\n- moved the stupid _copy() versions of the inplace ops to deprecated, since\n  nip2 can call inplace ops directly now\n- added im_draw_rect(), moved im_paintrect() to deprecated\n- added im_draw_image(), moved im_insertplace() to deprecated\n- added im_draw_line(), now clips, moved im_fastline() to deprecated\n- added im_draw_line_user(), now clips, moved im_fastlineuser() to deprecated\n- added im_draw_mask(), now wrappable, moved im_plotmask() to deprecated\n- added im_draw_point(), moved im_plotpoint() to deprecated\n- added im_read_point(), now partial, moved im_readpoint() to deprecated\n- added im_draw_smudge(), moved im_smudge() / im_smear() to deprecated\n- convolution functions support complex images\n- im_blend() can have any format condition image and it's converted to uchar\n- security fix for vips-7.23 wrapper script (thanks Jay)\n- im_affine() has a larger safety margin\n- fix gtk-doc warnings\n- small mask load/save improvements\n- mask gtk-doc done\n- add cfitsio dependency\n- add FITS reader\n- land the vector branch and the orc dependency ... we have SSE\n  erode/dilate/add/conv\n- add IM_SWAP\n- dilate/erode do (!=0) on non-uchar images\n- add multipass Orc to im_conv(), 3.5x faster for 5x5 mask\n- im_profile() works for any image format, any number of bands\n- im_rank_image() works for mix of formats, bands\n- morph gtk-doc done\n- oops, missing braces in debug.h and util.h, thanks Laurence\n- update C++/Python binding\n- oop, bool constants are always (int) now, so (^-1) works for unsigned types,\n  thanks Nicolas Robidoux\n- much lower memuse for im_cache() in complex pipelines\n- im_scale_dmask() normalises to 20, not 100 ... we hit the fast\n  conv path more often\n\n12/5/10 started 7.22.2\n- the conditional image of ifthenelse can be any format, a (!=0) is added if\n  necessary\n- oops vipsthumbnail sharpening was turning off for integer shrinks,\n  thanks Nicolas Robidoux\n- im_vips2jpeg() could fail for very small images (thanks Tim)\n- threadpool wasn't stopping on allocate errors (thanks Tim)\n- vips_sink_disc() could block if allocate failed (thanks Tim)\n\n12/5/10 started 7.22.1\n- fix a problem with tiff pyramid write and >1cpu, thanks Ruven\n- constant ops clip to target range\n- oops, moreconst and moreeqconst were the same\n- better buffer handling in sinkdisc for single-line images\n- less chatty errors from \"vips\"\n- oops, don't rename \"copy_set\" as \"copy_\", thanks Ole\n\n12/5/10 started 7.22.0\n- bump and rename\n- vipsthumbnail has a manualpage and sharpens correctly\n- more interpolator work\n- fixes to --disable-cxx mode (thanks Mike)\n- added German translation, thanks Chris Leick\n- fixed typos in some messages, thanks Chris Leick\n- fix gettext startup\n- all \"colour\" in messages changed to \"color\", have a proper en_GB\n  translation file\n- vipsthumbnail delete profile failed if there was a profile\n- interpolate cli unref was broken\n- more accurate, slightly faster bilinear and bicubic (thanks Nicolas Robidoux)\n\n21/3/10 started 7.21.3\n- added progress feedback to threadpool\n- --vips-wbuffer2 switch does all wbuffer use now\n- im_wbuffer2() renamed as vips_discsink(), some cleanups\n- im_gammacorrect() can do 16-bit images too\n- im_histplot() could fail for signed int histograms\n- im_fwfft() and im_invfft() could free their output image too early\n- added im_local_imask(), im_local_dmask()\n- added im_mpercent_hist()\n- im_maplut() casts the index image to one of the uint types\n- fixed a couple of /0 problems with scale == 0 masks\n- set G_LOG_DOMAIN to VIPS so we can use g_warning etc.\n- added VIPS_DEBUG_MSG() macro\n- --vips-wbuffer2 turns on threadpool for im_iterate as well\n- im_vips2tiff() uses vips_sink() instead of threadgroup\n- strip out threadgroup\n- add --enable-debug=xxx flag\n- im_iterate() -> vips_sink()\n- better number-of-bands detection for im_magick2vips()\n- added im_get_argv0()\n- added PFM read / write\n\n16/1/10 started 7.21.2\n- \"invalidate\" is careful to keep images alive, so invalidate callbacks can do\n  im_close()\n- flood_blob could loop if start point == ink\n- added im_meta_remove()\n- added remove profile option to vipsthumbnail\n- added vips_bandfmt_iscomplex() and friends, im_iscomplex() and friends\n  deprecated\n- im_bandjoin()/im_gbandjoin() work with images of varying formats\n- added im_copy_native(), deprecated im_copy_from() and friends\n- im_check*() name rationalisation\n- finally removed old flood stuff\n- im_insert*() bandalike and formatalike\n- im_*join() bandalike and formatalike\n- im_ri2c() bandalike\n- im_vips2png() saves 16-bit PNGs, if necessary\n- vipsthumbnail has selectable interpolators, optional sharpen\n- moved a lot of stuff (eg. im_iscomplex()) from deprecated to\n  almostdeprecated to avoid breakage\n- im_csv2vips(): allow lines that end with EOF rather than \\n\n- im_vips2tiff has a bigtiff option\n- oops, im_lineset() needs to ask for WIO of mask and ink\n- move cache invalidation to REGION, fixes a race\n- don't im_invalidate() after paint, it can cause horrible performance\n  problems ... for example, im_plotmask() used as the action operator for\n  im_fastlineuser() is terrible\n- instead, users of the inplace operations need to call im_invalidate() at the\n  end of a set of paint actions to trigger an update\n- parent/child renamed as upstream/downstream in DAG\n- set VIPS_ICC_DIR in configure\n- ICC profiles are looked for in VIPS_ICC_DIR as a fallback\n- im_render() mask image generation no longer triggers image calc\n- threadgroups scale output buffers with number of threads for smalltile ...\n  improves SMP scaling for narrow images on many-way machines\n- default to max number of processors (--vips-concurrency and IM_CONCURRENCY\n  set >0 can override) on linux and win32\n- better nprocs guesser\n- im_render() fixes to help the paintbox, some speedups too\n- added im_wbuffer2(), a new distributed threading system, and --vips-wbuffer2\n  to enable it, thank you Christian\n\n15/1/10 started 7.21.1\n- added \"written\" callbacks, used to implement write to non-vips formats\n\n26/11/09 started 7.21.0\n- branch for new dev cycle\n- argh, missing init from colour.c (thanks Peter)\n- argh, im_measure() was not looping over bands correctly (thanks Peter)\n- removed mmap_limit, we now always use windows ... reduces VM use hugely,\n  because mmap windows are freed when their regions are freed, while images\n  are only unmapped when they are closed\n- have a min bytes for mmap windows as well, so we don't make too many tiny\n  windows\n- im_disp2Lab() was broken\n- deprecated.h is now defined in terms of current functionality, rather than\n  repeating stuff\n- im_flood() and friends rewritten, typically 4x faster\n- removed --with-cimg option, added --disable-cxx\n- added im_system_image() (thanks Roland)\n- added postclose callbacks\n- added vipsthumbnail\n- oops, generate C++/Python wrappers for deprecated operations by default\n- read TIFF images strip-wise, not scanline-wise\n- better TIFF YCbCr reading (thanks Ole)\n- isanalyze generates fewer silly error messages\n\n26/11/09 started 7.20.3\n- updated en_GB.po translation\n- file_length is gint64 to avoid win32 breakage\n\n23/11/09 started 7.20.2\n- GETTEXT_PACKAGE now includes lib version number (thanks Jay)\n\n11/11/09 started 7.20.1\n- oop, im_clip2fmt() was missing PTOP flag, should get a small speedup\n- im_conv() / im_convf() didn't like all-zero masks\n- small updates to im_convf() from im_conv()\n- im_read_imask() produced an incorrect error message if passed a doublemask\n- rename im_convf(), im_convsepf() as _f()\n- vips.c drops _f suffix when overloading\n- regenerate C++ binding, don't make deprecated package\n\n9/11/09 started 7.20.0\n- removed vips-7.x.spec.in, shouldn't really have this in SVN\n- bumped version to 7.20\n- fixes to get \"make dist\" working again\n\n3/4/09 started 7.19.0\n- version bump\n- tiny conv speedup\n- catch lcms error messages\n- fix includes for gtk+-3.0\n- report virtual memory too in im__print_all()\n- cosmetic changes to nohalo\n- im_magick2vips() needs to invert alpha\n- now (more or less) passes -Wextra\n- added \"fail\" option to im_jpeg2vips: fail with an error on any warning\n  (thank you Ole)\n- started gtk-doc changes\n- renamed im_meta_get_type() and im_header_get_type() as\n  im_meta_get_typeof() and im_header_get_typeof() to prevent confusion with\n  GObject type definers (was breaking gtkdoc object scan)\n- revised more names, limited documented API\n- im_buildlut() could segv for non-zero based tables (thanks Jack)\n- VIPS_BUF_STATIC() does not take length arg\n- check for SetImageOption() so we work with GraphicsMagick too\n- \"header\" sets a non-zero exit code if anything failed\n- add and use im_check_uncoded() and friends\n- matlab load handles column-major and plane-separated images (thanks Mikhail)\n- JPEG save allows \"none\" for profile, meaning don't attach a profile\n- saner, simpler, faster typecasting for im_add(), im_subtract(),\n  im_multiply(), im_divide(), im_remainder()\n- im_remainder() has a float result for float types\n- im_measure() allows sel == NULL, meaning all patches\n- added \"deprecated\" package\n- faster, simpler, better im_max(), im_min, im_avg(), im_deviate()\n- im_max() returns true modulus, not square of modulus, for complex images\n- im_avg() works for complex, returning average modulus\n- im_system() fix (thanks Roland)\n- im_system() rewrite\n- im_maxpos()/im_minpos() are partial and work for complex\n- im_max()/im_min() are now convenience functions\n- im_maxpos_avg() handles complex and multi-band images\n- added im_point(), rewrite im_point_bilinear() in terms of this\n- close callbacks now happen *after* images have closed resources (such as\n  open files) ... this lets them delete temps and stuff. Expect breakage :(\n- added vips_interpolate_get_window_offset()\n- boolean revised: smaller, more general, faster\n- im_remainderconst_vec() renamed to im_remainder_vec() for consistency\n- added im_shift*_vec()\n- renamed im_eor_vec() as im_eorimage_vec() for consistency, also and, or\n- renamed im_eorconst() as im_eorimage_const() for consistency, also and, or\n- relational revised: smaller, more general, faster\n- im_blend()/im_ifthenelse() allows many-band conditional, 1-band then/else\n- im_blend()/im_ifthenelse() allows band and format to differ between then\n  and else parts\n- better im_check() functions\n- added im_flood_other() as start of simple segmentation operator\n- added im_label_regions()\n- im_printlines(), im_debugim() deprecated (use im_vips2csv() instead)\n- meta, header, callback, error, region, check, generate, memory gtkdocs\n- removed printlines tool, vips2csv is much better\n- removed other useless tools as well: debugim, binfile\n- fix up addr calcs on 64-bit machines with >2gb images and inplace ops\n  (thanks Christoph)\n- im_generate() checks that im_demand_hint() has been called for this image\n- im_jpeg2vips.c, set scale_num on shrink (thanks Guido)\n- heh argh reading history always stopped after the first line (thanks Haida)\n- added im_histindexed\n- new im_iterate() calls start and stop functions from workers so resources\n  they make are owned by the worker thread ... this makes it possible to have\n  start functions which create mutiple regions and therefore allows\n  im_iterate() to scan more than one image at once\n- threadgroup no longer has any default action, you must attach a work\n  function\n- added im_copy_file()\n- added im_insertset()\n- im_insertplace() allows small to be outside big\n- added im__colour_difference(), colour ops now work on any image format\n- added im_col_display_get_table(), so display tables are now shared by name\n- added im__colour_unary()\n- drop \"set\" postfix from names, so \"insert\" can now take a vector of positions\n- deprecate all the \"_raw\" variants, not really necessary now\n- removed \"contrib\", not very useful anymore\n- added im_header_as_string()\n- im_malloc()/im_free() now call g_try_malloc()/g_free() ... removes confusion\n  over whether to use im_free() or g_free() for things like im_header_string()\n- added im_history_get(), im_getexp(), im_printdesc() as wrapped functions ...\n  so you no longer need the \"header\" program\n- image vectors from Python work, woo\n\n25/3/09 started 7.18.0\n- revised version numbers\n- updated vipsmanual\n- revised manpages\n- removed name and \"changed\" from vipsobject since we don't use them yet\n- explicitly link with stdc++ for nohalo etc. stuff\n- wrap im_gauss_imask_sep in C++/Python\n\n6/3/09 started 7.17.3\n- revised nohalo\n- remove fading stuff from im_render() -- cleaner and simpler\n- configure spots support for \"restrict\"\n- reset dcm:display-range on magick read to help DICOM\n- saner im_buildlut() behaviour\n- added im_gauss_imask_sep()\n- allow open and view of truncated images (thanks Joe & Rachel)\n- revising rounding on im_affine*() coordinate transforms to make them more\n  stable\n- added Radiance write\n- added im_float2rad()\n- added IM_CODING_RAD, support where it makes sense (extract, flip, rotate,\n  etc.)\n- IM_PROGRESS env var\n- docs for rad2float and IM_CODING_RAD\n\n3/3/09 started 7.17.2\n- im_magick2vips.c: allow funky bit depths, like 14 (thanks Mikkel)\n- isradiance was returning TRUE too often\n- radiance loader now loads packed RGBE/XYZE instead of unpacking to float\n- added im_rad2float()\n\n11/10/08 started 7.17.0\n- merge vips-7.16 brach back into trunk\n- bumped version number to 7.17.0\n- re-added type.[hc]\n- added vipsinterpolate and im_affinei\n- added yafrsmooth interpolation\n- added yafrtest\n- added yafrnohalo\n- ubuntu 8.10 changes\n- interpolators get an output pointer, not region\n- tuning for bicubic\n- revised transform / clip code, we now do corner not centre\n- yafr-smooth reworked along the lines of bicubic\n- cleanups after yafr hacking\n- added affinei_all\n- don't set im_error() on failed callback\n- moved im_format_t to VipsFormat, now sits over VipsObject\n- IM_FORMAT_FLAG_PARTIAL -> VIPS_FORMAT_PARTIAL\n- updated docs\n- interpolators use type introspection\n- added vips --list classes, does formats too\n- include sys/param.h to get PATH_MAX in more places\n- added vips_format_get_flags()\n- oop, forgot to check for cancel during tiled tiff write\n- don't use mmap for tiff read: no performance advantage, chews up VM\n- VIPS_INTERPOLATE_SHIFT bumped to 12, we need the extra precision for u16 gel\n  data\n- added string->double transform for cmdline args\n- merged class-params branch back into trunk\n- IM_FREE() can do \"const char*\" variables\n- im_buf_t renamed as VipsBuf\n- added vips_object_to_string()\n- added \"nickname\" and \"description\" properties to VipsObject\n- shift/and/or/eor ops were broken for non-int types\n- added nohalo interpolator\n- updated format docs\n- IM_INPUT_INTERPOLATE() now used by affinei and affinei_all\n- added vips_object_new\n- resamplers/interpolators now in a resample package\n- removed yafrnohalo.c\n- added matio as a dependency\n- added Matlab save file read\n- added Radiance file read\n- better file-not-found messages\n\n11/9/08 started 7.16.3\n- oop typo in manpage for im_project()\n- doc fixes\n- returning non-zero from eval callbacks was not always stopping computation\n\n11/9/08 started 7.16.2\n- added --without-v4l option\n- added -no-undefined to libsrcCC build, so we get a libvipsCC.dll\n- removed the swig dependency: we include the generated bindings in the\n  distribution tarball\n\n6/9/08 started 7.16.1\n- trigger eval callbacks on tiled tiff write\n- added vips as an im_format_t\n- added im_format_write()/_read() convenience functions\n- more cleanups for the format API, argh\n- removed win32/ directory now mingw finally makes DLLs correctly\n- removed the windowed spcor for now, it has some edge effects\n\n24/8/08 branch for 7.16\n- renames and version numbers\n- load plgs from libdir as well as libdir/vips-x.x for compat\n- complex -> complex conversion was broken\n- refstring <-> gstring transforms\n- better behaviour with Magick non-presence\n- added --enable-links switch to configure ... we no longer make the bin/im_*\n  links by default\n- started a 'format' section in the docs\n- configure fails if no gettext found\n- revised po/\n- released as 7.16.0!\n\n25/5/08 fork for loadable image format branch\n- image load/save in non-vips format code moved to own dir\n- simple format searching added\n- some cleanups for vips load\n- im_open() simplified\n- add im_format_flags\n- only consider formats with a save method in im_format_for_name()\n- oops, format sort order was reversed\n- im_filename_suffix() includes \".\" in suffix\n- merge back into trunk for 7.15.1\n- remove im_ispng(), im_png2vips_header() etc. & friends\n- add \"vips --list formats\"\n- rename VBuf as im_buf_t for consistency\n- add type.[hc], start of new type system\n- removed man pages for IM_MIN, MAX and RINT to avoid case confusion on\n  OS X / win\n\n7/3/08 started 7.15.0\n- MAGIC constants should be tagged as unsigned\n- write MAGIC correctly on sparc/powerpc machines (thanks Joe)\n- oop, we were still making fade threads even when not fading\n- tiny cond jump fixes for valgrind in colour.c\n- remove -lstdc++ from libs, except on windows\n- push Magick cflags earlier in the include order to make it easier to pick\n  GraphicsMagick over ImageMagick (thanks Mikhail)\n- fix the en_GB translation\n- use meta to preserve resunit between tiff load and save\n- small doc improvements\n- read and write CMYKA tiff (thanks Doron)\n- performance improvements for morphology ops, esp. when zooming out\n- oop, im_render() was broken for mask == NULL\n- better support for multiple Python installs (thanks Jay)\n- better IM_SETSTR() stops some warnings\n- im_histcum() works for signed histograms\n- better rounding for im_conv(), im_convsep()\n- tiny speedup for im_conv()\n- better /0 test for remainderconst\n- revise i18n configure, get rid of intltool\n- command-line IMAGVEC input could segv with non-vips image output\n- added .tobuffer()/.frombuffer(), .tostring()/.fromstring() to Python binding\n- add PIL_mode_from_vips () and vips_from_PIL_mode () utility functions\n- update docs for new Python stuff\n- FIND_ macros no longer search for stuff, you have to specify prefixes if the\n  packages are not on the default path (or in $prefix). This avoids some\n  accidents on some platforms\n- configure prints a summary of optional packages found at the end\n- im_lhisteq() checks for window too small\n- added invalidate callbacks\n- now tests for MagickWand before ImageMagick (thanks Adam Turcotte)\n- added \"-rotate\" option to vips2dj\n- added man page for im_resize_linear\n- better jpeg-in-tiff YCbCr read (thanks Ole)\n- oops, invalidatefns were not being freed on im__close()\n- VMask() can init from std::vector, so Python can init from []\n- added IM_LIBDIR, im_guess_libdir()\n- load plugins from libdir/vips-x.x on startup\n- added meta get/set int/double/string/area/blob/GValue to C++ API\n- include time_t in vips.h, thanks Nicolas Robidoux\n- lock global image list (thanks lee)\n\n25/1/08 started 7.14.0\n- bump all version numbers for new stable\n- better CMYK JPEG read (thanks Ole)\n- add __str__ to VError in Python (thanks Ole)\n- revert the dynamic wrapping for Python :-( next version!\n- added VImage::convert2disc (thanks Ole)\n- you can now set the jpeg quality factor for tiff pyramids (thanks Joe)\n- you can now shrink jpegs during read, see \"man im_jpeg2vips\"\n- added CMYK JPEG write\n- optionally use GraphicsMagick (thanks Bob Friesenhahn)\n- look for MAGICKCORE_HDRI_SUPPORT (thanks Marcel)\n- set icc profiles in tiff pyramids explicitly (thanks Joe)\n- add --without-cimg configure option\n- add im_maxpos_subpel\n- make im_abs compile without liboil\n- add im_align_bands\n- fix type overflow in complex division\n- fix im_cross_phase and im_addgnoise (Tom)\n- updated docs, C++ and python\n- header no longer stops on error\n- C++ dummy2.cpp helps OS X linking\n\n12/12/07 started 7.13.3\n- added \"include <cstring>\" to VImage.cc to help gcc 4.3\n- started moving the python binding to dynamic wrapping\n- added im_wrap(), im_wraptwo(), im_phasecor_fft(), im_cross_phase() (Tom)\n- memleak plugged in im_save_string_setf()\n- bugfix in and docs for im_gradcor() (Tom)\n- use Glib macros to make im_msb work on big-endian platforms (Tom)\n- use Glib macros to get rid of needless compile warnings (Tom)\n- fix type overflow in im_c2ps/im_abs (Tom)\n\n31/10/07 started 7.13.2\n- build cimg on windows fixes\n- various include cleanups, updated man pages\n- break im_wbuffer() out to a separate API\n- use im_wbuffer() to make im_vips2jpeg() compress in the background\n- also im_vips2png(), im_vips2tiff(), im_vips2ppm()\n- revised evaluation progress system\n- new evalstart/evalend/preclose callbacks fix over/underflow reporting\n- but the meaning of evalend has changed in a non-backwards-compatible way :(\n  use preclose instead ito get the old behaviour\n- added \"--vips-progress\" flag to turn on a simple eval progress tracker\n- make im_spcor[12] static, im_spcor is wrapper (Tom)\n\n28/9/07 started 7.13.1\n- vips2dj can print RGB images\n- oop, include <stdexcept> missing\n- add protos for generate/iterate function args, fix warnings\n- add cimg package, we now have C++ source inside VIPS, sigh\n- added OUTPUT_DOUBLEVEC and OUTPUT_INTVEC, use for im_maxpos_vec() and friends\n\n29/8/07 started 7.13.0\n- we now have a trunk and the version is 7.13.x, woo!\n- move manpages into a separate man/ dir ... speeds up builds a lot on windows\n- don't install malkovich\n- don't fail on unknown args for python (thanks Simon)\n\n1/8/07 started 7.12.5\n- im_embed() is more general ... x and y can be negative\n- predicate.c is smaller and cleaner\n- libsrcCC link improvement from Pablo\n- support 32/64-bit ImageMagick as well (thanks Marcel)\n- better im_magick2vips() for Q8 ImageMagick\n- split repository to trunk/branches ready for a stable 7.12.x branch\n\n27/7/07 started 7.12.4\n- proto.h had vars called small, breaking on win32\n- more python fixing, we now have working matricies too\n\n17/7/07 started 7.12.3\n- fix to VImage.i for gcc 4.2 (thanks Damir)\n- eek, off by 1 for more than 1 band hists\n- needed a slightly larger worst-case buffer in im__b64_encode()\n- tiny cleanup for make_hI() prevents cond jump on ui in valgrind\n- --disable-threads was broken again\n- remove .svn dirs from dist\n- now passes distcheck again\n\n17/7/07 started 7.12.2\n- added im_bandmean()\n- added support for TIFFTAG_PREDICTOR (Andrey Kiselev)\n- fix TIFFOpen() mode snafu (Andrey Kiselev)\n\n11/5/07 started 7.12.1\n- memory.c abort()s with DEBUG\n- oops, im_bits_of_fmt() manpage was not being installed\n- im_histcum() can do all image types\n- updated NEWS\n- added im_csv2vips_header()\n- command-line csv read was broken (thanks Tom)\n- removed length limit on argument vectors (Tom)\n- added IM_PREFIX, configure-time install prefix\n- oop, turned off memory.c DEBUG\n- fix some bogus gcc 4.1 warnings with im_open_local_array()\n- better vips usage message\n- oops, IM_ANY missing from im_demand_hint() manpage (thanks Shahid)\n- just warn if plugins fail to load in im_init_world()\n- expose Vargv and make refblock public rather than private so that\n  subclasses of VImage can add vips-style member operations (thanks Pablo)\n- oops, im_initdesc() needed to have bbits set correctly (thanks Shahid)\n- make VError derive from std::exception more officially\n- woo, got exceptions working in SWIG\n- soname version bumped to 12.x.x\n- oops, added vector ops to Python\n- check for overflow of int in return of strtol in dispatch system (Tom)\n- add im_[di]mask_[xy]size to dispatch system (Tom)\n- add im_gradcor(), im_grad_[xy] (Tom)\n\n26/3/07 started 7.11.21\n- ooo, added %include \"std_except.i\" & friends to VError.i, VImage.i\n- im_init_world() is more lenient about recursive invocation\n- im_gbandjoin() falls back to im_copy() for 1 input image\n- race condition fixed in im_render.c (thanks Simon)\n- bump for 7.12!!!\n\n26/1/07 started 7.11.20\n- another fix to im_region_image() (thanks Mikkel)\n- tiny speed up to im_rect_includesrect()\n- avoid recursive invocation in im_init_world() (thanks Christian)\n- fix to extract_prefix (thanks Christian)\n- buffer cache is now per thread\n- combine buffer unref and ref in a single operation to reduce malloc/free\n  cycles\n- new internal API for passing regions between threads means we can remove\n  buffer locks\n- more buffer/region sanity checks, plus a memory barrier\n- lock around error buffer changes\n- im_vips2mask() was wrong for nx1 m-band images\n- liboil back to \"test\"\n- add buffer_cache_list to avoid GHashTable _insert()s\n- oop, --vips-concurrency was broken\n- renamed (in dispatch layer) im_and/or/eor_const -> im_and/or/eorimageconst\n  for consistency\n- C++ API wraps IMAGEVEC, DOUBLEVEC, INTVEC arguments\n- oop, IMAGE % vector<double> was broken\n\n21/12/06 started 7.11.19\n- added im_linreg() (Tom)\n- various C++ API polishes, plus a bugfix (Dennis Lubert)\n- vips.spec split to devel and python too (Dennis Lubert)\n- be more explicit about sizeof(magic)\n- init magic to native order by default (thanks Dennis)\n- Hist becomes im_history_get()\n- new history mechanism is faster, uses much less memory, and removes\n  duplicate lines\n- added im_get_option_group()\n- added official im_concurrency_set()/_get()()\n- don't read bbits from vips files ... set ourselves from bandfmt\n- oops add RGB16 and GREY16 to C++ header\n- --list packages option to vips.c\n- updated docs to 7.12\n- oops, im_region_image() snafu was causing a lot of recomputation\n- make im_mpercent() suck a little less\n- EXIF save was a bit bOrked ... cause of mac crashes?\n- im_histgr(), im_heq(), im_hist() all number bands from zero now\n- fix stride in liboil calls\n- set RGB16 on 16-bit RGB ICC export\n\n29/11/06 started 7.11.18\n- added im_buffer_t so regions can share calculated pixels: 2-3x speedup on\n  the benchmark\n- im_region_local() -> im_region_buffer()\n- im_sharpen() order change to help sharing\n- im_invalidate() clears buffer caches\n- add sentinel attributes\n- add some missing im_demand_hint()s\n- paint ops invalidate the output image\n- fix nothread eval\n- raise threads limit to 1024 (thanks Christian)\n- manual redone\n- vipsCC python init() hooks\n- add liboil dependency\n- use liboil for im_abs(), im_add(), im_divide(), im_floor(), im_multiply(),\n  im_subtract(), im_lintra(), im_avg(),im_deviate()\n- quiet libtoolize test (thanks Tom)\n- im_benchmarkn now regrows image each time\n- strip meta from sample2.v ... saves a lot of mem (esp. Hist)\n- added im_isscalar() (Tom)\n- added IM_REGION_ADDR_TOPLEFT() (Tom)\n- reduce size of im_rightshift_size.c to help compile (Tom)\n- make im_stop_many(NULL) safe (Tom)\n\n24/11/06 started 7.11.17\n1;5Q\n- better benchmark script makes graphing easier\n- double-buffer image file writes\n- reuse write threads\n- clean up threadgroup / iterate / generate\n- added im_benchmarkn to make it easier to make a CPU-bound op on large\n  machines\n- im_cache() failed for cpus > 1\n\n1/11/06 started 7.11.16\n- moved im__convert_saveable() into im_copy() (thanks Christian)\n- missing gobject dependency (thanks Christian)\n- --enable-threads was broken (thanks Christian)\n- eval without theads was broken (thanks Christian)\n- LIBADD libvips.la to libvipsCC.la (thanks Simon)\n- benchmark.sh is now plain sh, not bash\n- set ORIENTATION_TOPLEFT in im_vips2tiff (thanks Josef)\n- oops, im_vips2csv() output separator was broken\n- added im_benchmark2\n- move XYZ2Lab LUT build outside the eval thread\n\n30/10/06 started 7.11.15\n- print leaked windows\n- oops, race condition in im_window_unref()\n- integrated im_region_window() into im_region_image(), tiny speed up\n\n6/10/06 started 7.11.14\n- ifthenelse and affine dhints revised\n- buildlut no longer outputs x cods\n- configure asks for glib >= 2.6 (we need GOption)\n- configure uses AC_TOOL_CHECK to find tool names to help cross-compiling.\n- better configure test for libexif\n- add </libexif/ prefix if required\n- test for glibtoolize during bootstrap to help OS X\n- add --version to vips main prog\n- don't set Type in im_scale, want to be able to scale hists, for example\n- im_vips2mask() allows multiband hists as well\n- im_vips2csv() lets you specify an output separator\n- vips.c cleanups in arg handling\n- removed python binding to C layer, too hard to get it working right\n- leak test python test program\n- added throw() decls to C++ to help SWIG\n- no longer derive VError from std::exception, can't get it to work with SWIG\n- added mmap window manager to share windows between regions ... big reduction\n  in VM use for large workspaces and for SMP\n- add im_spcor2 (with sliding window) (Tom)\n\n15/9/06 started 7.11.12\n- python vips wrapper hooks into init to start vips\n- oop, python detect was broken again\n- im_file_length() error return was wrong (thanks Christian)\n- im_csv2vips() isnored last column if there was no trailing\n  whitespace/quoting\n- test for NULL filename/mode, common if you forget to check argc\n  (thanks Bruno)\n- im_break_token() returns NULL on trailing whitespace ... helps read_dmask\n  work with trailing whitespace on matrix headers\n- added im_buildlut(3)\n- removed extra im_free() in im_copy() fallback in im_msb()\n- added GValue input/output args\n- various C++ binding improvements (thanks Dennis): namespace support,\n  VError inherits from std::exception, small fixups\n- remove im_msb() warning on fallback to copy for uchar ... not very serious,\n  happens a lot in nip2\n- added <vips/vips> C++ include ... include in a namespace\n- added im_benchmark / SMP benchmark script\n- add im_maxpos_avg() and im_point_bilinear() (Tom)\n- make im_region_free(NULL) safe (Tom)\n- link in manpages for im_contrast_surface (Tom)\n\n8/9/06 started 7.11.11\n- add im_norm_dmask()\n- removed old code for gradient and lindetect\n- internal decls split from proto.h to help SWIG\n- test for python and SWIG during configure\n- added python dir for the binding\n- python binding done!\n- oops, --without-python was broken (thanks Tom)\n- added python/test\n- add im_lu_decomp() im_lu_solve(), rewrite NR type functions in terms of these (Tom)\n\n23/6/06 started 7.11.10\n- still more im_affine() rounding/clipping tweaks\n- ignore \"--\" arguments to vips.c\n- im_init_world() also sets g_*_prgname() and loads plugins\n- add manpage for im_init_world() (oops)\n- error_exit() prints prgname\n- various cygwin fixes\n- fix cache thread assert failure (thanks Joe)\n- \"header\" now uses GOption, slightly different args, will loop over args\n- fixed assert() overenthusiasm in im_prepare()\n- im_csv2vips() now has separate whitespace / separator tables\n- add im_rightshift_size() (Tom)\n- add im_maxpos_vec(), im_minpos_vec() (Tom)\n- add im_norm_dmask() (Tom)\n- make im_free_[di]mask(NULL) safe (Tom)\n\n23/6/06 started 7.11.9\n- back on sourceforge CVS again\n- require openexr 1.2.2 or greater\n- range check xy on im_insert*() for sanity\n- VMask::invertlut decl removed (thanks Jean)\n- added \\\"all\\\" option to vips.c\n\n17/5/06 started 7.11.8\n- debrokened openexr read\n- added im_tile_cache()\n- added tiled read to im_exr2vips()\n- im_tiff2vips() now uses im_tile_cache() rather than its own cache ...\n  faster in some cases, less RAM use in some cases, saves 200+ lines\n- removed 'broken' read option from im_tiff2vips()\n- read/write doubles with g_ascii_strtod() and friends where appropriate\n- add a \"thread\" member to region to help sanity check region ownership\n- saner threadgroup fixes a race problem on gcc 4.0.3 / amd64\n- added im_vips2csv()\n- im_open() now does CSV read/write too\n- oops, broke vips main prog for function name in argv1 case\n\n22/4/06 started 7.11.7\n- split vips_png.c to im_vips2png.c and im_png2vips.c\n- added OpenEXR dependency\n- added im_exr2vips(), im_exr2vips_header()\n- added im_isexr(), im_open() knows about OpenEXR\n- added im_contrast_surface(), im_contrast_surface_raw() (Tom)\n- added im_msb(), im_msb_band() (Tom)\n- im_scale() sets Type on output\n- added RGB16, GREY16 types\n- im_*2vips() set these types if appropriate\n- configure fixes for mac\n- vips main prog uses GOption\n- im_icc_* locks around calls to cmsDoTransform() to avoid corruption on SMP\n  machines\n- add im_prepare_many() (Tom)\n\n10/3/06 started 7.11.6\n- typo in manpage and header for im_rect_dup() (Tom)\n- don't abort image load if XML read fails\n- added im_video_test() ... test video source\n- oops, lcms .pc finder was not working\n- clipping problem in im_affine() fixed (thanks Clare)\n- test for attr support in libmagick\n- im_text() returns an error for empty string\n- im_falsecolour() scale reversed\n- im_remosaic() could crash on bad mosaics\n- configure changes to fix --without-magick, lcms and fftw (but sadly we now\n  require .pc files for these libs)\n- im_vips2jpeg() automatically converts to 1 or 3 band sRGB uchar for write\n- also im_vips2png()\n- added im_project()\n\n20/2/06 started 7.11.5\n- added im_csv2vips()\n- commas in filename options can be escaped with a '\\'\n- raise tile buffer limit (thanks Ruven)\n- im_spcor() and im_fastcor() have prettier borders\n- im_fastcor() returns sum of squares of differences, not sum of abs of\n  differences\n\n18/11/05 started 7.11.4\n- small win32 fixes, thanks Juan\n- added im_flood_blob_copy() ... a temporary hack\n- much faster im_histplot()\n- read RGBA palette-ized PNG images more robustly (thanks Tom)\n- turn on -ms-bitfields automatically for mingw\n\n26/9/05 started 7.11.3\n- better error recovery for im_binfile() file too large\n- all raw files now use mmap windows, so (eg.) ppm and analyze reads can go\n  >2GB\n- remove DISABLE_COMPAT ... you now have to define IM_ENABLE_DEPRECATED to get\n  broken #defines\n- fix to build without exif, thanks Chas\n- use native win32 API for seek()/truncate() to work with large files\n- use attribute to check printf-style args with gcc\n- fix gcc4 warnings\n- removed ebuild, since it's in gentoo now\n- im_magick2vips() sets meta from attributes (good for dicom)\n- im_magick2vips() writes many-frame images as tall thin VIPS images\n- im_histcum() was broken for vertical histograms\n- im_histnorm() is neater\n- simpler and faster inner loop for im_conv() and im_convf() avoids gcc4 bug\n- appendc() was reading past the end of the buffer on MSB machines\n\n13/6/05 started 7.11.2\n- im_copy_set() was messed up in 7.11.1\n- put into CVS, phew\n- fixed a rounding bug in im_affine() ... should no longer get black edges on\n  image resize\n- if TIFF open fails in im_open(), try going through libmagick\n- merge requires all bands == 0 for transparency (used to just check 1st\n  band)\n- 16 bit LAB TIFF read/write was wrong\n- new GType for refstring makes it visible from im_header_map()\n- jpeg loader attaches exif data (and human-readable meta fields)\n- jpeg saver writes any exif data\n- meta not wiped by im_*incheck() in a \"w\" image\n- meta keeps traverse order\n- now require glib >= 2.4\n- require libxml-2.0 for meta save and new history mechanism\n- no more .desc files, history saved in XML after pixel data\n- i/s/d meta fields saved there too\n- added base64 encode/decode\n- added blob header write\n- added a save string type: types which define transforms to and from the\n  save format get serialized\n- GValue meta API now exposed, since we can serialise anything\n- jpeg loader loads ICC profiles\n- jpeg saver saves ICC profiles from the VIPS header\n- src/header.c knows about meta system\n- added im_analyze2vips(), im_grid(), im_raw2vips()\n- extract/grid/replicate/zoom were not setting TRANSFORM flag\n- better falsecolour LUT\n- less stupid + more portable read/write of VIPS header\n- better im_updatehist()\n- jpeg load sets vips xres/yres from exif, if possible\n- jpeg save sets exif xres/yres from vips, if possible\n- icc_export and icc_transform  attach profiles and intents to output images\n- added im_icc_import_embedded() to import with an embedded profile\n- split vips_jpeg.c into two, it was getting too big\n- added im_cp_descv(), im_cp_desc_array(), funcs use them\n- removed im_append_Hist() from API\n- fixed meta copy bug\n- better history copy, removed nonsense about 1st line of Hist being special\n- tiff read/write now reads/writes ICC profile from meta\n- edvips rewritten to remove stupidness, and can now set xml\n- header can now print xml extension block\n- IM_ prefix for colour temp names\n\n1/6/05 started 7.11\n- added im_copy_morph()\n- im_region_region() allows Bands and BandFmt to differ, provided\n  sizeof( pel ) is the same ... makes im_copy_morph() work\n- added im_meta*() functions (MW)\n- im_header_*() rewritten for meta\n- added im_header_exists(), im_header_map()\n- use pkg-config to find libpng and ImageMagick\n- added im_lineset()\n- added im_extract_areabands() (JF)\n- added im_copy_from() (JF)\n\n15/4/05 started 7.10.12\n- im_ifthenelse just evals left/right for region all zero/all one\n- also im_blend\n- swap g_setenv() back to plain setenv() so we work with glib 2.2\n\n9/4/05 JC started 7.10.11\n- docs no longer have broken links\n- fixed memleak in im_text()\n\n8/4/05\n- one bit tiff read was sometimes reading a byte too far in each scanline\n\n14/1/05 started 7.10.9\n- im_filename_split() will now usually work for filenames containing ':'\n  characters\n- added im_render_fade() for fancier nip2 image repaint\n- added \"ccittfax4\" as a TIFF compression option\n- fix all 64-bit compiler warnings\n- \",\" allowed as column separator in mask read\n- better at spotting singular matricies\n- small im_render() tidies\n- glib dependency reduced to just 2.0, but untested ... helps people building\n  on older systems who aren't interested in nip2\n- removing leading spaces from IMAGEVEC arguments\n- load non-interlaced PNGs more efficiently\n- 1 point mosaic functions work on more image types\n- better memory allocation debugging info\n- local memory on regions can shrink as well as grow\n- shut down threadgroups on render if no dirty tiles\n- limit number of simultaneous renders\n- higher mmap window threshold\n- allow max == -1 for unlimited render cache\n- 'priority' marks non-suspendable renders\n- im_embed() mode == 4 paints white pels\n- im_tiff2vips() was broken with --disable-threads\n- oops, im_errormsg() compat macros were GCC only\n- larger default tile size and strip height\n- tiff write sets PHOTOMETRIC_CIELAB for vips TYPE_LAB images ... so we can\n  write float LAB as well as float RGB (thanks Ruven)\n- also 16 bit LAB TIFF write\n- im_render() rewritten\n\n20/11/04 started 7.10.8\n- im_sharpen() is ~15% faster\n- more quoting for MAGICK finder\n- im_XYZ2Lab() uses a LUT rather than cbrt(), 5x faster\n- --disable-threads removes gthread dependency completely (thanks Simon)\n- intercept TIFF warnings as well as errors ... stops occasional libMagick\n  exceptions\n- add im_init_world() to im_init() as well to help backwards compat (thanks\n  Simon)\n- im_icc_present() function description was broken, thanks Jay\n- oops, libtool library versioning was wrong, thanks Jay\n- can now make TIFF pyramids of any non-complex image type (was uchar and LAB\n  only), thanks Ruven\n- 1st order mosaic code now works for LABQ too\n- build system changes to make \"make distcheck\" work\n- RPM .spec files fixed up and updated by configure (thanks Simon)\n- tiny cleanups for vdump\n- use g_setenv()/g_getenv()\n- tiny improvements to IM_FREE*()\n- tiny VImage debug print fixes (thanks Jay)\n- swap off_t for gint64 to fix LARGEFILE support on win32\n- computation feedback now uses gint64 for number of pels, so we give feedback\n  correctly on images with >2**31 pels\n- other small fixes for >2**31 pels in an image\n\n10/11/04 started 7.10.7\n- im_histnD() was not checking BandFmt (thanks Kirk)\n- improvements to threading system speed up non-vips output in some cases\n- use cbrt(x) where we can ... 10x faster than pow(x,1.0/3) on win32\n- typeo in im_text() when built without PANGOFT2 (thanks Stefan)\n\n1/11/04 styarted 7.10.6\n- tiny doc fixes\n- scripts now only depend on 'vips' program\n- im_open( \"r\" ) is now lazier ... for non-VIPS formats, we delay read until\n  the first ->generate()\n- so im_open_header() now deprecated since im_open(\"r\") is identical\n- now looks for fftw3 as well as fftw2 ... slightly faster ffts\n\n19/10/04 started 7.10.5\n- fix to light_correct (thanks Jay)\n- edvips knows about xoffset/yoffset\n- better vips enum<->char conversions\n\n4/10/04 started 7.10.4\n- man page fixes (thanks Jay)\n- removed last csh scripts (thanks Jay)\n- scripts default VIPSHOME to $prefix (thanks Jay)\n- doc build system tidies\n- im_rank() edge padding was wrong\n- im_vips2tiff() can now embed ICC profiles\n\n22/9/04 started 7.10.3\n- mildly better im_vips2tiff()\n- *, -, +, /, % between two images now work for mixed number of bands\n- im_free() was missing a man page\n- revised documentation\n\n1/9/04 started 7.10.2\n- C++ .pc files were still set for 7.9, grr\n- im_insertplace() didn't check compatibility of images (thanks Matt)\n\n27/7/04 started 7.10.1\n- set default stack size explicitly to help platforms with a very low default\n- 16 bit RGB tiff read was broken (bug introduced in 7.9.5, thanks Haida)\n- !pangoft2 was broken, thanks Kenneth\n- win32 build fixes\n\n12/7/04 renamed as 7.10.0\n- added NOCACHE function flag ... stops nip memoising video & paint ops\n- added im_extract_bands() ... takes out many bands from an image\n- im_vips2tiff() scanline write speed up for area pipelines\n\n10/6/04 started 7.9.6\n- tiny polishing of im_ppm2vips()\n- im_blend() can now work on labq\n- boolean ops all work on float/complex images (by casting to int)\n- im_maplut() was broken for 1 band image + many band lut + >8 bit output\n- im_lintra_vec() now handles 1 band image and many band vector to make many\n  band image\n- oops, im_lintra_vec() was missing a man page\n- im_measure() can work on labq\n- im_lhisteq() uses new embed mode, _raw() version is one pixel smaller, sets\n  Xoffset/Yoffset for new origin scheme\n- generalised im_tone_build() to any image type to make im_tone_build_range()\n\n20/5/04 started 7.9.5\n- tiff output res can be a single number too\n- added im_text() to make a bitmap from a string with pango\n- im_tiff2vips() does 16 bit RGBA\n- im_binfile() was broken since 7.9.2 due to im_mapfile() change\n- im_ppm2vips() now works for 16 bit images\n- added im_copy_swap() ... copies, reversing byte order\n- im_resize_linear() was broken for some images, thanks Javi\n\n8/3/04 started 7.9.4\n- oops, config.h include missing in a few places\n- im_vips2tiff() can now write 1 bit images\n- im__find_lr/tboverlap() now exported to nip\n- better edge tile handling for tiff read/write (thanks Ruven)\n- added extend-pixels-from-edge mode to im_embed()\n- im_conv*(), im_rank(), im_stdif(), im_dilate(), im_erode() all use it to\n  expand their input, so their output now has guess borders, not black borders\n- im_fastcor() now does an im_embed( 1 ) on the output ... the zero borders\n  were very annoying before, since you would usually be searching for the\n  minimum point\n- no change to im_spcor(), since you will usually be searching for the maximum\n- better im_render() cache behaviour under heavy loads\n- im_affine() revised\n\t* clip, resample and transform is now pixel-perfect for all\n\t  inputs (I hope)\n\t* uses the new embed to make sure there are no black borders\n\t  from edge interpolation\n\t* about 20 - 30% faster\n- policy change: Xoffset and Yoffset are now set by all operations to record\n  the position of the input origin in the output\n- im_replicate() is much faster for some cases\n- added tile and mirror flags to im_embed()\n- added im_cache() convenience function\n- better ETA for image calculation\n- im_tiff2vips() now has a \"broken\" option so it can read tiled tiffs made\n  with earlier versions of vips\n- on convert float to int format, now does floor() not rint() ... more\n  'mathematical'\n- added im_rint()\n- im_sharpen() now uses a gaussian mask\n- im_convsep() more resistant to int overflow problems\n- added im_make_xy(), avoids rounding problems with the old float-based thing\n- im_profile() now makes vertical images for a vertical profile\n- added im_vips2tiff() option to set the resolution in inches not cm (thanks\n  Andrey)\n- im_binfile() is now exported\n\n6/2/04 started 7.9.3\n- added an im_init_world() to im_open(), to help old progs\n- renamed VSemaphore as im_semaphore_t\n- started using libtool library versioning\n- now uses g_module_*() in place of dlopen()\n- now uses pkg-config instead of vips-config (thanks Simon)\n- fixes to vips.h for _ADDR() with DEBUG on (thanks Konrad)\n\n10/12/03 started 7.9.2\n- patches for freebsd, thanks Lev Serebryakov\n- vips2dj knows about my colour laser printer\n- added i18n support, glib/gmodule/gthread dependency\n- im_error*() API revised to be more i18n friendly\n- List type removed, now uses g_slist\n- VBuf added, some more utility funcs pushed down from nip\n- im_thread stuff removed, now uses g_thread\n- im_lock stuff removed, now uses g_mutex\n- im_semaphore_t renamed to VSemaphore, not sure this is a good idea\n- build with --disable-threads to turn off threaded render\n- #include <vips/vips.h> now pulls in most of the public API, you shouldn't\n  need other vips includes very often\n- im_close() is better at cleaning up if there's an error\n- inverse FFTs could fail for wider-than-high images with fftw\n- better im_icc_transform error messages\n- bug fix in im_render with large caches\n- im_binfile() now has an offset parameter\n- im_mapfile()/im_unmapfile() now work on IMAGE and record the length of the\n  file they mapped ... this lets VIPS successfully unmap a file if it changes\n  size while it's open\n\n20/10/03 started 7.9.1\n- threadgroups now have their own kill flag\n- im_plotmask() now does anti-aliasing\n- im_iterate() fix for operations on mmap window images (thanks Clare)\n- im_writeline() stops on kill\n- fix for im_fwfft() segv for wider-than-high real images (thanks Andrey)\n- fix for im_fwfft() to work for non-square real images (thanks Andrey)\n- can now read and write 32-bit IEEE float TIFF (Andrey Kiselev)\n- clean-ups for colour.c (Andrey Kiselev)\n- no longer lets you make an image with width|height|bands == 0 (thanks Joe)\n- im_vips2tiff(), im_vips2*jpeg*(), im_vips2png(), im_vips2ppm() could\n  sometimes fail for mmap window input images (thanks David)\n- added IM_RECT_HCENTRE(), IM_RECT_VCENTRE() macros\n\n20/8/03 JC\n- started 7.9.0\n- added im_rank_image() ... im_maxvalue() a special case of this\n- im_subtract() goes up to int earlier for better value preserving, thanks\n  Haida\n- im_rank() much faster for large windows, correct result on all platforms\n  (dratted memcpy() was causing problems before)\n- fixed problem with libMagick config if installed somewhere strange\n- fixed problem with include order in library compile\n- added --without-magick configure option\n- added im_render(), threaded background image paint\n- added im_replicate(), replicate an image horizontally and vertically\n\n31/5/03 JC\n- started 7.8.11\n- fixed a problem with relational operators and some combinations of input\n  types (bug introduced in 7.8.9), thanks Haida\n- vips-7.8 script overrides VIPSHOME environment variable\n- better im_guess_prefix\n- stupid light_correct script no longer uses /pics/tmp\n- added batch_crop script\n\n22/5/03\n- started 7.8.10\n- the JPEG writer can embed ICC profiles in output images ... although I've\n  yet to see it make any difference :-( test this carefully at some point\n- fixed a possible coredumper in jpeg write\n- jpeg read now spots truncated files\n- im_invertlut() now makes an image, not a mask ... sorry :-(\n- im_histnD() makes an n-dimensional histogram from an n-band image\n- im_col_pythagoras() patch\n- IM_NUMBER() now returns int not size_t\n- new win32 build system from Juan and friends, based on tmake\n- sample project files for MSVC added, thanks Juan\n- win32/ subdir now has the win32 build systems\n- spec/ subdir now has the spec files for building RPMs\n- dist now includes formatted documentation\n- license change: VIPS is now LGPL, nip stays GPL ... this means proprietary\n  programs can link against the vips library\n- had a report of a working VIPS build on a 64 bit system (!)\n- im_log_dmask() now includes all of the negative lobe, thanks matt\n- vips-7.8 start script now auto-relocates\n- im_spcor_raw(), im_fastcor_raw() now exported\n\n29/4/03\n- started 7.8.9\n- changes to build to help MSVC\n- oops, makedef.pl missed out function names with an initial cap, and\n  error_exit()\n- im_min() and im_max() gave random wrong results for >1 thread on >1 CPU\n  machines (bug introduced in 7.7.20), thanks Joe\n- vips.c no longer generates C++ wrappers for functions with no image argument\n  (thanks Haida)\n- im_invertlut() now wrapped by hand in VMask.cc\n- C++ docs updated\n- added im_open_header(), returns an IMAGE with just width/height/etc and no\n  data\n- ... so now \"header\" will print useful stuff even on truncated files\n- tiff writer knows about alpha (thanks Jenny)\n\n7/2/03\n- started 7.8.8\n- build failed with lcms turned off\n- im_spcor() could segv for 16bit images (thanks Joe)\n- im_tiff2vips() read resolution expressed as pixels/cm incorrectly\n- im_vips2tiff() tries not to write mad resolutions\n- header and im_open file type tests reordered for slight speedup\n- im_copy_set() had a broken dispatch function for xres/yres\n- im_fwfft() exploits libfftw real -> complex transform if possible for a 2x\n  speed-up (thanks Matt)\n- im_invfftr() added for complex -> real inverse transform for 2x speed-up\n  (thanks Matt)\n- im_freqflt() now uses im_invfftr() for real result and speedup\n- im_flipver() could segv on some inputs, thanks Clare\n- relational operators now work on complex\n- relational rewritten ... now fractionally slower, but 1/3 the size\n- vips2dj -1:1 produced incorrect height\n- better overlap-too-small detection in mosaicing code\n- im_system() can have NULL output\n- global balance ignores overlaps with only transparent pixels\n\n3/1/03\n- started 7.8.7\n- worked in patch from Hans Breuer (thanks!)\n\t- png read/write with im_png2vips(), im_png2vips_header(),\n\t  im_vips2png(), im_ispng()\n\t- im_errorstring() and im_col_displays() are now functions not externs\n\t  (helps DLLs)\n\t- many include fixes to help native win32 build\n- added libMagick support, 78 file formats now loadable with\n  im_magick2vips(), im_magick2vips_header() and im_ismagick(), w00t\n- now installs vips.m4 to $prefix/share/aclocal\n- added im_icc_export_depth() ... export to device space with a specified bit\n  depth (8 or 16)\n- vips.def now rebuilt with custom rule in libsrc/Makefile.am\n- removed externs im_Type, im_BandFmt, im_Coding, im_Compression to simplify\n  DLL build\n- im_mmap() -> im__mmap(), since it's supposed to be an internal function\n- new vips-7.8.x/proj directory holds unsupported sample makefiles and\n  config.h for building with the MSC toolchain\n- new scripts batch_image_convert and batch_rubber_sheet (thanks Joe)\n- added the RPM .spec files to the main distribution\n- InitializeMagic() now passed \"\" rather than NULL to avoid assert() problems\n  on some libMagic versions\n\n2/12/02\n- started 7.8.6\n- now reads 8-bit RGBA tiff\n- C++ build guide fixes (thanks fsicre)\n- im_Type2char array text slightly messed up\n- global_balance is safer for complex mixed mosaics\n- removed im_lintra() fallback to im_copy() for scale == 1, offset == 0 ...\n  too confusing\n- im_tiff2vips() now reads 16-bit LAB\n- added im_Lab2LabS() and im_LabS2Lab()\n\n5/11/02\n- started 7.8.5\n- fix for mmap window of local region ... caused im_iterate() to break\n  sometimes for large images, in turn occasionally breaking\n  im_max()/im_min()/etc. (thanks Joe)\n- tiny speed up for im_rot90()/270()\n- on install on win32, add .exe suffix for links\n- vips.c knows to remove .exe suffix for linked commands\n- added im_errormsg_system() ... decode win32 error codes too\n- pagesize calcs for roving mmap windows were messed up on win32 (thanks Kirk)\n- some TODO cleanups\n- global balance broke horribly if you had filenames with spaces in (thanks\n  Clare)\n\n31/10/02\n- started 7.8.4\n- im_unmapfile() includes mixed up on mac os x\n- libtool patched for mac os x\n- vips.c sets numeric locale to \"C\"\n\n27/10/02\n- started 7.8.3\n- configure fixes help mac os x\n- im_guess_prefix() adds \".exe\" suffix on w32 if not there\n- changed im_measure() error messages to number bands from 1\n- added func descriptor for im_read_dmask() to help nip, updated C++ API, docs\n\n21/10/02 JC\n- started 7.8.2\n- tries rand() if random() is not available\n- tries mktemp() if mkstemp() is not available\n- turns off realpath() if not available\n- added IM_DIR_SEP/IM_DIR_SEP_STR directory separator character/string\n- added IM_PATH_SEP/IM_PATH_SEP_STR path separator character/string\n- added im_path_is_absolute()\n- vips.c knows to link to vips.exe on win32\n- spot mingw* and set BINARY_OPEN\n- open images in binary too (since we now read() the header)\n\n10/10/02 JC\n- im_lintra() and im_lintra_vec() were broken for complex images :-( thanks\n  matt\n- renamed im_and() as im_andimage(), im_eor() as im_eorimage() and im_or() as\n  im_orimage() ... avoids breakage in the C++ layer\n- added im_dE00_fromLab()\n- limited release as vips-7.8.0\n\n2/10/02\n- renamed as vips-7.8, woohoo\n- revised documentation\n\n19/9/02 JC\n- started sorting out VIPS #defines ... there are now a sensible set of new\n  names (eg. NOCODING becomes IM_CODING_NONE, LAB becomes IM_TYPE_LAB)\n- define IM_NO_VIPS7_COMPAT to turn off the old names\n- added im_mmap()/im_munmap() layer for windows portability\n- removed the contents of history.h .. obsolete\n- added IM_IMAGE_ADDR() macro\n\n10/9/02 JC\n- handle errors from TIFF lib correctly\n- configure fixes for cygwin\n- CMYK TIFF write fixed\n- configure fixes for mingw\n\n5/9/02 JC\n- im_cp_desc() now copies Xoffset/Yoffset\n\n21/8/02 JC\n- started 7.7.24\n- reads CMYK TIFF\n- reads dpi from TIFFs\n- better float Xres/Yres\n\n14/8/02 JC\n- new header fields Xoffset and Yoffset ... used by functions to hint\n  the position of the origin in output images\n- support added to c++ api and to header\n- im__lrmerge(), im__tbmerge(), im__affine(), im_insert(),\n  set Xoffset/Yoffset\n- now uses <lcms.h>, not <lcms/lcms.h> for better suse w0rkage\n- better configure for fftw (uses libdfftw name if libfftw not found)\n\n8/8/02 JC\n- large file support with mmap() windows ... had to change\n  im_prepare_inplace() to im_prepare_to()\n\n  benchmark:\n\n  - system\n\n\thardware: 2 x 2.5GHz P4, 1GB RAM, 15k SCSI, ReiserFS\n\tos: suse 8 (kernel 2.4.18)\n\tcompiler: gcc 2.95.3, -O2, threads turned on\n\timages: fred.v, fred2.v; both 4k by 4k LABPACK (64MB)\n\timages: jim.v, jim2.v; both 15k by 15k LABPACK (900MB)\n\ttime: smallest real of 5 runs, system idle\n\tvips: 7.7.23, debug on in im_openin.c, window limit set with an\n\t  environment variable\n\n  - benchmarks\n\n\tcpu-bound: im_sharpen fred.v fred3.v 11 1.5 20 50 1 2\n\tio-bound: im_insert fred.v fred2.v fred3.v 4000 0\n\tworst-case: im_rot90 fred.v fred3.v\n\n  - results\n\n\tdesktop:\n\n\t\t\tno mmap windows\t\tmmap windows\n\n\tcpu-bound\treal    0m3.712s\treal    0m3.970s\n\t\t\tuser    0m6.010s\tuser    0m6.390s\n\t\t\tsys     0m0.900s \tsys     0m1.110s\n\n\tio-bound\treal    0m1.813s\treal    0m1.865s\n\t\t\tuser    0m0.900s\tuser    0m0.990s\n\t\t\tsys     0m1.720s \tsys     0m1.520s\n\n\tworst-case\treal    0m1.344s\treal    0m3.039s\n\t\t\tuser    0m1.270s\tuser    0m2.230s\n\t\t\tsys     0m0.850s\tsys     0m3.050s\n\n  not quite sure why sharpen is a little slower (4%?) ... IO speed is about\n  the same though ... worst-case is having to constantly move windows about\n  (500,000 page faults, vs 10,000 for no windows)\n\n  again, with an image larger than RAM\n\n  \t\t\tno mmap windows\t\tmmap windows\n\n\tio-bound \treal    2m52.759s\treal    2m11.172s\n\t\t\tuser    0m14.940s\tuser    0m14.890s\n\t\t\tsys     0m29.940s\tsys     0m26.560s\n\n\tworst-case\treal    3m35.391s\treal    3m50.760s\n\t\t\tuser    0m19.850s\tuser    0m26.600s\n\t\t\tsys     0m12.650s \tsys     0m43.130s\n\n  mmap windows actually slightly faster in this case ... plus they stress the\n  OS less\n\n31/7/02 JC\n- added -lm for better lcms detect\n- README notes for fftw on suse8\n- im_profile() sets HISTOGRAM for output image\n- im_copy()/im_copy_set() function descriptor no longer sets PTOP ... helps\n  avoid LUT problems\n- im_subsample()/im_zoom() fall back to im_copy() for shrink/grow == 1\n- im_lintra() falls back to im_copy() for scale == 1, offset == 0\n- no longer use Type == LUT ... all just Type == HISTOGRAM now\n- im_blend() was messed up for > 1 band images :(\n\n16/7/02 JC\n- started 7.7.23\n- im_XYZ2sRGB() wasn't setting Type = sRGB\n- im_icc_import() was broken for rgb\n- im_header_string() had wrong return type in function database\n\n13/7/02 JC\n- added im_flood_blob()\n- added im_open_local_array() ... C API convenience function\n- oop, im_flood() was missing a man page\n- Type == FOURIER added to help visualisation\n- released as 7.7.22\n\n30/6/02 JC\n- JPEG, TIFF and PPM import all now set sRGB Type for RGB import\n- im_header_int(), im_header_double() and im_header_string() added to aid\n  UIs\n- now uses gettimeofday(), not time()\n- for consistency with other trig functions, im_c2amph() now returns degrees\n  not radians (ouch)\n- added im_c2rect() ... turn (amp, phase) to rectangular\n- added im_sign() ... unit vector in direction of value\n- better im_scaleps() ... old code was terrible\n- rewritten im_rotquad() ... now partial\n- im_icc_export()/_import() now do ABSOLUTE correctly\n- added im_icc_ac2rc() ... converts absolute to relative colorimetry\n\n25/6/02 JC\n- added im_copy_set(3) ... like im_copy(), but set informational header fields\n\n20/6/02 JC\n- added im_ceil(), im_floor()\n- im_Lab2LabQ was not clipping a/b range correctly\n- im_icc_export(), own ABSOLUTE mode\n- released as 7.7.21\n\n28/5/02 JC\n- im_remainderconst_vec broken for float/double\n- added Yxy colourspace\n\n16/05/02 JC\n- auug, libtool was all messed up ... redone all the autotools stuff\n- uses libtool convenience libraries to build vips in sections\n- uses config subdir for temp files and .m4 things\n- patched stupid suse config.guess\n- vips2dj patched for better raw cmyk\n- released as 7.7.20\n\n12/5/02 JC\n- im_vips2jpeg*() and im_vips2ppm() now both partial\n- started updating the C++ guide\n- had to change the location of the C++ headers :-( all C++ progs should now\n  have:\n\n\t#include <vips/vipscpp.h>\n\n  this is so things can work on systems which do not have case sensitive\n  file systems\n\n- changes for Mac OS X\n  * im_system() TRUE/FALSE removed\n  * searches /*/[lib|include] to get fink libs for tiff and jpeg\n\n30/4/02 JC\n- several functions were missing IM_FN_PIO in their descriptor ... this was\n  harmless for nip/ip/C, but broke the ref counting in the C++ layer\n- im_system() now defaults \"/tmp\" for temp files\n- STRING input and output args were broken for C++ :-(\n- threads exit more quickly on error\n- im_min()/im_max() now partial (at last)\n- im_remainderconst()/im_remainderconst_vec() added\n- --with-dmalloc configure switch\n- vips2dj does CMYK and mono too\n- im_vips2tiff() allows any number of bands (but not the right way to\n  write CMYK, see TODO)\n\n26/4/02 JC\n- old ICC profile reader removed\n- little cms wrapped ... configure spots it, im_icc_transform() uses it to map\n  between two images\n- also im_icc_import() and im_icc_export() so you can see PCS images\n- im_icc_present() to test for existence of lib\n- README fixes\n\n4/4/02 JC\n- TODO changes\n- oops, DEBUG left on in im_invertlut()\n\n2/4/02 JC\n- im_fwfft.c/im_invfft.c now use libfftw if available ... about 5x speed up\n  and double precision\n- added FIND_FFTW autoconf macro\n- include/vips/proto.h changes\n\n26/3/02 JC\n- started 7.7.19\n\n25/3/02 JC\n- im_log_dmask() was broken (thanks matt)\n- casts between VDMask and VIMask were broken (thanks matt)\n- various error msgs improvements and tiny man page fixes\n\n13/3/02 JC\n- tb/lr merge first/last cache moved to per-call state for better sharing\n- im_remosaic() bails out faster on error and makes better error messages\n\n13/3/02 ruven\n- im_vips2tiff() pyramids stop at tilesize, not 64x64\n\n25/02/02 JC\n- im_remosaic() is smarter, and works better with im_global_balance()\n- im_affine() 2x faster\n\n14/2/02 JC\n- started 7.7.18\n- vips.m4 and libsrc/Makefile.am fixes for IRIX\n\n11/02/02 JC\n- vips/thread.h and vips/threadgroup.h were missing extern \"C\" for C++\n- VImage::write() now tracks dependencies, so you can write() to a partial\n  safely ... although it's not a very useful thing to do (thanks Mike)\n- new VImage::print() function for debugging\n- added im_print()\n\n22/01/02 JC\n- started 7.7.17\n\n15/01/02 JC\n- im_rect_unionrect() and im_rect_intersectrect() safer for repeated args\n- im_video_v4l() no longer perrror()s on ioctl fail for less spam\n\n03/01/02 JC\n- started 7.7.16\n- im_version_string() really does return the date as well now\n\n12/12/01 JC\n- im_guess_prefix() extra smartness for relative path names\n- VImage() no longer uses tmpnam() (thanks Paul)\n\n11/12/01 JC\n- renamed im_fexists() as im_existsf()\n\n7/12/01 JC\n- ppm man pages added (doh)\n\n28/11/01 JC\n- warnings on g++ 2.96 fixed\n\n22/11/01 JC\n- started 7.7.15\n- im_video_v4l() failed to compile on non-linux platforms\n\n7/11/01 JC\n- im_remosaic() added\n- im_*merge() are more intelligent about transparency in bizarre overlaps\n- grr! putenv() semantics change on more recent clibs ... should be safer\n  now\n\n19/10/01 JC\n- VDisplay( \"display name\" ) segved on unknown display :-( thanks mike\n\n26/9/01 JC\n- contrib tools get data files from share/vips/xxx area now\n- im_vipshome() renamed as im_guess_prefix(), reworked for new package layout\n- doc/ build sorted out\n- ... but of course, docs still need updating for 7.8\n\n20/9/01 JC\n- fix to im_vipshome()\n- ip2 renamed as nip\n- split to library only ... separate ip and nip packages\n- new VIPS_VERSION_* macros set from configure.in in vips/version.h.in\n- vips.m4 VIPS finder\n- reworked README, doc/README and TODO\n- now installs to /usr/local/ by default\n- fmask4th.c was including varargs.h ... d'oh\n- include area reorganised: everything inside <vips/..> now ... hopefully the\n  only user-visible change is that all plain C progs need to change:\n\n\t#include <vips.h>\n\n  to:\n\n\t#include <vips/vips.h>\n\n  the C++ API should be unaltered\n\n21/8/01 ruven\n- im_setupout() was missing some #includes\n\n20/8/01 JC\n- started 7.7.14\n\n15/8/01 JC\n- added libxml dependency for ip2\n\n27/7/01 JC\n- im_conv(), im_convf(), im_convsep(), im_convsepf() now reject masks with\n  scale == 0\n\n26/7/01 JC\n- started 7.7.12\n\n25/7/01 JC\n- started 7.7.11\n- oop, im_histeq() and im_tonemap() also missed\n- better error messages from im_run_command()\n\n23/7/01 JC\n- started 7.7.10\n- im_sharpen() failed due to change in im_band_extract() offset\n\n20/7/01 JC\n- started 7.7.9\n\n4/7/01 JC\n- im_open(,\"w\") open() delayed until im_setupout(), very slightly safer\n- updated im_open() man page\n- im_tiff2vips() now embeds index in filename ... and it's page number (from\n  0), not subsample factor\n- finally bit the bullet ... im_extract()/im_extract_band() now number from\n  zero (sorry!)\n- and im_lrmosaic()/im_tbmosaic() bandno param too\n\n29/6/01 JC\n- im_region_free() now frees immediately\n\n27/6/01 JC\n- im_vips2tiff() man page updated for deflate, 2 years late\n\n22/6/01 JC\n- oops, limit wrong on im_rank()\n\n21/6/01 JC\n- better post_install for --prefix outside VIPS's tree\n- -ltiff needs -lm in acinclude.m4 ... fixes configure on redhat 7.x\n\n13/6/01 JC\n- started 7.7.8\n\n6/6/01 JC\n- im_invertlut() added\n\n31/5/01 JC\n- im_colour_temperature, im_XYZ2Lab_temp, im_Lab2XYZ_temp added\n- ... colour temp stuff needs sorting out properly\n\n25/5/01 JC\n- added vips-config script, cf. gtk-config\n- --without-threads option added\n- did a bit of work on the C++ API docs\n\n24/5/01 JC\n- added im_tiff2vips_header(), im_jpeg2vips_header() and im_ppm2vips_header()\n- header uses these to print fields quickly\n- switched to config.h\n- configure.in rewritten ... much nicer, fewer options, more automatic\n\n17/5/01 JC\n- im_matinv() didn't free stuff correctly on singular matrix\n\n16/5/01 JC\n- vips2dj now knows about 5000ps printers\n- allow RW mode for non-native VIPS image files, for 8 bit images\n\n2/5/01 JC\n- started 7.7.7\n\n1/5/01 JC\n- im_addgnoise() did not work for >1 band images\n\n23/4/01 JC\n- configure options to remove support for JPEG and TIFF ... helpful for a no-\n  dependencies build\n\n20/4/01 JC\n- im_(v)snprintf() added\n- all sprintf()s removed\n\n15/4/01 JC\n- im_affine() had a rounding problem\n\n11/4/01 JC\n- tiny mosaicing bug fixed in im__lrcalcon\n- started 7.7.6\n\n21/3/01 JC\n- new iblend code in im_tbmerge() was typo-d\n- mosaic1 was broken by affine too\n\n20/3/01 JC\n- im_image() failed for FMTUCHAR\n\n12/3/01 JC\n- started 7.7.5\n- im_sharpen() uses seperable convolution for big speed up\n- new \"Print\" menu\n\n11/3/01 JC\n- REALVEC renamed as DOUBLEVEC\n- added IMAGEVEC\n- added IM_INPUT_IMAGEVEC\n- gbandjoin now has function description\n- new function im_maxvalue()\n- im_compass()/im_lindetect() reimplemented with im_conv()/im_maxvalue(),\n  about 15% faster, works for any type, partial\n- im_gradient() reimplemented with im_conv()/im_abs()/im_add(), about 30%\n  slower, works for any type, partial\n\n10/3/01 JC\n- new function, im_clip2fmt() converts between any image formats ...\n  slightly faster than the old im_clip()\n- legacy im_clip2us() etc. functions now just call this\n\n9/3/01 JC\n- im_conv() rewritten, simpler, about 10% faster\n- im_convsep() rewritten, now does any non-complex type, partial, 20% faster\n- new functions: im_convf(), im_convsepf() for DOUBLEMASK\n- raw versions of each\n- legacy convolvers (eg. im_convbi()) removed\n\n8/3/01 JC\n- new function im_blend()\n- new function im_lab_morph()\n- speed up to im_ifthenelse()\n- speed up to im_*merge() (uses integer arithmetic for integer blends)\n\n4/3/01 JC\n- tiny speed ups to im_histgr()\n- speed ups to im_maplut()\n\n3/3/01 JC\n- new functions: im_histnorm(), im_histcum()\n- im_histeq() more general\n- im_vipshome() --- better behaviour for relative paths\n\n2/3/01 JC\n- new video package\n- im_video_v4l1() (video for linux) added\n- configure.in switches to turn v4l1 on and off\n\n1/3/01 JC\n- new im_histspec() implementation ... more general, bugs removed\n\n14/2/01 JC\n- better vips2dj usage message\n\n13/2/01 JC\n- im_image_sanity() added, called in various places in iofuncs\n\n9/2/01 JC\n- added 'check' and 'name' class member stuff to ip from ip_gtk2\n- new \"Plot\" menu\n- new \"Overlay\" menu\n- more stuff in _stdenv/_list ... curried forms of head/tail etc.\n\n7/2/01 JC\n- started 7.7.4\n- vips2dj and vdump now use im_vipshome()\n\n5/2/01 JC\n- new im_vipshome() function\n- min()/max() macros renamed as MIN()/MAX()\n- new im_load_plugins() function\n- vips.exe and ip now load $VIPSHOME/lib plugins at startup\n\n2/2/01 JC\n- mosaicing functions now have an extra max blend width parameter\n\n30/1/01 JC\n- fixed tbmerge no overlap detect\n\n13/12/00 JC\n- started 7.7.3\n\n30/12/00 JC\n- vips.h fixes for cygwin/wingdi conflict\n\n27/11/00 JC\n- added im_vips2ppm(), im_open() imports and exports it\n- fixed nasty implicit output conversion problem for PIO dispatch() calls\n\n21/11/00 JC\n- added im_ppm2vips()\n\n16/11/00 JC\n- configure.in fixes ... jpeg found correctly now\n- searches for libz as well\n\n16/11/00 JC\n- started 7.7.2\n\n5/11/00 JC\n- speed up to lab2labq\n\n19/10/00 JC\n- started 7.7.1\n\n13/1/00 JC\n- oops, im_open() was missing an 'else' in jpeg/tiff load\n\n5/8/00 JC\n- im_vips2tiff() now has mode string embedded in output filename\n- im_vips2jpeg() now has qfac in output filename\n- im_open() understands this\n\n11/7/00 JC\n- new im_image() function ... wraps a VIPS image around a memory buffer\n- C++ layer changes:\n\t* now use #include <vips/Vips.h>\n\t* error renamed as VError\n\t* new VMask() constructors\n\t* new VImage() constructor\n\t* new VImage::data() access member\n\t* more operator equivalences: <, >, <=, >=, ==, !=, &, |, ^, %\n\n17/6/00 JC\n- more consts added to vips protos\n\n10/5/00 JC\n- minor configure.in changes to help solaris\n- removed _TIFFmalloc() and _TIFFfree() calls\n\n9/3/00 JC\n- fixed rounding problem in generate grid\n\n8/3/00 JC\n- fixup to im_system() temp dir\n\n7/3/00 JC\n- added im_system()\n- small tidies\n\n1/3/00 JC\n- better plugin test in configure.in\n\n26/2/00 JC\n- fixes to Makefile.am in ip/src* and configure.in, to help ip find the right\n  gtk includes on systems with more than one gtk-xxx installed\n\n21/2/00 JC\n- now builds ip and ip_gtk2\n\n16/2/00 JC\n- configure.in fixes for xil and some TIFF/JPEG strangeness\n\n15/2/00 JC\n- im_global_balancef() was broken! d'oh\n- note in README about enabling video cards\n\n10/2/00 JC\n- configure now searches for xil ... FIND_XIL macro\n- im_zoom() spots integer overflow\n- better shape set on region drag end in ip\n- better zoom-too-far handling in ip\n\n13/1/00 JC\n- fixes to configure etc. to help cygwin\n- jpeg is now searched for too ... FIND_JPEG macro\n\n10/1/00 JC\n- global_balance() now uses new affine() atuff\n\n27/12/99 JC\n- mosaic1 stuff now uses new affine() funcs\n\n21/12/99 JC\n- added Joe's docs\n- im_LabS2LabQ() rounding on a/b slightly broken for a/b == 0\n\n20/12/99 JC\n- new function: im_affine()\n- similarity*() now in terms of affine()\n- tests for error return in reduce.c from maplut\n- small clean-ups\n\n15/12/99\n- im_version() added, new iofuncs package for it\n- ip did not call zero-input-arg vips functions\n- vips.c did not like zero-input-arg functions\n\n6/12/99 JC\n- Sobel filter was a bit broken\n\n3/12/99 JC\n- menu reorganisation\n- generate gauss mask dialog\n\n2/12/99 JC\n- reworked text file IO, better error messages\n\n1/12/99 JC\n- reworked .iprc filename stuff, cleaner\n\n30/11/99 JC\n- better menu set switcher in calc preferences\n- ip now thinks it's 7.7\n- did a spellcheck on the ip guide\n\n29/11/99 JC\n- 7.7 started!\n- srgb D65->D50 converter\n- Negate added to arith\n- find similar pixel value dialog\n- find similar colour dialog\n- paste into background dialog\n\n19/11/99 JC\n- adjust labq was mising\n- shrink image defaulted to /2 not /1\n- sharpdropshadow broken\n- Rotate.* broken\n- vips-7.6.3 release\n\n18/11/99 JC\n- ip didn't report space free on >2GB filesystems correctly\n- ip did not link statically against libXpm on solaris7\n\n17/11/99 JC\n- im_histplot() failed for all 0's histogram\n- new profile_image dialog\n- man pages for im_sRGB2XYZ/im_XYZ2sRGB were broken\n- new colourize image dialog\n- new shrink image image dialog\n- new expand image image dialog\n- better doc Makefiles\n\n16/11/99 JC\n- more menu reorganising\n- new image_to_mask/mask_to_image buttons\n- new match_two_images dialog\n- new measure_colour_chart dialog\n\n15/11/99 JC\n- new custom LABQ sharpen in Image menu\n- configure support for SGI video (thanks Ruven)\n- menu fiddling in ip\n- new \"resize canvas\" menu item\n- im_insert_noexpand() added, no docs tho'\n\n11/11/99 JC\n- new ip menu item: Image=>Adjust white/black/saturation of LabQ\n- fixed bug in decompose complex number\n- browse-icons now ignores errors\n- better error msg for \"12 12\" etc cases\n\n10/11/99 JC\n- open hi-res gives proper error msg if no file found\n- made file-select boxes a bit more compact and clearer\n- updated configure.in for vips-examples-7.6\n\n9/11/99 JC\n- new column start point moved\n- vdump now defaults to subsample 1, portrait\n- navigation boxes were broken\n- no longer shrink-to-fit if loading as high res\n- better positioning of zoom windows\n- removed some old cruft\n\n8/11/99 JC\n- ooops, im_remainder() got lost somehow\n- refguide converted to latex and updated\n- cppguide updated\n\n5/11/99 JC\n- libguide converted to latex and updated\n\n4/11/99 JC\n- ip guide now latex2htmls cleanly ... still needs updating tho'\n- cpp/app guide latex2html redone\n\n2/11/99 JC\n- configure no longer adds -32 to IRIX builds for you\n- some more stuff in README\n- simple DEBUGM malloc tracking, made libsrc/iofuncs/memory.c\n- changed im_malloc() to return void *\n- removed duplicate im_malloc() proto from util.h\n- changed all malloc/free to go through im_malloc()/im_free()\n\n23/10/99 JC\n- double-click on error image now pops a load browser and an error dialog\n- add-new-column no longer scrolls to right edge of workspace\n- better scroll-to-bottom on item add\n- load ws twice does not cause 'already open' errors\n- memorise directory button in fsb\n\n18/10/99 JC\n- new FIND_TIFF/FIND_MOTIF macros for acinclude.m4\n- new ./configure switches, see ./configure --help\n- enabled static libs\n\n8/10/99\n- broke action_proc_bop() into smaller functions, stops bad code gen on\n  gcc2.95.1 (and others, prolly)\n- restored old Makefiles in doc/src/ipguide\n- vips7.6 script renamed as vips-7.6\n\n5/10/99\n- replace image was broken\n- some menu reorganisation\n- 'reload all menus' button\n\n4/10/99\n- computed regions in ip were broken\n- updated system.iprc defaults\n- new menu item: adjust white/black points\n\n2/10/99\n- browse icons was broken\n- greyscale 16-bit tiled tiff was broken\n- extra mutex locks for TIFF*() in im_tiff2vips()\n\n1/10/99\n- some automake probs fixed\n- squished two ip bugs\n\n30/9/99\n- fixed problem with pthreads, now works on suse6.2 as well\n- new API stuff for threaded evaluation with im_threadgroup_t\n- new public interface provide platform independent threads/locks/semaphores\n- no error box if you zoom out too far now\n\n26/9/99\n- lr/tb merge blend was not quite right ... should be smoother now\n- histplot broken for float images\n\n24/9/99\n- better mono->labq converter\n- more portable ispoweroftwo detect for freq filter stuff\n\n23/9/99\n- better graphics expose handling\n\n17/9/99\n- >/< stuff in ip was a bit mixed up\n- ink preview fixed for mono images\n- help popup fixed\n\n15/9/99\n- linedetect and sobel filters for ip, thnx Kirk\n\n14/9/99\n- Find_histogram was broken\n- im_profile() man pages was broken\n- ooops, ip had old set of macros\n\n10/9/99\n- im_and/im_or/im_eor now work for any integer type\n\nSummer hols: (2nd half August '99)\n- initial heap block larger to avoid start gcs\n- def slicer fixed\n- larger max heap\n- toolkits with initial '_' hidden by default\n- custom recomb\n- dialog.def removed\n- ... other menu fixes\n- generate grid menu\n- im_remainder() added\n- new cursor change code, hglass rotates during comp!\n- dialog.c handles cursor changes better\n- rubber band in paintbox displays\n- mag widget stays on right!\n- undo/redo single pixel paint ops\n- heap size control from prefs\n- cancel for reductions as well as for image calc\n- browse stuff reworked, no more .icon.v files\n- save stops you overwriting open .v files\n- better animate_countdown() handling\n- better resize behaviour for bars added to images\n- better code generation, bug fixed in state tracking\n- auto recover from crash\n", "/* foreign file formats base class\n *\n * 7/2/12\n * \t- add support for sequential reads\n * 18/6/12\n * \t- flatten alpha with vips_flatten()\n * 28/5/13\n * \t- auto rshift down to 8 bits during save\n * 19/1/14\n * \t- pack and unpack rad to scrgb\n * 18/8/14\n * \t- fix conversion to 16-bit RGB, thanks John\n * 18/6/15\n * \t- forward progress signals from load\n * 23/5/16\n * \t- remove max-alpha stuff, this is now automatic\n * 12/6/17\n * \t- transform cmyk->rgb if there's an embedded profile\n * 16/6/17\n * \t- add page_height\n * 5/3/18\n * \t- block _start if one start fails, see #893\n */\n\n/*\n\n    This file is part of VIPS.\n\n    VIPS is free software; you can redistribute it and/or modify\n    it under the terms of the GNU Lesser General Public License as published by\n    the Free Software Foundation; either version 2 of the License, or\n    (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Lesser General Public License for more details.\n\n    You should have received a copy of the GNU Lesser General Public License\n    along with this program; if not, write to the Free Software\n    Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA\n    02110-1301  USA\n\n */\n\n/*\n\n    These files are distributed with VIPS - http://www.vips.ecs.soton.ac.uk\n\n */\n\n/*\n#define DEBUG\n */\n\n#ifdef HAVE_CONFIG_H\n#include <config.h>\n#endif /*HAVE_CONFIG_H*/\n#include <vips/intl.h>\n\n#include <stdio.h>\n#include <stdlib.h>\n\n#include <vips/vips.h>\n#include <vips/internal.h>\n#include <vips/debug.h>\n\n#include \"pforeign.h\"\n\n/**\n * SECTION: foreign\n * @short_description: load and save images in a variety of formats\n * @stability: Stable\n * @see_also: <link linkend=\"libvips-image\">image</link>\n * @include: vips/vips.h\n *\n * This set of operations load and save images in a variety of formats. \n *\n * The operations share a base class that offers a simple way to search for a\n * subclass of #VipsForeign which can load a certain file (see\n * vips_foreign_find_load()) or buffer (see vips_foreign_find_load_buffer()), \n * or which could be used to save an image to a\n * certain file type (see vips_foreign_find_save() and\n * vips_foreign_find_save_buffer()). You can then run these\n * operations using vips_call() and friends to perform the load or save.\n *\n * vips_image_write_to_file() and vips_image_new_from_file() and friends use\n * these functions to automate file load and save. \n *\n * You can also invoke the operations directly, for example:\n *\n * |[\n * vips_tiffsave (my_image, \"frank.anything\", \n *     \"compression\", VIPS_FOREIGN_TIFF_COMPRESSION_JPEG,\n *     NULL);\n * ]|\n *\n * To add support for a new file format to vips, simply define a new subclass\n * of #VipsForeignLoad or #VipsForeignSave. \n *\n * If you define a new operation which is a subclass of #VipsForeign, support \n * for it automatically appears in all VIPS user-interfaces. It will also be\n * transparently supported by vips_image_new_from_file() and friends.\n *\n * VIPS comes with VipsForeign for TIFF, JPEG, PNG, Analyze, PPM, OpenEXR, CSV,\n * Matlab, Radiance, RAW, FITS, WebP, SVG, PDF, GIF and VIPS. It also includes \n * import filters which can load with libMagick and with OpenSlide. \n *\n * ## Writing a new loader\n *\n * Add a new loader to VIPS by subclassing #VipsForeignLoad. Subclasses need to \n * implement at least @header().\n *\n * @header() must set at least the header fields of @out. @load(), if defined,\n * must load the pixels to @real.\n *\n * The suffix list is used to select a format to save a file in, and to pick a\n * loader if you don't define is_a().\n *\n * You should also define @nickname and @description in #VipsObject. \n *\n * As a complete example, here's code for a PNG loader, minus the actual\n * calls to libpng.\n *\n * |[\n * typedef struct _VipsForeignLoadPng {\n *   VipsForeignLoad parent_object;\n * \n *   char *filename; \n * } VipsForeignLoadPng;\n * \n * typedef VipsForeignLoadClass VipsForeignLoadPngClass;\n * \n * G_DEFINE_TYPE( VipsForeignLoadPng, vips_foreign_load_png, \n *   VIPS_TYPE_FOREIGN_LOAD );\n * \n * static VipsForeignFlags\n * vips_foreign_load_png_get_flags_filename( const char *filename )\n * {\n *   VipsForeignFlags flags;\n * \n *   flags = 0;\n *   if( vips__png_isinterlaced( filename ) )\n *   \tflags = VIPS_FOREIGN_PARTIAL;\n *   else\n *   \tflags = VIPS_FOREIGN_SEQUENTIAL;\n * \n *   return( flags );\n * }\n * \n * static VipsForeignFlags\n * vips_foreign_load_png_get_flags( VipsForeignLoad *load )\n * {\n *   VipsForeignLoadPng *png = (VipsForeignLoadPng *) load;\n * \n *   return( vips_foreign_load_png_get_flags_filename( png->filename ) );\n * }\n * \n * static int\n * vips_foreign_load_png_header( VipsForeignLoad *load )\n * {\n *   VipsForeignLoadPng *png = (VipsForeignLoadPng *) load;\n * \n *   if( vips__png_header( png->filename, load->out ) )\n *   \treturn( -1 );\n * \n *   return( 0 );\n * }\n * \n * static int\n * vips_foreign_load_png_load( VipsForeignLoad *load )\n * {\n *   VipsForeignLoadPng *png = (VipsForeignLoadPng *) load;\n * \n *   if( vips__png_read( png->filename, load->real ) )\n *   \treturn( -1 );\n * \n *   return( 0 );\n * }\n * \n * static void\n * vips_foreign_load_png_class_init( VipsForeignLoadPngClass *class )\n * {\n *   GObjectClass *gobject_class = G_OBJECT_CLASS( class );\n *   VipsObjectClass *object_class = (VipsObjectClass *) class;\n *   VipsForeignClass *foreign_class = (VipsForeignClass *) class;\n *   VipsForeignLoadClass *load_class = (VipsForeignLoadClass *) class;\n * \n *   gobject_class->set_property = vips_object_set_property;\n *   gobject_class->get_property = vips_object_get_property;\n * \n *   object_class->nickname = \"pngload\";\n *   object_class->description = _( \"load png from file\" );\n * \n *   foreign_class->suffs = vips__png_suffs;\n * \n *   load_class->is_a = vips__png_ispng;\n *   load_class->get_flags_filename = \n *   \tvips_foreign_load_png_get_flags_filename;\n *   load_class->get_flags = vips_foreign_load_png_get_flags;\n *   load_class->header = vips_foreign_load_png_header;\n *   load_class->load = vips_foreign_load_png_load;\n * \n *   VIPS_ARG_STRING( class, \"filename\", 1, \n *   \t_( \"Filename\" ),\n *   \t_( \"Filename to load from\" ),\n *   \tVIPS_ARGUMENT_REQUIRED_INPUT, \n *   \tG_STRUCT_OFFSET( VipsForeignLoadPng, filename ),\n *   \tNULL );\n * }\n * \n * static void\n * vips_foreign_load_png_init( VipsForeignLoadPng *png )\n * {\n * }\n * ]|\n * \n * ## Writing a new saver\n *\n * Call your saver in the class' @build() method after chaining up. The\n * prepared image should be ready for you to save in @ready.  \n *\n * As a complete example, here's the code for the CSV saver, minus the calls\n * to the actual save routines.\n *\n * |[\n * typedef struct _VipsForeignSaveCsv {\n *   VipsForeignSave parent_object;\n * \n *   char *filename; \n *   const char *separator;\n * } VipsForeignSaveCsv;\n * \n * typedef VipsForeignSaveClass VipsForeignSaveCsvClass;\n * \n * G_DEFINE_TYPE( VipsForeignSaveCsv, vips_foreign_save_csv, \n *   VIPS_TYPE_FOREIGN_SAVE );\n * \n * static int\n * vips_foreign_save_csv_build( VipsObject *object )\n * {\n *   VipsForeignSave *save = (VipsForeignSave *) object;\n *   VipsForeignSaveCsv *csv = (VipsForeignSaveCsv *) object;\n * \n *   if( VIPS_OBJECT_CLASS( vips_foreign_save_csv_parent_class )->\n *   \tbuild( object ) )\n *   \treturn( -1 );\n * \n *   if( vips__csv_write( save->ready, csv->filename, csv->separator ) )\n *   \treturn( -1 );\n * \n *   return( 0 );\n * }\n * \n * static void\n * vips_foreign_save_csv_class_init( VipsForeignSaveCsvClass *class )\n * {\n *   GObjectClass *gobject_class = G_OBJECT_CLASS( class );\n *   VipsObjectClass *object_class = (VipsObjectClass *) class;\n *   VipsForeignClass *foreign_class = (VipsForeignClass *) class;\n *   VipsForeignSaveClass *save_class = (VipsForeignSaveClass *) class;\n * \n *   gobject_class->set_property = vips_object_set_property;\n *   gobject_class->get_property = vips_object_get_property;\n * \n *   object_class->nickname = \"csvsave\";\n *   object_class->description = _( \"save image to csv file\" );\n *   object_class->build = vips_foreign_save_csv_build;\n * \n *   foreign_class->suffs = vips__foreign_csv_suffs;\n * \n *   save_class->saveable = VIPS_SAVEABLE_MONO;\n *   // no need to define ->format_table, we don't want the input \n *   // cast for us\n * \n *   VIPS_ARG_STRING( class, \"filename\", 1, \n *   \t_( \"Filename\" ),\n *   \t_( \"Filename to save to\" ),\n *   \tVIPS_ARGUMENT_REQUIRED_INPUT, \n *   \tG_STRUCT_OFFSET( VipsForeignSaveCsv, filename ),\n *   \tNULL );\n * \n *   VIPS_ARG_STRING( class, \"separator\", 13, \n *   \t_( \"Separator\" ), \n *   \t_( \"Separator characters\" ),\n *   \tVIPS_ARGUMENT_OPTIONAL_INPUT,\n *   \tG_STRUCT_OFFSET( VipsForeignSaveCsv, separator ),\n *   \t\"\\t\" ); \n * }\n * \n * static void\n * vips_foreign_save_csv_init( VipsForeignSaveCsv *csv )\n * {\n *   csv->separator = g_strdup( \"\\t\" );\n * }\n * ]|\n */\n\n/* Use this to link images to the load operation that made them. \n */\nstatic GQuark vips__foreign_load_operation = 0; \n\n/**\n * VipsForeignFlags: \n * @VIPS_FOREIGN_NONE: no flags set\n * @VIPS_FOREIGN_PARTIAL: the image may be read lazilly\n * @VIPS_FOREIGN_BIGENDIAN: image pixels are most-significant byte first\n * @VIPS_FOREIGN_SEQUENTIAL: top-to-bottom lazy reading\n *\n * Some hints about the image loader.\n *\n * #VIPS_FOREIGN_PARTIAL means that the image can be read directly from the\n * file without needing to be unpacked to a temporary image first. \n *\n * #VIPS_FOREIGN_SEQUENTIAL means that the loader supports lazy reading, but\n * only top-to-bottom (sequential) access. Formats like PNG can read sets of\n * scanlines, for example, but only in order. \n *\n * If neither PARTIAL or SEQUENTIAL is set, the loader only supports whole\n * image read. Setting both PARTIAL and SEQUENTIAL is an error.\n *\n * #VIPS_FOREIGN_BIGENDIAN means that image pixels are most-significant byte\n * first. Depending on the native byte order of the host machine, you may\n * need to swap bytes. See vips_copy().\n */\n\nG_DEFINE_ABSTRACT_TYPE( VipsForeign, vips_foreign, VIPS_TYPE_OPERATION );\n\nstatic void\nvips_foreign_summary_class( VipsObjectClass *object_class, VipsBuf *buf )\n{\n\tVipsForeignClass *class = VIPS_FOREIGN_CLASS( object_class );\n\n\tVIPS_OBJECT_CLASS( vips_foreign_parent_class )->\n\t\tsummary_class( object_class, buf );\n\n\tif( class->suffs ) {\n\t\tconst char **p;\n\n\t\tvips_buf_appends( buf, \" (\" );\n\t\tfor( p = class->suffs; *p; p++ ) {\n\t\t\tvips_buf_appendf( buf, \"%s\", *p );\n\t\t\tif( p[1] )\n\t\t\t\tvips_buf_appends( buf, \", \" );\n\t\t}\n\t\tvips_buf_appends( buf, \")\" );\n\t}\n\n\tvips_buf_appendf( buf, \", priority=%d\", class->priority );\n\n}\n\nstatic void\nvips_foreign_class_init( VipsForeignClass *class )\n{\n\tGObjectClass *gobject_class = G_OBJECT_CLASS( class );\n\tVipsObjectClass *object_class = (VipsObjectClass *) class;\n\n\tgobject_class->set_property = vips_object_set_property;\n\tgobject_class->get_property = vips_object_get_property;\n\n\tobject_class->nickname = \"foreign\";\n\tobject_class->description = _( \"load and save image files\" );\n\tobject_class->summary_class = vips_foreign_summary_class;\n}\n\nstatic void\nvips_foreign_init( VipsForeign *object )\n{\n}\n\n/* To iterate over supported files we build a temp list of subclasses of \n * VipsForeign, sort by priority, iterate, and free.\n */\n\nstatic void *\nfile_add_class( VipsForeignClass *class, GSList **files )\n{\n\t/* Append so we don't reverse the list of files. Sort will not reorder\n\t * items of equal priority. \n\t */\n\t*files = g_slist_append( *files, class );\n\n\treturn( NULL );\n}\n\nstatic gint\nfile_compare( VipsForeignClass *a, VipsForeignClass *b )\n{\n        return( b->priority - a->priority );\n}\n\n/**\n * vips_foreign_map:\n * @base: base class to search below (eg. \"VipsForeignLoad\")\n * @fn: (scope call): function to apply to each #VipsForeignClass\n * @a: user data\n * @b: user data\n *\n * Apply a function to every #VipsForeignClass that VIPS knows about. Foreigns\n * are presented to the function in priority order. \n *\n * Like all VIPS map functions, if @fn returns %NULL, iteration continues. If\n * it returns non-%NULL, iteration terminates and that value is returned. The\n * map function returns %NULL if all calls return %NULL.\n *\n * See also: vips_slist_map().\n *\n * Returns: (transfer none): the result of iteration\n */\nvoid *\nvips_foreign_map( const char *base, VipsSListMap2Fn fn, void *a, void *b )\n{\n\tGSList *files;\n\tvoid *result;\n\n\tfiles = NULL;\n\t(void) vips_class_map_all( g_type_from_name( base ), \n\t\t(VipsClassMapFn) file_add_class, (void *) &files );\n\n\tfiles = g_slist_sort( files, (GCompareFunc) file_compare );\n\tresult = vips_slist_map2( files, fn, a, b );\n\tg_slist_free( files );\n\n\treturn( result );\n}\n\n/* Abstract base class for image load.\n */\n\nG_DEFINE_ABSTRACT_TYPE( VipsForeignLoad, vips_foreign_load, VIPS_TYPE_FOREIGN );\n\nstatic void\nvips_foreign_load_dispose( GObject *gobject )\n{\n\tVipsForeignLoad *load = VIPS_FOREIGN_LOAD( gobject );\n\n\tVIPS_UNREF( load->real );\n\n\tG_OBJECT_CLASS( vips_foreign_load_parent_class )->dispose( gobject );\n}\n\nstatic void\nvips_foreign_load_summary_class( VipsObjectClass *object_class, VipsBuf *buf )\n{\n\tVipsForeignLoadClass *class = VIPS_FOREIGN_LOAD_CLASS( object_class );\n\n\tVIPS_OBJECT_CLASS( vips_foreign_load_parent_class )->\n\t\tsummary_class( object_class, buf );\n\n\tif( !G_TYPE_IS_ABSTRACT( G_TYPE_FROM_CLASS( class ) ) ) {\n\t\tif( class->is_a )\n\t\t\tvips_buf_appends( buf, \", is_a\" );\n\t\tif( class->is_a_buffer )\n\t\t\tvips_buf_appends( buf, \", is_a_buffer\" );\n\t\tif( class->get_flags )\n\t\t\tvips_buf_appends( buf, \", get_flags\" );\n\t\tif( class->get_flags_filename )\n\t\t\tvips_buf_appends( buf, \", get_flags_filename\" );\n\t\tif( class->header )\n\t\t\tvips_buf_appends( buf, \", header\" );\n\t\tif( class->load )\n\t\t\tvips_buf_appends( buf, \", load\" );\n\n\t\t/* You can omit ->load(), you must not omit ->header().\n\t\t */\n\t\tg_assert( class->header );\n\t}\n}\n\n/* Can this VipsForeign open this file?\n */\nstatic void *\nvips_foreign_find_load_sub( VipsForeignLoadClass *load_class, \n\tconst char *filename )\n{\n\tVipsForeignClass *class = VIPS_FOREIGN_CLASS( load_class );\n\n#ifdef DEBUG\n\tprintf( \"vips_foreign_find_load_sub: %s\\n\", \n\t\tVIPS_OBJECT_CLASS( class )->nickname );\n#endif /*DEBUG*/\n\n\tif( load_class->is_a ) {\n\t\tif( load_class->is_a( filename ) ) \n\t\t\treturn( load_class );\n\n#ifdef DEBUG\n\t\tprintf( \"vips_foreign_find_load_sub: is_a failed\\n\" ); \n#endif /*DEBUG*/\n\t}\n\telse if( class->suffs && \n\t\tvips_filename_suffix_match( filename, class->suffs ) )\n\t\treturn( load_class );\n\telse {\n#ifdef DEBUG\n\t\tprintf( \"vips_foreign_find_load_sub: suffix match failed\\n\" ); \n#endif /*DEBUG*/\n\t}\n\n\treturn( NULL );\n}\n\n/**\n * vips_foreign_find_load:\n * @filename: file to find a loader for\n *\n * Searches for an operation you could use to load @filename. Any trailing\n * options on @filename are stripped and ignored. \n *\n * See also: vips_foreign_find_load_buffer(), vips_image_new_from_file().\n *\n * Returns: the name of an operation on success, %NULL on error\n */\nconst char *\nvips_foreign_find_load( const char *name )\n{\n\tchar filename[VIPS_PATH_MAX];\n\tchar option_string[VIPS_PATH_MAX];\n\tVipsForeignLoadClass *load_class;\n\n\tvips__filename_split8( name, filename, option_string );\n\n\tif( !vips_existsf( \"%s\", filename ) ) {\n\t\tvips_error( \"VipsForeignLoad\", \n\t\t\t_( \"file \\\"%s\\\" not found\" ), name );\n\t\treturn( NULL );\n\t}\n\n\tif( !(load_class = (VipsForeignLoadClass *) vips_foreign_map( \n\t\t\"VipsForeignLoad\",\n\t\t(VipsSListMap2Fn) vips_foreign_find_load_sub, \n\t\t(void *) filename, NULL )) ) {\n\t\tvips_error( \"VipsForeignLoad\", \n\t\t\t_( \"\\\"%s\\\" is not a known file format\" ), name );\n\t\treturn( NULL );\n\t}\n\n#ifdef DEBUG\n\tprintf( \"vips_foreign_find_load: selected %s\\n\", \n\t\tVIPS_OBJECT_CLASS( load_class )->nickname );\n#endif /*DEBUG*/\n\n\treturn( G_OBJECT_CLASS_NAME( load_class ) );\n}\n\n/* Kept for compat with earlier version of the vip8 API. Use\n * vips_image_new_from_file() now. \n */\n\nint\nvips_foreign_load( const char *name, VipsImage **out, ... )\n{\n\tchar filename[VIPS_PATH_MAX];\n\tchar option_string[VIPS_PATH_MAX];\n\tconst char *operation_name;\n\tva_list ap;\n\tint result;\n\n\tvips__filename_split8( name, filename, option_string );\n\tif( !(operation_name = vips_foreign_find_load( filename )) )\n\t\treturn( -1 );\n\n\tva_start( ap, out );\n\tresult = vips_call_split_option_string( operation_name, option_string, \n\t\tap, filename, out );\n\tva_end( ap );\n\n\treturn( result );\n}\n\n/* Can this VipsForeign open this buffer?\n */\nstatic void *\nvips_foreign_find_load_buffer_sub( VipsForeignLoadClass *load_class, \n\tconst void **buf, size_t *len )\n{\n\tif( load_class->is_a_buffer &&\n\t\tload_class->is_a_buffer( *buf, *len ) ) \n\t\treturn( load_class );\n\n\treturn( NULL );\n}\n\n/**\n * vips_foreign_find_load_buffer:\n * @data: (array length=size) (element-type guint8) (transfer none): start of \n * memory buffer\n * @size: (type gsize): number of bytes in @data\n *\n * Searches for an operation you could use to load a memory buffer. To see the\n * range of buffer loaders supported by your vips, try something like:\n * \n * \tvips -l | grep load_buffer\n *\n * See also: vips_image_new_from_buffer().\n *\n * Returns: (transfer none): the name of an operation on success, %NULL on \n * error.\n */\nconst char *\nvips_foreign_find_load_buffer( const void *data, size_t size )\n{\n\tVipsForeignLoadClass *load_class;\n\n\tif( !(load_class = (VipsForeignLoadClass *) vips_foreign_map( \n\t\t\"VipsForeignLoad\",\n\t\t(VipsSListMap2Fn) vips_foreign_find_load_buffer_sub, \n\t\t&data, &size )) ) {\n\t\tvips_error( \"VipsForeignLoad\", \n\t\t\t\"%s\", _( \"buffer is not in a known format\" ) ); \n\t\treturn( NULL );\n\t}\n\n\treturn( G_OBJECT_CLASS_NAME( load_class ) );\n}\n\n/**\n * vips_foreign_is_a:\n * @loader: name of loader to use for test\n * @filename: file to test\n *\n * Return %TRUE if @filename can be loaded by @loader. @loader is something\n * like \"tiffload\" or \"VipsForeignLoadTiff\".\n *\n * Returns: %TRUE if @filename can be loaded by @loader.\n */\ngboolean \nvips_foreign_is_a( const char *loader, const char *filename )\n{\n\tconst VipsObjectClass *class;\n\tVipsForeignLoadClass *load_class;\n\n\tif( !(class = vips_class_find( \"VipsForeignLoad\", loader )) ) \n\t\treturn( FALSE );\n\tload_class = VIPS_FOREIGN_LOAD_CLASS( class );\n\tif( load_class->is_a &&\n\t\tload_class->is_a( filename ) ) \n\t\treturn( TRUE );\n\n\treturn( FALSE );\n}\n\n/**\n * vips_foreign_is_a_buffer:\n * @loader: name of loader to use for test\n * @data: (array length=size) (element-type guint8): pointer to the buffer to test\n * @size: (type gsize): size of the buffer to test\n *\n * Return %TRUE if @data can be loaded by @loader. @loader is something\n * like \"tiffload_buffer\" or \"VipsForeignLoadTiffBuffer\".\n *\n * Returns: %TRUE if @data can be loaded by @loader.\n */\ngboolean\nvips_foreign_is_a_buffer( const char *loader, const void *data, size_t size )\n{\n\tconst VipsObjectClass *class;\n\tVipsForeignLoadClass *load_class;\n\n\tif( !(class = vips_class_find( \"VipsForeignLoad\", loader )) )\n\t\treturn( FALSE );\n\tload_class = VIPS_FOREIGN_LOAD_CLASS( class );\n\tif( load_class->is_a_buffer &&\n\t\tload_class->is_a_buffer( data, size ) )\n\t\treturn( TRUE );\n\n\treturn( FALSE );\n}\n\n/**\n * vips_foreign_flags:\n * @loader: name of loader to use for test\n * @filename: file to test\n *\n * Return the flags for @filename using @loader. \n * @loader is something like \"tiffload\" or \"VipsForeignLoadTiff\".\n *\n * Returns: the flags for @filename.\n */\nVipsForeignFlags \nvips_foreign_flags( const char *loader, const char *filename )\n{\n\tconst VipsObjectClass *class;\n\n\tif( (class = vips_class_find( \"VipsForeignLoad\", loader )) ) {\n\t\tVipsForeignLoadClass *load_class = \n\t\t\tVIPS_FOREIGN_LOAD_CLASS( class );\n\n\t\tif( load_class->get_flags_filename ) \n\t\t\treturn( load_class->get_flags_filename( filename ) );\n\t}\n\n\treturn( 0 );\n}\n\nstatic VipsObject *\nvips_foreign_load_new_from_string( const char *string )\n{\n\tconst char *file_op;\n\tGType type;\n\tVipsForeignLoad *load;\n\n\tif( !(file_op = vips_foreign_find_load( string )) )\n\t\treturn( NULL );\n\ttype = g_type_from_name( file_op );\n\tg_assert( type ); \n\n\tload = VIPS_FOREIGN_LOAD( g_object_new( type, NULL ) );\n\tg_object_set( load,\n\t\t\"filename\", string,\n\t\tNULL );\n\n\treturn( VIPS_OBJECT( load ) );\n}\n\nstatic VipsImage *\nvips_foreign_load_temp( VipsForeignLoad *load )\n{\n\tconst guint64 disc_threshold = vips_get_disc_threshold();\n\tconst guint64 image_size = VIPS_IMAGE_SIZEOF_IMAGE( load->out );\n\n\t/* If this is a partial operation, we can open directly.\n\t */\n\tif( load->flags & VIPS_FOREIGN_PARTIAL ) {\n#ifdef DEBUG\n\t\tprintf( \"vips_foreign_load_temp: partial temp\\n\" );\n#endif /*DEBUG*/\n\n\t\treturn( vips_image_new() );\n\t}\n\n\t/* If it can do sequential access and it's been requested, we can open\n\t * directly.\n\t */\n\tif( (load->flags & VIPS_FOREIGN_SEQUENTIAL) && \n\t\tload->access != VIPS_ACCESS_RANDOM ) {\n#ifdef DEBUG\n\t\tprintf( \"vips_foreign_load_temp: partial sequential temp\\n\" );\n#endif /*DEBUG*/\n\n\t\treturn( vips_image_new() );\n\t}\n\n\t/* ->memory used to be called ->disc and default TRUE. If it's been\n\t * forced FALSE, set memory TRUE.\n\t */\n\tif( !load->disc )\n\t\tload->memory = TRUE;\n\n\t/* We open via disc if:\n\t * - 'memory' is off\n\t * - the uncompressed image will be larger than \n\t *   vips_get_disc_threshold()\n\t */\n\tif( !load->memory && \n\t\timage_size > disc_threshold ) {\n#ifdef DEBUG\n\t\tprintf( \"vips_foreign_load_temp: disc temp\\n\" );\n#endif /*DEBUG*/\n\n\t\treturn( vips_image_new_temp_file( \"%s.v\" ) );\n\t}\n\n#ifdef DEBUG\n\tprintf( \"vips_foreign_load_temp: memory temp\\n\" );\n#endif /*DEBUG*/\n\n\t/* Otherwise, fall back to a memory buffer.\n\t */\n\treturn( vips_image_new_memory() );\n}\n\n/* Check two images for compatibility: their geometries need to match.\n */\nstatic gboolean\nvips_foreign_load_iscompat( VipsImage *a, VipsImage *b )\n{\n\tif( a->Xsize != b->Xsize ||\n\t\ta->Ysize != b->Ysize ||\n\t\ta->Bands != b->Bands ||\n\t\ta->Coding != b->Coding ||\n\t\ta->BandFmt != b->BandFmt ) {\n\t\tvips_error( \"VipsForeignLoad\",\n\t\t\t\"%s\", _( \"images do not match\" ) ); \n\t\treturn( FALSE );\n\t}\n\n\treturn( TRUE );\n}\n\n/* Our start function ... do the lazy open, if necessary, and return a region\n * on the new image.\n */\nstatic void *\nvips_foreign_load_start( VipsImage *out, void *a, void *b )\n{\n\tVipsForeignLoad *load = VIPS_FOREIGN_LOAD( b );\n\tVipsForeignLoadClass *class = VIPS_FOREIGN_LOAD_GET_CLASS( load );\n\n\t/* If this start has failed before in another thread, we can fail now.\n\t */\n\tif( load->error )\n\t\treturn( NULL );\n\n\tif( !load->real ) {\n\t\tif( !(load->real = vips_foreign_load_temp( load )) )\n\t\t\treturn( NULL );\n\n#ifdef DEBUG\n\t\tprintf( \"vips_foreign_load_start: triggering ->load()\\n\" );\n#endif /*DEBUG*/\n\n\t\t/* Read the image in. This may involve a long computation and\n\t\t * will finish with load->real holding the decompressed image. \n\t\t *\n\t\t * We want our caller to be able to see this computation on\n\t\t * @out, so eval signals on ->real need to appear on ->out.\n\t\t */\n\t\tload->real->progress_signal = load->out;\n\n\t\t/* Note the load object on the image. Loaders can use \n\t\t * this to signal invalidate if they hit a load error. See\n\t\t * vips_foreign_load_invalidate() below.\n\t\t */\n\t\tg_object_set_qdata( G_OBJECT( load->real ), \n\t\t\tvips__foreign_load_operation, load ); \n\n\t\t/* Load the image and check the result.\n\t\t *\n\t\t * ->header() read the header into @out, load has read the\n\t\t * image into @real. They must match exactly in size, bands,\n\t\t * format and coding for the copy to work.  \n\t\t *\n\t\t * Some versions of ImageMagick give different results between\n\t\t * Ping and Load for some formats, for example.\n\t\t *\n\t\t * If the load fails, we need to stop\n\t\t */\n\t\tif( class->load( load ) ||\n\t\t\tvips_image_pio_input( load->real ) || \n\t\t\tvips_foreign_load_iscompat( load->real, out ) ) {\n\t\t\tvips_operation_invalidate( VIPS_OPERATION( load ) ); \n\t\t\tload->error = TRUE;\n\n\t\t\treturn( NULL );\n\t\t}\n\n\t\t/* We have to tell vips that out depends on real. We've set\n\t\t * the demand hint below, but not given an input there.\n\t\t */\n\t\tvips_image_pipelinev( load->out, load->out->dhint, \n\t\t\tload->real, NULL );\n\t}\n\n\treturn( vips_region_new( load->real ) );\n}\n\n/* Just pointer-copy.\n */\nstatic int\nvips_foreign_load_generate( VipsRegion *or, \n\tvoid *seq, void *a, void *b, gboolean *stop )\n{\n\tVipsRegion *ir = (VipsRegion *) seq;\n\n        VipsRect *r = &or->valid;\n\n        /* Ask for input we need.\n         */\n        if( vips_region_prepare( ir, r ) )\n                return( -1 );\n\n        /* Attach output region to that.\n         */\n        if( vips_region_region( or, ir, r, r->left, r->top ) )\n                return( -1 );\n\n        return( 0 );\n}\n\nstatic int\nvips_foreign_load_build( VipsObject *object )\n{\n\tVipsObjectClass *class = VIPS_OBJECT_GET_CLASS( object );\n\tVipsForeignLoad *load = VIPS_FOREIGN_LOAD( object );\n\tVipsForeignLoadClass *fclass = VIPS_FOREIGN_LOAD_GET_CLASS( object );\n\n\tVipsForeignFlags flags;\n\n#ifdef DEBUG\n\tprintf( \"vips_foreign_load_build:\\n\" );\n#endif /*DEBUG*/\n\n\tflags = 0;\n\tif( fclass->get_flags )\n\t\tflags |= fclass->get_flags( load );\n\n\tif( (flags & VIPS_FOREIGN_PARTIAL) &&\n\t\t(flags & VIPS_FOREIGN_SEQUENTIAL) ) {\n\t\tg_warning( \"%s\", \n\t\t\t_( \"VIPS_FOREIGN_PARTIAL and VIPS_FOREIGN_SEQUENTIAL \"\n\t\t\t\t\"both set -- using SEQUENTIAL\" ) );\n\t\tflags ^= VIPS_FOREIGN_PARTIAL;\n\t}\n\n\tg_object_set( load, \"flags\", flags, NULL );\n\n\t/* If the loader can do sequential mode and sequential has been\n\t * requested, we need to block caching.\n\t */\n\tif( (load->flags & VIPS_FOREIGN_SEQUENTIAL) && \n\t\tload->access != VIPS_ACCESS_RANDOM ) \n\t\tload->nocache = TRUE;\n\n\tif( VIPS_OBJECT_CLASS( vips_foreign_load_parent_class )->\n\t\tbuild( object ) )\n\t\treturn( -1 );\n\n\tif( load->sequential ) \n\t\tg_warning( \"%s\", \n\t\t\t_( \"ignoring deprecated \\\"sequential\\\" mode -- \"\n\t\t\t\t\"please use \\\"access\\\" instead\" ) ); \n\n\tg_object_set( object, \"out\", vips_image_new(), NULL ); \n\n\tvips_image_set_string( load->out, \n\t\tVIPS_META_LOADER, class->nickname );\n\n#ifdef DEBUG\n\tprintf( \"vips_foreign_load_build: triggering ->header()\\n\" );\n#endif /*DEBUG*/\n\n\t/* Read the header into @out.\n\t */\n\tif( fclass->header &&\n\t\tfclass->header( load ) ) \n\t\treturn( -1 );\n\n\t/* If there's no ->load() method then the header read has done\n\t * everything. Otherwise, it's just set fields and we must also\n\t * load pixels.\n\t *\n\t * Delay the load until the first pixel is requested by doing the work\n\t * in the start function of the copy.\n\t */\n\tif( fclass->load ) {\n#ifdef DEBUG\n\t\tprintf( \"vips_foreign_load_build: delaying read ...\\n\" );\n#endif /*DEBUG*/\n\n\t\t/* ->header() should set the dhint. It'll default to the safe\n\t\t * SMALLTILE if header() did not set it.\n\t\t */\n\t\tvips_image_pipelinev( load->out, load->out->dhint, NULL );\n\n\t\t/* Then 'start' creates the real image and 'gen' fetches \n\t\t * pixels for @out from @real on demand.\n\t\t */\n\t\tif( vips_image_generate( load->out, \n\t\t\tvips_foreign_load_start, \n\t\t\tvips_foreign_load_generate, \n\t\t\tvips_stop_one, \n\t\t\tNULL, load ) ) \n\t\t\treturn( -1 );\n\t}\n\n\t/* If random access has been requested, make sure that we don't have a\n\t * SEQ tag left from a sequential loader.\n\t */\n\tif( load->access == VIPS_ACCESS_RANDOM ) \n\t\t(void) vips_image_remove( load->out, VIPS_META_SEQUENTIAL );\n\n\treturn( 0 );\n}\n\nstatic VipsOperationFlags \nvips_foreign_load_operation_get_flags( VipsOperation *operation )\n{\n\tVipsForeignLoad *load = VIPS_FOREIGN_LOAD( operation );\n\n\tVipsOperationFlags flags;\n\n\tflags = VIPS_OPERATION_CLASS( vips_foreign_load_parent_class )->\n\t\tget_flags( operation );\n\tif( load->nocache )\n\t\tflags |= VIPS_OPERATION_NOCACHE;\n\n\treturn( flags );\n}\n\nstatic void\nvips_foreign_load_class_init( VipsForeignLoadClass *class )\n{\n\tGObjectClass *gobject_class = G_OBJECT_CLASS( class );\n\tVipsObjectClass *object_class = (VipsObjectClass *) class;\n\tVipsOperationClass *operation_class = (VipsOperationClass *) class;\n\n\tgobject_class->dispose = vips_foreign_load_dispose;\n\tgobject_class->set_property = vips_object_set_property;\n\tgobject_class->get_property = vips_object_get_property;\n\n\tobject_class->build = vips_foreign_load_build;\n\tobject_class->summary_class = vips_foreign_load_summary_class;\n\tobject_class->new_from_string = vips_foreign_load_new_from_string;\n\tobject_class->nickname = \"fileload\";\n\tobject_class->description = _( \"file loaders\" );\n\n\toperation_class->get_flags = vips_foreign_load_operation_get_flags;\n\n\tVIPS_ARG_IMAGE( class, \"out\", 2, \n\t\t_( \"Output\" ), \n\t\t_( \"Output image\" ),\n\t\tVIPS_ARGUMENT_REQUIRED_OUTPUT, \n\t\tG_STRUCT_OFFSET( VipsForeignLoad, out ) );\n\n\tVIPS_ARG_FLAGS( class, \"flags\", 6, \n\t\t_( \"Flags\" ), \n\t\t_( \"Flags for this file\" ),\n\t\tVIPS_ARGUMENT_OPTIONAL_OUTPUT,\n\t\tG_STRUCT_OFFSET( VipsForeignLoad, flags ),\n\t\tVIPS_TYPE_FOREIGN_FLAGS, VIPS_FOREIGN_NONE ); \n\n\tVIPS_ARG_BOOL( class, \"memory\", 7, \n\t\t_( \"Memory\" ), \n\t\t_( \"Force open via memory\" ),\n\t\tVIPS_ARGUMENT_OPTIONAL_INPUT,\n\t\tG_STRUCT_OFFSET( VipsForeignLoad, memory ),\n\t\tFALSE );\n\n\tVIPS_ARG_ENUM( class, \"access\", 8, \n\t\t_( \"Access\" ), \n\t\t_( \"Required access pattern for this file\" ),\n\t\tVIPS_ARGUMENT_OPTIONAL_INPUT,\n\t\tG_STRUCT_OFFSET( VipsForeignLoad, access ),\n\t\tVIPS_TYPE_ACCESS, VIPS_ACCESS_RANDOM ); \n\n\tVIPS_ARG_BOOL( class, \"sequential\", 10, \n\t\t_( \"Sequential\" ), \n\t\t_( \"Sequential read only\" ),\n\t\tVIPS_ARGUMENT_OPTIONAL_INPUT | VIPS_ARGUMENT_DEPRECATED,\n\t\tG_STRUCT_OFFSET( VipsForeignLoad, sequential ),\n\t\tFALSE );\n\n\tVIPS_ARG_BOOL( class, \"fail\", 11, \n\t\t_( \"Fail\" ), \n\t\t_( \"Fail on first error\" ),\n\t\tVIPS_ARGUMENT_OPTIONAL_INPUT,\n\t\tG_STRUCT_OFFSET( VipsForeignLoad, fail ),\n\t\tFALSE );\n\n\tVIPS_ARG_BOOL( class, \"disc\", 12, \n\t\t_( \"Disc\" ), \n\t\t_( \"Open to disc\" ),\n\t\tVIPS_ARGUMENT_OPTIONAL_INPUT | VIPS_ARGUMENT_DEPRECATED,\n\t\tG_STRUCT_OFFSET( VipsForeignLoad, disc ),\n\t\tTRUE );\n\n}\n\nstatic void\nvips_foreign_load_init( VipsForeignLoad *load )\n{\n\tload->disc = TRUE;\n\tload->access = VIPS_ACCESS_RANDOM;\n}\n\n/*\n * Loaders can call this\n */\n\n/**\n * vips_foreign_load_invalidate: (method)\n * @image: image to invalidate\n *\n * Loaders can call this on the image they are making if they see a read error\n * from the load library. It signals \"invalidate\" on the load operation and\n * will cause it to be dropped from cache. \n *\n * If we know a file will cause a read error, we don't want to cache the\n * failing operation, we want to make sure the image will really be opened \n * again if our caller tries again. For example, a broken file might be \n * replaced by a working one. \n */\nvoid\nvips_foreign_load_invalidate( VipsImage *image )\n{\n\tVipsOperation *operation; \n\n#ifdef DEBUG\n\tprintf( \"vips_foreign_load_invalidate: %p\\n\", image ); \n#endif /*DEBUG*/\n\n\tif( (operation = g_object_get_qdata( G_OBJECT( image ), \n\t\tvips__foreign_load_operation )) ) {\n\t\tvips_operation_invalidate( operation ); \n\t}\n}\n\n/* Abstract base class for image savers.\n */\n\nG_DEFINE_ABSTRACT_TYPE( VipsForeignSave, vips_foreign_save, VIPS_TYPE_FOREIGN );\n\nstatic void\nvips_foreign_save_dispose( GObject *gobject )\n{\n\tVipsForeignSave *save = VIPS_FOREIGN_SAVE( gobject );\n\n\tVIPS_UNREF( save->ready );\n\n\tG_OBJECT_CLASS( vips_foreign_save_parent_class )->dispose( gobject );\n}\n\nstatic void\nvips_foreign_save_summary_class( VipsObjectClass *object_class, VipsBuf *buf )\n{\n\tVipsForeignSaveClass *class = VIPS_FOREIGN_SAVE_CLASS( object_class );\n\n\tVIPS_OBJECT_CLASS( vips_foreign_save_parent_class )->\n\t\tsummary_class( object_class, buf );\n\n\tvips_buf_appendf( buf, \", %s\", \n\t\tvips_enum_nick( VIPS_TYPE_SAVEABLE, class->saveable ) );\n}\n\nstatic VipsObject *\nvips_foreign_save_new_from_string( const char *string )\n{\n\tconst char *file_op;\n\tGType type;\n\tVipsForeignSave *save;\n\n\tif( !(file_op = vips_foreign_find_save( string )) )\n\t\treturn( NULL );\n\ttype = g_type_from_name( file_op );\n\tg_assert( type ); \n\n\tsave = VIPS_FOREIGN_SAVE( g_object_new( type, NULL ) );\n\tg_object_set( save,\n\t\t\"filename\", string,\n\t\tNULL );\n\n\treturn( VIPS_OBJECT( save ) );\n}\n\n/* Convert an image for saving. \n */\nint\nvips__foreign_convert_saveable( VipsImage *in, VipsImage **ready,\n\tVipsSaveable saveable, VipsBandFormat *format, VipsCoding *coding,\n\tVipsArrayDouble *background )\n{\n\t/* in holds a reference to the output of our chain as we build it.\n\t */\n\tg_object_ref( in );\n\n\t/* For coded images, can this class save the coding we are in now? \n\t * Nothing to do.\n\t */\n\tif( in->Coding != VIPS_CODING_NONE &&\n\t\tcoding[in->Coding] ) {\n\t\t*ready = in;\n\t\treturn( 0 );\n\t}\n\n\t/* For uncoded images, if this saver supports ANY bands and this \n\t * format we have nothing to do.\n\t */\n\tif( in->Coding == VIPS_CODING_NONE &&\n\t        saveable == VIPS_SAVEABLE_ANY &&\n\t\tformat[in->BandFmt] == in->BandFmt ) {\n\t\t*ready = in;\n\t\treturn( 0 );\n\t}\n\n\t/* Otherwise ... we need to decode and then (possibly) recode at the\n\t * end.\n\t */\n\n\t/* If this is an VIPS_CODING_LABQ, we can go straight to RGB.\n\t */\n\tif( in->Coding == VIPS_CODING_LABQ ) {\n\t\tVipsImage *out;\n\n\t\tif( vips_LabQ2sRGB( in, &out, NULL ) ) {\n\t\t\tg_object_unref( in );\n\t\t\treturn( -1 );\n\t\t}\n\t\tg_object_unref( in );\n\n\t\tin = out;\n\t}\n\n\t/* If this is an VIPS_CODING_RAD, we unpack to float. This could be\n\t * scRGB or XYZ. \n\t */\n\tif( in->Coding == VIPS_CODING_RAD ) {\n\t\tVipsImage *out;\n\n\t\tif( vips_rad2float( in, &out, NULL ) ) {\n\t\t\tg_object_unref( in );\n\t\t\treturn( -1 );\n\t\t}\n\t\tg_object_unref( in );\n\n\t\tin = out;\n\t}\n\n\t/* If the saver supports RAD, we need to go to scRGB or XYZ. \n\t */\n\tif( coding[VIPS_CODING_RAD] ) {\n\t\tif( in->Type != VIPS_INTERPRETATION_scRGB &&\n\t\t\tin->Type != VIPS_INTERPRETATION_XYZ ) {\n\t\t\tVipsImage *out;\n\n\t\t\tif( vips_colourspace( in, &out, \n\t\t\t\tVIPS_INTERPRETATION_scRGB, NULL ) ) {\n\t\t\t\tg_object_unref( in );\n\t\t\t\treturn( -1 );\n\t\t\t}\n\t\t\tg_object_unref( in );\n\n\t\t\tin = out;\n\t\t}\n\t}\n\n\t/* If this image is CMYK and the saver is RGB-only, use lcms to try to\n\t * import to XYZ. This will only work if the image has an embedded\n\t * profile. \n\t */\n\tif( in->Type == VIPS_INTERPRETATION_CMYK &&\n\t\tin->Bands >= 4 &&\n\t\t(saveable == VIPS_SAVEABLE_RGB ||\n\t\t saveable == VIPS_SAVEABLE_RGBA ||\n\t\t saveable == VIPS_SAVEABLE_RGBA_ONLY) ) { \n\t\tVipsImage *out;\n\n\t\tif( vips_icc_import( in, &out, \n\t\t\t\"pcs\", VIPS_PCS_XYZ,\n\t\t\tNULL ) ) {\n\t\t\tg_object_unref( in );\n\t\t\treturn( -1 );\n\t\t}\n\t\tg_object_unref( in );\n\n\t\tin = out;\n\n\t\t/* We've imported to PCS, we must remove the embedded profile,\n\t\t * since it no longer matches the image.\n\t\t *\n\t\t * For example, when converting CMYK JPG to RGB PNG, we need \n\t\t * to remove the CMYK profile on import, or the png writer will \n\t\t * try to attach it when we write the image as RGB.\n\t\t */\n\t\tvips_image_remove( in, VIPS_META_ICC_NAME );\n\t}\n\n\t/* If this is something other than CMYK or RAD, eg. maybe a LAB image,\n\t * we need to transform to RGB.\n\t */\n\tif( !coding[VIPS_CODING_RAD] &&\n\t\tin->Bands >= 3 &&\n\t\tin->Type != VIPS_INTERPRETATION_CMYK &&\n\t\tvips_colourspace_issupported( in ) &&\n\t\t(saveable == VIPS_SAVEABLE_RGB ||\n\t\t saveable == VIPS_SAVEABLE_RGBA ||\n\t\t saveable == VIPS_SAVEABLE_RGBA_ONLY ||\n\t\t saveable == VIPS_SAVEABLE_RGB_CMYK) ) { \n\t\tVipsImage *out;\n\t\tVipsInterpretation interpretation;\n\n\t\t/* Do we make RGB or RGB16? We don't want to squash a 16-bit\n\t\t * RGB down to 8 bits if the saver supports 16. \n\t\t */\n\t\tif( vips_band_format_is8bit( format[in->BandFmt] ) )\n\t\t\tinterpretation = VIPS_INTERPRETATION_sRGB;\n\t\telse\n\t\t\tinterpretation = VIPS_INTERPRETATION_RGB16;\n\n\t\tif( vips_colourspace( in, &out, interpretation, NULL ) ) {\n\t\t\tg_object_unref( in );\n\t\t\treturn( -1 );\n\t\t}\n\t\tg_object_unref( in );\n\n\t\tin = out;\n\t}\n\n\t/* VIPS_SAVEABLE_RGBA_ONLY does not support 1 or 2 bands ... convert \n\t * to sRGB. \n\t */\n\tif( !coding[VIPS_CODING_RAD] &&\n\t\tin->Bands < 3 &&\n\t\tvips_colourspace_issupported( in ) &&\n\t\tsaveable == VIPS_SAVEABLE_RGBA_ONLY ) { \n\t\tVipsImage *out;\n\t\tVipsInterpretation interpretation;\n\n\t\t/* Do we make RGB or RGB16? We don't want to squash a 16-bit\n\t\t * RGB down to 8 bits if the saver supports 16. \n\t\t */\n\t\tif( vips_band_format_is8bit( format[in->BandFmt] ) )\n\t\t\tinterpretation = VIPS_INTERPRETATION_sRGB;\n\t\telse\n\t\t\tinterpretation = VIPS_INTERPRETATION_RGB16;\n\n\t\tif( vips_colourspace( in, &out, interpretation, NULL ) ) {\n\t\t\tg_object_unref( in );\n\t\t\treturn( -1 );\n\t\t}\n\t\tg_object_unref( in );\n\n\t\tin = out;\n\t}\n\n\t/* Get the bands right. We must do this after all colourspace\n\t * transforms, since they can change the number of bands. \n\t */\n\tif( in->Coding == VIPS_CODING_NONE ) {\n\t\t/* Do we need to flatten out an alpha channel? There needs to\n\t\t * be an alpha there now, and this writer needs to not support\n\t\t * alpha.\n\t\t */\n\t\tif( (in->Bands == 2 ||\n\t\t\t(in->Bands == 4 && \n\t\t\t in->Type != VIPS_INTERPRETATION_CMYK)) &&\n\t\t\t(saveable == VIPS_SAVEABLE_MONO ||\n\t\t\t saveable == VIPS_SAVEABLE_RGB ||\n\t\t\t saveable == VIPS_SAVEABLE_RGB_CMYK) ) {\n\t\t\tVipsImage *out;\n\n\t\t\tif( vips_flatten( in, &out, \n\t\t\t\t\"background\", background,\n\t\t\t\tNULL ) ) {\n\t\t\t\tg_object_unref( in );\n\t\t\t\treturn( -1 );\n\t\t\t}\n\t\t\tg_object_unref( in );\n\n\t\t\tin = out;\n\t\t}\n\n\t\t/* Other alpha removal strategies ... just drop the extra\n\t\t * bands.\n\t\t */\n\n\t\telse if( in->Bands > 3 && \n\t\t\t(saveable == VIPS_SAVEABLE_RGB ||\n\t\t\t (saveable == VIPS_SAVEABLE_RGB_CMYK &&\n\t\t\t  in->Type != VIPS_INTERPRETATION_CMYK)) ) { \n\t\t\tVipsImage *out;\n\n\t\t\t/* Don't let 4 bands though unless the image really is\n\t\t\t * a CMYK.\n\t\t\t *\n\t\t\t * Consider a RGBA png being saved as JPG. We can\n\t\t\t * write CMYK jpg, but we mustn't do that for RGBA\n\t\t\t * images.\n\t\t\t */\n\t\t\tif( vips_extract_band( in, &out, 0, \n\t\t\t\t\"n\", 3,\n\t\t\t\tNULL ) ) {\n\t\t\t\tg_object_unref( in );\n\t\t\t\treturn( -1 );\n\t\t\t}\n\t\t\tg_object_unref( in );\n\n\t\t\tin = out;\n\t\t}\n\t\telse if( in->Bands > 4 && \n\t\t\t((saveable == VIPS_SAVEABLE_RGB_CMYK &&\n\t\t\t  in->Type == VIPS_INTERPRETATION_CMYK) ||\n\t\t\t saveable == VIPS_SAVEABLE_RGBA ||\n\t\t\t saveable == VIPS_SAVEABLE_RGBA_ONLY) ) {\n\t\t\tVipsImage *out;\n\n\t\t\tif( vips_extract_band( in, &out, 0, \n\t\t\t\t\"n\", 4,\n\t\t\t\tNULL ) ) {\n\t\t\t\tg_object_unref( in );\n\t\t\t\treturn( -1 );\n\t\t\t}\n\t\t\tg_object_unref( in );\n\n\t\t\tin = out;\n\t\t}\n\t\telse if( in->Bands > 1 && \n\t\t\tsaveable == VIPS_SAVEABLE_MONO ) {\n\t\t\tVipsImage *out;\n\n\t\t\tif( vips_extract_band( in, &out, 0, NULL ) ) {\n\t\t\t\tg_object_unref( in );\n\t\t\t\treturn( -1 );\n\t\t\t}\n\t\t\tg_object_unref( in );\n\n\t\t\tin = out;\n\t\t}\n\n\t\t/* Else we have VIPS_SAVEABLE_ANY and we don't chop bands down.\n\t\t */\n\t}\n\n\t/* Handle the ushort interpretations.\n\t *\n\t * RGB16 and GREY16 use 0-65535 for black-white. If we have an image\n\t * tagged like this, and it has more than 8 bits (we leave crazy uchar\n\t * images tagged as RGB16 alone), we'll need to get it ready for the\n\t * saver.\n\t */\n\tif( (in->Type == VIPS_INTERPRETATION_RGB16 ||\n\t\t in->Type == VIPS_INTERPRETATION_GREY16) &&\n\t\t!vips_band_format_is8bit( in->BandFmt ) ) {\n\t\t/* If the saver supports ushort, cast to ushort. It may be\n\t\t * float at the moment, for example.\n\t\t *\n\t\t * If the saver does not support ushort, automatically shift\n\t\t * it down. This is the behaviour we want for saving an RGB16\n\t\t * image as JPG, for example.\n\t\t */\n\t\tif( format[VIPS_FORMAT_USHORT] == VIPS_FORMAT_USHORT ) {\n\t\t\tVipsImage *out;\n\n\t\t\tif( vips_cast( in, &out, VIPS_FORMAT_USHORT, NULL ) ) {\n\t\t\t\tg_object_unref( in );\n\t\t\t\treturn( -1 );\n\t\t\t}\n\t\t\tg_object_unref( in );\n\n\t\t\tin = out;\n\t\t}\n\t\telse {\n\t\t\tVipsImage *out;\n\n\t\t\tif( vips_rshift_const1( in, &out, 8, NULL ) ) { \n\t\t\t\tg_object_unref( in );\n\t\t\t\treturn( -1 );\n\t\t\t}\n\t\t\tg_object_unref( in );\n\n\t\t\tin = out;\n\n\t\t\t/* That could have produced an int image ... make sure \n\t\t\t * we are now uchar.\n\t\t\t */\n\t\t\tif( vips_cast( in, &out, VIPS_FORMAT_UCHAR, NULL ) ) {\n\t\t\t\tg_object_unref( in );\n\t\t\t\treturn( -1 );\n\t\t\t}\n\t\t\tg_object_unref( in );\n\n\t\t\tin = out;\n\t\t}\n\t}\n\n\t/* Cast to the output format.\n\t */\n\t{\n\t\tVipsImage *out;\n\n\t\tif( vips_cast( in, &out, format[in->BandFmt], NULL ) ) {\n\t\t\tg_object_unref( in );\n\t\t\treturn( -1 );\n\t\t}\n\t\tg_object_unref( in );\n\n\t\tin = out;\n\t}\n\n\t/* Does this class want a coded image? Search the coding table for the\n\t * first one.\n\t */\n\tif( coding[VIPS_CODING_NONE] ) {\n\t\t/* Already NONE, nothing to do.\n\t\t */\n\t}\n\telse if( coding[VIPS_CODING_LABQ] ) {\n\t\tVipsImage *out;\n\n\t\tif( vips_Lab2LabQ( in, &out, NULL ) ) {\n\t\t\tg_object_unref( in );\n\t\t\treturn( -1 );\n\t\t}\n\t\tg_object_unref( in );\n\n\t\tin = out;\n\t}\n\telse if( coding[VIPS_CODING_RAD] ) {\n\t\tVipsImage *out;\n\n\t\tif( vips_float2rad( in, &out, NULL ) ) {\n\t\t\tg_object_unref( in );\n\t\t\treturn( -1 );\n\t\t}\n\t\tg_object_unref( in );\n\n\t\tin = out;\n\t}\n\n\t*ready = in;\n\n\treturn( 0 );\n}\n\nstatic int\nvips_foreign_save_build( VipsObject *object )\n{\n\tVipsForeignSave *save = VIPS_FOREIGN_SAVE( object );\n\n\tif( save->in ) {\n\t\tVipsForeignSaveClass *class = \n\t\t\tVIPS_FOREIGN_SAVE_GET_CLASS( save );\n\t\tVipsImage *ready;\n\n\t\tif( vips__foreign_convert_saveable( save->in, &ready,\n\t\t\tclass->saveable, class->format_table, class->coding,\n\t\t\tsave->background ) )\n\t\t\treturn( -1 );\n\n\t\tif( save->page_height )\n\t\t\tvips_image_set_int( ready, \n\t\t\t\tVIPS_META_PAGE_HEIGHT, save->page_height );\n\n\t\tVIPS_UNREF( save->ready );\n\t\tsave->ready = ready;\n\t}\n\n\tif( VIPS_OBJECT_CLASS( vips_foreign_save_parent_class )->\n\t\tbuild( object ) )\n\t\treturn( -1 );\n\n\treturn( 0 );\n}\n\n#define UC VIPS_FORMAT_UCHAR\n#define C VIPS_FORMAT_CHAR\n#define US VIPS_FORMAT_USHORT\n#define S VIPS_FORMAT_SHORT\n#define UI VIPS_FORMAT_UINT\n#define I VIPS_FORMAT_INT\n#define F VIPS_FORMAT_FLOAT\n#define X VIPS_FORMAT_COMPLEX\n#define D VIPS_FORMAT_DOUBLE\n#define DX VIPS_FORMAT_DPCOMPLEX\n\nstatic int vips_foreign_save_format_table[10] = {\n// UC  C   US  S   UI  I  F  X  D  DX \n   UC, C,  US, S,  UI, I, F, X, D, DX\n};\n\nstatic void\nvips_foreign_save_class_init( VipsForeignSaveClass *class )\n{\n\tGObjectClass *gobject_class = G_OBJECT_CLASS( class );\n\tVipsObjectClass *object_class = (VipsObjectClass *) class;\n\tVipsOperationClass *operation_class = (VipsOperationClass *) class;\n\n\tint i;\n\n\tgobject_class->dispose = vips_foreign_save_dispose;\n\tgobject_class->set_property = vips_object_set_property;\n\tgobject_class->get_property = vips_object_get_property;\n\n\tobject_class->build = vips_foreign_save_build;\n\tobject_class->summary_class = vips_foreign_save_summary_class;\n\tobject_class->new_from_string = vips_foreign_save_new_from_string;\n\tobject_class->nickname = \"filesave\";\n\tobject_class->description = _( \"file savers\" );\n\n\t/* All savers are sequential by definition. Things like tiled tiff \n\t * write and interlaced png write, which are not, add extra caches \n\t * on their input. \n\t */\n\toperation_class->flags |= VIPS_OPERATION_SEQUENTIAL;\n\n\t/* Must not cache savers.\n\t */\n\toperation_class->flags |= VIPS_OPERATION_NOCACHE;\n\n\t/* Default to no coding allowed.\n\t */\n\tfor( i = 0; i < VIPS_CODING_LAST; i++ )\n\t\tclass->coding[i] = FALSE;\n\tclass->coding[VIPS_CODING_NONE] = TRUE;\n\n\t/* Default to no cast on save.\n\t */\n\tclass->format_table = vips_foreign_save_format_table; \n\n\tVIPS_ARG_IMAGE( class, \"in\", 0, \n\t\t_( \"Input\" ), \n\t\t_( \"Image to save\" ),\n\t\tVIPS_ARGUMENT_REQUIRED_INPUT,\n\t\tG_STRUCT_OFFSET( VipsForeignSave, in ) );\n\n\tVIPS_ARG_BOOL( class, \"strip\", 100,\n\t\t_( \"Strip\" ),\n\t\t_( \"Strip all metadata from image\" ),\n\t\tVIPS_ARGUMENT_OPTIONAL_INPUT,\n\t\tG_STRUCT_OFFSET( VipsForeignSave, strip ),\n\t\tFALSE );\n\n\tVIPS_ARG_BOXED( class, \"background\", 101, \n\t\t_( \"Background\" ), \n\t\t_( \"Background value\" ),\n\t\tVIPS_ARGUMENT_OPTIONAL_INPUT,\n\t\tG_STRUCT_OFFSET( VipsForeignSave, background ),\n\t\tVIPS_TYPE_ARRAY_DOUBLE );\n\n\tVIPS_ARG_INT( class, \"page_height\", 8, \n\t\t_( \"Page height\" ), \n\t\t_( \"Set page height for multipage save\" ),\n\t\tVIPS_ARGUMENT_OPTIONAL_INPUT,\n\t\tG_STRUCT_OFFSET( VipsForeignSave, page_height ),\n\t\t0, VIPS_MAX_COORD, 0 ); \n}\n\nstatic void\nvips_foreign_save_init( VipsForeignSave *save )\n{\n\tsave->background = vips_array_double_newv( 1, 0.0 );\n}\n\n/* Can we write this filename with this file? \n */\nstatic void *\nvips_foreign_find_save_sub( VipsForeignSaveClass *save_class, \n\tconst char *filename )\n{\n\tVipsForeignClass *class = VIPS_FOREIGN_CLASS( save_class );\n\n\t/* The suffs might be defined on an abstract base class, make sure we\n\t * don't pick that.\n\t */\n\tif( !G_TYPE_IS_ABSTRACT( G_TYPE_FROM_CLASS( class ) ) &&\n\t\tclass->suffs &&\n\t\tvips_filename_suffix_match( filename, class->suffs ) )\n\t\treturn( save_class );\n\n\treturn( NULL );\n}\n\n/**\n * vips_foreign_find_save:\n * @filename: name to find a saver for\n *\n * Searches for an operation you could use to write to @filename.\n * Any trailing options on @filename are stripped and ignored. \n *\n * See also: vips_foreign_find_save_buffer(), vips_image_write_to_file().\n *\n * Returns: the name of an operation on success, %NULL on error\n */\nconst char *\nvips_foreign_find_save( const char *name )\n{\n\tchar filename[VIPS_PATH_MAX];\n\tchar option_string[VIPS_PATH_MAX];\n\tVipsForeignSaveClass *save_class;\n\n\tvips__filename_split8( name, filename, option_string );\n\n\tif( !(save_class = (VipsForeignSaveClass *) vips_foreign_map( \n\t\t\"VipsForeignSave\",\n\t\t(VipsSListMap2Fn) vips_foreign_find_save_sub, \n\t\t(void *) filename, NULL )) ) {\n\t\tvips_error( \"VipsForeignSave\",\n\t\t\t_( \"\\\"%s\\\" is not a known file format\" ), name );\n\n\t\treturn( NULL );\n\t}\n\n\treturn( G_OBJECT_CLASS_NAME( save_class ) );\n}\n\n/* Kept for early vips8 API compat.\n */\n\nint\nvips_foreign_save( VipsImage *in, const char *name, ... )\n{\n\tchar filename[VIPS_PATH_MAX];\n\tchar option_string[VIPS_PATH_MAX];\n\tconst char *operation_name;\n\tva_list ap;\n\tint result;\n\n\tvips__filename_split8( name, filename, option_string );\n\n\tif( !(operation_name = vips_foreign_find_save( filename )) )\n\t\treturn( -1 );\n\n\tva_start( ap, name );\n\tresult = vips_call_split_option_string( operation_name, option_string, \n\t\tap, in, filename );\n\tva_end( ap );\n\n\treturn( result );\n}\n\n/* Can we write this buffer with this file type?\n */\nstatic void *\nvips_foreign_find_save_buffer_sub( VipsForeignSaveClass *save_class, \n\tconst char *suffix )\n{\n\tVipsObjectClass *object_class = VIPS_OBJECT_CLASS( save_class );\n\tVipsForeignClass *class = VIPS_FOREIGN_CLASS( save_class );\n\n\tif( class->suffs &&\n\t\tvips_ispostfix( object_class->nickname, \"_buffer\" ) &&\n\t\tvips_filename_suffix_match( suffix, class->suffs ) )\n\t\treturn( save_class );\n\n\treturn( NULL );\n}\n\n/**\n * vips_foreign_find_save_buffer:\n * @suffix: name to find a saver for\n *\n * Searches for an operation you could use to write to a buffer in @suffix\n * format. \n *\n * See also: vips_image_write_to_buffer().\n *\n * Returns: the name of an operation on success, %NULL on error\n */\nconst char *\nvips_foreign_find_save_buffer( const char *name )\n{\n\tchar suffix[VIPS_PATH_MAX];\n\tchar option_string[VIPS_PATH_MAX];\n\tVipsForeignSaveClass *save_class;\n\n\tvips__filename_split8( name, suffix, option_string );\n\n\tif( !(save_class = (VipsForeignSaveClass *) vips_foreign_map( \n\t\t\"VipsForeignSave\",\n\t\t(VipsSListMap2Fn) vips_foreign_find_save_buffer_sub, \n\t\t(void *) suffix, NULL )) ) {\n\t\tvips_error( \"VipsForeignSave\",\n\t\t\t_( \"\\\"%s\\\" is not a known buffer format\" ), name );\n\n\t\treturn( NULL );\n\t}\n\n\treturn( G_OBJECT_CLASS_NAME( save_class ) );\n}\n\n/* Called from iofuncs to init all operations in this dir. Use a plugin system\n * instead?\n */\nvoid\nvips_foreign_operation_init( void )\n{\n\textern GType vips_foreign_load_rad_get_type( void ); \n\textern GType vips_foreign_save_rad_file_get_type( void ); \n\textern GType vips_foreign_save_rad_buffer_get_type( void ); \n\textern GType vips_foreign_load_mat_get_type( void ); \n\textern GType vips_foreign_load_ppm_get_type( void ); \n\textern GType vips_foreign_save_ppm_get_type( void ); \n\textern GType vips_foreign_load_png_get_type( void ); \n\textern GType vips_foreign_load_png_buffer_get_type( void ); \n\textern GType vips_foreign_save_png_file_get_type( void ); \n\textern GType vips_foreign_save_png_buffer_get_type( void ); \n\textern GType vips_foreign_load_csv_get_type( void ); \n\textern GType vips_foreign_save_csv_get_type( void ); \n\textern GType vips_foreign_load_matrix_get_type( void ); \n\textern GType vips_foreign_save_matrix_get_type( void ); \n\textern GType vips_foreign_print_matrix_get_type( void ); \n\textern GType vips_foreign_load_fits_get_type( void ); \n\textern GType vips_foreign_save_fits_get_type( void ); \n\textern GType vips_foreign_load_analyze_get_type( void ); \n\textern GType vips_foreign_load_openexr_get_type( void ); \n\textern GType vips_foreign_load_openslide_get_type( void ); \n\textern GType vips_foreign_load_jpeg_file_get_type( void ); \n\textern GType vips_foreign_load_jpeg_buffer_get_type( void ); \n\textern GType vips_foreign_save_jpeg_file_get_type( void ); \n\textern GType vips_foreign_save_jpeg_buffer_get_type( void ); \n\textern GType vips_foreign_save_jpeg_mime_get_type( void ); \n\textern GType vips_foreign_load_tiff_file_get_type( void ); \n\textern GType vips_foreign_load_tiff_buffer_get_type( void ); \n\textern GType vips_foreign_save_tiff_file_get_type( void ); \n\textern GType vips_foreign_save_tiff_buffer_get_type( void ); \n\textern GType vips_foreign_load_vips_get_type( void ); \n\textern GType vips_foreign_save_vips_get_type( void ); \n\textern GType vips_foreign_load_raw_get_type( void ); \n\textern GType vips_foreign_save_raw_get_type( void ); \n\textern GType vips_foreign_save_raw_fd_get_type( void ); \n\textern GType vips_foreign_load_magick_file_get_type( void ); \n\textern GType vips_foreign_load_magick_buffer_get_type( void ); \n\textern GType vips_foreign_load_magick7_file_get_type( void ); \n\textern GType vips_foreign_load_magick7_buffer_get_type( void ); \n\textern GType vips_foreign_save_dz_file_get_type( void ); \n\textern GType vips_foreign_save_dz_buffer_get_type( void ); \n\textern GType vips_foreign_load_webp_file_get_type( void ); \n\textern GType vips_foreign_load_webp_buffer_get_type( void ); \n\textern GType vips_foreign_save_webp_file_get_type( void ); \n\textern GType vips_foreign_save_webp_buffer_get_type( void ); \n\textern GType vips_foreign_load_pdf_get_type( void ); \n\textern GType vips_foreign_load_pdf_file_get_type( void ); \n\textern GType vips_foreign_load_pdf_buffer_get_type( void ); \n\textern GType vips_foreign_load_svg_get_type( void ); \n\textern GType vips_foreign_load_svg_file_get_type( void ); \n\textern GType vips_foreign_load_svg_buffer_get_type( void ); \n\textern GType vips_foreign_load_gif_get_type( void ); \n\textern GType vips_foreign_load_gif_file_get_type( void ); \n\textern GType vips_foreign_load_gif_buffer_get_type( void ); \n\n\tvips_foreign_load_csv_get_type(); \n\tvips_foreign_save_csv_get_type(); \n\tvips_foreign_load_matrix_get_type(); \n\tvips_foreign_save_matrix_get_type(); \n\tvips_foreign_print_matrix_get_type(); \n\tvips_foreign_load_raw_get_type(); \n\tvips_foreign_save_raw_get_type(); \n\tvips_foreign_save_raw_fd_get_type(); \n\tvips_foreign_load_vips_get_type(); \n\tvips_foreign_save_vips_get_type(); \n\n#ifdef HAVE_ANALYZE\n\tvips_foreign_load_analyze_get_type(); \n#endif /*HAVE_ANALYZE*/\n\n#ifdef HAVE_PPM\n\tvips_foreign_load_ppm_get_type(); \n\tvips_foreign_save_ppm_get_type(); \n#endif /*HAVE_PPM*/\n\n#ifdef HAVE_RADIANCE\n\tvips_foreign_load_rad_get_type(); \n\tvips_foreign_save_rad_file_get_type(); \n\tvips_foreign_save_rad_buffer_get_type(); \n#endif /*HAVE_RADIANCE*/\n\n#ifdef HAVE_POPPLER\n\tvips_foreign_load_pdf_get_type(); \n\tvips_foreign_load_pdf_file_get_type(); \n\tvips_foreign_load_pdf_buffer_get_type(); \n#endif /*HAVE_POPPLER*/\n\n#ifdef HAVE_RSVG\n\tvips_foreign_load_svg_get_type(); \n\tvips_foreign_load_svg_file_get_type(); \n\tvips_foreign_load_svg_buffer_get_type(); \n#endif /*HAVE_RSVG*/\n\n#ifdef HAVE_GIFLIB\n\tvips_foreign_load_gif_get_type(); \n\tvips_foreign_load_gif_file_get_type(); \n\tvips_foreign_load_gif_buffer_get_type(); \n#endif /*HAVE_GIFLIB*/\n\n#ifdef HAVE_GSF\n\tvips_foreign_save_dz_file_get_type(); \n\tvips_foreign_save_dz_buffer_get_type(); \n#endif /*HAVE_GSF*/\n\n#ifdef HAVE_PNG\n\tvips_foreign_load_png_get_type(); \n\tvips_foreign_load_png_buffer_get_type(); \n\tvips_foreign_save_png_file_get_type(); \n\tvips_foreign_save_png_buffer_get_type(); \n#endif /*HAVE_PNG*/\n\n#ifdef HAVE_MATIO\n\tvips_foreign_load_mat_get_type(); \n#endif /*HAVE_MATIO*/\n\n#ifdef HAVE_JPEG\n\tvips_foreign_load_jpeg_file_get_type(); \n\tvips_foreign_load_jpeg_buffer_get_type(); \n\tvips_foreign_save_jpeg_file_get_type(); \n\tvips_foreign_save_jpeg_buffer_get_type(); \n\tvips_foreign_save_jpeg_mime_get_type(); \n#endif /*HAVE_JPEG*/\n\n#ifdef HAVE_LIBWEBP\n\tvips_foreign_load_webp_file_get_type(); \n\tvips_foreign_load_webp_buffer_get_type(); \n\tvips_foreign_save_webp_file_get_type(); \n\tvips_foreign_save_webp_buffer_get_type(); \n#endif /*HAVE_LIBWEBP*/\n\n#ifdef HAVE_TIFF\n\tvips_foreign_load_tiff_file_get_type(); \n\tvips_foreign_load_tiff_buffer_get_type(); \n\tvips_foreign_save_tiff_file_get_type(); \n\tvips_foreign_save_tiff_buffer_get_type(); \n#endif /*HAVE_TIFF*/\n\n#ifdef HAVE_OPENSLIDE\n\tvips_foreign_load_openslide_get_type(); \n#endif /*HAVE_OPENSLIDE*/\n\n#ifdef HAVE_MAGICK\n\tvips_foreign_load_magick_file_get_type(); \n\tvips_foreign_load_magick_buffer_get_type(); \n#endif /*HAVE_MAGICK*/\n\n#ifdef HAVE_MAGICK7\n\tvips_foreign_load_magick7_file_get_type(); \n\tvips_foreign_load_magick7_buffer_get_type(); \n#endif /*HAVE_MAGICK7*/\n\n#ifdef HAVE_CFITSIO\n\tvips_foreign_load_fits_get_type(); \n\tvips_foreign_save_fits_get_type(); \n#endif /*HAVE_CFITSIO*/\n\n#ifdef HAVE_OPENEXR\n\tvips_foreign_load_openexr_get_type(); \n#endif /*HAVE_OPENEXR*/\n\n\tvips__foreign_load_operation = \n\t\tg_quark_from_static_string( \"vips-foreign-load-operation\" ); \n}\n", "/* Base type for supported image formats. Subclass this to add a new\n * format.\n */\n\n/*\n\n    This file is part of VIPS.\n    \n    VIPS is free software; you can redistribute it and/or modify\n    it under the terms of the GNU Lesser General Public License as published by\n    the Free Software Foundation; either version 2 of the License, or\n    (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Lesser General Public License for more details.\n\n    You should have received a copy of the GNU Lesser General Public License\n    along with this program; if not, write to the Free Software\n    Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA\n    02110-1301  USA\n\n */\n\n/*\n\n    These files are distributed with VIPS - http://www.vips.ecs.soton.ac.uk\n\n */\n\n#ifndef VIPS_FOREIGN_H\n#define VIPS_FOREIGN_H\n\n#ifdef __cplusplus\nextern \"C\" {\n#endif /*__cplusplus*/\n\n#define VIPS_TYPE_FOREIGN (vips_foreign_get_type())\n#define VIPS_FOREIGN( obj ) \\\n\t(G_TYPE_CHECK_INSTANCE_CAST( (obj), \\\n\tVIPS_TYPE_FOREIGN, VipsForeign ))\n#define VIPS_FOREIGN_CLASS( klass ) \\\n\t(G_TYPE_CHECK_CLASS_CAST( (klass), \\\n\tVIPS_TYPE_FOREIGN, VipsForeignClass))\n#define VIPS_IS_FOREIGN( obj ) \\\n\t(G_TYPE_CHECK_INSTANCE_TYPE( (obj), VIPS_TYPE_FOREIGN ))\n#define VIPS_IS_FOREIGN_CLASS( klass ) \\\n\t(G_TYPE_CHECK_CLASS_TYPE( (klass), VIPS_TYPE_FOREIGN ))\n#define VIPS_FOREIGN_GET_CLASS( obj ) \\\n\t(G_TYPE_INSTANCE_GET_CLASS( (obj), \\\n\tVIPS_TYPE_FOREIGN, VipsForeignClass ))\n\ntypedef struct _VipsForeign {\n\tVipsOperation parent_object;\n\n\t/*< public >*/\n\n} VipsForeign;\n\ntypedef struct _VipsForeignClass {\n\tVipsOperationClass parent_class;\n\n\t/*< public >*/\n\n\t/* Loop over formats in this order, default 0. We need this because\n\t * some formats can be read by several loaders (eg. tiff can be read\n\t * by the libMagick loader as well as by the tiff loader), and we want\n\t * to make sure the better loader comes first.\n\t */\n\tint priority;\n\n\t/* Null-terminated list of recommended suffixes, eg. \".tif\", \".tiff\".\n\t * This can be used by both load and save, so it's in the base class.\n\t */\n\tconst char **suffs;\n\n} VipsForeignClass;\n\n/* Don't put spaces around void here, it breaks gtk-doc.\n */\nGType vips_foreign_get_type(void);\n\n/* Map over and find formats. This uses type introspection to loop over\n * subclasses of VipsForeign.\n */\nvoid *vips_foreign_map( const char *base, \n\tVipsSListMap2Fn fn, void *a, void *b );\n\n/* Image file load properties. \n *\n * Keep in sync with the deprecated VipsFormatFlags, we need to be able to\n * cast between them.\n */\ntypedef enum /*< flags >*/ {\n\tVIPS_FOREIGN_NONE = 0,\t\t/* No flags set */\n\tVIPS_FOREIGN_PARTIAL = 1,\t/* Lazy read OK (eg. tiled tiff) */\n\tVIPS_FOREIGN_BIGENDIAN = 2,\t/* Most-significant byte first */\n\tVIPS_FOREIGN_SEQUENTIAL = 4,\t/* Top-to-bottom lazy read OK */\n\tVIPS_FOREIGN_ALL = 7\t\t/* All flags set */\n} VipsForeignFlags;\n\n#define VIPS_TYPE_FOREIGN_LOAD (vips_foreign_load_get_type())\n#define VIPS_FOREIGN_LOAD( obj ) \\\n\t(G_TYPE_CHECK_INSTANCE_CAST( (obj), \\\n\tVIPS_TYPE_FOREIGN_LOAD, VipsForeignLoad ))\n#define VIPS_FOREIGN_LOAD_CLASS( klass ) \\\n\t(G_TYPE_CHECK_CLASS_CAST( (klass), \\\n\tVIPS_TYPE_FOREIGN_LOAD, VipsForeignLoadClass))\n#define VIPS_IS_FOREIGN_LOAD( obj ) \\\n\t(G_TYPE_CHECK_INSTANCE_TYPE( (obj), VIPS_TYPE_FOREIGN_LOAD ))\n#define VIPS_IS_FOREIGN_LOAD_CLASS( klass ) \\\n\t(G_TYPE_CHECK_CLASS_TYPE( (klass), VIPS_TYPE_FOREIGN_LOAD ))\n#define VIPS_FOREIGN_LOAD_GET_CLASS( obj ) \\\n\t(G_TYPE_INSTANCE_GET_CLASS( (obj), \\\n\tVIPS_TYPE_FOREIGN_LOAD, VipsForeignLoadClass ))\n\ntypedef struct _VipsForeignLoad {\n\tVipsForeign parent_object;\n\t/*< private >*/\n\n\t/* Set TRUE to force open via memory. \n\t */\n\tgboolean memory;\n\n\t/* Type of access upstream wants and the loader must supply. \n\t */\n\tVipsAccess access;\n\n\t/* Flags for this load operation.\n\t */\n\tVipsForeignFlags flags;\n\n\t/* Stop load on first warning.\n\t */\n\tgboolean fail;\n\n\t/* Deprecated and unused, just here for compat.\n\t */\n\tgboolean sequential;\n\n\t/*< public >*/\n\n\t/* The image we generate. This must be set by ->header().\n\t */\n\tVipsImage *out;\n\n\t/* The behind-the-scenes real image we decompress to. This can be a\n\t * disc file or a memory buffer. This must be set by ->load().\n\t */\n\tVipsImage *real;\n\n\t/* Set this to tag the operation as nocache.\n\t */\n\tgboolean nocache;\n\n\t/* Deprecated: the memory option used to be called disc and default\n\t * TRUE.\n\t */\n\tgboolean disc;\n\n\t/* Set if a start function fails. We want to prevent the other starts\n\t * from also triggering the load.\n\t */\n\tgboolean error;\n} VipsForeignLoad;\n\ntypedef struct _VipsForeignLoadClass {\n\tVipsForeignClass parent_class;\n\t/*< public >*/\n\n\t/* Is a file in this format. \n\t *\n\t * This function should return %TRUE if the file contains an image of \n\t * this type. If you don't define this function, #VipsForeignLoad\n\t * will use @suffs instead.\n\t */\n\tgboolean (*is_a)( const char *filename );\n\n\t/* Is a buffer in this format. \n\t *\n\t * This function should return %TRUE if the buffer contains an image of \n\t * this type. \n\t */\n\tgboolean (*is_a_buffer)( const void *data, size_t size );\n\n\t/* Get the flags from a filename. \n\t *\n\t * This function should examine the file and return a set\n\t * of flags. If you don't define it, vips will default to 0 (no flags \n\t * set).  \n\t *\n\t * This operation is necessary for vips7 compatibility. \n\t */\n\tVipsForeignFlags (*get_flags_filename)( const char *filename );\n\n\t/* Get the flags for this load operation. Images can be loaded from \n\t * (for example) memory areas rather than files, so you can't just use\n\t * @get_flags_filename().\n\t */\n\tVipsForeignFlags (*get_flags)( VipsForeignLoad *load );\n\n\t/* Do the minimum read we can. \n\t *\n\t * Set the header fields in @out from @filename. If you can read the \n\t * whole image as well with no performance cost (as with vipsload),\n\t * or if your loader does not support reading only the header, read\n\t * the entire image in this method and leave @load() NULL.\n\t *\n\t * @header() needs to set the dhint on the image .. otherwise you get \n\t * the default SMALLTILE.\n\t *\n\t * Return 0 for success, -1 for error, setting\n\t * vips_error().\n\t */\n\tint (*header)( VipsForeignLoad *load );\n\n\t/* Read the whole image into @real. The pixels will get copied to @out \n\t * later.\n\t *\n\t * You can omit this method if you define a @header() method which \n\t * loads the whole file. \n\t *\n\t * Return 0 for success, -1 for error, setting\n\t * vips_error().\n\t */\n\tint (*load)( VipsForeignLoad *load );\n} VipsForeignLoadClass;\n\n/* Don't put spaces around void here, it breaks gtk-doc.\n */\nGType vips_foreign_load_get_type(void);\n\nconst char *vips_foreign_find_load( const char *filename );\nconst char *vips_foreign_find_load_buffer( const void *data, size_t size );\n\nVipsForeignFlags vips_foreign_flags( const char *loader, const char *filename );\ngboolean vips_foreign_is_a( const char *loader, const char *filename );\ngboolean vips_foreign_is_a_buffer( const char *loader, \n\tconst void *data, size_t size );\n\nvoid vips_foreign_load_invalidate( VipsImage *image );\n\n#define VIPS_TYPE_FOREIGN_SAVE (vips_foreign_save_get_type())\n#define VIPS_FOREIGN_SAVE( obj ) \\\n\t(G_TYPE_CHECK_INSTANCE_CAST( (obj), \\\n\tVIPS_TYPE_FOREIGN_SAVE, VipsForeignSave ))\n#define VIPS_FOREIGN_SAVE_CLASS( klass ) \\\n\t(G_TYPE_CHECK_CLASS_CAST( (klass), \\\n\tVIPS_TYPE_FOREIGN_SAVE, VipsForeignSaveClass))\n#define VIPS_IS_FOREIGN_SAVE( obj ) \\\n\t(G_TYPE_CHECK_INSTANCE_TYPE( (obj), VIPS_TYPE_FOREIGN_SAVE ))\n#define VIPS_IS_FOREIGN_SAVE_CLASS( klass ) \\\n\t(G_TYPE_CHECK_CLASS_TYPE( (klass), VIPS_TYPE_FOREIGN_SAVE ))\n#define VIPS_FOREIGN_SAVE_GET_CLASS( obj ) \\\n\t(G_TYPE_INSTANCE_GET_CLASS( (obj), \\\n\tVIPS_TYPE_FOREIGN_SAVE, VipsForeignSaveClass ))\n\n/** \n * VipsSaveable:\n * @VIPS_SAVEABLE_MONO: 1 band (eg. CSV)\n * @VIPS_SAVEABLE_RGB: 1 or 3 bands (eg. PPM) \n * @VIPS_SAVEABLE_RGBA: 1, 2, 3 or 4 bands (eg. PNG)\n * @VIPS_SAVEABLE_RGBA_ONLY: 3 or 4 bands (eg. WEBP)\n * @VIPS_SAVEABLE_RGB_CMYK: 1, 3 or 4 bands (eg. JPEG)\n * @VIPS_SAVEABLE_ANY: any number of bands (eg. TIFF)\n *\n * See also: #VipsForeignSave.\n */\ntypedef enum {\n\tVIPS_SAVEABLE_MONO,\n\tVIPS_SAVEABLE_RGB,\n\tVIPS_SAVEABLE_RGBA,\n\tVIPS_SAVEABLE_RGBA_ONLY,\n\tVIPS_SAVEABLE_RGB_CMYK,\n\tVIPS_SAVEABLE_ANY,\n\tVIPS_SAVEABLE_LAST\n} VipsSaveable;\n\ntypedef struct _VipsForeignSave {\n\tVipsForeign parent_object;\n\n\t/* Don't attach metadata.\n\t */\n\tgboolean strip;\n\n\t/* If flattening out alpha, the background colour to use. Default to\n\t * 0 (black).\n\t */\n\tVipsArrayDouble *background;\n\n\t/* Set to non-zero to set the page size for multi-page save.\n\t */\n\tint page_height;\n\n\t/*< public >*/\n\n\t/* The image we are to save, as supplied by our caller. \n\t */\n\tVipsImage *in;\n\n\t/* @in converted to a saveable format (eg. 8-bit RGB) according to the\n\t * instructions you give in the class fields below.\n\t *\n\t * This is the image you should actually write to the output.\n\t */\n\tVipsImage *ready;\n\n} VipsForeignSave;\n\ntypedef struct _VipsForeignSaveClass {\n\tVipsForeignClass parent_class;\n\n\t/*< public >*/\n\n\t/* How this format treats bands.\n\t *\n\t * @saveable describes the bands that your saver can handle. For \n\t * example, PPM images can have 1 or 3 bands (mono or RGB), so it \n\t * uses #VIPS_SAVEABLE_RGB.\n\t */\n\tVipsSaveable saveable;\n\n\t/* How this format treats band formats.\n\t *\n\t * @format_table describes the band formats that your saver can \n\t * handle. For each of the 10 #VipsBandFormat values, the array \n\t * should give the format your saver will accept. \n\t */\n\tVipsBandFormat *format_table;\n\n\t/* The set of coding types this format can save. For example, jpeg can\n\t * only save NONE, so has NONE TRUE and RAD and LABQ FALSE.\n\t *\n\t * Default NONE TRUE, RAD and LABQ FALSE.\n\t */\n\tgboolean coding[VIPS_CODING_LAST];\n} VipsForeignSaveClass;\n\n/* Don't put spaces around void here, it breaks gtk-doc.\n */\nGType vips_foreign_save_get_type(void);\n\nconst char *vips_foreign_find_save( const char *filename );\nconst char *vips_foreign_find_save_buffer( const char *suffix );\n\nint vips_vipsload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\nint vips_vipssave( VipsImage *in, const char *filename, ... )\n\t__attribute__((sentinel));\n\nint vips_openslideload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\n\nint vips_jpegload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\nint vips_jpegload_buffer( void *buf, size_t len, VipsImage **out, ... )\n\t__attribute__((sentinel));\n\nint vips_jpegsave( VipsImage *in, const char *filename, ... )\n\t__attribute__((sentinel));\nint vips_jpegsave_buffer( VipsImage *in, void **buf, size_t *len, ... )\n\t__attribute__((sentinel));\nint vips_jpegsave_mime( VipsImage *in, ... )\n\t__attribute__((sentinel));\n\n/**\n * VipsForeignWebpPreset:\n * @VIPS_FOREIGN_WEBP_PRESET_DEFAULT: default preset\n * @VIPS_FOREIGN_WEBP_PRESET_PICTURE: digital picture, like portrait, inner shot\n * @VIPS_FOREIGN_WEBP_PRESET_PHOTO: outdoor photograph, with natural lighting\n * @VIPS_FOREIGN_WEBP_PRESET_DRAWING: hand or line drawing, with high-contrast details\n * @VIPS_FOREIGN_WEBP_PRESET_ICON: small-sized colorful images\n * @VIPS_FOREIGN_WEBP_PRESET_TEXT: text-like\n *\n * Tune lossy encoder settings for different image types.\n */\ntypedef enum {\n\tVIPS_FOREIGN_WEBP_PRESET_DEFAULT,\n\tVIPS_FOREIGN_WEBP_PRESET_PICTURE,\n\tVIPS_FOREIGN_WEBP_PRESET_PHOTO,\n\tVIPS_FOREIGN_WEBP_PRESET_DRAWING,\n\tVIPS_FOREIGN_WEBP_PRESET_ICON,\n\tVIPS_FOREIGN_WEBP_PRESET_TEXT,\n\tVIPS_FOREIGN_WEBP_PRESET_LAST\n} VipsForeignWebpPreset;\n\nint vips_webpload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\nint vips_webpload_buffer( void *buf, size_t len, VipsImage **out, ... )\n\t__attribute__((sentinel));\n\nint vips_webpsave( VipsImage *in, const char *filename, ... )\n\t__attribute__((sentinel));\nint vips_webpsave_buffer( VipsImage *in, void **buf, size_t *len, ... )\n\t__attribute__((sentinel));\nint vips_webpsave_mime( VipsImage *in, ... )\n\t__attribute__((sentinel));\n\n/**\n * VipsForeignTiffCompression:\n * @VIPS_FOREIGN_TIFF_COMPRESSION_NONE: no compression\n * @VIPS_FOREIGN_TIFF_COMPRESSION_JPEG: jpeg compression\n * @VIPS_FOREIGN_TIFF_COMPRESSION_DEFLATE: deflate (zip) compression\n * @VIPS_FOREIGN_TIFF_COMPRESSION_PACKBITS: packbits compression\n * @VIPS_FOREIGN_TIFF_COMPRESSION_CCITTFAX4: fax4 compression\n * @VIPS_FOREIGN_TIFF_COMPRESSION_LZW: LZW compression\n *\n * The compression types supported by the tiff writer.\n *\n * Use @Q to set the jpeg compression level, default 75.\n *\n * Use @prediction to set the lzw or deflate prediction, default none.\n */\ntypedef enum {\n\tVIPS_FOREIGN_TIFF_COMPRESSION_NONE,\n\tVIPS_FOREIGN_TIFF_COMPRESSION_JPEG,\n\tVIPS_FOREIGN_TIFF_COMPRESSION_DEFLATE,\n\tVIPS_FOREIGN_TIFF_COMPRESSION_PACKBITS,\n\tVIPS_FOREIGN_TIFF_COMPRESSION_CCITTFAX4,\n\tVIPS_FOREIGN_TIFF_COMPRESSION_LZW,\n\tVIPS_FOREIGN_TIFF_COMPRESSION_LAST\n} VipsForeignTiffCompression;\n\n/**\n * VipsForeignTiffPredictor:\n * @VIPS_FOREIGN_TIFF_PREDICTOR_NONE: no prediction\n * @VIPS_FOREIGN_TIFF_PREDICTOR_HORIZONTAL: horizontal differencing\n * @VIPS_FOREIGN_TIFF_PREDICTOR_FLOAT: float predictor\n *\n * The predictor can help deflate and lzw compression. The values are fixed by\n * the tiff library.\n */\ntypedef enum {\n\tVIPS_FOREIGN_TIFF_PREDICTOR_NONE = 1,\n\tVIPS_FOREIGN_TIFF_PREDICTOR_HORIZONTAL = 2,\n\tVIPS_FOREIGN_TIFF_PREDICTOR_FLOAT = 3,\n\tVIPS_FOREIGN_TIFF_PREDICTOR_LAST\n} VipsForeignTiffPredictor;\n\n/**\n * VipsForeignTiffResunit:\n * @VIPS_FOREIGN_TIFF_RESUNIT_CM: use centimeters\n * @VIPS_FOREIGN_TIFF_RESUNIT_INCH: use inches\n *\n * Use inches or centimeters as the resolution unit for a tiff file.\n */\ntypedef enum {\n\tVIPS_FOREIGN_TIFF_RESUNIT_CM,\n\tVIPS_FOREIGN_TIFF_RESUNIT_INCH,\n\tVIPS_FOREIGN_TIFF_RESUNIT_LAST\n} VipsForeignTiffResunit;\n\nint vips_tiffload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\nint vips_tiffload_buffer( void *buf, size_t len, VipsImage **out, ... )\n\t__attribute__((sentinel));\nint vips_tiffsave( VipsImage *in, const char *filename, ... )\n\t__attribute__((sentinel));\nint vips_tiffsave_buffer( VipsImage *in, void **buf, size_t *len, ... )\n\t__attribute__((sentinel));\n\nint vips_openexrload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\n\nint vips_fitsload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\nint vips_fitssave( VipsImage *in, const char *filename, ... )\n\t__attribute__((sentinel));\n\nint vips_analyzeload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\n\nint vips_rawload( const char *filename, VipsImage **out, \n\tint width, int height, int bands, ... )\n\t__attribute__((sentinel));\nint vips_rawsave( VipsImage *in, const char *filename, ... )\n\t__attribute__((sentinel));\nint vips_rawsave_fd( VipsImage *in, int fd, ... )\n\t__attribute__((sentinel));\n\nint vips_csvload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\nint vips_csvsave( VipsImage *in, const char *filename, ... )\n\t__attribute__((sentinel));\n\nint vips_matrixload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\nint vips_matrixsave( VipsImage *in, const char *filename, ... )\n\t__attribute__((sentinel));\nint vips_matrixprint( VipsImage *in, ... )\n\t__attribute__((sentinel));\n\nint vips_magickload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\nint vips_magickload_buffer( void *buf, size_t len, VipsImage **out, ... )\n\t__attribute__((sentinel));\n\n/**\n * VipsForeignPngFilter:\n * @VIPS_FOREIGN_PNG_FILTER_NONE: no filtering\n * @VIPS_FOREIGN_PNG_FILTER_SUB: difference to the left\n * @VIPS_FOREIGN_PNG_FILTER_UP: difference up\n * @VIPS_FOREIGN_PNG_FILTER_AVG: average of left and up\n * @VIPS_FOREIGN_PNG_FILTER_PAETH: pick best neighbor predictor automatically\n * @VIPS_FOREIGN_PNG_FILTER_ALL: adaptive\n *\n * http://www.w3.org/TR/PNG-Filters.html\n * The values mirror those of png.h in libpng.\n */\ntypedef enum /*< flags >*/ {\n\tVIPS_FOREIGN_PNG_FILTER_NONE = 0x08,\n\tVIPS_FOREIGN_PNG_FILTER_SUB = 0x10,\n\tVIPS_FOREIGN_PNG_FILTER_UP = 0x20,\n\tVIPS_FOREIGN_PNG_FILTER_AVG = 0x40,\n\tVIPS_FOREIGN_PNG_FILTER_PAETH = 0x80,\n\tVIPS_FOREIGN_PNG_FILTER_ALL = 0xEA\n} VipsForeignPngFilter;\n\nint vips_pngload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\nint vips_pngload_buffer( void *buf, size_t len, VipsImage **out, ... )\n\t__attribute__((sentinel));\nint vips_pngsave( VipsImage *in, const char *filename, ... )\n\t__attribute__((sentinel));\nint vips_pngsave_buffer( VipsImage *in, void **buf, size_t *len, ... )\n\t__attribute__((sentinel));\n\nint vips_ppmload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\nint vips_ppmsave( VipsImage *in, const char *filename, ... )\n\t__attribute__((sentinel));\n\nint vips_matload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\n\nint vips_radload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\nint vips_radsave( VipsImage *in, const char *filename, ... )\n\t__attribute__((sentinel));\nint vips_radsave_buffer( VipsImage *in, void **buf, size_t *len, ... )\n\t__attribute__((sentinel));\n\nint vips_pdfload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\nint vips_pdfload_buffer( void *buf, size_t len, VipsImage **out, ... )\n\t__attribute__((sentinel));\n\nint vips_svgload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\nint vips_svgload_buffer( void *buf, size_t len, VipsImage **out, ... )\n\t__attribute__((sentinel));\n\nint vips_gifload( const char *filename, VipsImage **out, ... )\n\t__attribute__((sentinel));\nint vips_gifload_buffer( void *buf, size_t len, VipsImage **out, ... )\n\t__attribute__((sentinel));\n\n/**\n * VipsForeignDzLayout:\n * @VIPS_FOREIGN_DZ_LAYOUT_DZ: use DeepZoom directory layout\n * @VIPS_FOREIGN_DZ_LAYOUT_ZOOMIFY: use Zoomify directory layout\n * @VIPS_FOREIGN_DZ_LAYOUT_GOOGLE: use Google maps directory layout\n *\n * What directory layout and metadata standard to use. \n */\ntypedef enum {\n\tVIPS_FOREIGN_DZ_LAYOUT_DZ,\n\tVIPS_FOREIGN_DZ_LAYOUT_ZOOMIFY,\n\tVIPS_FOREIGN_DZ_LAYOUT_GOOGLE,\n\tVIPS_FOREIGN_DZ_LAYOUT_LAST\n} VipsForeignDzLayout;\n\n/**\n * VipsForeignDzDepth:\n * @VIPS_FOREIGN_DZ_DEPTH_ONEPIXEL: create layers down to 1x1 pixel\n * @VIPS_FOREIGN_DZ_DEPTH_ONETILE: create layers down to 1x1 tile\n * @VIPS_FOREIGN_DZ_DEPTH_ONE: only create a single layer\n *\n * How many pyramid layers to create.\n */\ntypedef enum {\n\tVIPS_FOREIGN_DZ_DEPTH_ONEPIXEL,\n\tVIPS_FOREIGN_DZ_DEPTH_ONETILE,\n\tVIPS_FOREIGN_DZ_DEPTH_ONE,\n\tVIPS_FOREIGN_DZ_DEPTH_LAST\n} VipsForeignDzDepth;\n\n/**\n * VipsForeignDzContainer:\n * @VIPS_FOREIGN_DZ_CONTAINER_FS: write tiles to the filesystem\n * @VIPS_FOREIGN_DZ_CONTAINER_ZIP: write tiles to a zip file\n *\n * How many pyramid layers to create.\n */\ntypedef enum {\n\tVIPS_FOREIGN_DZ_CONTAINER_FS,\n\tVIPS_FOREIGN_DZ_CONTAINER_ZIP,\n\tVIPS_FOREIGN_DZ_CONTAINER_LAST\n} VipsForeignDzContainer;\n\nint vips_dzsave( VipsImage *in, const char *name, ... )\n\t__attribute__((sentinel));\n\n#ifdef __cplusplus\n}\n#endif /*__cplusplus*/\n\n#endif /*VIPS_FOREIGN_H*/\n"], "filenames": ["ChangeLog", "libvips/foreign/foreign.c", "libvips/include/vips/foreign.h"], "buggy_code_start_loc": [6, 20, 160], "buggy_code_end_loc": [6, 834, 160], "fixing_code_start_loc": [7, 21, 161], "fixing_code_end_loc": [8, 848, 166], "type": "CWE-362", "message": "In libvips before 8.6.3, a NULL function pointer dereference vulnerability was found in the vips_region_generate function in region.c, which allows remote attackers to cause a denial of service or possibly have unspecified other impact via a crafted image file. This occurs because of a race condition involving a failed delayed load and other worker threads.", "other": {"cve": {"id": "CVE-2018-7998", "sourceIdentifier": "cve@mitre.org", "published": "2018-03-09T19:29:01.070", "lastModified": "2018-03-27T16:34:41.717", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "In libvips before 8.6.3, a NULL function pointer dereference vulnerability was found in the vips_region_generate function in region.c, which allows remote attackers to cause a denial of service or possibly have unspecified other impact via a crafted image file. This occurs because of a race condition involving a failed delayed load and other worker threads."}, {"lang": "es", "value": "En libvips, en versiones anteriores a la 8.6.3, se ha encontrado una vulnerabilidad de desreferencia de puntero de funci\u00f3n NULL en la funci\u00f3n rvips_region_generate en region.c. Esto permite que atacantes remotos provoquen una denegaci\u00f3n de servicio (DoS) u otro tipo de impacto sin especificar mediante un archivo de imagen manipulado. Esto ocurre debido a una condici\u00f3n de carrera relacionada con una carga aplazada fallida y otros subprocesos de trabajo."}], "metrics": {"cvssMetricV30": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:H/PR:N/UI:R/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "HIGH", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 7.5, "baseSeverity": "HIGH"}, "exploitabilityScore": 1.6, "impactScore": 5.9}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:H/Au:N/C:P/I:P/A:P", "accessVector": "NETWORK", "accessComplexity": "HIGH", "authentication": "NONE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 5.1}, "baseSeverity": "MEDIUM", "exploitabilityScore": 4.9, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-362"}, {"lang": "en", "value": "CWE-476"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:libvips_project:libvips:*:*:*:*:*:*:*:*", "versionEndExcluding": "8.6.3", "matchCriteriaId": "B58A0298-8C5D-4550-84BF-22AA1A9107DC"}]}]}, {"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:o:debian:debian_linux:7.0:*:*:*:*:*:*:*", "matchCriteriaId": "16F59A04-14CF-49E2-9973-645477EA09DA"}]}]}], "references": [{"url": "https://github.com/jcupitt/libvips/commit/20d840e6da15c1574b3ed998bc92f91d1e36c2a5", "source": "cve@mitre.org", "tags": ["Patch"]}, {"url": "https://github.com/jcupitt/libvips/issues/893", "source": "cve@mitre.org", "tags": ["Exploit", "Third Party Advisory"]}, {"url": "https://lists.debian.org/debian-lts-announce/2018/03/msg00009.html", "source": "cve@mitre.org", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/jcupitt/libvips/commit/20d840e6da15c1574b3ed998bc92f91d1e36c2a5"}}