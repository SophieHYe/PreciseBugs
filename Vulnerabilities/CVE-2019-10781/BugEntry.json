{"buggy_code": ["/*\n * This module is intended to be executed both on client side and server side.\n * No error should be thrown. (soft error handling)\n */\n\n(function () {\n\tvar root = {};\n\t// Dependencies --------------------------------------------------------------\n\troot.async = (typeof require === 'function') ? require('async') : window.async;\n\tif (typeof root.async !== 'object') {\n\t\tthrow new Error('Module async is required (https://github.com/caolan/async)');\n\t}\n\tvar async = root.async;\n\n\tfunction _extend(origin, add) {\n\t\tif (!add || typeof add !== 'object') {\n\t\t\treturn origin;\n\t\t}\n\t\tvar keys = Object.keys(add);\n\t\tvar i = keys.length;\n\t\twhile (i--) {\n\t\t\torigin[keys[i]] = add[keys[i]];\n\t\t}\n\t\treturn origin;\n\t}\n\n\tfunction _merge() {\n\t\tvar ret = {};\n\t\tvar args = Array.prototype.slice.call(arguments);\n\t\tvar keys = null;\n\t\tvar i = null;\n\n\t\targs.forEach(function (arg) {\n\t\t\tif (arg && arg.constructor === Object) {\n\t\t\t\tkeys = Object.keys(arg);\n\t\t\t\ti = keys.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\tret[keys[i]] = arg[keys[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn ret;\n\t}\n\n\t// Customisable class (Base class) -------------------------------------------\n\t// Use with operation \"new\" to extend Validation and Sanitization themselves,\n\t// not their prototype. In other words, constructor shall be call to extend\n\t// those functions, instead of being in their constructor, like this:\n\t//\t\t_extend(Validation, new Customisable);\n\n\tfunction Customisable() {\n\t\tthis.custom = {};\n\n\t\tthis.extend = function (custom) {\n\t\t\treturn _extend(this.custom, custom);\n\t\t};\n\n\t\tthis.reset = function () {\n\t\t\tthis.custom = {};\n\t\t};\n\n\t\tthis.remove = function (fields) {\n\t\t\tif (!_typeIs.array(fields)) {\n\t\t\t\tfields = [fields];\n\t\t\t}\n\t\t\tfields.forEach(function (field) {\n\t\t\t\tdelete this.custom[field];\n\t\t\t}, this);\n\t\t};\n\t}\n\n\t// Inspection class (Base class) ---------------------------------------------\n\t// Use to extend Validation and Sanitization prototypes. Inspection\n\t// constructor shall be called in derived class constructor.\n\n\tfunction Inspection(schema, custom) {\n\t\tvar _stack = ['@'];\n\n\t\tthis._schema = schema;\n\t\tthis._custom = {};\n\t\tif (custom != null) {\n\t\t\tfor (var key in custom) {\n\t\t\t\tif (custom.hasOwnProperty(key)){\n\t\t\t\t\tthis._custom['$' + key] = custom[key];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis._getDepth = function () {\n\t\t\treturn _stack.length;\n\t\t};\n\n\t\tthis._dumpStack = function () {\n\t\t\treturn _stack.map(function (i) {return i.replace(/^\\[/g, '\\u001b\\u001c\\u001d\\u001e');})\n\t\t\t.join('.').replace(/\\.\\u001b\\u001c\\u001d\\u001e/g, '[');\n\t\t};\n\n\t\tthis._deeperObject = function (name) {\n\t\t\t_stack.push((/^[a-z$_][a-z0-9$_]*$/i).test(name) ? name : '[\"' + name + '\"]');\n\t\t\treturn this;\n\t\t};\n\n\t\tthis._deeperArray = function (i) {\n\t\t\t_stack.push('[' + i + ']');\n\t\t\treturn this;\n\t\t};\n\n\t\tthis._back = function () {\n\t\t\t_stack.pop();\n\t\t\treturn this;\n\t\t};\n\t}\n\t// Simple types --------------------------------------------------------------\n\t// If the property is not defined or is not in this list:\n\tvar _typeIs = {\n\t\t\"function\": function (element) {\n\t\t\treturn typeof element === 'function';\n\t\t},\n\t\t\"string\": function (element) {\n\t\t\treturn typeof element === 'string';\n\t\t},\n\t\t\"number\": function (element) {\n\t\t\treturn typeof element === 'number' && !isNaN(element);\n\t\t},\n\t\t\"integer\": function (element) {\n\t\t\treturn typeof element === 'number' && element % 1 === 0;\n\t\t},\n\t\t\"NaN\": function (element) {\n\t\t\treturn typeof element === 'number' && isNaN(element);\n\t\t},\n\t\t\"boolean\": function (element) {\n\t\t\treturn typeof element === 'boolean';\n\t\t},\n\t\t\"null\": function (element) {\n\t\t\treturn element === null;\n\t\t},\n\t\t\"date\": function (element) {\n\t\t\treturn element != null && element instanceof Date;\n\t\t},\n\t\t\"object\": function (element) {\n\t\t\treturn element != null && element.constructor === Object;\n\t\t},\n\t\t\"array\": function (element) {\n\t\t\treturn element != null && element.constructor === Array;\n\t\t},\n\t\t\"any\": function (element) {\n\t\t\treturn true;\n\t\t}\n\t};\n\n\tfunction _simpleType(type, candidate) {\n\t\tif (typeof type == 'function') {\n\t\t\treturn candidate instanceof type;\n\t\t}\n\t\ttype = type in _typeIs ? type : 'any';\n\t\treturn _typeIs[type](candidate);\n\t}\n\n\tfunction _realType(candidate) {\n\t\tfor (var i in _typeIs) {\n\t\t\tif (_simpleType(i, candidate)) {\n\t\t\t\tif (i !== 'any') { return i; }\n\t\t\t\treturn 'an instance of ' + candidate.constructor.name;\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction getIndexes(a, value) {\n\t\tvar indexes = [];\n\t\tvar i = a.indexOf(value);\n\n\t\twhile (i !== -1) {\n\t\t\tindexes.push(i);\n\t\t\ti = a.indexOf(value, i + 1);\n\t\t}\n\t\treturn indexes;\n\t}\n\n\t// Available formats ---------------------------------------------------------\n\tvar _formats = {\n\t\t'void': /^$/,\n\t\t'url': /^(https?|ftp):\\/\\/(((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:)*@)?(((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5]))|((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)?(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.?)(:\\d*)?)(\\/((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)+(\\/(([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)*)*)?)?(\\?((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)|[\\uE000-\\uF8FF]|\\/|\\?)*)?(\\#((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)|\\/|\\?)*)?$/i,\n\t\t'date-time': /^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d{3})?(Z?|(-|\\+)\\d{2}:\\d{2})$/,\n\t\t'date': /^\\d{4}-\\d{2}-\\d{2}$/,\n\t\t'coolDateTime': /^\\d{4}(-|\\/)\\d{2}(-|\\/)\\d{2}(T| )\\d{2}:\\d{2}:\\d{2}(\\.\\d{3})?Z?$/,\n\t\t'time': /^\\d{2}\\:\\d{2}\\:\\d{2}$/,\n\t\t'color': /^#([0-9a-f])+$/i,\n\t\t'email': /^((([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+(\\.([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+)*)|((\\x22)((((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(([\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x7f]|\\x21|[\\x23-\\x5b]|[\\x5d-\\x7e]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(\\\\([\\x01-\\x09\\x0b\\x0c\\x0d-\\x7f]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]))))*(((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(\\x22)))@((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)+(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.?$/i,\n\t\t'numeric': /^[0-9]+$/,\n\t\t'integer': /^\\-?[0-9]+$/,\n\t\t'decimal': /^\\-?[0-9]*\\.?[0-9]+$/,\n\t\t'alpha': /^[a-z]+$/i,\n\t\t'alphaNumeric': /^[a-z0-9]+$/i,\n\t\t'alphaDash': /^[a-z0-9_-]+$/i,\n\t\t'javascript': /^[a-z_\\$][a-z0-9_\\$]*$/i,\n\t\t'upperString': /^[A-Z ]*$/,\n\t\t'lowerString': /^[a-z ]*$/\n\t};\n\n// Validation ------------------------------------------------------------------\n\tvar _validationAttribut = {\n\t\toptional: function (schema, candidate) {\n\t\t\tvar opt = typeof schema.optional === 'boolean' ? schema.optional : (schema.optional === 'true'); // Default is false\n\n\t\t\tif (opt === true) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (typeof candidate === 'undefined') {\n\t\t\t\tthis.report('is missing and not optional', null, 'optional');\n\t\t\t}\n\t\t},\n\t\ttype: function (schema, candidate) {\n\t\t\t// return because optional function already handle this case\n\t\t\tif (typeof candidate === 'undefined' || (typeof schema.type !== 'string' && !(schema.type instanceof Array) && typeof schema.type !== 'function')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar types = _typeIs.array(schema.type) ? schema.type : [schema.type];\n\t\t\tvar typeIsValid = types.some(function (type) {\n\t\t\t\treturn _simpleType(type, candidate);\n\t\t\t});\n\t\t\tif (!typeIsValid) {\n\t\t\t\ttypes = types.map(function (t) {return typeof t === 'function' ? 'and instance of ' + t.name : t; });\n\t\t\t\tthis.report('must be ' + types.join(' or ') + ', but is ' + _realType(candidate), null, 'type');\n\t\t\t}\n\t\t},\n\t\tuniqueness: function (schema, candidate) {\n\t\t\tif (typeof schema.uniqueness === 'string') { schema.uniqueness = (schema.uniqueness === 'true'); }\n\t\t\tif (typeof schema.uniqueness !== 'boolean' || schema.uniqueness === false || (!_typeIs.array(candidate) && typeof candidate !== 'string')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar reported = [];\n\t\t\tfor (var i = 0; i < candidate.length; i++) {\n\t\t\t\tif (reported.indexOf(candidate[i]) >= 0) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tvar indexes = getIndexes(candidate, candidate[i]);\n\t\t\t\tif (indexes.length > 1) {\n\t\t\t\t\treported.push(candidate[i]);\n\t\t\t\t\tthis.report('has value [' + candidate[i] + '] more than once at indexes [' + indexes.join(', ') + ']', null, 'uniqueness');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tpattern: function (schema, candidate) {\n\t\t\tvar self = this;\n\t\t\tvar regexs = schema.pattern;\n\t\t\tif (typeof candidate !== 'string') {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar matches = false;\n\t\t\tif (!_typeIs.array(regexs)) {\n\t\t\t\tregexs = [regexs];\n\t\t\t}\n\t\t\tregexs.forEach(function (regex) {\n\t\t\t\tif (typeof regex === 'string' && regex in _formats) {\n\t\t\t\t\tregex = _formats[regex];\n\t\t\t\t}\n\t\t\t\tif (regex instanceof RegExp) {\n\t\t\t\t\tif (regex.test(candidate)) {\n\t\t\t\t\t\tmatches = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (!matches) {\n\t\t\t\tself.report('must match [' + regexs.join(' or ') + '], but is equal to \"' + candidate + '\"', null, 'pattern');\n\t\t\t}\n\t\t},\n\t\tvalidDate: function (schema, candidate) {\n\t\t\tif (String(schema.validDate) === 'true' && candidate instanceof Date && isNaN(candidate.getTime())) {\n\t\t\t\tthis.report('must be a valid date', null, 'validDate');\n\t\t\t}\n\t\t},\n\t\tminLength: function (schema, candidate) {\n\t\t\tif (typeof candidate !== 'string' && !_typeIs.array(candidate)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar minLength = Number(schema.minLength);\n\t\t\tif (isNaN(minLength)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (candidate.length < minLength) {\n\t\t\t\tthis.report('must be longer than ' + minLength + ' elements, but it has ' + candidate.length, null, 'minLength');\n\t\t\t}\n\t\t},\n\t\tmaxLength: function (schema, candidate) {\n\t\t\tif (typeof candidate !== 'string' && !_typeIs.array(candidate)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar maxLength = Number(schema.maxLength);\n\t\t\tif (isNaN(maxLength)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (candidate.length > maxLength) {\n\t\t\t\tthis.report('must be shorter than ' + maxLength + ' elements, but it has ' + candidate.length, null, 'maxLength');\n\t\t\t}\n\t\t},\n\t\texactLength: function (schema, candidate) {\n\t\t\tif (typeof candidate !== 'string' && !_typeIs.array(candidate)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar exactLength = Number(schema.exactLength);\n\t\t\tif (isNaN(exactLength)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (candidate.length !== exactLength) {\n\t\t\t\tthis.report('must have exactly ' + exactLength + ' elements, but it have ' + candidate.length, null, 'exactLength');\n\t\t\t}\n\t\t},\n\t\tlt: function (schema, candidate) {\n\t\t\tvar limit = Number(schema.lt);\n\t\t\tif (typeof candidate !== 'number' || isNaN(limit)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (candidate >= limit) {\n\t\t\t\tthis.report('must be less than ' + limit + ', but is equal to \"' + candidate + '\"', null, 'lt');\n\t\t\t}\n\t\t},\n\t\tlte: function (schema, candidate) {\n\t\t\tvar limit = Number(schema.lte);\n\t\t\tif (typeof candidate !== 'number' || isNaN(limit)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (candidate > limit) {\n\t\t\t\tthis.report('must be less than or equal to ' + limit + ', but is equal to \"' + candidate + '\"', null, 'lte');\n\t\t\t}\n\t\t},\n\t\tgt: function (schema, candidate) {\n\t\t\tvar limit = Number(schema.gt);\n\t\t\tif (typeof candidate !== 'number' || isNaN(limit)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (candidate <= limit) {\n\t\t\t\tthis.report('must be greater than ' + limit + ', but is equal to \"' + candidate + '\"', null, 'gt');\n\t\t\t}\n\t\t},\n\t\tgte: function (schema, candidate) {\n\t\t\tvar limit = Number(schema.gte);\n\t\t\tif (typeof candidate !== 'number' || isNaN(limit)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (candidate < limit) {\n\t\t\t\tthis.report('must be greater than or equal to ' + limit + ', but is equal to \"' + candidate + '\"', null, 'gte');\n\t\t\t}\n\t\t},\n\t\teq: function (schema, candidate) {\n\t\t\tif (typeof candidate !== 'number' && typeof candidate !== 'string' && typeof candidate !== 'boolean') {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar limit = schema.eq;\n\t\t\tif (typeof limit !== 'number' && typeof limit !== 'string' && typeof limit !== 'boolean' && !_typeIs.array(limit)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (_typeIs.array(limit)) {\n\t\t\t\tfor (var i = 0; i < limit.length; i++) {\n\t\t\t\t\tif (candidate === limit[i]) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.report('must be equal to [' + limit.map(function (l) {\n\t\t\t\t\treturn '\"' + l + '\"';\n\t\t\t\t}).join(' or ') + '], but is equal to \"' + candidate + '\"', null, 'eq');\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (candidate !== limit) {\n\t\t\t\t\tthis.report('must be equal to \"' + limit + '\", but is equal to \"' + candidate + '\"', null, 'eq');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tne: function (schema, candidate) {\n\t\t\tif (typeof candidate !== 'number' && typeof candidate !== 'string') {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar limit = schema.ne;\n\t\t\tif (typeof limit !== 'number' && typeof limit !== 'string' && !_typeIs.array(limit)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (_typeIs.array(limit)) {\n\t\t\t\tfor (var i = 0; i < limit.length; i++) {\n\t\t\t\t\tif (candidate === limit[i]) {\n\t\t\t\t\t\tthis.report('must not be equal to \"' + limit[i] + '\"', null, 'ne');\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (candidate === limit) {\n\t\t\t\t\tthis.report('must not be equal to \"' + limit + '\"', null, 'ne');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tsomeKeys: function (schema, candidat) {\n\t\t\tvar _keys = schema.someKeys;\n\t\t\tif (!_typeIs.object(candidat)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar valid = _keys.some(function (action) {\n\t\t\t\treturn (action in candidat);\n\t\t\t});\n\t\t\tif (!valid) {\n\t\t\t\tthis.report('must have at least key ' + _keys.map(function (i) {\n\t\t\t\t\treturn '\"' + i + '\"';\n\t\t\t\t}).join(' or '), null, 'someKeys');\n\t\t\t}\n\t\t},\n\t\tstrict: function (schema, candidate) {\n\t\t\tif (typeof schema.strict === 'string') { schema.strict = (schema.strict === 'true'); }\n\t\t\tif (schema.strict !== true || !_typeIs.object(candidate) || !_typeIs.object(schema.properties)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar self = this;\n\t\t\tif (typeof schema.properties['*'] === 'undefined') {\n\t\t\t\tvar intruder = Object.keys(candidate).filter(function (key) {\n\t\t\t\t\treturn (typeof schema.properties[key] === 'undefined');\n\t\t\t\t});\n\t\t\t\tif (intruder.length > 0) {\n\t\t\t\t\tvar msg = 'should not contains ' + (intruder.length > 1 ? 'properties' : 'property') +\n\t\t\t\t\t\t' [' + intruder.map(function (i) { return '\"' + i + '\"'; }).join(', ') + ']';\n\t\t\t\t\tself.report(msg, null, 'strict');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\texec: function (schema, candidate, callback) {\n\t\t\tvar self = this;\n\n\t\t\tif (typeof callback === 'function') {\n\t\t\t\treturn this.asyncExec(schema, candidate, callback);\n\t\t\t}\n\t\t\t(_typeIs.array(schema.exec) ? schema.exec : [schema.exec]).forEach(function (exec) {\n\t\t\t\tif (typeof exec === 'function') {\n\t\t\t\t\texec.call(self, schema, candidate);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tproperties: function (schema, candidate, callback) {\n\t\t\tif (typeof callback === 'function') {\n\t\t\t\treturn this.asyncProperties(schema, candidate, callback);\n\t\t\t}\n\t\t\tif (!(schema.properties instanceof Object) || !(candidate instanceof Object)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar properties = schema.properties,\n\t\t\t\t\ti;\n\t\t\tif (properties['*'] != null) {\n\t\t\t\tfor (i in candidate) {\n\t\t\t\t\tif (i in properties) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tthis._deeperObject(i);\n\t\t\t\t\tthis._validate(properties['*'], candidate[i]);\n\t\t\t\t\tthis._back();\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (i in properties) {\n\t\t\t\tif (i === '*') {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tthis._deeperObject(i);\n\t\t\t\tthis._validate(properties[i], candidate[i]);\n\t\t\t\tthis._back();\n\t\t\t}\n\t\t},\n\t\titems: function (schema, candidate, callback) {\n\t\t\tif (typeof callback === 'function') {\n\t\t\t\treturn this.asyncItems(schema, candidate, callback);\n\t\t\t}\n\t\t\tif (!(schema.items instanceof Object) || !(candidate instanceof Object)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar items = schema.items;\n\t\t\tvar i, l;\n\t\t\t// If provided schema is an array\n\t\t\t// then call validate for each case\n\t\t\t// else it is an Object\n\t\t\t// then call validate for each key\n\t\t\tif (_typeIs.array(items) && _typeIs.array(candidate)) {\n\t\t\t\tfor (i = 0, l = items.length; i < l; i++) {\n\t\t\t\t\tthis._deeperArray(i);\n\t\t\t\t\tthis._validate(items[i], candidate[i]);\n\t\t\t\t\tthis._back();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfor (var key in candidate) {\n\t\t\t\t\tif (candidate.hasOwnProperty(key)){\n\t\t\t\t\t\tthis._deeperArray(key);\n\t\t\t\t\t\tthis._validate(items, candidate[key]);\n\t\t\t\t\t\tthis._back();\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tvar _asyncValidationAttribut = {\n\t\tasyncExec: function (schema, candidate, callback) {\n\t\t\tvar self = this;\n\t\t\tasync.eachSeries(_typeIs.array(schema.exec) ? schema.exec : [schema.exec], function (exec, done) {\n\t\t\t\tif (typeof exec === 'function') {\n\t\t\t\t\tif (exec.length > 2) {\n\t\t\t\t\t\treturn exec.call(self, schema, candidate, done);\n\t\t\t\t\t}\n\t\t\t\t\texec.call(self, schema, candidate);\n\t\t\t\t}\n\t\t\t\tasync.nextTick(done);\n\t\t\t}, callback);\n\t\t},\n\t\tasyncProperties: function (schema, candidate, callback) {\n\t\t\tif (!(schema.properties instanceof Object) || !_typeIs.object(candidate)) {\n\t\t\t\treturn callback();\n\t\t\t}\n\t\t\tvar self = this;\n\t\t\tvar properties = schema.properties;\n\t\t\tasync.series([\n\t\t\t\tfunction (next) {\n\t\t\t\t\tif (properties['*'] == null) {\n\t\t\t\t\t\treturn next();\n\t\t\t\t\t}\n\t\t\t\t\tasync.eachSeries(Object.keys(candidate), function (i, done) {\n\t\t\t\t\t\tif (i in properties) {\n\t\t\t\t\t\t\treturn async.nextTick(done);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tself._deeperObject(i);\n\t\t\t\t\t\tself._asyncValidate(properties['*'], candidate[i], function (err) {\n\t\t\t\t\t\t\tself._back();\n\t\t\t\t\t\t\tdone(err);\n\t\t\t\t\t\t});\n\t\t\t\t\t}, next);\n\t\t\t\t},\n\t\t\t\tfunction (next) {\n\t\t\t\t\tasync.eachSeries(Object.keys(properties), function (i, done) {\n\t\t\t\t\t\tif (i === '*') {\n\t\t\t\t\t\t\treturn async.nextTick(done);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tself._deeperObject(i);\n\t\t\t\t\t\tself._asyncValidate(properties[i], candidate[i], function (err) {\n\t\t\t\t\t\t\tself._back();\n\t\t\t\t\t\t\tdone(err);\n\t\t\t\t\t\t});\n\t\t\t\t\t}, next);\n\t\t\t\t}\n\t\t\t], callback);\n\t\t},\n\t\tasyncItems: function (schema, candidate, callback) {\n\t\t\tif (!(schema.items instanceof Object) || !(candidate instanceof Object)) {\n\t\t\t\treturn callback();\n\t\t\t}\n\t\t\tvar self = this;\n\t\t\tvar items = schema.items;\n\t\t\tvar i, l;\n\n\t\t\tif (_typeIs.array(items) && _typeIs.array(candidate)) {\n\t\t\t\tasync.timesSeries(items.length, function (i, done) {\n\t\t\t\t\tself._deeperArray(i);\n\t\t\t\t\tself._asyncValidate(items[i], candidate[i], function (err, res) {\n\t\t\t\t\t\tself._back();\n\t\t\t\t\t\tdone(err, res);\n\t\t\t\t\t});\n\t\t\t\t\tself._back();\n\t\t\t\t}, callback);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tasync.eachSeries(Object.keys(candidate), function (key, done) {\n\t\t\t\t\tself._deeperArray(key);\n\t\t\t\t\tself._asyncValidate(items, candidate[key], function (err, res) {\n\t\t\t\t\t\tself._back();\n\t\t\t\t\t\tdone(err, res);\n\t\t\t\t\t});\n\t\t\t\t}, callback);\n\t\t\t}\n\t\t}\n\t};\n\n\t// Validation Class ----------------------------------------------------------\n\t// inherits from Inspection class (actually we just call Inspection\n\t// constructor with the new context, because its prototype is empty\n\tfunction Validation(schema, custom) {\n\t\tInspection.prototype.constructor.call(this, schema, _merge(Validation.custom, custom));\n\t\tvar _error = [];\n\n\t\tthis._basicFields = Object.keys(_validationAttribut);\n\t\tthis._customFields = Object.keys(this._custom);\n\t\tthis.origin = null;\n\n\t\tthis.report = function (message, code, reason) {\n\t\t\tvar newErr = {\n\t\t\t\tcode: code || this.userCode || null,\n\t\t\t\treason: reason || 'unknown',\n\t\t\t\tmessage: this.userError || message || 'is invalid',\n\t\t\t\tproperty: this.userAlias ? (this.userAlias + ' (' + this._dumpStack() + ')') : this._dumpStack()\n\t\t\t};\n\t\t\t_error.push(newErr);\n\t\t\treturn this;\n\t\t};\n\n\t\tthis.result = function () {\n\t\t\treturn {\n\t\t\t\terror: _error,\n\t\t\t\tvalid: _error.length === 0,\n\t\t\t\tformat: function () {\n\t\t\t\t\tif (this.valid === true) {\n\t\t\t\t\t\treturn 'Candidate is valid';\n\t\t\t\t\t}\n\t\t\t\t\treturn this.error.map(function (i) {\n\t\t\t\t\t\treturn 'Property ' + i.property + ': ' + i.message;\n\t\t\t\t\t}).join('\\n');\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\t}\n\n\t_extend(Validation.prototype, _validationAttribut);\n\t_extend(Validation.prototype, _asyncValidationAttribut);\n\t_extend(Validation, new Customisable());\n\n\tValidation.prototype.validate = function (candidate, callback) {\n\t\tthis.origin = candidate;\n\t\tif (typeof callback === 'function') {\n\t\t\tvar self = this;\n\t\t\treturn async.nextTick(function () {\n\t\t\t\tself._asyncValidate(self._schema, candidate, function (err) {\n\t\t\t\t\tself.origin = null;\n\t\t\t\t\tcallback(err, self.result());\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\treturn this._validate(this._schema, candidate).result();\n\t};\n\n\tValidation.prototype._validate = function (schema, candidate, callback) {\n\t\tthis.userCode = schema.code || null;\n\t\tthis.userError = schema.error || null;\n\t\tthis.userAlias = schema.alias || null;\n\t\tthis._basicFields.forEach(function (i) {\n\t\t\tif ((i in schema || i === 'optional') && typeof this[i] === 'function') {\n\t\t\t\tthis[i](schema, candidate);\n\t\t\t}\n\t\t}, this);\n\t\tthis._customFields.forEach(function (i) {\n\t\t\tif (i in schema && typeof this._custom[i] === 'function') {\n\t\t\t\tthis._custom[i].call(this, schema, candidate);\n\t\t\t}\n\t\t}, this);\n\t\treturn this;\n\t};\n\n\tValidation.prototype._asyncValidate = function (schema, candidate, callback) {\n\t\tvar self = this;\n\t\tthis.userCode = schema.code || null;\n\t\tthis.userError = schema.error || null;\n\t\tthis.userAlias = schema.alias || null;\n\n\t\tasync.series([\n\t\t\tfunction (next) {\n\t\t\t\tasync.eachSeries(Object.keys(_validationAttribut), function (i, done) {\n\t\t\t\t\tasync.nextTick(function () {\n\t\t\t\t\t\tif ((i in schema || i === 'optional') && typeof self[i] === 'function') {\n\t\t\t\t\t\t\tif (self[i].length > 2) {\n\t\t\t\t\t\t\t\treturn self[i](schema, candidate, done);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tself[i](schema, candidate);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdone();\n\t\t\t\t\t});\n\t\t\t\t}, next);\n\t\t\t},\n\t\t\tfunction (next) {\n\t\t\t\tasync.eachSeries(Object.keys(self._custom), function (i, done) {\n\t\t\t\t\tasync.nextTick(function () {\n\t\t\t\t\t\tif (i in schema && typeof self._custom[i] === 'function') {\n\t\t\t\t\t\t\tif (self._custom[i].length > 2) {\n\t\t\t\t\t\t\t\treturn self._custom[i].call(self, schema, candidate, done);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tself._custom[i].call(self, schema, candidate);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdone();\n\t\t\t\t\t});\n\t\t\t\t}, next);\n\t\t\t}\n\t\t], callback);\n\t};\n\n// Sanitization ----------------------------------------------------------------\n\t// functions called by _sanitization.type method.\n\tvar _forceType = {\n\t\tnumber: function (post, schema) {\n\t\t\tvar n;\n\t\t\tif (typeof post === 'number') {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\telse if (post === '') {\n\t\t\t\tif (typeof schema.def !== 'undefined')\n\t\t\t\t\treturn schema.def;\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\telse if (typeof post === 'string') {\n\t\t\t\tn = parseFloat(post.replace(/,/g, '.').replace(/ /g, ''));\n\t\t\t\tif (typeof n === 'number') {\n\t\t\t\t\treturn n;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (post instanceof Date) {\n\t\t\t\treturn +post;\n\t\t\t}\n\t\t\treturn null;\n\t\t},\n\t\tinteger: function (post, schema) {\n\t\t\tvar n;\n\t\t\tif (typeof post === 'number' && post % 1 === 0) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\telse if (post === '') {\n\t\t\t\tif (typeof schema.def !== 'undefined')\n\t\t\t\t\treturn schema.def;\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\telse if (typeof post === 'string') {\n\t\t\t\tn = parseInt(post.replace(/ /g, ''), 10);\n\t\t\t\tif (typeof n === 'number') {\n\t\t\t\t\treturn n;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (typeof post === 'number') {\n\t\t\t\treturn parseInt(post, 10);\n\t\t\t}\n\t\t\telse if (typeof post === 'boolean') {\n\t\t\t\tif (post) { return 1; }\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\telse if (post instanceof Date) {\n\t\t\t\treturn +post;\n\t\t\t}\n\t\t\treturn null;\n\t\t},\n\t\tstring: function (post, schema) {\n\t\t\tif (typeof post === 'boolean' || typeof post === 'number' || post instanceof Date) {\n\t\t\t\treturn post.toString();\n\t\t\t}\n\t\t\telse if (_typeIs.array(post)) {\n\t\t\t\t// If user authorize array and strings...\n\t\t\t\tif (schema.items || schema.properties)\n\t\t\t\t\treturn post;\n\t\t\t\treturn post.join(String(schema.joinWith || ','));\n\t\t\t}\n\t\t\telse if (post instanceof Object) {\n\t\t\t\t// If user authorize objects ans strings...\n\t\t\t\tif (schema.items || schema.properties)\n\t\t\t\t\treturn post;\n\t\t\t\treturn JSON.stringify(post);\n\t\t\t}\n\t\t\telse if (typeof post === 'string' && post.length) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\treturn null;\n\t\t},\n\t\tdate: function (post, schema) {\n\t\t\tif (post instanceof Date) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar d = new Date(post);\n\t\t\t\tif (!isNaN(d.getTime())) { // if valid date\n\t\t\t\t\treturn d;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn null;\n\t\t},\n\t\tboolean: function (post, schema) {\n\t\t\tif (typeof post === 'undefined') return null;\n\t\t\tif (typeof post === 'string' && post.toLowerCase() === 'false') return false;\n\t\t\treturn !!post;\n\t\t},\n\t\tobject: function (post, schema) {\n\t\t\tif (typeof post !== 'string' || _typeIs.object(post)) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\ttry {\n\t\t\t\treturn JSON.parse(post);\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tarray: function (post, schema) {\n\t\t\tif (_typeIs.array(post))\n\t\t\t\treturn post;\n\t\t\tif (typeof post === 'undefined')\n\t\t\t\treturn null;\n\t\t\tif (typeof post === 'string') {\n\t\t\t\tif (post.substring(0,1) === '[' && post.slice(-1) === ']') {\n\t\t\t\t\ttry {\n\t\t\t\t\t\treturn JSON.parse(post);\n\t\t\t\t\t}\n\t\t\t\t\tcatch (e) {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn post.split(String(schema.splitWith || ','));\n\n\t\t\t}\n\t\t\tif (!_typeIs.array(post))\n\t\t\t\treturn [ post ];\n\t\t\treturn null;\n\t\t}\n\t};\n\n\tvar _applyRules = {\n\t\tupper: function (post) {\n\t\t\treturn post.toUpperCase();\n\t\t},\n\t\tlower: function (post) {\n\t\t\treturn post.toLowerCase();\n\t\t},\n\t\ttitle: function (post) {\n\t\t\t// Fix by seb (replace \\w\\S* by \\S* => exemple : coucou \u00e7a va)\n\t\t\treturn post.replace(/\\S*/g, function (txt) {\n\t\t\t\treturn txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();\n\t\t\t});\n\t\t},\n\t\tcapitalize: function (post) {\n\t\t\treturn post.charAt(0).toUpperCase() + post.substr(1).toLowerCase();\n\t\t},\n\t\tucfirst: function (post) {\n\t\t\treturn post.charAt(0).toUpperCase() + post.substr(1);\n\t\t},\n\t\ttrim: function (post) {\n\t\t\treturn post.trim();\n\t\t}\n\t};\n\n\t// Every function return the future value of each property. Therefore you\n\t// have to return post even if you do not change its value\n\tvar _sanitizationAttribut = {\n\t\tstrict: function (schema, post) {\n\t\t\tif (typeof schema.strict === 'string') { schema.strict = (schema.strict === 'true'); }\n\t\t\tif (schema.strict !== true)\n\t\t\t\treturn post;\n\t\t\tif (!_typeIs.object(schema.properties))\n\t\t\t\treturn post;\n\t\t\tif (!_typeIs.object(post))\n\t\t\t\treturn post;\n\t\t\tvar that = this;\n\t\t\tObject.keys(post).forEach(function (key) {\n\t\t\t\tif (!(key in schema.properties)) {\n\t\t\t\t\tdelete post[key];\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn post;\n\t\t},\n\t\toptional: function (schema, post) {\n\t\t\tvar opt = typeof schema.optional === 'boolean' ? schema.optional : (schema.optional !== 'false'); // Default: true\n\t\t\tif (opt === true) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tif (typeof post !== 'undefined') {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tthis.report();\n\t\t\tif (schema.def === Date) {\n\t\t\t\treturn new Date();\n\t\t\t}\n\t\t\treturn schema.def;\n\t\t},\n\t\ttype: function (schema, post) {\n\t\t\t// if (_typeIs['object'](post) || _typeIs.array(post)) {\n\t\t\t// \treturn post;\n\t\t\t// }\n\t\t\tif (typeof schema.type !== 'string' || typeof _forceType[schema.type] !== 'function') {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tvar n;\n\t\t\tvar opt = typeof schema.optional === 'boolean' ? schema.optional : true;\n\t\t\tif (typeof _forceType[schema.type] === 'function') {\n\t\t\t\tn = _forceType[schema.type](post, schema);\n\t\t\t\tif ((n === null && !opt) || (!n && isNaN(n)) || (n === null && schema.type === 'string')) {\n\t\t\t\t\tn = schema.def;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (!opt) {\n\t\t\t\tn = schema.def;\n\t\t\t}\n\t\t\tif ((n != null || (typeof schema.def !== 'undefined' && schema.def === n)) && n !== post) {\n\t\t\t\tthis.report();\n\t\t\t\treturn n;\n\t\t\t}\n\t\t\treturn post;\n\t\t},\n\t\trules: function (schema, post) {\n\t\t\tvar rules = schema.rules;\n\t\t\tif (typeof post !== 'string' || (typeof rules !== 'string' && !_typeIs.array(rules))) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tvar modified = false;\n\t\t\t(_typeIs.array(rules) ? rules : [rules]).forEach(function (rule) {\n\t\t\t\tif (typeof _applyRules[rule] === 'function') {\n\t\t\t\t\tpost = _applyRules[rule](post);\n\t\t\t\t\tmodified = true;\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (modified) {\n\t\t\t\tthis.report();\n\t\t\t}\n\t\t\treturn post;\n\t\t},\n\t\tmin: function (schema, post) {\n\t\t\tvar postTest = Number(post);\n\t\t\tif (isNaN(postTest)) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tvar min = Number(schema.min);\n\t\t\tif (isNaN(min)) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tif (postTest < min) {\n\t\t\t\tthis.report();\n\t\t\t\treturn min;\n\t\t\t}\n\t\t\treturn post;\n\t\t},\n\t\tmax: function (schema, post) {\n\t\t\tvar postTest = Number(post);\n\t\t\tif (isNaN(postTest)) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tvar max = Number(schema.max);\n\t\t\tif (isNaN(max)) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tif (postTest > max) {\n\t\t\t\tthis.report();\n\t\t\t\treturn max;\n\t\t\t}\n\t\t\treturn post;\n\t\t},\n\t\tminLength: function (schema, post) {\n\t\t\tvar limit = Number(schema.minLength);\n\t\t\tif (typeof post !== 'string' || isNaN(limit) || limit < 0) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tvar str = '';\n\t\t\tvar gap = limit - post.length;\n\t\t\tif (gap > 0) {\n\t\t\t\tfor (var i = 0; i < gap; i++) {\n\t\t\t\t\tstr += '-';\n\t\t\t\t}\n\t\t\t\tthis.report();\n\t\t\t\treturn post + str;\n\t\t\t}\n\t\t\treturn post;\n\t\t},\n\t\tmaxLength: function (schema, post) {\n\t\t\tvar limit = Number(schema.maxLength);\n\t\t\tif (typeof post !== 'string' || isNaN(limit) || limit < 0) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tif (post.length > limit) {\n\t\t\t\tthis.report();\n\t\t\t\treturn post.slice(0, limit);\n\t\t\t}\n\t\t\treturn post;\n\t\t},\n\t\tproperties: function (schema, post, callback) {\n\t\t\tif (typeof callback === 'function') {\n\t\t\t\treturn this.asyncProperties(schema, post, callback);\n\t\t\t}\n\t\t\tif (!post || typeof post !== 'object') {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tvar properties = schema.properties;\n\t\t\tvar tmp;\n\t\t\tvar i;\n\t\t\tif (typeof properties['*'] !== 'undefined') {\n\t\t\t\tfor (i in post) {\n\t\t\t\t\tif (i in properties) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tthis._deeperObject(i);\n\t\t\t\t\ttmp = this._sanitize(schema.properties['*'], post[i]);\n\t\t\t\t\tif (typeof tmp !== 'undefined') {\n\t\t\t\t\t\tpost[i]= tmp;\n\t\t\t\t\t}\n\t\t\t\t\tthis._back();\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (i in schema.properties) {\n\t\t\t\tif (i !== '*') {\n\t\t\t\t\tthis._deeperObject(i);\n\t\t\t\t\ttmp = this._sanitize(schema.properties[i], post[i]);\n\t\t\t\t\tif (typeof tmp !== 'undefined') {\n\t\t\t\t\t\tpost[i]= tmp;\n\t\t\t\t\t}\n\t\t\t\t\tthis._back();\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn post;\n\t\t},\n\t\titems: function (schema, post, callback) {\n\t\t\tif (typeof callback === 'function') {\n\t\t\t\treturn this.asyncItems(schema, post, callback);\n\t\t\t}\n\t\t\tif (!(schema.items instanceof Object) || !(post instanceof Object)) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tvar i;\n\t\t\tif (_typeIs.array(schema.items) && _typeIs.array(post)) {\n\t\t\t\tvar minLength = schema.items.length < post.length ? schema.items.length : post.length;\n\t\t\t\tfor (i = 0; i < minLength; i++) {\n\t\t\t\t\tthis._deeperArray(i);\n\t\t\t\t\tpost[i] = this._sanitize(schema.items[i], post[i]);\n\t\t\t\t\tthis._back();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfor (i in post) {\n\t\t\t\t\tif(post.hasOwnProperty(i)){\n\t\t\t\t\t\tthis._deeperArray(i);\n\t\t\t\t\t\tpost[i] = this._sanitize(schema.items, post[i]);\n\t\t\t\t\t\tthis._back();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn post;\n\t\t},\n\t\texec: function (schema, post, callback) {\n\t\t\tif (typeof callback === 'function') {\n\t\t\t\treturn this.asyncExec(schema, post, callback);\n\t\t\t}\n\t\t\tvar execs = _typeIs.array(schema.exec) ? schema.exec : [schema.exec];\n\n\t\t\texecs.forEach(function (exec) {\n\t\t\t\tif (typeof exec === 'function') {\n\t\t\t\t\tpost = exec.call(this, schema, post);\n\t\t\t\t}\n\t\t\t}, this);\n\t\t\treturn post;\n\t\t}\n\t};\n\n\tvar _asyncSanitizationAttribut = {\n\t\tasyncExec: function (schema, post, callback) {\n\t\t\tvar self = this;\n\t\t\tvar execs = _typeIs.array(schema.exec) ? schema.exec : [schema.exec];\n\n\t\t\tasync.eachSeries(execs, function (exec, done) {\n\t\t\t\tif (typeof exec === 'function') {\n\t\t\t\t\tif (exec.length > 2) {\n\t\t\t\t\t\treturn exec.call(self, schema, post, function (err, res) {\n\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\treturn done(err);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tpost = res;\n\t\t\t\t\t\t\tdone();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tpost = exec.call(self, schema, post);\n\t\t\t\t}\n\t\t\t\tdone();\n\t\t\t}, function (err) {\n\t\t\t\tcallback(err, post);\n\t\t\t});\n\t\t},\n\t\tasyncProperties: function (schema, post, callback) {\n\t\t\tif (!post || typeof post !== 'object') {\n\t\t\t\treturn callback(null, post);\n\t\t\t}\n\t\t\tvar self = this;\n\t\t\tvar properties = schema.properties;\n\n\t\t\tasync.series([\n\t\t\t\tfunction (next) {\n\t\t\t\t\tif (properties['*'] == null) {\n\t\t\t\t\t\treturn next();\n\t\t\t\t\t}\n\t\t\t\t\tvar globing = properties['*'];\n\t\t\t\t\tasync.eachSeries(Object.keys(post), function (i, next) {\n\t\t\t\t\t\tif (i in properties) {\n\t\t\t\t\t\t\treturn next();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tself._deeperObject(i);\n\t\t\t\t\t\tself._asyncSanitize(globing, post[i], function (err, res) {\n\t\t\t\t\t\t\tif (err) { /* Error can safely be ignored here */ }\n\t\t\t\t\t\t\tif (typeof res !== 'undefined') {\n\t\t\t\t\t\t\t\tpost[i] = res;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tself._back();\n\t\t\t\t\t\t\tnext();\n\t\t\t\t\t\t});\n\t\t\t\t\t}, next);\n\t\t\t\t},\n\t\t\t\tfunction (next) {\n\t\t\t\t\tasync.eachSeries(Object.keys(properties), function (i, next) {\n\t\t\t\t\t\tif (i === '*') {\n\t\t\t\t\t\t\treturn next();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tself._deeperObject(i);\n\t\t\t\t\t\tself._asyncSanitize(properties[i], post[i], function (err, res) {\n\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\treturn next(err);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (typeof res !== 'undefined') {\n\t\t\t\t\t\t\t\tpost[i] = res;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tself._back();\n\t\t\t\t\t\t\tnext();\n\t\t\t\t\t\t});\n\t\t\t\t\t}, next);\n\t\t\t\t}\n\t\t\t], function (err) {\n\t\t\t\treturn callback(err, post);\n\t\t\t});\n\t\t},\n\t\tasyncItems: function (schema, post, callback) {\n\t\t\tif (!(schema.items instanceof Object) || !(post instanceof Object)) {\n\t\t\t\treturn callback(null, post);\n\t\t\t}\n\t\t\tvar self = this;\n\t\t\tvar items = schema.items;\n\t\t\tif (_typeIs.array(items) && _typeIs.array(post)) {\n\t\t\t\tvar minLength = items.length < post.length ? items.length : post.length;\n\t\t\t\tasync.timesSeries(minLength, function (i, next) {\n\t\t\t\t\tself._deeperArray(i);\n\t\t\t\t\tself._asyncSanitize(items[i], post[i], function (err, res) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\treturn next(err);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tpost[i] = res;\n\t\t\t\t\t\tself._back();\n\t\t\t\t\t\tnext();\n\t\t\t\t\t});\n\t\t\t\t}, function (err) {\n\t\t\t\t\tcallback(err, post);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse {\n\t\t\t\tasync.eachSeries(Object.keys(post), function (key, next) {\n\t\t\t\t\tself._deeperArray(key);\n\t\t\t\t\tself._asyncSanitize(items, post[key], function (err, res) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\treturn next();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tpost[key] = res;\n\t\t\t\t\t\tself._back();\n\t\t\t\t\t\tnext();\n\t\t\t\t\t});\n\t\t\t\t}, function (err) {\n\t\t\t\t\tcallback(err, post);\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn post;\n\t\t}\n\t};\n\n\t// Sanitization Class --------------------------------------------------------\n\t// inherits from Inspection class (actually we just call Inspection\n\t// constructor with the new context, because its prototype is empty\n\tfunction Sanitization(schema, custom) {\n\t\tInspection.prototype.constructor.call(this, schema, _merge(Sanitization.custom, custom));\n\t\tvar _reporting = [];\n\n\t\tthis._basicFields = Object.keys(_sanitizationAttribut);\n\t\tthis._customFields = Object.keys(this._custom);\n\t\tthis.origin = null;\n\n\t\tthis.report = function (message) {\n\t\t\tvar newNot = {\n\t\t\t\t\tmessage: message || 'was sanitized',\n\t\t\t\t\tproperty: this.userAlias ? (this.userAlias + ' (' + this._dumpStack() + ')') : this._dumpStack()\n\t\t\t};\n\t\t\tif (!_reporting.some(function (e) { return e.property === newNot.property; })) {\n\t\t\t\t_reporting.push(newNot);\n\t\t\t}\n\t\t};\n\n\t\tthis.result = function (data) {\n\t\t\treturn {\n\t\t\t\tdata: data,\n\t\t\t\treporting: _reporting,\n\t\t\t\tformat: function () {\n\t\t\t\t\treturn this.reporting.map(function (i) {\n\t\t\t\t\t\treturn 'Property ' + i.property + ' ' + i.message;\n\t\t\t\t\t}).join('\\n');\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\t}\n\n\t_extend(Sanitization.prototype, _sanitizationAttribut);\n\t_extend(Sanitization.prototype, _asyncSanitizationAttribut);\n\t_extend(Sanitization, new Customisable());\n\n\n\tSanitization.prototype.sanitize = function (post, callback) {\n\t\tthis.origin = post;\n\t\tif (typeof callback === 'function') {\n\t\t\tvar self = this;\n\t\t\treturn this._asyncSanitize(this._schema, post, function (err, data) {\n\t\t\t\tself.origin = null;\n\t\t\t\tcallback(err, self.result(data));\n\t\t\t});\n\t\t}\n\t\tvar data = this._sanitize(this._schema, post);\n\t\tthis.origin = null;\n\t\treturn this.result(data);\n\t};\n\n\tSanitization.prototype._sanitize = function (schema, post) {\n\t\tthis.userAlias = schema.alias || null;\n\t\tthis._basicFields.forEach(function (i) {\n\t\t\tif ((i in schema || i === 'optional') && typeof this[i] === 'function') {\n\t\t\t\tpost = this[i](schema, post);\n\t\t\t}\n\t\t}, this);\n\t\tthis._customFields.forEach(function (i) {\n\t\t\tif (i in schema && typeof this._custom[i] === 'function') {\n\t\t\t\tpost = this._custom[i].call(this, schema, post);\n\t\t\t}\n\t\t}, this);\n\t\treturn post;\n\t};\n\n\tSanitization.prototype._asyncSanitize = function (schema, post, callback) {\n\t\tvar self = this;\n\t\tthis.userAlias = schema.alias || null;\n\n\t\tasync.waterfall([\n\t\t\tfunction (next) {\n\t\t\t\tasync.reduce(self._basicFields, post, function (value, i, next) {\n\t\t\t\t\tasync.nextTick(function () {\n\t\t\t\t\t\tif ((i in schema || i === 'optional') && typeof self[i] === 'function') {\n\t\t\t\t\t\t\tif (self[i].length > 2) {\n\t\t\t\t\t\t\t\treturn self[i](schema, value, next);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvalue = self[i](schema, value);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnext(null, value);\n\t\t\t\t\t});\n\t\t\t\t}, next);\n\t\t\t},\n\t\t\tfunction (inter, next) {\n\t\t\t\tasync.reduce(self._customFields, inter, function (value, i, next) {\n\t\t\t\t\tasync.nextTick(function () {\n\t\t\t\t\t\tif (i in schema && typeof self._custom[i] === 'function') {\n\t\t\t\t\t\t\tif (self._custom[i].length > 2) {\n\t\t\t\t\t\t\t\treturn self._custom[i].call(self, schema, value, next);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvalue = self._custom[i].call(self, schema, value);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnext(null, value);\n\t\t\t\t\t});\n\t\t\t\t}, next);\n\t\t\t}\n\t\t], callback);\n\t};\n\n\t// ---------------------------------------------------------------------------\n\n\tvar INT_MIN = -2147483648;\n\tvar INT_MAX = 2147483647;\n\n\tvar _rand = {\n\t\tint: function (min, max) {\n\t\t\treturn min + (0 | Math.random() * (max - min + 1));\n\t\t},\n\t\tfloat: function (min, max) {\n\t\t\treturn (Math.random() * (max - min) + min);\n\t\t},\n\t\tbool: function () {\n\t\t\treturn (Math.random() > 0.5);\n\t\t},\n\t\tchar: function (min, max) {\n\t\t\treturn String.fromCharCode(this.int(min, max));\n\t\t},\n\t\tfromList: function (list) {\n\t\t\treturn list[this.int(0, list.length - 1)];\n\t\t}\n\t};\n\n\tvar _formatSample = {\n\t\t'date-time': function () {\n\t\t\treturn new Date().toISOString();\n\t\t},\n\t\t'date': function () {\n\t\t\treturn new Date().toISOString().replace(/T.*$/, '');\n\t\t},\n\t\t'time': function () {\n\t\t\treturn new Date().toLocaleTimeString({}, { hour12: false });\n\t\t},\n\t\t'color': function (min, max) {\n\t\t\tvar s = '#';\n\t\t\tif (min < 1) {\n\t\t\t\tmin = 1;\n\t\t\t}\n\t\t\tfor (var i = 0, l = _rand.int(min, max); i < l; i++) {\n\t\t\t\ts += _rand.fromList('0123456789abcdefABCDEF');\n\t\t\t}\n\t\t\treturn s;\n\t\t},\n\t\t'numeric': function () {\n\t\t\treturn '' + _rand.int(0, INT_MAX);\n\t\t},\n\t\t'integer': function () {\n\t\t\tif (_rand.bool() === true) {\n\t\t\t\treturn '-' + this.numeric();\n\t\t\t}\n\t\t\treturn this.numeric();\n\t\t},\n\t\t'decimal': function () {\n\t\t\treturn this.integer() + '.' + this.numeric();\n\t\t},\n\t\t'alpha': function (min, max) {\n\t\t\tvar s = '';\n\t\t\tif (min < 1) {\n\t\t\t\tmin = 1;\n\t\t\t}\n\t\t\tfor (var i = 0, l = _rand.int(min, max); i < l; i++) {\n\t\t\t\ts += _rand.fromList('abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ');\n\t\t\t}\n\t\t\treturn s;\n\t\t},\n\t\t'alphaNumeric': function (min, max) {\n\t\t\tvar s = '';\n\t\t\tif (min < 1) {\n\t\t\t\tmin = 1;\n\t\t\t}\n\t\t\tfor (var i = 0, l = _rand.int(min, max); i < l; i++) {\n\t\t\t\ts += _rand.fromList('abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789');\n\t\t\t}\n\t\t\treturn s;\n\t\t},\n\t\t'alphaDash': function (min, max) {\n\t\t\tvar s = '';\n\t\t\tif (min < 1) {\n\t\t\t\tmin = 1;\n\t\t\t}\n\t\t\tfor (var i = 0, l = _rand.int(min, max); i < l; i++) {\n\t\t\t\ts += _rand.fromList('_-abcdefghijklmnopqrstuvwxyz_-ABCDEFGHIJKLMNOPQRSTUVWXYZ_-0123456789_-');\n\t\t\t}\n\t\t\treturn s;\n\t\t},\n\t\t'javascript': function (min, max) {\n\t\t\tvar s = _rand.fromList('_$abcdefghijklmnopqrstuvwxyz_$ABCDEFGHIJKLMNOPQRSTUVWXYZ_$');\n\t\t\tfor (var i = 0, l = _rand.int(min, max - 1); i < l; i++) {\n\t\t\t\ts += _rand.fromList('_$abcdefghijklmnopqrstuvwxyz_$ABCDEFGHIJKLMNOPQRSTUVWXYZ_$0123456789_$');\n\t\t\t}\n\t\t\treturn s;\n\t\t}\n\t};\n\n\tfunction _getLimits(schema) {\n\t\tvar min = INT_MIN;\n\t\tvar max = INT_MAX;\n\n\t\tif (schema.gte != null) {\n\t\t\tmin = schema.gte;\n\t\t}\n\t\telse if (schema.gt != null) {\n\t\t\tmin = schema.gt + 1;\n\t\t}\n\t\tif (schema.lte != null) {\n\t\t\tmax = schema.lte;\n\t\t}\n\t\telse if (schema.lt != null) {\n\t\t\tmax = schema.lt - 1;\n\t\t}\n\t\treturn { min: min, max: max };\n\t}\n\n\tvar _typeGenerator = {\n\t\tstring: function (schema) {\n\t\t\tif (schema.eq != null) {\n\t\t\t\treturn schema.eq;\n\t\t\t}\n\t\t\tvar s = '';\n\t\t\tvar minLength = schema.minLength != null ? schema.minLength : 0;\n\t\t\tvar maxLength = schema.maxLength != null ? schema.maxLength : 32;\n\t\t\tif (typeof schema.pattern === 'string' && typeof _formatSample[schema.pattern] === 'function') {\n\t\t\t\treturn _formatSample[schema.pattern](minLength, maxLength);\n\t\t\t}\n\n\t\t\tvar l = schema.exactLength != null ? schema.exactLength : _rand.int(minLength, maxLength);\n\t\t\tfor (var i = 0; i < l; i++) {\n\t\t\t\ts += _rand.char(32, 126);\n\t\t\t}\n\t\t\treturn s;\n\t\t},\n\t\tnumber: function (schema) {\n\t\t\tif (schema.eq != null) {\n\t\t\t\treturn schema.eq;\n\t\t\t}\n\t\t\tvar limit = _getLimits(schema);\n\t\t\tvar n = _rand.float(limit.min, limit.max);\n\t\t\tif (schema.ne != null) {\n\t\t\t\tvar ne = _typeIs.array(schema.ne) ? schema.ne : [schema.ne];\n\t\t\t\twhile (ne.indexOf(n) !== -1) {\n\t\t\t\t\tn = _rand.float(limit.min, limit.max);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn n;\n\t\t},\n\t\tinteger: function (schema) {\n\t\t\tif (schema.eq != null) {\n\t\t\t\treturn schema.eq;\n\t\t\t}\n\t\t\tvar limit = _getLimits(schema);\n\t\t\tvar n = _rand.int(limit.min, limit.max);\n\t\t\tif (schema.ne != null) {\n\t\t\t\tvar ne = _typeIs.array(schema.ne) ? schema.ne : [schema.ne];\n\t\t\t\twhile (ne.indexOf(n) !== -1) {\n\t\t\t\t\tn = _rand.int(limit.min, limit.max);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn n;\n\t\t},\n\t\tboolean: function (schema) {\n\t\t\tif (schema.eq != null) {\n\t\t\t\treturn schema.eq;\n\t\t\t}\n\t\t\treturn _rand.bool();\n\t\t},\n\t\t\"null\": function (schema) {\n\t\t\treturn null;\n\t\t},\n\t\tdate: function (schema) {\n\t\t\tif (schema.eq != null) {\n\t\t\t\treturn schema.eq;\n\t\t\t}\n\t\t\treturn new Date();\n\t\t},\n\t\tobject: function (schema) {\n\t\t\tvar o = {};\n\t\t\tvar prop = schema.properties || {};\n\n\t\t\tfor (var key in prop) {\n\t\t\t\tif (prop.hasOwnProperty(key)){\n\t\t\t\t\tif (prop[key].optional === true && _rand.bool() === true) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tif (key !== '*') {\n\t\t\t\t\t\to[key] = this.generate(prop[key]);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tvar rk = '__random_key_';\n\t\t\t\t\t\tvar randomKey = rk + 0;\n\t\t\t\t\t\tvar n = _rand.int(1, 9);\n\t\t\t\t\t\tfor (var i = 1; i <= n; i++) {\n\t\t\t\t\t\t\tif (!(randomKey in prop)) {\n\t\t\t\t\t\t\t\to[randomKey] = this.generate(prop[key]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\trandomKey = rk + i;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn o;\n\t\t},\n\t\tarray: function (schema) {\n\t\t\tvar self = this;\n\t\t\tvar items = schema.items || {};\n\t\t\tvar minLength = schema.minLength != null ? schema.minLength : 0;\n\t\t\tvar maxLength = schema.maxLength != null ? schema.maxLength : 16;\n\t\t\tvar type;\n\t\t\tvar candidate;\n\t\t\tvar size;\n\t\t\tvar i;\n\n\t\t\tif (_typeIs.array(items)) {\n\t\t\t\tsize = items.length;\n\t\t\t\tif (schema.exactLength != null) {\n\t\t\t\t\tsize = schema.exactLength;\n\t\t\t\t}\n\t\t\t\telse if (size < minLength) {\n\t\t\t\t\tsize = minLength;\n\t\t\t\t}\n\t\t\t\telse if (size > maxLength) {\n\t\t\t\t\tsize = maxLength;\n\t\t\t\t}\n\t\t\t\tcandidate = new Array(size);\n\t\t\t\ttype = null;\n\t\t\t\tfor (i = 0; i < size; i++) {\n\t\t\t\t\ttype = items[i].type || 'any';\n\t\t\t\t\tif (_typeIs.array(type)) {\n\t\t\t\t\t\ttype = type[_rand.int(0, type.length - 1)];\n\t\t\t\t\t}\n\t\t\t\t\tcandidate[i] = self[type](items[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tsize = schema.exactLength != null ? schema.exactLength : _rand.int(minLength, maxLength);\n\t\t\t\tcandidate = new Array(size);\n\t\t\t\ttype = items.type || 'any';\n\t\t\t\tif (_typeIs.array(type)) {\n\t\t\t\t\ttype = type[_rand.int(0, type.length - 1)];\n\t\t\t\t}\n\t\t\t\tfor (i = 0; i < size; i++) {\n\t\t\t\t\tcandidate[i] = self[type](items);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn candidate;\n\t\t},\n\t\tany: function (schema) {\n\t\t\tvar fields = Object.keys(_typeGenerator);\n\t\t\tvar i = fields[_rand.int(0, fields.length - 2)];\n\t\t\treturn this[i](schema);\n\t\t}\n\t};\n\n\t// CandidateGenerator Class (Singleton) --------------------------------------\n\tfunction CandidateGenerator() {\n\t\t// Maybe extends Inspection class too ?\n\t}\n\n\t_extend(CandidateGenerator.prototype, _typeGenerator);\n\n\tvar _instance = null;\n\tCandidateGenerator.instance = function () {\n\t\tif (!(_instance instanceof CandidateGenerator)) {\n\t\t\t_instance = new CandidateGenerator();\n\t\t}\n\t\treturn _instance;\n\t};\n\n\tCandidateGenerator.prototype.generate = function (schema) {\n\t\tvar type = schema.type || 'any';\n\t\tif (_typeIs.array(type)) {\n\t\t\ttype = type[_rand.int(0, type.length - 1)];\n\t\t}\n\t\treturn this[type](schema);\n\t};\n\n// Exports ---------------------------------------------------------------------\n\tvar SchemaInspector = {};\n\n\t// if server-side (node.js) else client-side\n\tif (typeof module !== 'undefined' && module.exports) {\n\t\tmodule.exports = SchemaInspector;\n\t}\n\telse {\n\t\twindow.SchemaInspector = SchemaInspector;\n\t}\n\n\tSchemaInspector.newSanitization = function (schema, custom) {\n\t\treturn new Sanitization(schema, custom);\n\t};\n\n\tSchemaInspector.newValidation = function (schema, custom) {\n\t\treturn new Validation(schema, custom);\n\t};\n\n\tSchemaInspector.Validation = Validation;\n\tSchemaInspector.Sanitization = Sanitization;\n\n\tSchemaInspector.sanitize = function (schema, post, custom, callback) {\n\t\tif (arguments.length === 3 && typeof custom === 'function') {\n\t\t\tcallback = custom;\n\t\t\tcustom = null;\n\t\t}\n\t\treturn new Sanitization(schema, custom).sanitize(post, callback);\n\t};\n\n\tSchemaInspector.validate = function (schema, candidate, custom, callback) {\n\t\tif (arguments.length === 3 && typeof custom === 'function') {\n\t\t\tcallback = custom;\n\t\t\tcustom = null;\n\t\t}\n\t\treturn new Validation(schema, custom).validate(candidate, callback);\n\t};\n\n\tSchemaInspector.generate = function (schema, n) {\n\t\tif (typeof n === 'number') {\n\t\t\tvar r = new Array(n);\n\t\t\tfor (var i = 0; i < n; i++) {\n\t\t\t\tr[i] = CandidateGenerator.instance().generate(schema);\n\t\t\t}\n\t\t\treturn r;\n\t\t}\n\t\treturn CandidateGenerator.instance().generate(schema);\n\t};\n})();\n"], "fixing_code": ["/*\n * This module is intended to be executed both on client side and server side.\n * No error should be thrown. (soft error handling)\n */\n\n(function () {\n\tvar root = {};\n\t// Dependencies --------------------------------------------------------------\n\troot.async = (typeof require === 'function') ? require('async') : window.async;\n\tif (typeof root.async !== 'object') {\n\t\tthrow new Error('Module async is required (https://github.com/caolan/async)');\n\t}\n\tvar async = root.async;\n\n\tfunction _extend(origin, add) {\n\t\tif (!add || typeof add !== 'object') {\n\t\t\treturn origin;\n\t\t}\n\t\tvar keys = Object.keys(add);\n\t\tvar i = keys.length;\n\t\twhile (i--) {\n\t\t\torigin[keys[i]] = add[keys[i]];\n\t\t}\n\t\treturn origin;\n\t}\n\n\tfunction _merge() {\n\t\tvar ret = {};\n\t\tvar args = Array.prototype.slice.call(arguments);\n\t\tvar keys = null;\n\t\tvar i = null;\n\n\t\targs.forEach(function (arg) {\n\t\t\tif (arg && arg.constructor === Object) {\n\t\t\t\tkeys = Object.keys(arg);\n\t\t\t\ti = keys.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\tret[keys[i]] = arg[keys[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn ret;\n\t}\n\n\t// Customisable class (Base class) -------------------------------------------\n\t// Use with operation \"new\" to extend Validation and Sanitization themselves,\n\t// not their prototype. In other words, constructor shall be call to extend\n\t// those functions, instead of being in their constructor, like this:\n\t//\t\t_extend(Validation, new Customisable);\n\n\tfunction Customisable() {\n\t\tthis.custom = {};\n\n\t\tthis.extend = function (custom) {\n\t\t\treturn _extend(this.custom, custom);\n\t\t};\n\n\t\tthis.reset = function () {\n\t\t\tthis.custom = {};\n\t\t};\n\n\t\tthis.remove = function (fields) {\n\t\t\tif (!_typeIs.array(fields)) {\n\t\t\t\tfields = [fields];\n\t\t\t}\n\t\t\tfields.forEach(function (field) {\n\t\t\t\tdelete this.custom[field];\n\t\t\t}, this);\n\t\t};\n\t}\n\n\t// Inspection class (Base class) ---------------------------------------------\n\t// Use to extend Validation and Sanitization prototypes. Inspection\n\t// constructor shall be called in derived class constructor.\n\n\tfunction Inspection(schema, custom) {\n\t\tvar _stack = ['@'];\n\n\t\tthis._schema = schema;\n\t\tthis._custom = {};\n\t\tif (custom != null) {\n\t\t\tfor (var key in custom) {\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(custom, key)) {\n\t\t\t\t\tthis._custom['$' + key] = custom[key];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis._getDepth = function () {\n\t\t\treturn _stack.length;\n\t\t};\n\n\t\tthis._dumpStack = function () {\n\t\t\treturn _stack.map(function (i) {return i.replace(/^\\[/g, '\\u001b\\u001c\\u001d\\u001e');})\n\t\t\t.join('.').replace(/\\.\\u001b\\u001c\\u001d\\u001e/g, '[');\n\t\t};\n\n\t\tthis._deeperObject = function (name) {\n\t\t\t_stack.push((/^[a-z$_][a-z0-9$_]*$/i).test(name) ? name : '[\"' + name + '\"]');\n\t\t\treturn this;\n\t\t};\n\n\t\tthis._deeperArray = function (i) {\n\t\t\t_stack.push('[' + i + ']');\n\t\t\treturn this;\n\t\t};\n\n\t\tthis._back = function () {\n\t\t\t_stack.pop();\n\t\t\treturn this;\n\t\t};\n\t}\n\t// Simple types --------------------------------------------------------------\n\t// If the property is not defined or is not in this list:\n\tvar _typeIs = {\n\t\t\"function\": function (element) {\n\t\t\treturn typeof element === 'function';\n\t\t},\n\t\t\"string\": function (element) {\n\t\t\treturn typeof element === 'string';\n\t\t},\n\t\t\"number\": function (element) {\n\t\t\treturn typeof element === 'number' && !isNaN(element);\n\t\t},\n\t\t\"integer\": function (element) {\n\t\t\treturn typeof element === 'number' && element % 1 === 0;\n\t\t},\n\t\t\"NaN\": function (element) {\n\t\t\treturn typeof element === 'number' && isNaN(element);\n\t\t},\n\t\t\"boolean\": function (element) {\n\t\t\treturn typeof element === 'boolean';\n\t\t},\n\t\t\"null\": function (element) {\n\t\t\treturn element === null;\n\t\t},\n\t\t\"date\": function (element) {\n\t\t\treturn element != null && element instanceof Date;\n\t\t},\n\t\t\"object\": function (element) {\n\t\t\treturn element != null && element.constructor === Object;\n\t\t},\n\t\t\"array\": function (element) {\n\t\t\treturn element != null && element.constructor === Array;\n\t\t},\n\t\t\"any\": function (element) {\n\t\t\treturn true;\n\t\t}\n\t};\n\n\tfunction _simpleType(type, candidate) {\n\t\tif (typeof type == 'function') {\n\t\t\treturn candidate instanceof type;\n\t\t}\n\t\ttype = type in _typeIs ? type : 'any';\n\t\treturn _typeIs[type](candidate);\n\t}\n\n\tfunction _realType(candidate) {\n\t\tfor (var i in _typeIs) {\n\t\t\tif (_simpleType(i, candidate)) {\n\t\t\t\tif (i !== 'any') { return i; }\n\t\t\t\treturn 'an instance of ' + candidate.constructor.name;\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction getIndexes(a, value) {\n\t\tvar indexes = [];\n\t\tvar i = a.indexOf(value);\n\n\t\twhile (i !== -1) {\n\t\t\tindexes.push(i);\n\t\t\ti = a.indexOf(value, i + 1);\n\t\t}\n\t\treturn indexes;\n\t}\n\n\t// Available formats ---------------------------------------------------------\n\tvar _formats = {\n\t\t'void': /^$/,\n\t\t'url': /^(https?|ftp):\\/\\/(((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:)*@)?(((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5]))|((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)?(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.?)(:\\d*)?)(\\/((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)+(\\/(([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)*)*)?)?(\\?((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)|[\\uE000-\\uF8FF]|\\/|\\?)*)?(\\#((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)|\\/|\\?)*)?$/i,\n\t\t'date-time': /^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d{3})?(Z?|(-|\\+)\\d{2}:\\d{2})$/,\n\t\t'date': /^\\d{4}-\\d{2}-\\d{2}$/,\n\t\t'coolDateTime': /^\\d{4}(-|\\/)\\d{2}(-|\\/)\\d{2}(T| )\\d{2}:\\d{2}:\\d{2}(\\.\\d{3})?Z?$/,\n\t\t'time': /^\\d{2}\\:\\d{2}\\:\\d{2}$/,\n\t\t'color': /^#([0-9a-f])+$/i,\n\t\t'email': /^((([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+(\\.([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+)*)|((\\x22)((((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(([\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x7f]|\\x21|[\\x23-\\x5b]|[\\x5d-\\x7e]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(\\\\([\\x01-\\x09\\x0b\\x0c\\x0d-\\x7f]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]))))*(((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(\\x22)))@((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)+(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.?$/i,\n\t\t'numeric': /^[0-9]+$/,\n\t\t'integer': /^\\-?[0-9]+$/,\n\t\t'decimal': /^\\-?[0-9]*\\.?[0-9]+$/,\n\t\t'alpha': /^[a-z]+$/i,\n\t\t'alphaNumeric': /^[a-z0-9]+$/i,\n\t\t'alphaDash': /^[a-z0-9_-]+$/i,\n\t\t'javascript': /^[a-z_\\$][a-z0-9_\\$]*$/i,\n\t\t'upperString': /^[A-Z ]*$/,\n\t\t'lowerString': /^[a-z ]*$/\n\t};\n\n// Validation ------------------------------------------------------------------\n\tvar _validationAttribut = {\n\t\toptional: function (schema, candidate) {\n\t\t\tvar opt = typeof schema.optional === 'boolean' ? schema.optional : (schema.optional === 'true'); // Default is false\n\n\t\t\tif (opt === true) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (typeof candidate === 'undefined') {\n\t\t\t\tthis.report('is missing and not optional', null, 'optional');\n\t\t\t}\n\t\t},\n\t\ttype: function (schema, candidate) {\n\t\t\t// return because optional function already handle this case\n\t\t\tif (typeof candidate === 'undefined' || (typeof schema.type !== 'string' && !(schema.type instanceof Array) && typeof schema.type !== 'function')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar types = _typeIs.array(schema.type) ? schema.type : [schema.type];\n\t\t\tvar typeIsValid = types.some(function (type) {\n\t\t\t\treturn _simpleType(type, candidate);\n\t\t\t});\n\t\t\tif (!typeIsValid) {\n\t\t\t\ttypes = types.map(function (t) {return typeof t === 'function' ? 'and instance of ' + t.name : t; });\n\t\t\t\tthis.report('must be ' + types.join(' or ') + ', but is ' + _realType(candidate), null, 'type');\n\t\t\t}\n\t\t},\n\t\tuniqueness: function (schema, candidate) {\n\t\t\tif (typeof schema.uniqueness === 'string') { schema.uniqueness = (schema.uniqueness === 'true'); }\n\t\t\tif (typeof schema.uniqueness !== 'boolean' || schema.uniqueness === false || (!_typeIs.array(candidate) && typeof candidate !== 'string')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar reported = [];\n\t\t\tfor (var i = 0; i < candidate.length; i++) {\n\t\t\t\tif (reported.indexOf(candidate[i]) >= 0) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tvar indexes = getIndexes(candidate, candidate[i]);\n\t\t\t\tif (indexes.length > 1) {\n\t\t\t\t\treported.push(candidate[i]);\n\t\t\t\t\tthis.report('has value [' + candidate[i] + '] more than once at indexes [' + indexes.join(', ') + ']', null, 'uniqueness');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tpattern: function (schema, candidate) {\n\t\t\tvar self = this;\n\t\t\tvar regexs = schema.pattern;\n\t\t\tif (typeof candidate !== 'string') {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar matches = false;\n\t\t\tif (!_typeIs.array(regexs)) {\n\t\t\t\tregexs = [regexs];\n\t\t\t}\n\t\t\tregexs.forEach(function (regex) {\n\t\t\t\tif (typeof regex === 'string' && regex in _formats) {\n\t\t\t\t\tregex = _formats[regex];\n\t\t\t\t}\n\t\t\t\tif (regex instanceof RegExp) {\n\t\t\t\t\tif (regex.test(candidate)) {\n\t\t\t\t\t\tmatches = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (!matches) {\n\t\t\t\tself.report('must match [' + regexs.join(' or ') + '], but is equal to \"' + candidate + '\"', null, 'pattern');\n\t\t\t}\n\t\t},\n\t\tvalidDate: function (schema, candidate) {\n\t\t\tif (String(schema.validDate) === 'true' && candidate instanceof Date && isNaN(candidate.getTime())) {\n\t\t\t\tthis.report('must be a valid date', null, 'validDate');\n\t\t\t}\n\t\t},\n\t\tminLength: function (schema, candidate) {\n\t\t\tif (typeof candidate !== 'string' && !_typeIs.array(candidate)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar minLength = Number(schema.minLength);\n\t\t\tif (isNaN(minLength)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (candidate.length < minLength) {\n\t\t\t\tthis.report('must be longer than ' + minLength + ' elements, but it has ' + candidate.length, null, 'minLength');\n\t\t\t}\n\t\t},\n\t\tmaxLength: function (schema, candidate) {\n\t\t\tif (typeof candidate !== 'string' && !_typeIs.array(candidate)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar maxLength = Number(schema.maxLength);\n\t\t\tif (isNaN(maxLength)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (candidate.length > maxLength) {\n\t\t\t\tthis.report('must be shorter than ' + maxLength + ' elements, but it has ' + candidate.length, null, 'maxLength');\n\t\t\t}\n\t\t},\n\t\texactLength: function (schema, candidate) {\n\t\t\tif (typeof candidate !== 'string' && !_typeIs.array(candidate)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar exactLength = Number(schema.exactLength);\n\t\t\tif (isNaN(exactLength)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (candidate.length !== exactLength) {\n\t\t\t\tthis.report('must have exactly ' + exactLength + ' elements, but it have ' + candidate.length, null, 'exactLength');\n\t\t\t}\n\t\t},\n\t\tlt: function (schema, candidate) {\n\t\t\tvar limit = Number(schema.lt);\n\t\t\tif (typeof candidate !== 'number' || isNaN(limit)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (candidate >= limit) {\n\t\t\t\tthis.report('must be less than ' + limit + ', but is equal to \"' + candidate + '\"', null, 'lt');\n\t\t\t}\n\t\t},\n\t\tlte: function (schema, candidate) {\n\t\t\tvar limit = Number(schema.lte);\n\t\t\tif (typeof candidate !== 'number' || isNaN(limit)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (candidate > limit) {\n\t\t\t\tthis.report('must be less than or equal to ' + limit + ', but is equal to \"' + candidate + '\"', null, 'lte');\n\t\t\t}\n\t\t},\n\t\tgt: function (schema, candidate) {\n\t\t\tvar limit = Number(schema.gt);\n\t\t\tif (typeof candidate !== 'number' || isNaN(limit)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (candidate <= limit) {\n\t\t\t\tthis.report('must be greater than ' + limit + ', but is equal to \"' + candidate + '\"', null, 'gt');\n\t\t\t}\n\t\t},\n\t\tgte: function (schema, candidate) {\n\t\t\tvar limit = Number(schema.gte);\n\t\t\tif (typeof candidate !== 'number' || isNaN(limit)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (candidate < limit) {\n\t\t\t\tthis.report('must be greater than or equal to ' + limit + ', but is equal to \"' + candidate + '\"', null, 'gte');\n\t\t\t}\n\t\t},\n\t\teq: function (schema, candidate) {\n\t\t\tif (typeof candidate !== 'number' && typeof candidate !== 'string' && typeof candidate !== 'boolean') {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar limit = schema.eq;\n\t\t\tif (typeof limit !== 'number' && typeof limit !== 'string' && typeof limit !== 'boolean' && !_typeIs.array(limit)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (_typeIs.array(limit)) {\n\t\t\t\tfor (var i = 0; i < limit.length; i++) {\n\t\t\t\t\tif (candidate === limit[i]) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.report('must be equal to [' + limit.map(function (l) {\n\t\t\t\t\treturn '\"' + l + '\"';\n\t\t\t\t}).join(' or ') + '], but is equal to \"' + candidate + '\"', null, 'eq');\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (candidate !== limit) {\n\t\t\t\t\tthis.report('must be equal to \"' + limit + '\", but is equal to \"' + candidate + '\"', null, 'eq');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tne: function (schema, candidate) {\n\t\t\tif (typeof candidate !== 'number' && typeof candidate !== 'string') {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar limit = schema.ne;\n\t\t\tif (typeof limit !== 'number' && typeof limit !== 'string' && !_typeIs.array(limit)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (_typeIs.array(limit)) {\n\t\t\t\tfor (var i = 0; i < limit.length; i++) {\n\t\t\t\t\tif (candidate === limit[i]) {\n\t\t\t\t\t\tthis.report('must not be equal to \"' + limit[i] + '\"', null, 'ne');\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (candidate === limit) {\n\t\t\t\t\tthis.report('must not be equal to \"' + limit + '\"', null, 'ne');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tsomeKeys: function (schema, candidat) {\n\t\t\tvar _keys = schema.someKeys;\n\t\t\tif (!_typeIs.object(candidat)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar valid = _keys.some(function (action) {\n\t\t\t\treturn (action in candidat);\n\t\t\t});\n\t\t\tif (!valid) {\n\t\t\t\tthis.report('must have at least key ' + _keys.map(function (i) {\n\t\t\t\t\treturn '\"' + i + '\"';\n\t\t\t\t}).join(' or '), null, 'someKeys');\n\t\t\t}\n\t\t},\n\t\tstrict: function (schema, candidate) {\n\t\t\tif (typeof schema.strict === 'string') { schema.strict = (schema.strict === 'true'); }\n\t\t\tif (schema.strict !== true || !_typeIs.object(candidate) || !_typeIs.object(schema.properties)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar self = this;\n\t\t\tif (typeof schema.properties['*'] === 'undefined') {\n\t\t\t\tvar intruder = Object.keys(candidate).filter(function (key) {\n\t\t\t\t\treturn (typeof schema.properties[key] === 'undefined');\n\t\t\t\t});\n\t\t\t\tif (intruder.length > 0) {\n\t\t\t\t\tvar msg = 'should not contains ' + (intruder.length > 1 ? 'properties' : 'property') +\n\t\t\t\t\t\t' [' + intruder.map(function (i) { return '\"' + i + '\"'; }).join(', ') + ']';\n\t\t\t\t\tself.report(msg, null, 'strict');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\texec: function (schema, candidate, callback) {\n\t\t\tvar self = this;\n\n\t\t\tif (typeof callback === 'function') {\n\t\t\t\treturn this.asyncExec(schema, candidate, callback);\n\t\t\t}\n\t\t\t(_typeIs.array(schema.exec) ? schema.exec : [schema.exec]).forEach(function (exec) {\n\t\t\t\tif (typeof exec === 'function') {\n\t\t\t\t\texec.call(self, schema, candidate);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tproperties: function (schema, candidate, callback) {\n\t\t\tif (typeof callback === 'function') {\n\t\t\t\treturn this.asyncProperties(schema, candidate, callback);\n\t\t\t}\n\t\t\tif (!(schema.properties instanceof Object) || !(candidate instanceof Object)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar properties = schema.properties,\n\t\t\t\t\ti;\n\t\t\tif (properties['*'] != null) {\n\t\t\t\tfor (i in candidate) {\n\t\t\t\t\tif (i in properties) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tthis._deeperObject(i);\n\t\t\t\t\tthis._validate(properties['*'], candidate[i]);\n\t\t\t\t\tthis._back();\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (i in properties) {\n\t\t\t\tif (i === '*') {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tthis._deeperObject(i);\n\t\t\t\tthis._validate(properties[i], candidate[i]);\n\t\t\t\tthis._back();\n\t\t\t}\n\t\t},\n\t\titems: function (schema, candidate, callback) {\n\t\t\tif (typeof callback === 'function') {\n\t\t\t\treturn this.asyncItems(schema, candidate, callback);\n\t\t\t}\n\t\t\tif (!(schema.items instanceof Object) || !(candidate instanceof Object)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar items = schema.items;\n\t\t\tvar i, l;\n\t\t\t// If provided schema is an array\n\t\t\t// then call validate for each case\n\t\t\t// else it is an Object\n\t\t\t// then call validate for each key\n\t\t\tif (_typeIs.array(items) && _typeIs.array(candidate)) {\n\t\t\t\tfor (i = 0, l = items.length; i < l; i++) {\n\t\t\t\t\tthis._deeperArray(i);\n\t\t\t\t\tthis._validate(items[i], candidate[i]);\n\t\t\t\t\tthis._back();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfor (var key in candidate) {\n\t\t\t\t\tif (Object.prototype.hasOwnProperty.call(candidate, key)) {\n\t\t\t\t\t\tthis._deeperArray(key);\n\t\t\t\t\t\tthis._validate(items, candidate[key]);\n\t\t\t\t\t\tthis._back();\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tvar _asyncValidationAttribut = {\n\t\tasyncExec: function (schema, candidate, callback) {\n\t\t\tvar self = this;\n\t\t\tasync.eachSeries(_typeIs.array(schema.exec) ? schema.exec : [schema.exec], function (exec, done) {\n\t\t\t\tif (typeof exec === 'function') {\n\t\t\t\t\tif (exec.length > 2) {\n\t\t\t\t\t\treturn exec.call(self, schema, candidate, done);\n\t\t\t\t\t}\n\t\t\t\t\texec.call(self, schema, candidate);\n\t\t\t\t}\n\t\t\t\tasync.nextTick(done);\n\t\t\t}, callback);\n\t\t},\n\t\tasyncProperties: function (schema, candidate, callback) {\n\t\t\tif (!(schema.properties instanceof Object) || !_typeIs.object(candidate)) {\n\t\t\t\treturn callback();\n\t\t\t}\n\t\t\tvar self = this;\n\t\t\tvar properties = schema.properties;\n\t\t\tasync.series([\n\t\t\t\tfunction (next) {\n\t\t\t\t\tif (properties['*'] == null) {\n\t\t\t\t\t\treturn next();\n\t\t\t\t\t}\n\t\t\t\t\tasync.eachSeries(Object.keys(candidate), function (i, done) {\n\t\t\t\t\t\tif (i in properties) {\n\t\t\t\t\t\t\treturn async.nextTick(done);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tself._deeperObject(i);\n\t\t\t\t\t\tself._asyncValidate(properties['*'], candidate[i], function (err) {\n\t\t\t\t\t\t\tself._back();\n\t\t\t\t\t\t\tdone(err);\n\t\t\t\t\t\t});\n\t\t\t\t\t}, next);\n\t\t\t\t},\n\t\t\t\tfunction (next) {\n\t\t\t\t\tasync.eachSeries(Object.keys(properties), function (i, done) {\n\t\t\t\t\t\tif (i === '*') {\n\t\t\t\t\t\t\treturn async.nextTick(done);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tself._deeperObject(i);\n\t\t\t\t\t\tself._asyncValidate(properties[i], candidate[i], function (err) {\n\t\t\t\t\t\t\tself._back();\n\t\t\t\t\t\t\tdone(err);\n\t\t\t\t\t\t});\n\t\t\t\t\t}, next);\n\t\t\t\t}\n\t\t\t], callback);\n\t\t},\n\t\tasyncItems: function (schema, candidate, callback) {\n\t\t\tif (!(schema.items instanceof Object) || !(candidate instanceof Object)) {\n\t\t\t\treturn callback();\n\t\t\t}\n\t\t\tvar self = this;\n\t\t\tvar items = schema.items;\n\t\t\tvar i, l;\n\n\t\t\tif (_typeIs.array(items) && _typeIs.array(candidate)) {\n\t\t\t\tasync.timesSeries(items.length, function (i, done) {\n\t\t\t\t\tself._deeperArray(i);\n\t\t\t\t\tself._asyncValidate(items[i], candidate[i], function (err, res) {\n\t\t\t\t\t\tself._back();\n\t\t\t\t\t\tdone(err, res);\n\t\t\t\t\t});\n\t\t\t\t\tself._back();\n\t\t\t\t}, callback);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tasync.eachSeries(Object.keys(candidate), function (key, done) {\n\t\t\t\t\tself._deeperArray(key);\n\t\t\t\t\tself._asyncValidate(items, candidate[key], function (err, res) {\n\t\t\t\t\t\tself._back();\n\t\t\t\t\t\tdone(err, res);\n\t\t\t\t\t});\n\t\t\t\t}, callback);\n\t\t\t}\n\t\t}\n\t};\n\n\t// Validation Class ----------------------------------------------------------\n\t// inherits from Inspection class (actually we just call Inspection\n\t// constructor with the new context, because its prototype is empty\n\tfunction Validation(schema, custom) {\n\t\tInspection.prototype.constructor.call(this, schema, _merge(Validation.custom, custom));\n\t\tvar _error = [];\n\n\t\tthis._basicFields = Object.keys(_validationAttribut);\n\t\tthis._customFields = Object.keys(this._custom);\n\t\tthis.origin = null;\n\n\t\tthis.report = function (message, code, reason) {\n\t\t\tvar newErr = {\n\t\t\t\tcode: code || this.userCode || null,\n\t\t\t\treason: reason || 'unknown',\n\t\t\t\tmessage: this.userError || message || 'is invalid',\n\t\t\t\tproperty: this.userAlias ? (this.userAlias + ' (' + this._dumpStack() + ')') : this._dumpStack()\n\t\t\t};\n\t\t\t_error.push(newErr);\n\t\t\treturn this;\n\t\t};\n\n\t\tthis.result = function () {\n\t\t\treturn {\n\t\t\t\terror: _error,\n\t\t\t\tvalid: _error.length === 0,\n\t\t\t\tformat: function () {\n\t\t\t\t\tif (this.valid === true) {\n\t\t\t\t\t\treturn 'Candidate is valid';\n\t\t\t\t\t}\n\t\t\t\t\treturn this.error.map(function (i) {\n\t\t\t\t\t\treturn 'Property ' + i.property + ': ' + i.message;\n\t\t\t\t\t}).join('\\n');\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\t}\n\n\t_extend(Validation.prototype, _validationAttribut);\n\t_extend(Validation.prototype, _asyncValidationAttribut);\n\t_extend(Validation, new Customisable());\n\n\tValidation.prototype.validate = function (candidate, callback) {\n\t\tthis.origin = candidate;\n\t\tif (typeof callback === 'function') {\n\t\t\tvar self = this;\n\t\t\treturn async.nextTick(function () {\n\t\t\t\tself._asyncValidate(self._schema, candidate, function (err) {\n\t\t\t\t\tself.origin = null;\n\t\t\t\t\tcallback(err, self.result());\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\treturn this._validate(this._schema, candidate).result();\n\t};\n\n\tValidation.prototype._validate = function (schema, candidate, callback) {\n\t\tthis.userCode = schema.code || null;\n\t\tthis.userError = schema.error || null;\n\t\tthis.userAlias = schema.alias || null;\n\t\tthis._basicFields.forEach(function (i) {\n\t\t\tif ((i in schema || i === 'optional') && typeof this[i] === 'function') {\n\t\t\t\tthis[i](schema, candidate);\n\t\t\t}\n\t\t}, this);\n\t\tthis._customFields.forEach(function (i) {\n\t\t\tif (i in schema && typeof this._custom[i] === 'function') {\n\t\t\t\tthis._custom[i].call(this, schema, candidate);\n\t\t\t}\n\t\t}, this);\n\t\treturn this;\n\t};\n\n\tValidation.prototype._asyncValidate = function (schema, candidate, callback) {\n\t\tvar self = this;\n\t\tthis.userCode = schema.code || null;\n\t\tthis.userError = schema.error || null;\n\t\tthis.userAlias = schema.alias || null;\n\n\t\tasync.series([\n\t\t\tfunction (next) {\n\t\t\t\tasync.eachSeries(Object.keys(_validationAttribut), function (i, done) {\n\t\t\t\t\tasync.nextTick(function () {\n\t\t\t\t\t\tif ((i in schema || i === 'optional') && typeof self[i] === 'function') {\n\t\t\t\t\t\t\tif (self[i].length > 2) {\n\t\t\t\t\t\t\t\treturn self[i](schema, candidate, done);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tself[i](schema, candidate);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdone();\n\t\t\t\t\t});\n\t\t\t\t}, next);\n\t\t\t},\n\t\t\tfunction (next) {\n\t\t\t\tasync.eachSeries(Object.keys(self._custom), function (i, done) {\n\t\t\t\t\tasync.nextTick(function () {\n\t\t\t\t\t\tif (i in schema && typeof self._custom[i] === 'function') {\n\t\t\t\t\t\t\tif (self._custom[i].length > 2) {\n\t\t\t\t\t\t\t\treturn self._custom[i].call(self, schema, candidate, done);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tself._custom[i].call(self, schema, candidate);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdone();\n\t\t\t\t\t});\n\t\t\t\t}, next);\n\t\t\t}\n\t\t], callback);\n\t};\n\n// Sanitization ----------------------------------------------------------------\n\t// functions called by _sanitization.type method.\n\tvar _forceType = {\n\t\tnumber: function (post, schema) {\n\t\t\tvar n;\n\t\t\tif (typeof post === 'number') {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\telse if (post === '') {\n\t\t\t\tif (typeof schema.def !== 'undefined')\n\t\t\t\t\treturn schema.def;\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\telse if (typeof post === 'string') {\n\t\t\t\tn = parseFloat(post.replace(/,/g, '.').replace(/ /g, ''));\n\t\t\t\tif (typeof n === 'number') {\n\t\t\t\t\treturn n;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (post instanceof Date) {\n\t\t\t\treturn +post;\n\t\t\t}\n\t\t\treturn null;\n\t\t},\n\t\tinteger: function (post, schema) {\n\t\t\tvar n;\n\t\t\tif (typeof post === 'number' && post % 1 === 0) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\telse if (post === '') {\n\t\t\t\tif (typeof schema.def !== 'undefined')\n\t\t\t\t\treturn schema.def;\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\telse if (typeof post === 'string') {\n\t\t\t\tn = parseInt(post.replace(/ /g, ''), 10);\n\t\t\t\tif (typeof n === 'number') {\n\t\t\t\t\treturn n;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (typeof post === 'number') {\n\t\t\t\treturn parseInt(post, 10);\n\t\t\t}\n\t\t\telse if (typeof post === 'boolean') {\n\t\t\t\tif (post) { return 1; }\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\telse if (post instanceof Date) {\n\t\t\t\treturn +post;\n\t\t\t}\n\t\t\treturn null;\n\t\t},\n\t\tstring: function (post, schema) {\n\t\t\tif (typeof post === 'boolean' || typeof post === 'number' || post instanceof Date) {\n\t\t\t\treturn post.toString();\n\t\t\t}\n\t\t\telse if (_typeIs.array(post)) {\n\t\t\t\t// If user authorize array and strings...\n\t\t\t\tif (schema.items || schema.properties)\n\t\t\t\t\treturn post;\n\t\t\t\treturn post.join(String(schema.joinWith || ','));\n\t\t\t}\n\t\t\telse if (post instanceof Object) {\n\t\t\t\t// If user authorize objects ans strings...\n\t\t\t\tif (schema.items || schema.properties)\n\t\t\t\t\treturn post;\n\t\t\t\treturn JSON.stringify(post);\n\t\t\t}\n\t\t\telse if (typeof post === 'string' && post.length) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\treturn null;\n\t\t},\n\t\tdate: function (post, schema) {\n\t\t\tif (post instanceof Date) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar d = new Date(post);\n\t\t\t\tif (!isNaN(d.getTime())) { // if valid date\n\t\t\t\t\treturn d;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn null;\n\t\t},\n\t\tboolean: function (post, schema) {\n\t\t\tif (typeof post === 'undefined') return null;\n\t\t\tif (typeof post === 'string' && post.toLowerCase() === 'false') return false;\n\t\t\treturn !!post;\n\t\t},\n\t\tobject: function (post, schema) {\n\t\t\tif (typeof post !== 'string' || _typeIs.object(post)) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\ttry {\n\t\t\t\treturn JSON.parse(post);\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tarray: function (post, schema) {\n\t\t\tif (_typeIs.array(post))\n\t\t\t\treturn post;\n\t\t\tif (typeof post === 'undefined')\n\t\t\t\treturn null;\n\t\t\tif (typeof post === 'string') {\n\t\t\t\tif (post.substring(0,1) === '[' && post.slice(-1) === ']') {\n\t\t\t\t\ttry {\n\t\t\t\t\t\treturn JSON.parse(post);\n\t\t\t\t\t}\n\t\t\t\t\tcatch (e) {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn post.split(String(schema.splitWith || ','));\n\n\t\t\t}\n\t\t\tif (!_typeIs.array(post))\n\t\t\t\treturn [ post ];\n\t\t\treturn null;\n\t\t}\n\t};\n\n\tvar _applyRules = {\n\t\tupper: function (post) {\n\t\t\treturn post.toUpperCase();\n\t\t},\n\t\tlower: function (post) {\n\t\t\treturn post.toLowerCase();\n\t\t},\n\t\ttitle: function (post) {\n\t\t\t// Fix by seb (replace \\w\\S* by \\S* => exemple : coucou \u00e7a va)\n\t\t\treturn post.replace(/\\S*/g, function (txt) {\n\t\t\t\treturn txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();\n\t\t\t});\n\t\t},\n\t\tcapitalize: function (post) {\n\t\t\treturn post.charAt(0).toUpperCase() + post.substr(1).toLowerCase();\n\t\t},\n\t\tucfirst: function (post) {\n\t\t\treturn post.charAt(0).toUpperCase() + post.substr(1);\n\t\t},\n\t\ttrim: function (post) {\n\t\t\treturn post.trim();\n\t\t}\n\t};\n\n\t// Every function return the future value of each property. Therefore you\n\t// have to return post even if you do not change its value\n\tvar _sanitizationAttribut = {\n\t\tstrict: function (schema, post) {\n\t\t\tif (typeof schema.strict === 'string') { schema.strict = (schema.strict === 'true'); }\n\t\t\tif (schema.strict !== true)\n\t\t\t\treturn post;\n\t\t\tif (!_typeIs.object(schema.properties))\n\t\t\t\treturn post;\n\t\t\tif (!_typeIs.object(post))\n\t\t\t\treturn post;\n\t\t\tvar that = this;\n\t\t\tObject.keys(post).forEach(function (key) {\n\t\t\t\tif (!(key in schema.properties)) {\n\t\t\t\t\tdelete post[key];\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn post;\n\t\t},\n\t\toptional: function (schema, post) {\n\t\t\tvar opt = typeof schema.optional === 'boolean' ? schema.optional : (schema.optional !== 'false'); // Default: true\n\t\t\tif (opt === true) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tif (typeof post !== 'undefined') {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tthis.report();\n\t\t\tif (schema.def === Date) {\n\t\t\t\treturn new Date();\n\t\t\t}\n\t\t\treturn schema.def;\n\t\t},\n\t\ttype: function (schema, post) {\n\t\t\t// if (_typeIs['object'](post) || _typeIs.array(post)) {\n\t\t\t// \treturn post;\n\t\t\t// }\n\t\t\tif (typeof schema.type !== 'string' || typeof _forceType[schema.type] !== 'function') {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tvar n;\n\t\t\tvar opt = typeof schema.optional === 'boolean' ? schema.optional : true;\n\t\t\tif (typeof _forceType[schema.type] === 'function') {\n\t\t\t\tn = _forceType[schema.type](post, schema);\n\t\t\t\tif ((n === null && !opt) || (!n && isNaN(n)) || (n === null && schema.type === 'string')) {\n\t\t\t\t\tn = schema.def;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (!opt) {\n\t\t\t\tn = schema.def;\n\t\t\t}\n\t\t\tif ((n != null || (typeof schema.def !== 'undefined' && schema.def === n)) && n !== post) {\n\t\t\t\tthis.report();\n\t\t\t\treturn n;\n\t\t\t}\n\t\t\treturn post;\n\t\t},\n\t\trules: function (schema, post) {\n\t\t\tvar rules = schema.rules;\n\t\t\tif (typeof post !== 'string' || (typeof rules !== 'string' && !_typeIs.array(rules))) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tvar modified = false;\n\t\t\t(_typeIs.array(rules) ? rules : [rules]).forEach(function (rule) {\n\t\t\t\tif (typeof _applyRules[rule] === 'function') {\n\t\t\t\t\tpost = _applyRules[rule](post);\n\t\t\t\t\tmodified = true;\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (modified) {\n\t\t\t\tthis.report();\n\t\t\t}\n\t\t\treturn post;\n\t\t},\n\t\tmin: function (schema, post) {\n\t\t\tvar postTest = Number(post);\n\t\t\tif (isNaN(postTest)) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tvar min = Number(schema.min);\n\t\t\tif (isNaN(min)) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tif (postTest < min) {\n\t\t\t\tthis.report();\n\t\t\t\treturn min;\n\t\t\t}\n\t\t\treturn post;\n\t\t},\n\t\tmax: function (schema, post) {\n\t\t\tvar postTest = Number(post);\n\t\t\tif (isNaN(postTest)) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tvar max = Number(schema.max);\n\t\t\tif (isNaN(max)) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tif (postTest > max) {\n\t\t\t\tthis.report();\n\t\t\t\treturn max;\n\t\t\t}\n\t\t\treturn post;\n\t\t},\n\t\tminLength: function (schema, post) {\n\t\t\tvar limit = Number(schema.minLength);\n\t\t\tif (typeof post !== 'string' || isNaN(limit) || limit < 0) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tvar str = '';\n\t\t\tvar gap = limit - post.length;\n\t\t\tif (gap > 0) {\n\t\t\t\tfor (var i = 0; i < gap; i++) {\n\t\t\t\t\tstr += '-';\n\t\t\t\t}\n\t\t\t\tthis.report();\n\t\t\t\treturn post + str;\n\t\t\t}\n\t\t\treturn post;\n\t\t},\n\t\tmaxLength: function (schema, post) {\n\t\t\tvar limit = Number(schema.maxLength);\n\t\t\tif (typeof post !== 'string' || isNaN(limit) || limit < 0) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tif (post.length > limit) {\n\t\t\t\tthis.report();\n\t\t\t\treturn post.slice(0, limit);\n\t\t\t}\n\t\t\treturn post;\n\t\t},\n\t\tproperties: function (schema, post, callback) {\n\t\t\tif (typeof callback === 'function') {\n\t\t\t\treturn this.asyncProperties(schema, post, callback);\n\t\t\t}\n\t\t\tif (!post || typeof post !== 'object') {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tvar properties = schema.properties;\n\t\t\tvar tmp;\n\t\t\tvar i;\n\t\t\tif (typeof properties['*'] !== 'undefined') {\n\t\t\t\tfor (i in post) {\n\t\t\t\t\tif (i in properties) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tthis._deeperObject(i);\n\t\t\t\t\ttmp = this._sanitize(schema.properties['*'], post[i]);\n\t\t\t\t\tif (typeof tmp !== 'undefined') {\n\t\t\t\t\t\tpost[i]= tmp;\n\t\t\t\t\t}\n\t\t\t\t\tthis._back();\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (i in schema.properties) {\n\t\t\t\tif (i !== '*') {\n\t\t\t\t\tthis._deeperObject(i);\n\t\t\t\t\ttmp = this._sanitize(schema.properties[i], post[i]);\n\t\t\t\t\tif (typeof tmp !== 'undefined') {\n\t\t\t\t\t\tpost[i]= tmp;\n\t\t\t\t\t}\n\t\t\t\t\tthis._back();\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn post;\n\t\t},\n\t\titems: function (schema, post, callback) {\n\t\t\tif (typeof callback === 'function') {\n\t\t\t\treturn this.asyncItems(schema, post, callback);\n\t\t\t}\n\t\t\tif (!(schema.items instanceof Object) || !(post instanceof Object)) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tvar i;\n\t\t\tif (_typeIs.array(schema.items) && _typeIs.array(post)) {\n\t\t\t\tvar minLength = schema.items.length < post.length ? schema.items.length : post.length;\n\t\t\t\tfor (i = 0; i < minLength; i++) {\n\t\t\t\t\tthis._deeperArray(i);\n\t\t\t\t\tpost[i] = this._sanitize(schema.items[i], post[i]);\n\t\t\t\t\tthis._back();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfor (i in post) {\n\t\t\t\t\tif (Object.prototype.hasOwnProperty.call(post, i)) {\n\t\t\t\t\t\tthis._deeperArray(i);\n\t\t\t\t\t\tpost[i] = this._sanitize(schema.items, post[i]);\n\t\t\t\t\t\tthis._back();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn post;\n\t\t},\n\t\texec: function (schema, post, callback) {\n\t\t\tif (typeof callback === 'function') {\n\t\t\t\treturn this.asyncExec(schema, post, callback);\n\t\t\t}\n\t\t\tvar execs = _typeIs.array(schema.exec) ? schema.exec : [schema.exec];\n\n\t\t\texecs.forEach(function (exec) {\n\t\t\t\tif (typeof exec === 'function') {\n\t\t\t\t\tpost = exec.call(this, schema, post);\n\t\t\t\t}\n\t\t\t}, this);\n\t\t\treturn post;\n\t\t}\n\t};\n\n\tvar _asyncSanitizationAttribut = {\n\t\tasyncExec: function (schema, post, callback) {\n\t\t\tvar self = this;\n\t\t\tvar execs = _typeIs.array(schema.exec) ? schema.exec : [schema.exec];\n\n\t\t\tasync.eachSeries(execs, function (exec, done) {\n\t\t\t\tif (typeof exec === 'function') {\n\t\t\t\t\tif (exec.length > 2) {\n\t\t\t\t\t\treturn exec.call(self, schema, post, function (err, res) {\n\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\treturn done(err);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tpost = res;\n\t\t\t\t\t\t\tdone();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tpost = exec.call(self, schema, post);\n\t\t\t\t}\n\t\t\t\tdone();\n\t\t\t}, function (err) {\n\t\t\t\tcallback(err, post);\n\t\t\t});\n\t\t},\n\t\tasyncProperties: function (schema, post, callback) {\n\t\t\tif (!post || typeof post !== 'object') {\n\t\t\t\treturn callback(null, post);\n\t\t\t}\n\t\t\tvar self = this;\n\t\t\tvar properties = schema.properties;\n\n\t\t\tasync.series([\n\t\t\t\tfunction (next) {\n\t\t\t\t\tif (properties['*'] == null) {\n\t\t\t\t\t\treturn next();\n\t\t\t\t\t}\n\t\t\t\t\tvar globing = properties['*'];\n\t\t\t\t\tasync.eachSeries(Object.keys(post), function (i, next) {\n\t\t\t\t\t\tif (i in properties) {\n\t\t\t\t\t\t\treturn next();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tself._deeperObject(i);\n\t\t\t\t\t\tself._asyncSanitize(globing, post[i], function (err, res) {\n\t\t\t\t\t\t\tif (err) { /* Error can safely be ignored here */ }\n\t\t\t\t\t\t\tif (typeof res !== 'undefined') {\n\t\t\t\t\t\t\t\tpost[i] = res;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tself._back();\n\t\t\t\t\t\t\tnext();\n\t\t\t\t\t\t});\n\t\t\t\t\t}, next);\n\t\t\t\t},\n\t\t\t\tfunction (next) {\n\t\t\t\t\tasync.eachSeries(Object.keys(properties), function (i, next) {\n\t\t\t\t\t\tif (i === '*') {\n\t\t\t\t\t\t\treturn next();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tself._deeperObject(i);\n\t\t\t\t\t\tself._asyncSanitize(properties[i], post[i], function (err, res) {\n\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\treturn next(err);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (typeof res !== 'undefined') {\n\t\t\t\t\t\t\t\tpost[i] = res;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tself._back();\n\t\t\t\t\t\t\tnext();\n\t\t\t\t\t\t});\n\t\t\t\t\t}, next);\n\t\t\t\t}\n\t\t\t], function (err) {\n\t\t\t\treturn callback(err, post);\n\t\t\t});\n\t\t},\n\t\tasyncItems: function (schema, post, callback) {\n\t\t\tif (!(schema.items instanceof Object) || !(post instanceof Object)) {\n\t\t\t\treturn callback(null, post);\n\t\t\t}\n\t\t\tvar self = this;\n\t\t\tvar items = schema.items;\n\t\t\tif (_typeIs.array(items) && _typeIs.array(post)) {\n\t\t\t\tvar minLength = items.length < post.length ? items.length : post.length;\n\t\t\t\tasync.timesSeries(minLength, function (i, next) {\n\t\t\t\t\tself._deeperArray(i);\n\t\t\t\t\tself._asyncSanitize(items[i], post[i], function (err, res) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\treturn next(err);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tpost[i] = res;\n\t\t\t\t\t\tself._back();\n\t\t\t\t\t\tnext();\n\t\t\t\t\t});\n\t\t\t\t}, function (err) {\n\t\t\t\t\tcallback(err, post);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse {\n\t\t\t\tasync.eachSeries(Object.keys(post), function (key, next) {\n\t\t\t\t\tself._deeperArray(key);\n\t\t\t\t\tself._asyncSanitize(items, post[key], function (err, res) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\treturn next();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tpost[key] = res;\n\t\t\t\t\t\tself._back();\n\t\t\t\t\t\tnext();\n\t\t\t\t\t});\n\t\t\t\t}, function (err) {\n\t\t\t\t\tcallback(err, post);\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn post;\n\t\t}\n\t};\n\n\t// Sanitization Class --------------------------------------------------------\n\t// inherits from Inspection class (actually we just call Inspection\n\t// constructor with the new context, because its prototype is empty\n\tfunction Sanitization(schema, custom) {\n\t\tInspection.prototype.constructor.call(this, schema, _merge(Sanitization.custom, custom));\n\t\tvar _reporting = [];\n\n\t\tthis._basicFields = Object.keys(_sanitizationAttribut);\n\t\tthis._customFields = Object.keys(this._custom);\n\t\tthis.origin = null;\n\n\t\tthis.report = function (message) {\n\t\t\tvar newNot = {\n\t\t\t\t\tmessage: message || 'was sanitized',\n\t\t\t\t\tproperty: this.userAlias ? (this.userAlias + ' (' + this._dumpStack() + ')') : this._dumpStack()\n\t\t\t};\n\t\t\tif (!_reporting.some(function (e) { return e.property === newNot.property; })) {\n\t\t\t\t_reporting.push(newNot);\n\t\t\t}\n\t\t};\n\n\t\tthis.result = function (data) {\n\t\t\treturn {\n\t\t\t\tdata: data,\n\t\t\t\treporting: _reporting,\n\t\t\t\tformat: function () {\n\t\t\t\t\treturn this.reporting.map(function (i) {\n\t\t\t\t\t\treturn 'Property ' + i.property + ' ' + i.message;\n\t\t\t\t\t}).join('\\n');\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\t}\n\n\t_extend(Sanitization.prototype, _sanitizationAttribut);\n\t_extend(Sanitization.prototype, _asyncSanitizationAttribut);\n\t_extend(Sanitization, new Customisable());\n\n\n\tSanitization.prototype.sanitize = function (post, callback) {\n\t\tthis.origin = post;\n\t\tif (typeof callback === 'function') {\n\t\t\tvar self = this;\n\t\t\treturn this._asyncSanitize(this._schema, post, function (err, data) {\n\t\t\t\tself.origin = null;\n\t\t\t\tcallback(err, self.result(data));\n\t\t\t});\n\t\t}\n\t\tvar data = this._sanitize(this._schema, post);\n\t\tthis.origin = null;\n\t\treturn this.result(data);\n\t};\n\n\tSanitization.prototype._sanitize = function (schema, post) {\n\t\tthis.userAlias = schema.alias || null;\n\t\tthis._basicFields.forEach(function (i) {\n\t\t\tif ((i in schema || i === 'optional') && typeof this[i] === 'function') {\n\t\t\t\tpost = this[i](schema, post);\n\t\t\t}\n\t\t}, this);\n\t\tthis._customFields.forEach(function (i) {\n\t\t\tif (i in schema && typeof this._custom[i] === 'function') {\n\t\t\t\tpost = this._custom[i].call(this, schema, post);\n\t\t\t}\n\t\t}, this);\n\t\treturn post;\n\t};\n\n\tSanitization.prototype._asyncSanitize = function (schema, post, callback) {\n\t\tvar self = this;\n\t\tthis.userAlias = schema.alias || null;\n\n\t\tasync.waterfall([\n\t\t\tfunction (next) {\n\t\t\t\tasync.reduce(self._basicFields, post, function (value, i, next) {\n\t\t\t\t\tasync.nextTick(function () {\n\t\t\t\t\t\tif ((i in schema || i === 'optional') && typeof self[i] === 'function') {\n\t\t\t\t\t\t\tif (self[i].length > 2) {\n\t\t\t\t\t\t\t\treturn self[i](schema, value, next);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvalue = self[i](schema, value);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnext(null, value);\n\t\t\t\t\t});\n\t\t\t\t}, next);\n\t\t\t},\n\t\t\tfunction (inter, next) {\n\t\t\t\tasync.reduce(self._customFields, inter, function (value, i, next) {\n\t\t\t\t\tasync.nextTick(function () {\n\t\t\t\t\t\tif (i in schema && typeof self._custom[i] === 'function') {\n\t\t\t\t\t\t\tif (self._custom[i].length > 2) {\n\t\t\t\t\t\t\t\treturn self._custom[i].call(self, schema, value, next);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvalue = self._custom[i].call(self, schema, value);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnext(null, value);\n\t\t\t\t\t});\n\t\t\t\t}, next);\n\t\t\t}\n\t\t], callback);\n\t};\n\n\t// ---------------------------------------------------------------------------\n\n\tvar INT_MIN = -2147483648;\n\tvar INT_MAX = 2147483647;\n\n\tvar _rand = {\n\t\tint: function (min, max) {\n\t\t\treturn min + (0 | Math.random() * (max - min + 1));\n\t\t},\n\t\tfloat: function (min, max) {\n\t\t\treturn (Math.random() * (max - min) + min);\n\t\t},\n\t\tbool: function () {\n\t\t\treturn (Math.random() > 0.5);\n\t\t},\n\t\tchar: function (min, max) {\n\t\t\treturn String.fromCharCode(this.int(min, max));\n\t\t},\n\t\tfromList: function (list) {\n\t\t\treturn list[this.int(0, list.length - 1)];\n\t\t}\n\t};\n\n\tvar _formatSample = {\n\t\t'date-time': function () {\n\t\t\treturn new Date().toISOString();\n\t\t},\n\t\t'date': function () {\n\t\t\treturn new Date().toISOString().replace(/T.*$/, '');\n\t\t},\n\t\t'time': function () {\n\t\t\treturn new Date().toLocaleTimeString({}, { hour12: false });\n\t\t},\n\t\t'color': function (min, max) {\n\t\t\tvar s = '#';\n\t\t\tif (min < 1) {\n\t\t\t\tmin = 1;\n\t\t\t}\n\t\t\tfor (var i = 0, l = _rand.int(min, max); i < l; i++) {\n\t\t\t\ts += _rand.fromList('0123456789abcdefABCDEF');\n\t\t\t}\n\t\t\treturn s;\n\t\t},\n\t\t'numeric': function () {\n\t\t\treturn '' + _rand.int(0, INT_MAX);\n\t\t},\n\t\t'integer': function () {\n\t\t\tif (_rand.bool() === true) {\n\t\t\t\treturn '-' + this.numeric();\n\t\t\t}\n\t\t\treturn this.numeric();\n\t\t},\n\t\t'decimal': function () {\n\t\t\treturn this.integer() + '.' + this.numeric();\n\t\t},\n\t\t'alpha': function (min, max) {\n\t\t\tvar s = '';\n\t\t\tif (min < 1) {\n\t\t\t\tmin = 1;\n\t\t\t}\n\t\t\tfor (var i = 0, l = _rand.int(min, max); i < l; i++) {\n\t\t\t\ts += _rand.fromList('abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ');\n\t\t\t}\n\t\t\treturn s;\n\t\t},\n\t\t'alphaNumeric': function (min, max) {\n\t\t\tvar s = '';\n\t\t\tif (min < 1) {\n\t\t\t\tmin = 1;\n\t\t\t}\n\t\t\tfor (var i = 0, l = _rand.int(min, max); i < l; i++) {\n\t\t\t\ts += _rand.fromList('abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789');\n\t\t\t}\n\t\t\treturn s;\n\t\t},\n\t\t'alphaDash': function (min, max) {\n\t\t\tvar s = '';\n\t\t\tif (min < 1) {\n\t\t\t\tmin = 1;\n\t\t\t}\n\t\t\tfor (var i = 0, l = _rand.int(min, max); i < l; i++) {\n\t\t\t\ts += _rand.fromList('_-abcdefghijklmnopqrstuvwxyz_-ABCDEFGHIJKLMNOPQRSTUVWXYZ_-0123456789_-');\n\t\t\t}\n\t\t\treturn s;\n\t\t},\n\t\t'javascript': function (min, max) {\n\t\t\tvar s = _rand.fromList('_$abcdefghijklmnopqrstuvwxyz_$ABCDEFGHIJKLMNOPQRSTUVWXYZ_$');\n\t\t\tfor (var i = 0, l = _rand.int(min, max - 1); i < l; i++) {\n\t\t\t\ts += _rand.fromList('_$abcdefghijklmnopqrstuvwxyz_$ABCDEFGHIJKLMNOPQRSTUVWXYZ_$0123456789_$');\n\t\t\t}\n\t\t\treturn s;\n\t\t}\n\t};\n\n\tfunction _getLimits(schema) {\n\t\tvar min = INT_MIN;\n\t\tvar max = INT_MAX;\n\n\t\tif (schema.gte != null) {\n\t\t\tmin = schema.gte;\n\t\t}\n\t\telse if (schema.gt != null) {\n\t\t\tmin = schema.gt + 1;\n\t\t}\n\t\tif (schema.lte != null) {\n\t\t\tmax = schema.lte;\n\t\t}\n\t\telse if (schema.lt != null) {\n\t\t\tmax = schema.lt - 1;\n\t\t}\n\t\treturn { min: min, max: max };\n\t}\n\n\tvar _typeGenerator = {\n\t\tstring: function (schema) {\n\t\t\tif (schema.eq != null) {\n\t\t\t\treturn schema.eq;\n\t\t\t}\n\t\t\tvar s = '';\n\t\t\tvar minLength = schema.minLength != null ? schema.minLength : 0;\n\t\t\tvar maxLength = schema.maxLength != null ? schema.maxLength : 32;\n\t\t\tif (typeof schema.pattern === 'string' && typeof _formatSample[schema.pattern] === 'function') {\n\t\t\t\treturn _formatSample[schema.pattern](minLength, maxLength);\n\t\t\t}\n\n\t\t\tvar l = schema.exactLength != null ? schema.exactLength : _rand.int(minLength, maxLength);\n\t\t\tfor (var i = 0; i < l; i++) {\n\t\t\t\ts += _rand.char(32, 126);\n\t\t\t}\n\t\t\treturn s;\n\t\t},\n\t\tnumber: function (schema) {\n\t\t\tif (schema.eq != null) {\n\t\t\t\treturn schema.eq;\n\t\t\t}\n\t\t\tvar limit = _getLimits(schema);\n\t\t\tvar n = _rand.float(limit.min, limit.max);\n\t\t\tif (schema.ne != null) {\n\t\t\t\tvar ne = _typeIs.array(schema.ne) ? schema.ne : [schema.ne];\n\t\t\t\twhile (ne.indexOf(n) !== -1) {\n\t\t\t\t\tn = _rand.float(limit.min, limit.max);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn n;\n\t\t},\n\t\tinteger: function (schema) {\n\t\t\tif (schema.eq != null) {\n\t\t\t\treturn schema.eq;\n\t\t\t}\n\t\t\tvar limit = _getLimits(schema);\n\t\t\tvar n = _rand.int(limit.min, limit.max);\n\t\t\tif (schema.ne != null) {\n\t\t\t\tvar ne = _typeIs.array(schema.ne) ? schema.ne : [schema.ne];\n\t\t\t\twhile (ne.indexOf(n) !== -1) {\n\t\t\t\t\tn = _rand.int(limit.min, limit.max);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn n;\n\t\t},\n\t\tboolean: function (schema) {\n\t\t\tif (schema.eq != null) {\n\t\t\t\treturn schema.eq;\n\t\t\t}\n\t\t\treturn _rand.bool();\n\t\t},\n\t\t\"null\": function (schema) {\n\t\t\treturn null;\n\t\t},\n\t\tdate: function (schema) {\n\t\t\tif (schema.eq != null) {\n\t\t\t\treturn schema.eq;\n\t\t\t}\n\t\t\treturn new Date();\n\t\t},\n\t\tobject: function (schema) {\n\t\t\tvar o = {};\n\t\t\tvar prop = schema.properties || {};\n\n\t\t\tfor (var key in prop) {\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(prop, key)) {\n\t\t\t\t\tif (prop[key].optional === true && _rand.bool() === true) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tif (key !== '*') {\n\t\t\t\t\t\to[key] = this.generate(prop[key]);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tvar rk = '__random_key_';\n\t\t\t\t\t\tvar randomKey = rk + 0;\n\t\t\t\t\t\tvar n = _rand.int(1, 9);\n\t\t\t\t\t\tfor (var i = 1; i <= n; i++) {\n\t\t\t\t\t\t\tif (!(randomKey in prop)) {\n\t\t\t\t\t\t\t\to[randomKey] = this.generate(prop[key]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\trandomKey = rk + i;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn o;\n\t\t},\n\t\tarray: function (schema) {\n\t\t\tvar self = this;\n\t\t\tvar items = schema.items || {};\n\t\t\tvar minLength = schema.minLength != null ? schema.minLength : 0;\n\t\t\tvar maxLength = schema.maxLength != null ? schema.maxLength : 16;\n\t\t\tvar type;\n\t\t\tvar candidate;\n\t\t\tvar size;\n\t\t\tvar i;\n\n\t\t\tif (_typeIs.array(items)) {\n\t\t\t\tsize = items.length;\n\t\t\t\tif (schema.exactLength != null) {\n\t\t\t\t\tsize = schema.exactLength;\n\t\t\t\t}\n\t\t\t\telse if (size < minLength) {\n\t\t\t\t\tsize = minLength;\n\t\t\t\t}\n\t\t\t\telse if (size > maxLength) {\n\t\t\t\t\tsize = maxLength;\n\t\t\t\t}\n\t\t\t\tcandidate = new Array(size);\n\t\t\t\ttype = null;\n\t\t\t\tfor (i = 0; i < size; i++) {\n\t\t\t\t\ttype = items[i].type || 'any';\n\t\t\t\t\tif (_typeIs.array(type)) {\n\t\t\t\t\t\ttype = type[_rand.int(0, type.length - 1)];\n\t\t\t\t\t}\n\t\t\t\t\tcandidate[i] = self[type](items[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tsize = schema.exactLength != null ? schema.exactLength : _rand.int(minLength, maxLength);\n\t\t\t\tcandidate = new Array(size);\n\t\t\t\ttype = items.type || 'any';\n\t\t\t\tif (_typeIs.array(type)) {\n\t\t\t\t\ttype = type[_rand.int(0, type.length - 1)];\n\t\t\t\t}\n\t\t\t\tfor (i = 0; i < size; i++) {\n\t\t\t\t\tcandidate[i] = self[type](items);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn candidate;\n\t\t},\n\t\tany: function (schema) {\n\t\t\tvar fields = Object.keys(_typeGenerator);\n\t\t\tvar i = fields[_rand.int(0, fields.length - 2)];\n\t\t\treturn this[i](schema);\n\t\t}\n\t};\n\n\t// CandidateGenerator Class (Singleton) --------------------------------------\n\tfunction CandidateGenerator() {\n\t\t// Maybe extends Inspection class too ?\n\t}\n\n\t_extend(CandidateGenerator.prototype, _typeGenerator);\n\n\tvar _instance = null;\n\tCandidateGenerator.instance = function () {\n\t\tif (!(_instance instanceof CandidateGenerator)) {\n\t\t\t_instance = new CandidateGenerator();\n\t\t}\n\t\treturn _instance;\n\t};\n\n\tCandidateGenerator.prototype.generate = function (schema) {\n\t\tvar type = schema.type || 'any';\n\t\tif (_typeIs.array(type)) {\n\t\t\ttype = type[_rand.int(0, type.length - 1)];\n\t\t}\n\t\treturn this[type](schema);\n\t};\n\n// Exports ---------------------------------------------------------------------\n\tvar SchemaInspector = {};\n\n\t// if server-side (node.js) else client-side\n\tif (typeof module !== 'undefined' && module.exports) {\n\t\tmodule.exports = SchemaInspector;\n\t}\n\telse {\n\t\twindow.SchemaInspector = SchemaInspector;\n\t}\n\n\tSchemaInspector.newSanitization = function (schema, custom) {\n\t\treturn new Sanitization(schema, custom);\n\t};\n\n\tSchemaInspector.newValidation = function (schema, custom) {\n\t\treturn new Validation(schema, custom);\n\t};\n\n\tSchemaInspector.Validation = Validation;\n\tSchemaInspector.Sanitization = Sanitization;\n\n\tSchemaInspector.sanitize = function (schema, post, custom, callback) {\n\t\tif (arguments.length === 3 && typeof custom === 'function') {\n\t\t\tcallback = custom;\n\t\t\tcustom = null;\n\t\t}\n\t\treturn new Sanitization(schema, custom).sanitize(post, callback);\n\t};\n\n\tSchemaInspector.validate = function (schema, candidate, custom, callback) {\n\t\tif (arguments.length === 3 && typeof custom === 'function') {\n\t\t\tcallback = custom;\n\t\t\tcustom = null;\n\t\t}\n\t\treturn new Validation(schema, custom).validate(candidate, callback);\n\t};\n\n\tSchemaInspector.generate = function (schema, n) {\n\t\tif (typeof n === 'number') {\n\t\t\tvar r = new Array(n);\n\t\t\tfor (var i = 0; i < n; i++) {\n\t\t\t\tr[i] = CandidateGenerator.instance().generate(schema);\n\t\t\t}\n\t\t\treturn r;\n\t\t}\n\t\treturn CandidateGenerator.instance().generate(schema);\n\t};\n})();\n"], "filenames": ["lib/schema-inspector.js"], "buggy_code_start_loc": [83], "buggy_code_end_loc": [1434], "fixing_code_start_loc": [83], "fixing_code_end_loc": [1434], "type": "CWE-668", "message": "In schema-inspector before 1.6.9, a maliciously crafted JavaScript object can bypass the `sanitize()` and the `validate()` function used within schema-inspector.", "other": {"cve": {"id": "CVE-2019-10781", "sourceIdentifier": "report@snyk.io", "published": "2020-01-22T14:15:11.497", "lastModified": "2020-01-29T17:35:35.183", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "In schema-inspector before 1.6.9, a maliciously crafted JavaScript object can bypass the `sanitize()` and the `validate()` function used within schema-inspector."}, {"lang": "es", "value": "En schema-inspector versiones anteriores a 1.6.9, un objeto JavaScript creado maliciosamente puede omitir las funciones \"sanitize()\" y \"validate()\" utilizadas dentro de schema-inspector."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.8, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.9, "impactScore": 5.9}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:N/C:P/I:P/A:P", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "NONE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 7.5}, "baseSeverity": "HIGH", "exploitabilityScore": 10.0, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-668"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:schema-inspector_project:schema-inspector:*:*:*:*:*:*:*:*", "versionEndExcluding": "1.6.9", "matchCriteriaId": "51F53F6C-0F66-40E8-9C48-3CC7ED00726C"}]}]}], "references": [{"url": "https://github.com/Atinux/schema-inspector/commit/345a7b2eed11bb6128421150d65f4f83fdbb737d", "source": "report@snyk.io", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://snyk.io/vuln/SNYK-JS-SCHEMAINSPECTOR-536970", "source": "report@snyk.io", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/Atinux/schema-inspector/commit/345a7b2eed11bb6128421150d65f4f83fdbb737d"}}