{"buggy_code": ["<?php\n\n/**\n * edit entry panel\n *\n * Type:\n * Name:\n * Date:\n * Purpose:\n * Input:\n *\n * @author NoWhereMan <real_nowhereman at users dot sf dot com>\n *        \n */\n\n// require (ADMIN_DIR . 'panels/entry/shared.entry.form.php');\n\n// ---------------------------------------------------------------------\n// utils\n// ---------------------------------------------------------------------\nfunction smarty_function_flag_classes($params, &$smarty) {\n\t$flags = entry_flags_get();\n\t($active_flags = array_intersect($smarty->getTemplateVars('categories'), $flags));\n\treturn implode(' ', $active_flags);\n}\n\nclass admin_entry_list extends AdminPanelActionValidated {\n\n\tvar $actionname = 'list';\n\n\tfunction setup() {\n\t\t$this->smarty->registerPlugin('function', 'flag_classes', 'smarty_function_flag_classes');\n\t}\n\n\tfunction main() {\n\t\tparent::main();\n\t\t// $smarty = $this->smarty;\n\n\t\t// parameters for the list\n\t\t// start offset and count (now defaults to 8...)\n\n\t\t$this->smarty->assign('categories_all', entry_categories_get('defs'));\n\t\t$this->smarty->assign('saved_flags', entry_flags_get());\n\n\t\t$defcount = 8; // <-- no magic numbers! todo: add config option?\n\n\t\tglobal $fpdb;\n\n\t\tif (!empty($_REQUEST ['entry']))\n\t\t\tutils_redirect('admin.php?p=entry&action=write&entry=' . $_REQUEST ['entry']);\n\n\t\tisset($_REQUEST ['m']) ? $params ['m'] = $_REQUEST ['m'] : null;\n\t\tisset($_REQUEST ['y']) ? $params ['y'] = $_REQUEST ['y'] : null;\n\t\t// $params['start'] = isset($_REQUEST['start'])? $_REQUEST['start'] : 0;\n\t\t$params ['count'] = isset($_REQUEST ['count']) ? $_REQUEST ['count'] : $defcount;\n\t\t$params ['page'] = isset($_REQUEST ['paged']) ? $_REQUEST ['paged'] : 1;\n\t\tisset($_REQUEST ['category']) ? $params ['category'] = $_REQUEST ['category'] : $params ['category'] = 'all';\n\t\t$params ['fullparse'] = false;\n\t\t$params ['comments'] = true;\n\t\t$fpdb->query($params);\n\n\t\treturn 0;\n\t}\n\n\tfunction onsubmit($data = null) {\n\t\tparent::onsubmit($data);\n\t\treturn $this->main();\n\t}\n\n\tfunction onfilter() {\n\t\treturn $this->main();\n\t}\n\n\tfunction onerror() {\n\t\treturn $this->main();\n\t}\n\n}\n\n?>\n", "\n<h2>{$panelstrings.head}</h2>\n\n\n\n\n{draft_block}\n{if isset($draft_list)}\n\t<div id=\"admin-drafts\">\n\t\t<p>{$lang.admin.entry.list.drafts}</p>\n\t\t<ul>\n\t\t{foreach from=$draft_list key=draftid item=draft}\n\t\t\t<li>\n\t\t\t\t<a href=\"admin.php?p=entry&amp;entry={$draftid}&amp;action=write\">{$draft|truncate:50}</a>\n\t\t\t</li>\n\t\t{/foreach}\n\t\t</ul>\n\t</div>\n{/if}\n{/draft_block}\n\n\n\n{include file=\"shared:errorlist.tpl\"}\n\n<p>{$panelstrings.descr}</p>\n\n<form method=\"get\" action=\"{$smarty.server.PHP_SELF}?p=entry\">\n<p> <input type=\"hidden\" name=\"p\" value=\"entry\" /> </p>\n<fieldset><legend>{$panelstrings.filter}</legend>\n\t<select name=\"category\" class=\"alignleft\">\n\t<option label=\"{$lang.admin.entry.list.nofilter}\" value=\"all\">{$panelstrings.nofilter}</option>\n\t{*html_options options=$lang.entry.flags.short selected=$smarty.request.cat*}\n\t{if isset($smarty.request.category)} {assign var=category value=$smarty.request.category} {else} {assign var=category value=\"\"}{/if}\n\t{html_options options=$categories_all selected=$category}\n\t</select>\n\t{html_submit name='filter' id='filter' class=\"alignright\" value=$panelstrings.filterbtn}\n</fieldset>\n\n</form>\n\n{entry_block}\n\n<table class=\"entrylist\">\n<thead><tr>{*<th>{$panelstrings.sel}</th>*}\n<th>{$panelstrings.date}</th>\n<th class=\"main-cell\">{$panelstrings.title}</th>\n<!-- <th>{$panelstrings.author}</th> -->\n<th>{$panelstrings.comms}</th>\n<th>{$panelstrings.action}</th></tr></thead>\n<tbody>\n{entry}\n<tr>\n<td>{$id|entry_idtotime|date_format:\"`$fp_config.locale.dateformatshort`, `$fp_config.locale.timeformat`\"}</td>\n<td class=\"main-cell\">\n{if in_array('draft',$categories)}\n(<em class=\"entry-flag\">{$lang.entry.flags.short.draft}</em>)\n{/if}\n<a class=\"link-general\" \nhref=\"{$panel_url|action_link:write}&amp;entry={$id}\">\n{$subject|truncate:70} \n</a>\n</td>\n<!-- <td>{$author}</td> -->\n<td><a class=\"link-general\" \nhref=\"{$panel_url|action_link:commentlist}&amp;entry={$id}\">\n{* Compatibility with pre-0.702 *}\n{$commentcount|default:$comments}</a></td>\n<td>\n<a class=\"link-general\" \nhref=\"{$id|link:post_link}\">\n{$panelstrings.act_view}\n</a>\n<a class=\"link-general\" \nhref=\"{$panel_url|action_link:write}&amp;entry={$id}\">\n{$panelstrings.act_edit}\n</a>\n<a class=\"link-delete\" \nhref=\"{$panel_url|action_link:delete}&amp;entry={$id}\">\n{$panelstrings.act_del}\n</a>\n\n</td>\n\n</tr>\n\n{/entry}\n\n</tbody></table>\n\n<div class=\"navigation\">\n\t{prevpage admin=yes}\n\t{nextpage admin=yes}\n</div>\n{/entry_block}\n\n\n"], "fixing_code": ["<?php\n\n/**\n * edit entry panel\n *\n * Type:\n * Name:\n * Date:\n * Purpose:\n * Input:\n *\n * @author NoWhereMan <real_nowhereman at users dot sf dot com>\n *        \n */\n\n// require (ADMIN_DIR . 'panels/entry/shared.entry.form.php');\n\n// ---------------------------------------------------------------------\n// utils\n// ---------------------------------------------------------------------\nfunction smarty_function_flag_classes($params, &$smarty) {\n\t$flags = entry_flags_get();\n\t($active_flags = array_intersect($smarty->getTemplateVars('categories'), $flags));\n\treturn implode(' ', $active_flags);\n}\n\nclass admin_entry_list extends AdminPanelActionValidated {\n\n\tvar $actionname = 'list';\n\n\tfunction setup() {\n\t\t$this->smarty->registerPlugin('function', 'flag_classes', 'smarty_function_flag_classes');\n\t}\n\n\tfunction main() {\n\t\tparent::main();\n\t\t// $smarty = $this->smarty;\n\n\t\t// parameters for the list\n\t\t// start offset and count (now defaults to 8...)\n\n\t\t$this->smarty->assign('formtarget', strip_tags($_SERVER ['PHP_SELF']));\n\t\t$this->smarty->assign('categories_all', entry_categories_get('defs'));\n\t\t$this->smarty->assign('saved_flags', entry_flags_get());\n\n\t\t$defcount = 8; // <-- no magic numbers! todo: add config option?\n\n\t\tglobal $fpdb;\n\n\t\tif (!empty($_REQUEST ['entry'])) {\n\t\t\tutils_redirect('admin.php?p=entry&action=write&entry=' . $_REQUEST ['entry']);\n\t\t}\n\n\t\tisset($_REQUEST ['m']) ? $params ['m'] = $_REQUEST ['m'] : null;\n\t\tisset($_REQUEST ['y']) ? $params ['y'] = $_REQUEST ['y'] : null;\n\t\t// $params['start'] = isset($_REQUEST['start'])? $_REQUEST['start'] : 0;\n\t\t$params ['count'] = isset($_REQUEST ['count']) ? $_REQUEST ['count'] : $defcount;\n\t\t$params ['page'] = isset($_REQUEST ['paged']) ? $_REQUEST ['paged'] : 1;\n\t\tisset($_REQUEST ['category']) ? $params ['category'] = $_REQUEST ['category'] : $params ['category'] = 'all';\n\t\t$params ['fullparse'] = false;\n\t\t$params ['comments'] = true;\n\t\t$fpdb->query($params);\n\n\t\treturn 0;\n\t}\n\n\tfunction onsubmit($data = null) {\n\t\tparent::onsubmit($data);\n\t\treturn $this->main();\n\t}\n\n\tfunction onfilter() {\n\t\treturn $this->main();\n\t}\n\n\tfunction onerror() {\n\t\treturn $this->main();\n\t}\n\n}\n\n?>\n", "\n<h2>{$panelstrings.head}</h2>\n\n\n\n\n{draft_block}\n{if isset($draft_list)}\n\t<div id=\"admin-drafts\">\n\t\t<p>{$lang.admin.entry.list.drafts}</p>\n\t\t<ul>\n\t\t{foreach from=$draft_list key=draftid item=draft}\n\t\t\t<li>\n\t\t\t\t<a href=\"admin.php?p=entry&amp;entry={$draftid}&amp;action=write\">{$draft|truncate:50}</a>\n\t\t\t</li>\n\t\t{/foreach}\n\t\t</ul>\n\t</div>\n{/if}\n{/draft_block}\n\n\n\n{include file=\"shared:errorlist.tpl\"}\n\n<p>{$panelstrings.descr}</p>\n\n<form method=\"get\" action=\"{$formtarget}?p=entry\">\n<p> <input type=\"hidden\" name=\"p\" value=\"entry\" /> </p>\n<fieldset><legend>{$panelstrings.filter}</legend>\n\t<select name=\"category\" class=\"alignleft\">\n\t<option label=\"{$lang.admin.entry.list.nofilter}\" value=\"all\">{$panelstrings.nofilter}</option>\n\t{*html_options options=$lang.entry.flags.short selected=$smarty.request.cat*}\n\t{if isset($smarty.request.category)} {assign var=category value=$smarty.request.category} {else} {assign var=category value=\"\"}{/if}\n\t{html_options options=$categories_all selected=$category}\n\t</select>\n\t{html_submit name='filter' id='filter' class=\"alignright\" value=$panelstrings.filterbtn}\n</fieldset>\n\n</form>\n\n{entry_block}\n\n<table class=\"entrylist\">\n<thead><tr>{*<th>{$panelstrings.sel}</th>*}\n<th>{$panelstrings.date}</th>\n<th class=\"main-cell\">{$panelstrings.title}</th>\n<!-- <th>{$panelstrings.author}</th> -->\n<th>{$panelstrings.comms}</th>\n<th>{$panelstrings.action}</th></tr></thead>\n<tbody>\n{entry}\n<tr>\n<td>{$id|entry_idtotime|date_format:\"`$fp_config.locale.dateformatshort`, `$fp_config.locale.timeformat`\"}</td>\n<td class=\"main-cell\">\n{if in_array('draft',$categories)}\n(<em class=\"entry-flag\">{$lang.entry.flags.short.draft}</em>)\n{/if}\n<a class=\"link-general\" \nhref=\"{$panel_url|action_link:write}&amp;entry={$id}\">\n{$subject|truncate:70} \n</a>\n</td>\n<!-- <td>{$author}</td> -->\n<td><a class=\"link-general\" \nhref=\"{$panel_url|action_link:commentlist}&amp;entry={$id}\">\n{* Compatibility with pre-0.702 *}\n{$commentcount|default:$comments}</a></td>\n<td>\n<a class=\"link-general\" \nhref=\"{$id|link:post_link}\">\n{$panelstrings.act_view}\n</a>\n<a class=\"link-general\" \nhref=\"{$panel_url|action_link:write}&amp;entry={$id}\">\n{$panelstrings.act_edit}\n</a>\n<a class=\"link-delete\" \nhref=\"{$panel_url|action_link:delete}&amp;entry={$id}\">\n{$panelstrings.act_del}\n</a>\n\n</td>\n\n</tr>\n\n{/entry}\n\n</tbody></table>\n\n<div class=\"navigation\">\n\t{prevpage admin=yes}\n\t{nextpage admin=yes}\n</div>\n{/entry_block}\n\n\n"], "buggy_code_start_loc": [41, 28], "buggy_code_end_loc": [50, 29], "fixing_code_start_loc": [42, 28], "fixing_code_end_loc": [53, 29], "type": "CWE-79", "message": "A vulnerability classified as problematic has been found in FlatPress. This affects an unknown part of the file admin/panels/entry/admin.entry.list.php of the component Admin Area. The manipulation leads to cross site scripting. It is possible to initiate the attack remotely. The name of the patch is 229752b51025e678370298284d42f8ebb231f67f. It is recommended to apply a patch to fix this issue. The associated identifier of this vulnerability is VDB-216999.", "other": {"cve": {"id": "CVE-2022-4820", "sourceIdentifier": "cna@vuldb.com", "published": "2022-12-28T21:15:10.703", "lastModified": "2023-01-06T02:21:24.193", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability classified as problematic has been found in FlatPress. This affects an unknown part of the file admin/panels/entry/admin.entry.list.php of the component Admin Area. The manipulation leads to cross site scripting. It is possible to initiate the attack remotely. The name of the patch is 229752b51025e678370298284d42f8ebb231f67f. It is recommended to apply a patch to fix this issue. The associated identifier of this vulnerability is VDB-216999."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV30": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 3.5, "baseSeverity": "LOW"}, "exploitabilityScore": 2.1, "impactScore": 1.4}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:flatpress:flatpress:-:*:*:*:*:*:*:*", "matchCriteriaId": "CD0F1B05-3B1E-4527-9AE3-488578A1ADCE"}]}]}], "references": [{"url": "https://github.com/flatpressblog/flatpress/commit/229752b51025e678370298284d42f8ebb231f67f", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/flatpressblog/flatpress/issues/180", "source": "cna@vuldb.com", "tags": ["Issue Tracking", "Patch", "Third Party Advisory"]}, {"url": "https://vuldb.com/?ctiid.216999", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}, {"url": "https://vuldb.com/?id.216999", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/flatpressblog/flatpress/commit/229752b51025e678370298284d42f8ebb231f67f"}}